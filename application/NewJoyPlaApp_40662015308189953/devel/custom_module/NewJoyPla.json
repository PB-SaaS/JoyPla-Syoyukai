{
 "id": "custom_module_mst39775",
 "name": "NewJoyPla",
 "comment": "",
 "kind": "dir",
 "parent_path": "/",
 "children":  [
    {
   "id": "custom_module_mst39777",
   "name": "DelAcceptance",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\n/**\r\n * DelAcceptance\r\n * 検収書削除\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n * \r\n */\r\nclass DelAcceptance{\r\n    \r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_ReceivingHDB';\r\n    //private $childDatabase = 'NJ_ReceivingDB';\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n\t/**\r\n\t * 削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $receivingHId 検収書履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return boolean True or False\r\n\t * @todo \r\n\t */\r\n    public function delete(string $receivingHId,string $authKey){\r\n    \tif($receivingHId == ''){\r\n    \t\treturn false;\r\n    \t}\r\n        $delete = $this->deleteReceivingHistoryDB($receivingHId,$authKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n\t/**\r\n\t * DBにリクエストを送る関数\r\n     * \r\n\t * @access public\r\n\t * @param string $receivingHId 検収書履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return array \r\n\t */\r\n    private function deleteReceivingHistoryDB(string $receivingHId,string $authKey){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('receivingHId',$receivingHId);\r\n\t\t$this->spiralDataBase->addSearchCondition('authKey',$authKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39778",
   "name": "DelBilling",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * DelBilling\r\n * 物品請求履歴削除\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\nclass DelBilling{\r\n\r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_BillingHDB';\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n    /**\r\n\t * 削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $billingNumber 物品請求履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return boolean True or False\r\n\t * @todo \r\n\t */\r\n    public function delete(string $billingNumber,string $authKey){\r\n        $delete = $this->deleteBillingHistoryDB($billingNumber,$authKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n\t/**\r\n\t * DBにリクエストを送る関数\r\n     * \r\n\t * @access public\r\n\t * @param string $billingNumber 物品請求履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return array \r\n\t */\r\n    private function deleteBillingHistoryDB(string $billingNumber,string $authKey){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('billingNumber',$billingNumber);\r\n\t\t$this->spiralDataBase->addSearchCondition('billingAuthKey',$authKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39780",
   "name": "DelInventory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * DelInventory\r\n * 棚卸履歴削除\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\n\r\nclass DelInventory{\r\n\r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_InventoryEDB';\r\n    private $childDatabase = 'NJ_InventoryHDB';\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    /**\r\n\t * 棚卸終了伝票削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $inventoryEndId 棚卸終了伝票番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return boolean\r\n\t */\r\n    public function deleteEndHistory(string $inventoryEndId,string $authKey){\r\n        $delete = $this->deleteInventoryEDB($inventoryEndId,$authKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n\t * 棚卸終了伝票削除関数\r\n     * \r\n\t * @access private\r\n\t * @param string $inventoryEndId 棚卸終了伝票番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return array\r\n\t */\r\n    private function deleteInventoryEDB(string $inventoryEndId,string $authKey){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryEndId',$inventoryEndId);\r\n\t\t$this->spiralDataBase->addSearchCondition('invEndAuthKey',$authKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n\r\n    /**\r\n\t * 部署別棚卸伝票削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $inventoryHId 部署別棚卸伝票番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return boolean\r\n\t */\r\n    public function deleteHistory(string $inventoryHId,string $authKey){\r\n        $delete = $this->deleteInventoryHDB($inventoryHId,$authKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n\t * 部署別棚卸伝票削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $inventoryHId 部署別棚卸伝票番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return array\r\n\t */\r\n    private function deleteInventoryHDB(string $inventoryHId,string $authKey){\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryHId',$inventoryHId);\r\n\t\t$this->spiralDataBase->addSearchCondition('invHAuthKey',$authKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39781",
   "name": "DelPayout",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * DelPayout\r\n * 払出伝票削除\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\nclass DelPayout{\r\n\r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_PayoutHDB';\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    /**\r\n\t * 削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $payoutHistoryId 払出履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return boolean\r\n\t */\r\n    public function delete(string $payoutHistoryId,string $authKey){\r\n        $delete = $this->deletePayoutHistoryDB($payoutHistoryId,$authKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n\t * 削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $payoutHistoryId 払出履歴番号\r\n\t * @param string $authKey 変更削除キー\r\n\t * @return array\r\n\t */\r\n    private function deletePayoutHistoryDB(string $payoutHistoryId,string $authKey){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('payoutHistoryId',$payoutHistoryId);\r\n\t\t$this->spiralDataBase->addSearchCondition('payoutAuthKey',$authKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39779",
   "name": "DeleteOrder",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * DeleteOrder\r\n * 注文書削除\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\n\r\nclass DeleteOrder{\r\n\r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    /**\r\n\t * 削除関数\r\n     * \r\n\t * @access public\r\n\t * @param string $orderNum 発注書番号\r\n\t * @param string $orderAuthKey 変更削除キー\r\n\t * @return boolean\r\n\t */\r\n    public function delete(string $orderNum,string $orderAuthKey){\r\n\r\n        $delete = $this->deleteOrderHistoryDB($orderNum,$orderAuthKey);\r\n        if($delete['code'] != 0){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    /**\r\n\t * 削除関数\r\n     * \r\n\t * @access private\r\n\t * @param string $orderNum 発注書番号\r\n\t * @param string $orderAuthKey 変更削除キー\r\n\t * @return array\r\n\t */\r\n    private function deleteOrderHistoryDB(string $orderNum,string $orderAuthKey){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderNumber',$orderNum);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderAuthKey',$orderAuthKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39782",
   "name": "GetCardInfo",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * GetCardInfo\r\n * 単票情報取得\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\n\r\nclass GetCardInfo{\r\n\r\n    private $spiralDataBase;\r\n\r\n    /**\r\n\t * コンストラクタ\r\n     * \r\n\t * @access public\r\n\t * @param SpiralDataBase\r\n\t */\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    /**\r\n     * 取得関数\r\n     * \r\n     * @access public\r\n     * @param string $database データベースタイトル\r\n     * @param string $cardID レコードID\r\n     * @param string ...$fields(可変) フィールド名\r\n     * @return array\r\n     */\r\n    public function select(string $database, string $cardID , string ...$fields){\r\n        $this->spiralDataBase->setDataBase($database);\r\n        $this->spiralDataBase->addSelectFields(...$fields);\r\n        $this->spiralDataBase->addSearchCondition('id',$cardID);\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39783",
   "name": "GetDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n/**\r\n * GetDistributor\r\n * 卸業者情報取得\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\n\r\nclass GetDistributor{\r\n\r\n  private $spiralDataBase;\r\n  private $userInfo;\r\n  \r\n  private $distributorDB = 'NJ_distributorDB';\r\n\r\n  /**\r\n   * コンストラクタ\r\n   * \r\n   * @access public\r\n   * @param SpiralDataBase\r\n   * @param UserInfo\r\n   */\r\n  public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n    $this->spiralDataBase = $spiralDataBase;\r\n    $this->userInfo = $userInfo;\r\n  }\r\n\r\n  /**\r\n\t * 卸業者情報取得\r\n   * \r\n\t * @access public\r\n\t * @return array\r\n\t */\r\n  public function getDistributor(){\r\n    $result = $this->getDistributorDB();\r\n    return $result;\r\n  }\r\n\r\n  /**\r\n\t * 卸業者情報取得\r\n   * \r\n\t * @access private\r\n\t * @return array\r\n\t */\r\n  private function getDistributorDB(){\r\n    $this->spiralDataBase->setDataBase($this->distributorDB);\r\n    $this->spiralDataBase->addSelectFields('distributorName','distributorId');\r\n    $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n    \r\n    return $this->spiralDataBase->doSelect();\r\n  }\r\n\r\n  /**\r\n\t * 卸業者情報取得\r\n   * \r\n\t * @access public\r\n　 * @param string $distributorId 卸業者ID\r\n\t * @return array\r\n\t */\r\n  public function getMyDistributor(string $distributorId){\r\n    $result = $this->getMyDistributorDB($distributorId);\r\n    return $result;\r\n  }\r\n\r\n  /**\r\n\t * 卸業者情報取得\r\n   * \r\n\t * @access private\r\n　 * @param string $distributorId 卸業者ID\r\n\t * @return array\r\n\t */\r\n  private function getMyDistributorDB(string $distributorId){\r\n    $this->spiralDataBase->setDataBase($this->distributorDB);\r\n    $this->spiralDataBase->addSelectFields('distributorName','distributorId');\r\n    $this->spiralDataBase->addSearchCondition('distributorId',$distributorId);\r\n    return $this->spiralDataBase->doSelect();\r\n  }\r\n}"
  },
    {
   "id": "custom_module_mst39784",
   "name": "GetDivision",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\n/**\r\n * GetDivision\r\n * 部署情報取得\r\n *\r\n * @package App\\Api\r\n * @since PHP7.2\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n */\r\nclass GetDivision{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $database = 'NJ_divisionDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $divisionId = null){\r\n        $result = $this->selectDivision($divisionId);\r\n\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n\r\n        $result2 = $this->selectStore();\r\n\r\n        if($result2['code'] != 0){\r\n            return $result2;\r\n        }\r\n\r\n        return array('store' => $result2['data'] , 'division'=> $result['data'] ,'code'=>$result2['code']);\r\n    }\r\n\r\n    private function selectDivision(string $divisionId = null){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields('registrationTime','divisionId','hospitalId','divisionName','divisionType','deleteFlag');\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('divisionType','2');\r\n        if($divisionId != null){\r\n            $this->spiralDataBase->addSearchCondition('divisionId',$divisionId);\r\n        }\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n    private function selectStore(){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields('registrationTime','divisionId','hospitalId','divisionName','divisionType','deleteFlag');\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('divisionType','1');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39785",
   "name": "GetHospitalData",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetHospitalData{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $database = 'NJ_HospitalDB';\r\n\r\n    private $column = array('registrationTime','updateTime','hospitalId','hospitalName','postalCode','prefectures','address','phoneNumber','faxNumber','tenantId','name','nameKana','mailAddress','contactAddress','plan','receivingTarget','function1','function2','function3','function4','function5','function6','function7','function8','registerableNum','authKey');\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $hospitalId = null){\r\n        $result = $this->selectHospitalDB($hospitalId);\r\n\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n\r\n        $result['data'] = $this->spiralDataBase->arrayToNameArray($result['data'],$this->column);\r\n        return $result;\r\n    }\r\n\r\n    private function selectHospitalDB(string $hospitalId = null){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->column);\r\n        if($hospitalId == null){\r\n            $hospitalId = $this->userInfo->getHospitalId();\r\n        }\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$hospitalId);\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39786",
   "name": "GetHospitalUserCount",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetHospitalUserCount{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $database = 'NJ_HUserDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $hospitalId = null){\r\n        return $this->getHospitalUser($hospitalId);\r\n    }\r\n\r\n    private function getHospitalUser(string $hospitalId = null){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        if($hospitalId == null){\r\n            $hospitalId = $this->userInfo->getHospitalId();\r\n        }\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$hospitalId);\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39787",
   "name": "GetInventory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetInventory{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n    private $InventoryHId;\r\n    \r\n    private $database = 'NJ_InventoryDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n    \r\n    public function getInventory(string $InventoryEId){\r\n        \r\n        return $this->getInventoryDB($InventoryEId);\r\n    }\r\n    \r\n    private function getInventoryDB(string $InventoryEId){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('inventoryEndId',$InventoryEId);\r\n        $this->spiralDataBase->addSelectFields('id','divisionId','inventryNum','inHospitalItemId');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39788",
   "name": "GetInventoryEndHistoryId",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetInventoryEndHistoryId{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n    private $InventoryEId;\r\n    private $InventoryHId;\r\n    \r\n    private $EndHistoryDatabase = 'NJ_InventoryEDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n    \r\n    public function getInventoryEndHistoryId(){\r\n\r\n\t\t$result = $this->getInventoryEndHistory();\r\n\t\tif($result['code'] != 0){\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif($result['count'] == 0){\r\n\t\t\t$this->InventoryEId = $this->makeInventoryEId();\r\n\t\t\t$makeInventoryEData = $this->makeInventoryEData();\r\n\t\t\t$result = $this->regInventoryEDB($makeInventoryEData);\r\n\t\t\tif($result['code'] != \"0\"){\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn $this->InventoryEId;\r\n\t\t}\r\n\r\n\t\t$this->InventoryEId = $result['data'][0][1];\r\n        \r\n        return $this->InventoryEId;\r\n    }\r\n    \r\n    private function getInventoryEndHistory(){\r\n        $this->spiralDataBase->setDataBase($this->EndHistoryDatabase);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('inventoryStatus','1');\r\n        $this->spiralDataBase->addSelectFields('id','inventoryEndId');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\t\r\n\tprivate function makeInventoryEId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '09';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n\t}\r\n\t\r\n\tprivate function makeInventoryEData(){\r\n\t\t$insertData = array(\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\"value\" => \"now\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"inventoryEndId\",\r\n\t\t\t\t\"value\" => $this->InventoryEId\r\n\t\t\t),\r\n\t\t);\r\n\t\treturn $insertData;\r\n    }\r\n    \r\n\tprivate function regInventoryEDB(array $insertData){\r\n        $this->spiralDataBase->setDataBase($this->EndHistoryDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39789",
   "name": "GetInventoryHistoryId",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetInventoryHistoryId{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n    private $InventoryHId;\r\n    \r\n    private $historyDatabase = 'NJ_InventoryHDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n    \r\n    public function getInventoryHistoryId(string $divisionId , string $InventoryEId){\r\n        $this->setDivisionId($divisionId);\r\n        \r\n\t\t$result = $this->getInventoryHistory($InventoryEId);\r\n\t\tif($result['code'] != '0'){\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif($result['count'] == 0){\r\n\t\t\t$this->InventoryHId = $this->makeInventoryHId();\r\n\t\t\t$makeInventoryHData = $this->makeInventoryHData($InventoryEId);\r\n            $result = $this->regInventoryHDB($makeInventoryHData);\r\n\t\t\tif($result['code'] != '0'){\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n            \r\n\t\t} else {\r\n\t\t\t$this->InventoryHId = $result['data'][0][1];\r\n\t\t}\r\n\r\n        return $this->InventoryHId;\r\n    }\r\n    \r\n    private function getInventoryHistory(string $InventoryEId){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('divisionId',$this->divisionId);\r\n        $this->spiralDataBase->addSearchCondition('inventoryEndId',$InventoryEId);\r\n        $this->spiralDataBase->addSelectFields('id','inventoryHId');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n\tprivate function makeInventoryHId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '08';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n\t}\r\n\r\n    private function makeInventoryHData(string $InventoryEId){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"updateTime\",\r\n\t\t\t\t\t\"value\" => \"\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"inventoryHId\",\r\n\t\t\t\t\t\"value\" => $this->InventoryHId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"inventoryEndId\",\r\n\t\t\t\t\t\"value\" => $InventoryEId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"divisionId\",\r\n\t\t\t\t\t\"value\" => $this->divisionId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => '0'\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"totalAmount\",\r\n\t\t\t\t\t\"value\" => '0'\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function regInventoryHDB(array $insertData){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n        //return $this->spiralDataBase->doInsert($insertData);\r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function makeInventory(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','inventoryHId','inHospitalItemId','hospitalId','price','calculatingStock','inventryNum','inventryAmount');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPid => $data){\r\n\t\t\tif( (int)$data['countNum']  > 0 ){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t'',\r\n\t\t\t\t$this->InventoryHId,\r\n\t\t\t\t$inHPid,\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']),\r\n\t\t\t\t'',\r\n\t\t\t\t(int)$data['countNum'],\r\n\t\t\t\t(string)(number_format(str_replace(',', '', $data['kakaku']) / $data['irisu'], 2) * (int)$data['countNum']),\r\n\t\t\t\t$data['irisu'],\r\n\t\t\t\t$data['unit'],\r\n\t\t\t\t$data['itemUnit'],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n    \r\n    private function regInventory(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','updateTime','inventoryHId','inHospitalItemId','hospitalId','price','calculatingStock','inventryNum','inventryAmount');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function totalAmount(array $array){\r\n    \t$num = 0;\r\n    \tforeach($array as $data){\r\n    \t\t$num += $data[8];\r\n    \t}\r\n    \treturn $num;\r\n\t}\r\n\t\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39790",
   "name": "GetItemBilling",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetItemBilling{\r\n    \r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $billingNumber;\r\n\r\n    private $database = 'billingDetail';\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function getItemBilling(string $billingNumber){\r\n        $this->billingNumber = $billingNumber;\r\n        return $this->getBillingDb();\r\n    }\r\n\r\n    private function getBillingDb(){ \r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields('registrationTime','updateTime','inHospitalItemId','billingNumber','price','billingQuantity','billingAmount','hospitalId','divisionId','itemId','itemName','itemCode','itemStandard','itemJANCode','quantityUnit','makerName','itemUnit','quantity');\r\n        $this->spiralDataBase->addSearchCondition('billingNumber',$this->billingNumber);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39791",
   "name": "GetItemPayout",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetItemPayout{\r\n    \r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $payoutNumber;\r\n\r\n    private $database = 'payoutData';\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function getItemPayout(string $payoutNumber){\r\n        $this->payoutNumber = $payoutNumber;\r\n        return $this->getPayoutDb();\r\n    }\r\n\r\n    private function getPayoutDb(){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields('registrationTime','payoutHistoryId','price','itemId','itemName','itemCode','itemStandard','itemJANCode','quantityUnit','payoutQuantity','payoutAmount','itemUnit','quantity','makerName','inHospitalItemId','payoutCount','payoutLabelCount','distributorId','catalogNo','labelId');\r\n        $this->spiralDataBase->addSearchCondition('payoutHistoryId',$this->payoutNumber);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39792",
   "name": "GetItemReceipt",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetItemReceipt{\r\n    \r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $receivingHId;\r\n\r\n    private $database = 'receivingdata';\r\n\r\n    private $column = array('id','makerName','itemName','itemCode','itemStandard','quantity','quantityUnit','itemUnit','itemJANCode','orderQuantity','receivingCount','orderCNumber','inHospitalItemId','totalReturnCount','receivingNumber','price','labelId');\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase,\\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function getItemReceipt(string $receivingHId){\r\n        $this->receivingHId = $receivingHId;\r\n        $result = $this->getReceivingDb();\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n\r\n        $result['data'] = $this->spiralDataBase->arrayToNameArray($result['data'],$this->column);\r\n        return $result;\r\n    }\r\n\r\n    private function getReceivingDb(){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->column);\r\n        $this->spiralDataBase->addSearchCondition('receivingHId',$this->receivingHId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39793",
   "name": "GetOrderItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetOrderItems{\r\n\r\n    private $spiralDataBase;\r\n    private $database = 'hacchuShouhin';\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    public function select(string $orderNumber , string ...$fields){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields(...$fields);\r\n        $this->spiralDataBase->addSortField('id' , 'asc' );\r\n        $this->spiralDataBase->addSearchCondition('orderNumber',$orderNumber);\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39794",
   "name": "GetReceivingHistory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetReceivingHistory{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $database = 'receiptHDB';\r\n\r\n    private $column = array('registrationTime','distributorName','distributorId','orderHistoryId','hospitalName','postalCode','prefectures','address','phoneNumber','ordererUserName','authKey','orderAuthKey','divisionId');\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $receivingHId){\r\n        $result = $this->getReceivingHistory($receivingHId);\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n        $result['data'] = $this->spiralDataBase->arrayToNameArray($result['data'],$this->column);\r\n        return $result;\r\n    }\r\n\r\n    private function getReceivingHistory(string $receivingHId){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSearchCondition('receivingHId',$receivingHId);\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->column);\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39795",
   "name": "GetReceivingItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetReceivingItems{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $database = 'NJ_ReceivingDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(array $itemids){\r\n        return $this->getReceivingItems($itemids);\r\n    }\r\n\r\n    private function getReceivingItems(array $itemids){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        foreach($itemids as $itemid){\r\n            $this->spiralDataBase->addSearchCondition('orderCNumber',$itemid,'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('registrationTime','orderCNumber','receivingCount','receivingHId');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39796",
   "name": "GetReturnData",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetReturnData{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $database = 'returnData';\r\n    private $column = array('id','makerName','itemName','itemCode','itemStandard','quantity','quantityUnit','itemUnit','itemJANCode','price','returnCount','returnPrice','receivingCount');\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $returnHistoryID){\r\n        $result =  $this->getReturnItems($returnHistoryID);\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n\r\n        $result['data'] = $this->spiralDataBase->arrayToNameArray($result['data'],$this->column);\r\n        return $result;\r\n    }\r\n\r\n    private function getReturnItems(string $returnHistoryID){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSearchCondition('returnHistoryID',$returnHistoryID);\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->column);\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39797",
   "name": "GetStock",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetStock{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n    \r\n    private $database = 'stockManagement';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n\r\n    public function getStockData(array $items,string $divisionId){\r\n\t\t$this->setDivisionId($divisionId);\r\n\t\treturn $this->getStockDB($items);\r\n\t}\r\n    \r\n    private function getStockDB(array $items){\r\n    \t$this->spiralDataBase->setDataBase($this->database);\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\t$this->spiralDataBase->addSearchCondition('divisionId',$this->divisionId);\r\n\t\tforeach($items as $inHpitemId => $record){\r\n\t\t\t$this->spiralDataBase->addSearchCondition('inHospitalItemId',$inHpitemId,'=','or');\r\n\t\t}\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','stockQuantity','rackName','divisionName','constantByDiv','distributorName');\r\n\t\treturn $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39798",
   "name": "GetTenantData",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetTenantData{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $database = 'NJ_TenantAdminDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(string $tenantId = null){\r\n        $result = $this->selectTenantAdminDB($tenantId);\r\n\r\n        if($result['code'] != 0){\r\n            return $result;\r\n        }\r\n\r\n        $result['data'] = $this->spiralDataBase->arrayToNameArray($result['data'],array('tenantId','tenantKind'));\r\n        return $result;\r\n    }\r\n\r\n    private function selectTenantAdminDB(string $tenantId = null){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSelectFields('tenantId','tenantKind');\r\n        if($tenantId == null){\r\n            $tenantId = $this->userInfo->getTenantId();\r\n        }\r\n        $this->spiralDataBase->addSearchCondition('tenantId',$tenantId);\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39799",
   "name": "GetUnordered",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GetUnordered{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $database = 'NJ_OrderHDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function select(){\r\n        return $this->getUnordered();\r\n    }\r\n\r\n    private function getUnordered(){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('orderStatus',1);\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39800",
   "name": "GoodsBillingMonthlyReport",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass GoodsBillingMonthlyReport{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $billingDB = 'NJ_BillingDB';\r\n    private $inHPItemDB = 'NJ_inHPItemDB';\r\n\r\n    private $billingData = array();\r\n    private $inHPItemData = array();\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function dataSelect(string $startMonth = null,string $endMonth = null,string $divisionId = null,string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        $this->setBillingDBSearch($startMonth,$endMonth,$divisionId);\r\n        $this->billingData = $this->getBillingDB();\r\n        if($this->billingData['code'] != '0'){\r\n            //var_dump($this->billingData);\r\n            return $this->billingData;\r\n        }\r\n        if($this->billingData['count'] == '0'){\r\n            return array('data'=>array(),'count'=>'0','totalAmount' => '0');\r\n        }\r\n        $this->setInHPItemDBSearch($itemName,$itemCode,$itemStandard,$page,$maxCount);\r\n        $this->inHPItemData = $this->getInHPItemDB();\r\n        if($this->inHPItemData['code'] != '0'){\r\n            //var_dump($this->inHPItemData);\r\n            return $this->inHPItemData;\r\n        }\r\n        return $this->makeGoodsBillingMonthlyReport();\r\n    }\r\n\r\n    private function setStartMonth(string $startMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$startMonth,'>=','and');\r\n    }\r\n\r\n    private function setEndMonth(string $endMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$endMonth,'<=','and');\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->spiralDataBase->addSearchCondition('divisionId',$divisionId,'=','and');\r\n    }\r\n\r\n    private function setItemName(string $itemName){\r\n        $this->spiralDataBase->addSearchCondition('itemName',\"%$itemName%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setItemCode(string $itemCode){\r\n        $this->spiralDataBase->addSearchCondition('itemCode',\"%$itemCode%\",'LIKE','and');\r\n    }\r\n\r\n    private function setItemStandard(string $itemStandard){\r\n        $this->spiralDataBase->addSearchCondition('itemStandard',\"%$itemStandard%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setPage(int $page){\r\n        $this->spiralDataBase->setPage($page);\r\n    }\r\n\r\n    private function setMaxCount(int $maxCount){\r\n        $this->spiralDataBase->setLinesPerPage($maxCount);\r\n    }\r\n\r\n    private function setBillingDBSearch(string $startMonth = null,string $endMonth = null,string $divisionId = null){\r\n        \r\n        if($startMonth != null){\r\n            $this->setStartMonth($startMonth);\r\n        }\r\n        if($endMonth != null){\r\n            $this->setEndMonth(date(\"Y-m-d\",strtotime($endMonth . \"+1 day\")));\r\n        }\r\n        if($divisionId != null){\r\n            $this->setDivisionId($divisionId);\r\n        }\r\n    }\r\n\r\n    private function setInHPItemDBSearch(string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        if($itemName != null){\r\n            $this->setItemName($itemName);\r\n        }\r\n        if($itemCode != null){\r\n            $this->setItemCode($itemCode);\r\n        }\r\n        if($itemStandard != null){\r\n            $this->setItemStandard($itemStandard);\r\n        }\r\n        if($page != null){\r\n            $this->setPage($page);\r\n        }\r\n        if($maxCount != null){\r\n            $this->setMaxCount($maxCount);\r\n        }\r\n    }\r\n\r\n    private function makeGoodsBillingMonthlyReport(){\r\n        $result = array();\r\n        foreach($this->inHPItemData['data'] as $inHPitem){\r\n            $billingQuantity = $this->getBillingQuantity($inHPitem[1]);\r\n            $result['data'][] = array(\r\n                'id' => $inHPitem[0],\r\n                'inHospitalItemId' => $inHPitem[1],\r\n                'makerName' => $inHPitem[2],\r\n                'itemName' => $inHPitem[3],\r\n                'itemCode' => $inHPitem[4],\r\n                'itemStandard' => $inHPitem[5],\r\n                'minPrice' => $inHPitem[6],\r\n                'billingQuantity' => $billingQuantity,\r\n                'totalAmount' => $inHPitem[6] * $billingQuantity,\r\n                'quantityUnit'=> $inHPitem[7]\r\n            );\r\n        }\r\n        $result['count'] = $this->inHPItemData['count'];\r\n        $result['totalAmount'] = $this->getTotalAmount();\r\n        return $result;\r\n    }\r\n\r\n    private function getBillingQuantity(string $inHospitalItemId){\r\n        $billingQuantity = 0;\r\n        foreach($this->billingData['data'] as $billingItem){\r\n            if($inHospitalItemId == $billingItem[0]){\r\n                $billingQuantity = $billingQuantity + $billingItem[1];\r\n            }\r\n        }\r\n        return $billingQuantity;\r\n    }\r\n\r\n    private function getBillingDB(){\r\n        $this->spiralDataBase->setDataBase($this->billingDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','billingQuantity','registrationTime','billingAmount');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n    private function getInHPItemDB(){\r\n        $this->spiralDataBase->setDataBase($this->inHPItemDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        foreach($this->billingData['data'] as $record){\r\n            $this->spiralDataBase->addSearchCondition('inHospitalItemId',$record[0],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','minPrice','quantityUnit');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n    private function getTotalAmount(){\r\n        $billingQuantity = 0;\r\n        foreach($this->billingData['data'] as $billingItem){\r\n            $billingQuantity += (float)$billingItem[3];\r\n        }\r\n        return $billingQuantity;\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39801",
   "name": "LabelSearchBarcode",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass LabelSearchBarcode{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $InHPItemDB = 'itemInHospitalDB';\r\n\r\n    private $fields = array(\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"quantity\",\"price\",\"itemJANCode\",\"distributorName\",\"inHospitalItemId\",\"quantityUnit\",\"itemUnit\",\"distributorId\",\"labelId\");\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n/**\r\n * $items = array(\r\n * \"maker\" => \"小林製薬\",\r\n * \"shouhinName\" => \"オードムーゲローション\",\r\n * \"code\" => \"10180951\",\r\n * \"kikaku\" => \"規格\",\r\n * \"irisu\" => \"10\",\r\n * \"kakaku\" => \"35\",\r\n * \"jan\" => \"4987072035306\",\r\n * \"oroshi\" => \"株式会社パイプドビッツ\",\r\n * \"recordId\" => \"00000002\",\r\n * \"unit\" => \"個\",\r\n * \"itemUnit\" => \"箱\",\r\n * \"distributorId\" => \"pipedbits\"\r\n * );\r\n * \r\n */\r\n    public function search(string $systemCheckId){\r\n        if(preg_match('/^1/', $systemCheckId) && strlen($systemCheckId) == 14){\r\n            //旧JoyPlaのラベル\r\n            $labelId = substr($systemCheckId, 1 , 5);\r\n            $customQuantity = substr($systemCheckId, 10 , 4);\r\n            \r\n            $result = $this->getInHPItemDBForOldLabel($labelId);\r\n\r\n            if($result['code'] != '0'){\r\n                return $result;\r\n            }\r\n\r\n            if($result['count'] == '0'){\r\n                return array('code' => '1' , 'data' => array(),'message' => $result['message'] ,'count' => \"0\");\r\n            }\r\n\r\n            $data = $this->remakeData($result['data'][0],$customQuantity);\r\n            \r\n            return array('code' => $result['code'] , 'data' => $data ,'message' => $result['message'] ,'count' => $result['count']);\r\n        }\r\n        if(preg_match('/^01/', $systemCheckId) && strlen($systemCheckId) == 14){\r\n            $inHospitalItemId = substr($systemCheckId, 2 , 8);\r\n            $customQuantity = substr($systemCheckId, 10 , 4);\r\n\r\n            $result = $this->getInHPItemDB($inHospitalItemId);\r\n            \r\n            if($result['code'] != '0'){\r\n                return $result;\r\n            }\r\n\r\n            if($result['count'] == '0'){\r\n                return array('code' => $result['code']  , 'data' => array(),'message' => $result['message'] ,'count' => \"0\");\r\n            }\r\n\r\n            $data = $this->remakeData($result['data'][0],$customQuantity);\r\n            \r\n            return array('code' => $result['code'] , 'data' => $data ,'message' => $result['message'] ,'count' => $result['count']);\r\n        }\r\n        return array('code' => '1' , 'data' => array(),'message' => \"no data\" ,'count' => \"0\");\r\n    }\r\n\r\n    private function getInHPItemDBForOldLabel(string $labelId){\r\n        $this->spiralDataBase->setDataBase($this->InHPItemDB);\r\n        $this->spiralDataBase->addSearchCondition('labelId',$labelId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->fields);\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n    private function getInHPItemDB(string $labelId){\r\n        $this->spiralDataBase->setDataBase($this->InHPItemDB);\r\n        //$this->spiralDataBase->addSearchCondition('inHospitalItemId',$inHospitalItemId);\r\n        $this->spiralDataBase->addSearchCondition('labelId',$labelId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFieldsToArray($this->fields);\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n\r\n    private function remakeData(array $resultData,String $customQuantity){\r\n        $items = array(\r\n            \"maker\" => $resultData[0],\r\n            \"shouhinName\" => $resultData[1],\r\n            \"code\" => $resultData[2],\r\n            \"kikaku\" => $resultData[3],\r\n            \"irisu\" => $resultData[4],\r\n            \"kakaku\" => $resultData[5],\r\n            \"jan\" => $resultData[6],\r\n            \"oroshi\" => $resultData[7],\r\n            \"recordId\" => $resultData[8],\r\n            \"unit\" => $resultData[9],\r\n            \"itemUnit\" => $resultData[10],\r\n            \"distributorId\" => $resultData[11],\r\n            \"count\" => (int)$customQuantity,//ラベルの入数\r\n            \"labelId\" => $resultData[12]\r\n            );\r\n\r\n        return $items;\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39802",
   "name": "OrderMonthlyReport",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass OrderMonthlyReport{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $OrderDB = 'NJ_OrderDB';\r\n    private $inHPItemDB = 'itemInHospitalDB';\r\n \r\n    private $OrderData = array();\r\n    private $inHPItemData = array();\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function dataSelect(string $startMonth = null,string $endMonth = null,string $distributorId = null,string $divisionId = null,string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        $this->setOrderDBSearch($startMonth,$endMonth,$divisionId);\r\n        $this->OrderData = $this->getOrderDB();\r\n        if($this->OrderData['code'] != '0'){\r\n            //var_dump($this->OrderData);\r\n            return $this->OrderData;\r\n        }\r\n        if($this->OrderData['count'] == '0'){\r\n            return array('data'=>array(),'count'=>'0','totalAmount' => '0');\r\n        }\r\n        $this->setInHPItemDBSearch($itemName,$itemCode,$itemStandard,$page,$maxCount,$distributorId);\r\n        $this->inHPItemData = $this->getInHPItemDB();\r\n        if($this->inHPItemData['code'] != '0'){\r\n            //var_dump($this->inHPItemData);\r\n            return $this->inHPItemData;\r\n        }\r\n        return $this->makeOrderMonthlyReport();\r\n    }\r\n\r\n    private function setStartMonth(string $startMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$startMonth,'>=','and');\r\n    }\r\n\r\n    private function setEndMonth(string $endMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$endMonth,'<=','and');\r\n    }\r\n\r\n    private function setDistributorId(string $distributorId){\r\n        $this->spiralDataBase->addSearchCondition('distributorId',$distributorId,'=','and');\r\n    }\r\n\r\n    private function setItemName(string $itemName){\r\n        $this->spiralDataBase->addSearchCondition('itemName',\"%$itemName%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setItemCode(string $itemCode){\r\n        $this->spiralDataBase->addSearchCondition('itemCode',\"%$itemCode%\",'LIKE','and');\r\n    }\r\n\r\n    private function setItemStandard(string $itemStandard){\r\n        $this->spiralDataBase->addSearchCondition('itemStandard',\"%$itemStandard%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setPage(int $page){\r\n        $this->spiralDataBase->setPage($page);\r\n    }\r\n\r\n    private function setMaxCount(int $maxCount){\r\n        $this->spiralDataBase->setLinesPerPage($maxCount);\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->spiralDataBase->addSearchCondition('divisionId',$divisionId,'=','and');\r\n    }\r\n\r\n    private function setOrderDBSearch(string $startMonth = null,string $endMonth = null,string $divisionId = null){\r\n        \r\n        if($startMonth != null){\r\n            $this->setStartMonth($startMonth);\r\n        }\r\n        if($endMonth != null){\r\n            $this->setEndMonth(date(\"Y-m-d\",strtotime($endMonth . \"+1 day\")));\r\n        }\r\n        if($divisionId != null){\r\n            $this->setDivisionId($divisionId);\r\n        }\r\n    }\r\n\r\n    private function setInHPItemDBSearch(string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null,string $distributorId = null){\r\n        if($itemName != null){\r\n            $this->setItemName($itemName);\r\n        }\r\n        if($itemCode != null){\r\n            $this->setItemCode($itemCode);\r\n        }\r\n        if($itemStandard != null){\r\n            $this->setItemStandard($itemStandard);\r\n        }\r\n        if($page != null){\r\n            $this->setPage($page);\r\n        }\r\n        if($maxCount != null){\r\n            $this->setMaxCount($maxCount);\r\n        }\r\n        if($distributorId != null){\r\n            $this->setDistributorId($distributorId);\r\n        }\r\n    }\r\n\r\n    private function makeOrderMonthlyReport(){\r\n        $result = array();\r\n        foreach($this->inHPItemData['data'] as $inHPitem){\r\n            $orderQuantity = $this->getOrderQuantity($inHPitem[1]);\r\n            $result['data'][] = array(\r\n                'id' => $inHPitem[0],\r\n                'inHospitalItemId' => $inHPitem[1],\r\n                'makerName' => $inHPitem[2],\r\n                'itemName' => $inHPitem[3],\r\n                'itemCode' => $inHPitem[4],\r\n                'itemStandard' => $inHPitem[5],\r\n                'price' => $inHPitem[6],\r\n                'orderQuantity' => $orderQuantity,\r\n                'totalAmount' => $inHPitem[6] * $orderQuantity,\r\n                'itemUnit'=> $inHPitem[7],\r\n                'distributorName'=> $inHPitem[8]\r\n            );\r\n        }\r\n        $result['count'] = $this->inHPItemData['count'];\r\n        $result['totalAmount'] = $this->getTotalAmount();\r\n        return $result;\r\n    }\r\n\r\n    private function getOrderQuantity(string $inHospitalItemId){\r\n        $orderQuantity = 0;\r\n        foreach($this->OrderData['data'] as $orderItem){\r\n            if($inHospitalItemId == $orderItem[0]){\r\n                $orderQuantity = $orderQuantity + $orderItem[1];\r\n            }\r\n        }\r\n        return $orderQuantity;\r\n    }\r\n\r\n    private function getTotalAmount(){\r\n        $orderQuantity = 0;\r\n        foreach($this->OrderData['data'] as $orderItem){\r\n            $orderQuantity += (float)$orderItem[3];\r\n        }\r\n        return $orderQuantity;\r\n    }\r\n\r\n    private function getOrderDB(){\r\n        $this->spiralDataBase->setDataBase($this->OrderDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','orderQuantity','registrationTime','orderPrice');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n    private function getInHPItemDB(){\r\n        $this->spiralDataBase->setDataBase($this->inHPItemDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        foreach($this->OrderData['data'] as $record){\r\n            $this->spiralDataBase->addSearchCondition('inHospitalItemId',$record[0],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','price','itemUnit','distributorName');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39803",
   "name": "OroshiSearchBarcode",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass OroshiSearchBarcode{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    private $spiralTable;\r\n    \r\n    private $orderHDB = 'NJ_OrderHDB';\r\n\r\n    private $receivingHDB = 'NJ_ReceivingHDB';\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase,\\App\\Lib\\SpiralTable $spiralTable, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->spiralTable = $spiralTable;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    /**\r\n     * $cardTitles = array(\r\n     * '02' => url,\r\n     * '03_unorder' => url,\r\n     * '03_order' => url,\r\n     * '04' => url,\r\n     * '05' => url,\r\n     * '06' => url,\r\n     * '08' => url,\r\n     * )\r\n     */\r\n    public function search(string $systemCheckId,string $jsessonId,string $myAreaTitle,array $cardTitles){\r\n        \r\n        if(preg_match('/^03/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //注文書\r\n            $result = $this->getOrderHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => '1','urls'=>array(),'message'=>'no urls');\r\n            }\r\n            \r\n            $cardTitle = '';\r\n            \r\n            if(isset($cardTitles['03_order'])){\r\n                $cardTitle = $cardTitles['03_order'];\r\n            }\r\n\r\n            if($result['data'][0][1] == '1' && isset($cardTitles['03_unorder'])){\r\n                return array('code' => '1','urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            return $result;\r\n        }\r\n        if(preg_match('/^04/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //検収書\r\n            $result = $this->getReceivingHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => '1','urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $cardTitle = '';\r\n            if(isset($cardTitles['04'])){\r\n                $cardTitle = $cardTitles['04'];\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n\r\n            return $result;\r\n        }\r\n        return array('code' => '99','urls'=>array(),'message'=>'no urls');\r\n    } \r\n\r\n    private function getOrderHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->orderHDB);\r\n        $this->spiralDataBase->addSearchCondition('orderNumber',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('distributorId',$this->userInfo->getDistributorId());\r\n        $this->spiralDataBase->addSelectFields('id','orderStatus');\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n    \r\n    private function getReceivingHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->receivingHDB);\r\n        $this->spiralDataBase->addSearchCondition('receivingHId',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('distributorId',$this->userInfo->getDistributorId());\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n    \r\n    private function getUrl(string $id,string $jsessonId,string $myAreaTitle,string $cardTitle){\r\n        $this->spiralTable->setJsessionid($jsessonId);\r\n        $this->spiralTable->setMyAreaTitle($myAreaTitle);\r\n        $this->spiralTable->setCardTitle($cardTitle);\r\n        $this->spiralTable->addIds($id);\r\n        return $this->spiralTable->getCardUrls();\r\n    }\r\n\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39804",
   "name": "PayoutMonthlyReport",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass PayoutMonthlyReport{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $PayoutDB = 'NJ_PayoutDB';\r\n    private $inHPItemDB = 'itemInHospitalDB';\r\n\r\n    private $PayoutData = array();\r\n    private $inHPItemData = array();\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function dataSelect(string $startMonth = null,string $endMonth = null,string $divisionId = null,string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        $this->setPayoutDBSearch($startMonth,$endMonth,$divisionId);\r\n        $this->PayoutData = $this->getPayoutDB();\r\n        if($this->PayoutData['code'] != '0'){\r\n            //var_dump($this->PayoutData);\r\n            return $this->PayoutData;\r\n        }\r\n        if($this->PayoutData['count'] == '0'){\r\n            return array('data'=>array(),'count'=>'0','totalAmount' => '0');\r\n        }\r\n        $this->setInHPItemDBSearch($itemName,$itemCode,$itemStandard,$page,$maxCount);\r\n        $this->inHPItemData = $this->getInHPItemDB();\r\n        if($this->inHPItemData['code'] != '0'){\r\n            //var_dump($this->inHPItemData);\r\n            return $this->inHPItemData;\r\n        }\r\n        return $this->makePayoutMonthlyReport();\r\n    }\r\n\r\n    private function setStartMonth(string $startMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$startMonth,'>=','and');\r\n    }\r\n\r\n    private function setEndMonth(string $endMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$endMonth,'<=','and');\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->spiralDataBase->addSearchCondition('targetDivisionId',$divisionId,'=','and');\r\n    }\r\n\r\n    private function setItemName(string $itemName){\r\n        $this->spiralDataBase->addSearchCondition('itemName',\"%$itemName%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setItemCode(string $itemCode){\r\n        $this->spiralDataBase->addSearchCondition('itemCode',\"%$itemCode%\",'LIKE','and');\r\n    }\r\n\r\n    private function setItemStandard(string $itemStandard){\r\n        $this->spiralDataBase->addSearchCondition('itemStandard',\"%$itemStandard%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setPage(int $page){\r\n        $this->spiralDataBase->setPage($page);\r\n    }\r\n\r\n    private function setMaxCount(int $maxCount){\r\n        $this->spiralDataBase->setLinesPerPage($maxCount);\r\n    }\r\n\r\n    private function setPayoutDBSearch(string $startMonth = null,string $endMonth = null,string $divisionId = null){\r\n        \r\n        if($startMonth != null){\r\n            $this->setStartMonth($startMonth);\r\n        }\r\n        if($endMonth != null){\r\n            $this->setEndMonth(date(\"Y-m-d\",strtotime($endMonth . \"+1 day\")));\r\n        }\r\n        if($divisionId != null){\r\n            $this->setDivisionId($divisionId);\r\n        }\r\n    }\r\n\r\n    private function setInHPItemDBSearch(string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        if($itemName != null){\r\n            $this->setItemName($itemName);\r\n        }\r\n        if($itemCode != null){\r\n            $this->setItemCode($itemCode);\r\n        }\r\n        if($itemStandard != null){\r\n            $this->setItemStandard($itemStandard);\r\n        }\r\n        if($page != null){\r\n            $this->setPage($page);\r\n        }\r\n        if($maxCount != null){\r\n            $this->setMaxCount($maxCount);\r\n        }\r\n    }\r\n\r\n    private function makePayoutMonthlyReport(){\r\n        $result = array();\r\n        foreach($this->inHPItemData['data'] as $inHPitem){\r\n            $payoutQuantity = $this->getPayoutQuantity($inHPitem[1]);\r\n            $result['data'][] = array(\r\n                'id' => $inHPitem[0],\r\n                'inHospitalItemId' => $inHPitem[1],\r\n                'makerName' => $inHPitem[2],\r\n                'itemName' => $inHPitem[3],\r\n                'itemCode' => $inHPitem[4],\r\n                'itemStandard' => $inHPitem[5],\r\n                'minPrice' => $inHPitem[6],\r\n                'payoutQuantity' => $payoutQuantity,\r\n                'totalAmount' => $inHPitem[6] * $payoutQuantity,\r\n                'quantityUnit'=> $inHPitem[7]\r\n            );\r\n        }\r\n        $result['count'] = $this->inHPItemData['count'];\r\n        $result['totalAmount'] = $this->getTotalAmount();\r\n        return $result;\r\n    }\r\n\r\n    private function getPayoutQuantity(string $inHospitalItemId){\r\n        $payoutQuantity = 0;\r\n        foreach($this->PayoutData['data'] as $payoutItem){\r\n            if($inHospitalItemId == $payoutItem[0]){\r\n                $payoutQuantity = $payoutQuantity + $payoutItem[1];\r\n            }\r\n        }\r\n        return $payoutQuantity;\r\n    }\r\n\r\n    private function getPayoutDB(){\r\n        $this->spiralDataBase->setDataBase($this->PayoutDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','payoutQuantity','registrationTime','payoutAmount');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n    private function getInHPItemDB(){\r\n        $this->spiralDataBase->setDataBase($this->inHPItemDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        foreach($this->PayoutData['data'] as $record){\r\n            $this->spiralDataBase->addSearchCondition('inHospitalItemId',$record[0],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','minPrice','quantityUnit');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n    private function getTotalAmount(){\r\n        $payoutQuantity = 0;\r\n        foreach($this->PayoutData['data'] as $payoutItem){\r\n            $payoutQuantity += (float)$payoutItem[3];\r\n        }\r\n        return $payoutQuantity;\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39805",
   "name": "ReceivingMonthlyReport",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass ReceivingMonthlyReport{\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    \r\n    private $ReceivingDB = 'NJ_ReceivingDB';\r\n    private $inHPItemDB = 'itemInHospitalDB';\r\n\r\n    private $ReceivingData = array();\r\n    private $inHPItemData = array();\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function dataSelect(string $startMonth = null,string $endMonth = null,string $distributorId = null,string $divisionId = null,string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null){\r\n        $this->setReceivingDBSearch($startMonth,$endMonth,$divisionId);\r\n        $this->ReceivingData = $this->getReceivingDB();\r\n        if($this->ReceivingData['code'] != '0'){\r\n            //var_dump($this->ReceivingData);\r\n            return $this->ReceivingData;\r\n        }\r\n        if($this->ReceivingData['count'] == '0'){\r\n            return array('data'=>array(),'count'=>'0','totalAmount' => '0');\r\n        }\r\n        $this->setInHPItemDBSearch($itemName,$itemCode,$itemStandard,$page,$maxCount,$distributorId);\r\n        $this->inHPItemData = $this->getInHPItemDB();\r\n        if($this->inHPItemData['code'] != '0'){\r\n            //var_dump($this->inHPItemData);\r\n            return $this->inHPItemData;\r\n        }\r\n        return $this->makeReceivingMonthlyReport();\r\n    }\r\n\r\n    private function setStartMonth(string $startMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$startMonth,'>=','and');\r\n    }\r\n\r\n    private function setEndMonth(string $endMonth){\r\n        $this->spiralDataBase->addSearchCondition('registrationTime',$endMonth,'<=','and');\r\n    }\r\n\r\n    private function setDistributorId(string $distributorId){\r\n        $this->spiralDataBase->addSearchCondition('distributorId',$distributorId,'=','and');\r\n    }\r\n\r\n    private function setItemName(string $itemName){\r\n        $this->spiralDataBase->addSearchCondition('itemName',\"%$itemName%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setItemCode(string $itemCode){\r\n        $this->spiralDataBase->addSearchCondition('itemCode',\"%$itemCode%\",'LIKE','and');\r\n    }\r\n\r\n    private function setItemStandard(string $itemStandard){\r\n        $this->spiralDataBase->addSearchCondition('itemStandard',\"%$itemStandard%\",'LIKE','and');\r\n    }\r\n    \r\n    private function setPage(int $page){\r\n        $this->spiralDataBase->setPage($page);\r\n    }\r\n\r\n    private function setMaxCount(int $maxCount){\r\n        $this->spiralDataBase->setLinesPerPage($maxCount);\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->spiralDataBase->addSearchCondition('divisionId',$divisionId,'=','and');\r\n    }\r\n\r\n\r\n    private function setReceivingDBSearch(string $startMonth = null,string $endMonth = null,string $divisionId = null){\r\n        \r\n        if($startMonth != null){\r\n            $this->setStartMonth($startMonth);\r\n        }\r\n        if($endMonth != null){\r\n            $this->setEndMonth(date(\"Y-m-d\",strtotime($endMonth . \"+1 day\")));\r\n        }\r\n        if($divisionId != null){\r\n            $this->setDivisionId($divisionId);\r\n        }\r\n    }\r\n\r\n    private function setInHPItemDBSearch(string $itemName = null,string $itemCode = null,string $itemStandard = null,int $page = null,int $maxCount = null,string $distributorId = null){\r\n        if($itemName != null){\r\n            $this->setItemName($itemName);\r\n        }\r\n        if($itemCode != null){\r\n            $this->setItemCode($itemCode);\r\n        }\r\n        if($itemStandard != null){\r\n            $this->setItemStandard($itemStandard);\r\n        }\r\n        if($page != null){\r\n            $this->setPage($page);\r\n        }\r\n        if($maxCount != null){\r\n            $this->setMaxCount($maxCount);\r\n        }\r\n        if($distributorId != null){\r\n            $this->setDistributorId($distributorId);\r\n        }\r\n    }\r\n\r\n    private function makeReceivingMonthlyReport(){\r\n        $result = array();\r\n        foreach($this->inHPItemData['data'] as $inHPitem){\r\n            $receivingCount = $this->getReceivingQuantity($inHPitem[1]);\r\n            $returnCount = $this->getReturnCount($inHPitem[1]);\r\n            $result['data'][] = array(\r\n                'id' => $inHPitem[0],\r\n                'inHospitalItemId' => $inHPitem[1],\r\n                'makerName' => $inHPitem[2],\r\n                'itemName' => $inHPitem[3],\r\n                'itemCode' => $inHPitem[4],\r\n                'itemStandard' => $inHPitem[5],\r\n                'price' => $inHPitem[6],\r\n                'receivingCount' => $receivingCount,\r\n                'totalAmount' => $inHPitem[6] * $receivingCount,\r\n                'itemUnit'=> $inHPitem[7],\r\n                'distributorName'=> $inHPitem[8],\r\n                'totalReturnCount'=> $returnCount,\r\n            );\r\n        }\r\n        $result['count'] = $this->inHPItemData['count'];\r\n        $result['totalAmount'] = $this->getTotalAmount();\r\n        return $result;\r\n    }\r\n\r\n    private function getReceivingQuantity(string $inHospitalItemId){\r\n        $ReceivingQuantity = 0;\r\n        foreach($this->ReceivingData['data'] as $ReceivingItem){\r\n            if($inHospitalItemId == $ReceivingItem[0]){\r\n                $ReceivingQuantity = $ReceivingQuantity + (int)$ReceivingItem[1];\r\n            }\r\n        }\r\n        return $ReceivingQuantity;\r\n    }\r\n\r\n    private function getReturnCount(string $inHospitalItemId){\r\n        $ReturnCount = 0;\r\n        foreach($this->ReceivingData['data'] as $ReceivingItem){\r\n            if($inHospitalItemId == $ReceivingItem[0]){\r\n                $ReturnCount = $ReturnCount + (int)$ReceivingItem[4];\r\n            }\r\n        }\r\n        return $ReturnCount;\r\n    }\r\n\r\n    private function getTotalAmount(){\r\n        $ReceivingQuantity = 0;\r\n        foreach($this->ReceivingData['data'] as $ReceivingItem){\r\n            $ReceivingQuantity += (float)$ReceivingItem[3];\r\n        }\r\n        return $ReceivingQuantity;\r\n    }\r\n\r\n    private function getReceivingDB(){\r\n        $this->spiralDataBase->setDataBase($this->ReceivingDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','receivingCount','registrationTime','receivingPrice','totalReturnCount');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n    private function getInHPItemDB(){\r\n        $this->spiralDataBase->setDataBase($this->inHPItemDB);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        foreach($this->ReceivingData['data'] as $record){\r\n            $this->spiralDataBase->addSearchCondition('inHospitalItemId',$record[0],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','price','itemUnit','distributorName');\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39806",
   "name": "RegComment",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegComment{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $topicId;\r\n\tprivate $authKey;\r\n\t\r\n    private $database = 'NJ_comment';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n\t}\r\n\t\r\n\tpublic function regComment(String $topicId,String $authKey,array $commentData){\r\n\t\t$commentData = $this->requestUrldecode($commentData);\r\n\r\n\t\t$this->topicId = $topicId;\r\n\t\t$this->authKey = $authKey;\r\n\r\n\t\treturn $this->insertComment($commentData);\r\n\t}\r\n\r\n    private function insertComment(array $commentData){\r\n\t\t$insertData = array(\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\"value\" => \"now\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"topicId\",\r\n\t\t\t\t\"value\" => $this->topicId\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"name\",\r\n\t\t\t\t\"value\" => $commentData['name']\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"comment\",\r\n\t\t\t\t\"value\" => $commentData['comment']\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"name\" => \"authKey\",\r\n\t\t\t\t\"value\" => $this->authKey\r\n\t\t\t)\r\n\t\t);\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n        //return $this->spiralDataBase->doInsert($insertData);\r\n        //throw new Exception(\"エラーハンドリング\");\r\n\t}\r\n\t\r\n\tprivate function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39807",
   "name": "RegGoodsBilling",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegGoodsBilling{\r\n\r\n    private $spiralDataBase;\r\n    private $divisionId;\r\n    private $billingId;\r\n    private $userInfo;\r\n    \r\n    \r\n    private $historyDatabase = 'NJ_BillingHDB';\r\n    private $childDatabase = 'NJ_BillingDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n    }\r\n    \r\n    public function register(array $array, string $divisionId){\r\n\t\t$array = $this->requestUrldecode($array);\r\n        $this->setDivisionId($divisionId);\r\n    \t$this->billingId = $this->makeGoodsBillingId();\r\n  \r\n    \t$childData = $this->makeGoodsBilling($array);\r\n    \t\r\n    \tif(count($childData) === 0){\r\n    \t\treturn false;\r\n    \t}\r\n  \r\n    \t$historyData = $this->makeGoodsBillingHistory($childData);\r\n    \t\r\n    \t$response = $this->regGoodsBillingHistory($historyData);\r\n    \tif($response['code'] != 0){\r\n    \t\treturn false;\r\n        }\r\n        \r\n    \t$responseChild = $this->regGoodsBilling($childData);\r\n    \tif($responseChild['code'] != 0){\r\n    \t\treturn false;\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    \r\n    private function makeGoodsBillingHistory(array $array){\r\n\t\tif(count($array) == 0){\r\n\t\t\treturn array();\r\n\t\t}\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"updateTime\",\r\n\t\t\t\t\t\"value\" => \"\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"billingNumber\",\r\n\t\t\t\t\t\"value\" => $this->billingId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"divisionId\",\r\n\t\t\t\t\t\"value\" => $this->divisionId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => count($array)\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"totalAmount\",\r\n\t\t\t\t\t\"value\" => $this->totalAmount($array)\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function regGoodsBillingHistory(array $insertData){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n        //return $this->spiralDataBase->doInsert($insertData);\r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function makeGoodsBilling(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','inHospitalItemId','billingNumber','price','billingQuantity','billingAmount','hospitalId','divisionId');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPid => $data){\r\n\t\t\tif( (int)$data['countNum']  > 0 ){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t'',\r\n\t\t\t\t$inHPid,\r\n\t\t\t\t$this->billingId,\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']),\r\n\t\t\t\t(int)$data['countNum'],\r\n\t\t\t\t(string)(number_format(str_replace(',', '', $data['kakaku']) / $data['irisu'], 2) * (int)$data['countNum']),\r\n                $this->userInfo->getHospitalId(),\r\n                $this->divisionId,\r\n\t\t\t\t$data['irisu'],\r\n\t\t\t\t$data['unit'],\r\n\t\t\t\t$data['itemUnit'],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n    \r\n    private function regGoodsBilling(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','updateTime','inHospitalItemId','billingNumber','price','billingQuantity','billingAmount','hospitalId','divisionId','quantity','quantityUnit','itemUnit');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function makeGoodsBillingId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '02';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function totalAmount(array $array){\r\n    \t$num = 0;\r\n    \tforeach($array as $data){\r\n    \t\t$num += $data[6];\r\n    \t}\r\n    \treturn $num;\r\n\t}\r\n\t\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39808",
   "name": "RegInHPitemsBlukIns",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInHPitemsBlukIns{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $database = \"NJ_inHPItemDB\";\r\n    private $mstDatabase = \"NJ_itemDB\";\r\n    private $distributorDB = 'NJ_distributorDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function blukinsert(array $itemList){\r\n        $itemList = $this->requestUrldecode($itemList);\r\n        $mstItems = $this->getMstData($itemList);\r\n\r\n        if($mstItems['code'] != \"0\"){\r\n            return $mstItems;\r\n        }\r\n\r\n        $result = $this->checkItems($itemList,$mstItems['data']);\r\n        if($result['result'] != true){\r\n            return array('code' => '99', \"message\" => 'not regist itemsId: '.$result['id']);\r\n        }\r\n\r\n        $distributor = $this->getDistributorDB();\r\n        if($distributor['code'] != \"0\"){\r\n            return $distributor;\r\n        }\r\n\r\n        $result = $this->checkDistributor($itemList,$distributor['data']);\r\n        if($result['result'] != true){\r\n            return array('code' => '99', \"message\" => 'not regist distributorId: '.$result['id']);\r\n        }\r\n\r\n        $itemList = $this->remake($itemList);\r\n\r\n        return $this->regItems($itemList);\r\n    }\r\n\r\n    private function checkItems(array $itemList,array $mstItems){\r\n        $remakeMstItems = array();\r\n        foreach( $mstItems as $record ){\r\n            $remakeMstItems[] = $record[0];//itemId\r\n        }\r\n\r\n        foreach($itemList as $record){\r\n            if(!in_array($record[0], $remakeMstItems)){\r\n                //配列に存在しない商品IDは登録できない\r\n                return array('result' => false , 'id' => $record[0]);\r\n            }\r\n        }\r\n        return array('result' => true);\r\n    }\r\n\r\n    private function checkDistributor(array $itemList,array $distributor){\r\n        $remakeDistributor = array();\r\n        foreach( $distributor as $record ){\r\n            $remakeDistributor[] = $record[0];\r\n        }\r\n\r\n        foreach($itemList as $record){\r\n            if(!in_array($record[1], $remakeDistributor)){\r\n                //配列に存在しない卸業者IDは登録できない\r\n                return array('result' => false , 'id' => $record[1]);\r\n            }\r\n        }\r\n        return array('result' => true);\r\n    }\r\n\r\n    private function remake(array $itemList){\r\n        foreach($itemList as &$record){\r\n            $record[] = $this->userInfo->getHospitalId();\r\n        }\r\n        return $itemList;\r\n    }\r\n\r\n    private function getMstData(array $itemList){\r\n        $this->spiralDataBase->setDataBase($this->mstDatabase);\r\n        $this->spiralDataBase->addSelectFields('itemId','tenantId');\r\n        foreach($itemList as $item){\r\n            $this->spiralDataBase->addSearchCondition('itemId',$item[0],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSearchCondition('tenantId',$this->userInfo->getTenantId());\r\n        return $this->spiralDataBase->doSelectLoop();\r\n    }\r\n\r\n    private function getDistributorDB(){\r\n\t\t$this->spiralDataBase->setDataBase($this->distributorDB);\r\n\t\t$this->spiralDataBase->addSelectFields('distributorId','distributorName');\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\t\r\n\t\treturn $this->spiralDataBase->doSelect();\r\n\t}\r\n\r\n    private function regItems(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array(\"itemId\",\"distributorId\",\"catalogNo\",\"serialNo\",\"quantity\",\"itemUnit\",\"medicineCategory\",\"homeCategory\",\"notUsedFlag\",\"notice\",\"labelId\",\"hospitalId\");\r\n        \r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        \r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n        \r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}\r\n \r\n"
  },
    {
   "id": "custom_module_mst39809",
   "name": "RegInventory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInventory{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n    private $InventoryEId;\r\n    private $InventoryHId;\r\n    \r\n    private $database = 'NJ_stocktakingTR';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\t\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n\r\n    public function register(array $array, string $divisionId, string $InventoryEId , string $InventoryHId){\r\n\t\t$array = $this->requestUrldecode($array);\r\n\t\t$this->setDivisionId($divisionId);\r\n\t\t$makeInventory = $this->makeInventory($array,$InventoryEId,$InventoryHId);\r\n\r\n\t\t$result = $this->regInventory($makeInventory);\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n    private function makeInventory(array $array, string $InventoryEId , string $InventoryHId){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','inventoryHId','inHospitalItemId','hospitalId','price','calculatingStock','inventryNum','inventryAmount');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPid => $data){\r\n\t\t\tif( (int)$data['countNum']  > 0 ){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t$InventoryEId,\r\n\t\t\t\t$InventoryHId,\r\n\t\t\t\t$inHPid,\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t\t$this->divisionId,\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']),\r\n\t\t\t\t'',\r\n\t\t\t\t(int)$data['countNum'],\r\n\t\t\t\t(string)(str_replace(',', '', $data['kakaku']) / $data['irisu'] * (int)$data['countNum']),\r\n\t\t\t\t$data['irisu'],\r\n\t\t\t\t$data['unit'],\r\n\t\t\t\t$data['itemUnit'],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n    \r\n    private function regInventory(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','inventoryEndId','inventoryHId','inHospitalItemId','hospitalId','divisionId','price','calculatingStock','inventryNum','inventryAmount','quantity','quantityUnit','itemUnit');\r\n\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n\t\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39810",
   "name": "RegInventoryEndHistory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInventoryEndHistory{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n\t\r\n\tprivate $totalAmount;\r\n\tprivate $itemsNumber;\r\n    \r\n    private $historyDatabase = 'NJ_InventoryEDB';\r\n    private $childDatabase = 'NJ_InventoryDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\t\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n\r\n    public function updateHistory(string $InventoryEId){\r\n\r\n\t\t$inventoryDB = $this->getInventoryDB($InventoryEId);\r\n\t\tif($inventoryDB['code'] != \"0\"){\r\n\t\t\tvar_dump($inventoryHDB);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t$this->totalAmount = $this->sumInventoryAmount($inventoryDB['data']);\r\n\t\t$this->itemsNumber = $this->sumItemsNumber($inventoryDB['data']);\r\n\t\t\r\n\t\t$result = $this->updateInventoryEndHistoryDB($InventoryEId);\r\n\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate function sumInventoryAmount(array $array){\r\n\t\t$sum = 0;\r\n\t\tforeach($array as $record){\r\n\t\t\t$sum = $sum + $record[1];\r\n\t\t}\r\n\r\n\t\treturn $sum;\r\n\t}\r\n\r\n\tprivate function sumItemsNumber(array $array){\r\n\t\t$sum = 0;\r\n\t\t$items = array();\r\n\t\tforeach($array as $record){\r\n\t\t\tif(in_array($record[0], $items)){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t$items[] = $record[0];\r\n\t\t\t$sum ++;\r\n\t\t}\r\n\r\n\t\treturn $sum;\r\n\t}\r\n/*\r\n\tprivate function getInventoryHDB(string $inventoryEId){\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n        $this->spiralDataBase->addSearchCondition('inventoryEndId',$inventoryEId);\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\t$this->spiralDataBase->setGroupByFields('inHospitalItemId');\r\n        $this->spiralDataBase->addSelectFields('hospitalId','itemsNumber','totalAmount','inventoryEndId','inHospitalItemId');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n*/\r\n\tprivate function getInventoryDB(string $inventoryEId){\r\n\t\t$this->spiralDataBase->setDataBase($this->childDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryEndId',$inventoryEId);\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\t$this->spiralDataBase->addSelectFields('inHospitalItemId','inventryAmount');\r\n\t\treturn $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n\r\n\tprivate function updateInventoryEndHistoryDB(string $inventoryEId){\r\n\t\t$this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryEndId',$inventoryEId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array('name'=> 'itemsNumber','value'=>$this->itemsNumber),array('name'=> 'totalAmount','value'=>$this->totalAmount)));\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39811",
   "name": "RegInventoryFinish",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInventoryFinish{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n\tprivate $totalAmount;\r\n\tprivate $itemsNumber;\r\n    \r\n    private $historyDatabase = 'NJ_InventoryEDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\r\n    public function updateHistory(string $InventoryEId,string $authKey){\r\n\r\n\t\t$result = $this->updateInventoryEndHistoryDB($InventoryEId,$authKey);\r\n\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n    \r\n\tprivate function updateInventoryEndHistoryDB(string $inventoryEId,string $authKey){\r\n\t\t$this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryEndId',$inventoryEId);\r\n\t\t$this->spiralDataBase->addSearchCondition('invEndAuthKey',$authKey);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array('name'=> 'inventoryStatus','value'=>'2'),array('name'=> 'inventoryTime','value'=>'now')));\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39812",
   "name": "RegInventoryHistory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInventoryHistory{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n\t\r\n\t\r\n\tprivate $totalAmount;\r\n    \r\n    private $historyDatabase = 'NJ_InventoryHDB';\r\n    private $childDatabase = 'NJ_InventoryDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\t\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n\r\n    public function updateHistory(string $InventoryHId){\r\n\r\n\t\t$inventoryDB = $this->getInventoryDB($InventoryHId);\r\n\r\n\t\t$this->totalAmount = $this->sumInventryAmount($inventoryDB['data']);\r\n\t\t\r\n\t\t$result = $this->updateInventoryHistoryDB($InventoryHId, $inventoryDB['data']);\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate function sumInventryAmount(array $array){\r\n\t\t$sum = 0;\r\n\t\tforeach($array as $record){\r\n\t\t\t$sum = $sum + (float)$record[1];\r\n\t\t}\r\n\r\n\t\treturn $sum;\r\n\t}\r\n\r\n\tprivate function getInventoryDB(string $inventoryHId){\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n        $this->spiralDataBase->addSearchCondition('inventoryHId',$inventoryHId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','inventryAmount');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n\t\r\n\tprivate function updateInventoryHistoryDB(string $inventoryHId, array $array){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('inventoryHId',$inventoryHId);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array('name'=> 'itemsNumber','value'=>count($array)),array('name'=> 'totalAmount','value'=>$this->totalAmount)));\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39813",
   "name": "RegInventoryTrdb",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegInventoryTrdb{\r\n    \r\n    private $spiralDataBase;\r\n    private $divisionId;\r\n    private $billingId;\r\n    private $userInfo;\r\n    \r\n    private $TransactionDatabase = 'NJ_inventoryTRDB';\r\n\r\n    \r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function orderCount(array $array, string $divisionId, string $pattern){\r\n    \t$array = $this->requestUrldecode($array);\r\n\r\n        $regData = $this->makeRegData($array,$divisionId,$pattern);//入庫\r\n        $result = $this->regInventoryTrdb($regData);\r\n        if($result['code'] != 0){\r\n    \t\t  return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public function orderWithinCount(array $array, string $divisionId, string $pattern){\r\n    \t$array = $this->requestUrldecode($array);\r\n\r\n        $regData = $this->makeOrderedData($array,$divisionId,$pattern);//発注中\r\n        $result = $this->regInventoryTrdb($regData);\r\n        if($result['code'] != 0){\r\n    \t\t  return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * $pattern = 1; // 加算\r\n     * $pattern = 2; // 減算\r\n     */\r\n    private function makeOrderedData(array $array,string $divisionId,string $pattern){\r\n      $itemList = array();\r\n      if($pattern == '1'){\r\n        $p = '';\r\n      }else if($pattern == '2'){\r\n        $p = '-';\r\n      }\r\n      foreach($array as $inHPItemid => $data){\r\n        if((int)$data['countNum'] > 0){\r\n            $itemList[] = array(\r\n                      'now',\r\n                      $divisionId,\r\n                      $inHPItemid,\r\n                      '0',\r\n                      $this->userInfo->getHospitalId(),\r\n                      $p . $data['countNum'],\r\n          );\r\n        }\r\n      }\r\n\r\n      return $itemList;\r\n    }\r\n\r\n    /**\r\n     * $pattern = 1; // 加算\r\n     * $pattern = 2; // 減算\r\n     */\r\n    private function makeRegData(array $array,string $divisionId,string $pattern){\r\n      $itemList = array();\r\n      if($pattern == '1'){\r\n        $p = '';\r\n      }else if($pattern == '2'){\r\n        $p = '-';\r\n      }\r\n      foreach($array as $inHPItemid => $data){\r\n        if((int)$data['countNum'] > 0){\r\n            $itemList[] = array(\r\n                      'now',\r\n                      $divisionId,\r\n                      $inHPItemid,\r\n                      $p . $data['countNum'],\r\n                      $this->userInfo->getHospitalId(),\r\n                      0,\r\n          );\r\n        }\r\n      }\r\n\r\n\t\t  return $itemList;\r\n    }\r\n\r\n    private function regInventoryTrdb(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','divisionId','inHospitalItemId','count','hospitalId','orderWithinCount');\r\n\r\n        $this->spiralDataBase->setDataBase($this->TransactionDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n\r\n\tprivate function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39814",
   "name": "RegItemsBlukIns",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegItemsBlukIns{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n\r\n    private $database = \"NJ_itemDB\";\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    public function blukinsert(array $itemList){\r\n        $itemList = $this->requestUrldecode($itemList);\r\n        $itemList = $this->remake($itemList);\r\n        return $this->regItems($itemList);\r\n    }\r\n\r\n    private function remake(array $itemList){\r\n        foreach($itemList as &$record){\r\n            $record[] = $this->userInfo->getTenantId();\r\n        }\r\n        return $itemList;\r\n    }\r\n\r\n    private function regItems(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array(\"itemName\",\"itemCode\",\"itemStandard\",\"itemJANCode\",\"makerName\",\"officialFlag\",\"officialpriceOld\",\"officialprice\",\"quantity\",\"quantityUnit\",\"itemUnit\",\"minPrice\",\"tenantId\");\r\n        \r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        \r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n        \r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}\r\n \r\n"
  },
    {
   "id": "custom_module_mst39815",
   "name": "RegLot",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegLot{\r\n\r\n    private $spiralDataBase;\r\n    private $receivingHId;\r\n    private $payoutHistoryId;\r\n    private $divisionId;\r\n\tprivate $userInfo;\r\n\t\r\n\tprivate $receivingItemIds = array();\r\n    \r\n    private $database = 'NJ_LotDB';\r\n    private $ReceivingDB = 'NJ_ReceivingDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n/**\r\n * lotData\r\n * array(\r\n * \tarray(\r\n * \t\tLotId\r\n *      LotNumber\r\n *      LotDate\r\n *      inHospitalItemId\r\n *      receivingNumber = ''\r\n *      \r\n *  \t)\r\n * )\r\n */\r\n\tpublic function regLot(array $lotData,string $divisionId,string $receivingHId = null,string $payoutHistoryId = null){\r\n\r\n\t\t$this->receivingHId = $receivingHId;\r\n\t\t$this->payoutHistoryId = $payoutHistoryId;\r\n\t\t$this->divisionId = $divisionId;\r\n\r\n\t\t$lotData = $this->remakeLotData($lotData);\r\n\r\n\t\tif($this->receivingHId != null){\r\n\t\t\t$ReceivingItems = $this->getReceivingItems($lotData);\r\n\t\t\tif($ReceivingItems['code'] != '0'){\r\n\t\t\t\treturn $ReceivingItems;\r\n\t\t\t}\r\n\t\t\t$this->receivingItemIds = $this->remakeReceivingItems($ReceivingItems['data']);\r\n\t\t}\r\n\t\t$makeLotUpsertData = $this->makeLotUpsertData($lotData);\r\n\t\treturn $this->regLotUpSert($makeLotUpsertData);\r\n\t}\r\n\r\n\tprivate function remakeLotData(array $lotData){\r\n\t\t$result = array();\r\n\t\tforeach($lotData as $lotRecord){\r\n\t\t\tforeach($lotRecord as $lot){\r\n\t\t\t\tif($lot['lotNumber'] != '' || $lot['lotDate'] != ''){\r\n\t\t\t\t\t$result[] = $lot;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n\tprivate function makeLotUpsertData(array $lotData){\r\n\t\t$result = array();\r\n\t\tforeach($lotData as $lot){\r\n\t\t\t$lotId = '';\r\n\t\t\tif($lot['lotId'] == \"\"){\r\n\t\t\t\t//$lotId = $this->makeLotId();\r\n\t\t\t\t$lotId = '';\r\n\t\t\t} else {\r\n\t\t\t\t$lotId = $lot['lotId'];\r\n\t\t\t}\r\n\t\t\t$receivingItemId = '';\r\n\t\t\tif(array_key_exists($lot['inHospitalItemId'], $this->receivingItemIds)){\r\n\t\t\t\t$receivingItemId = $this->receivingItemIds[$lot['inHospitalItemId']];\r\n\t\t\t}\r\n\t\t\t$result[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t$lotId,\r\n\t\t\t\t$receivingItemId,\r\n\t\t\t\t$lot['payoutId'],\r\n\t\t\t\t$this->receivingHId,\r\n\t\t\t\t$this->payoutHistoryId,\r\n\t\t\t\t$lot['lotNumber'],\r\n\t\t\t\t$lot['lotDate'],\r\n\t\t\t\t$this->divisionId,\r\n\t\t\t\t$lot['inHospitalItemId'],\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n    private function getReceivingItems(array $lotData){\r\n        $this->spiralDataBase->setDataBase($this->ReceivingDB);\r\n\t\t$this->spiralDataBase->addSearchCondition('receivingHId',$this->receivingHId);\r\n        foreach($lotData as $lot){\r\n            $this->spiralDataBase->addSearchCondition('inHospitalItemId',$lot['inHospitalItemId'],'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectFields('receivingNumber','inHospitalItemId');\r\n        return $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n\t\r\n\tprivate function regLotUpSert(array $upsertData){\r\n\t\t$this->spiralDataBase->setDataBase($this->database);\r\n\t\t$column = array('updateTime','lotId','receivingNumber','payoutId','receivingHId','payoutHistoryId','lotNumber','lotDate','divisionId','inHospitalItemId','hospitalId');\r\n        return $this->spiralDataBase->doBulkUpsert(\"lotId\",$column,$upsertData);\r\n\t}\r\n\r\n\tprivate function remakeReceivingItems(array $ReceivingItems){\r\n\t\t$result = array();\r\n\t\tforeach($ReceivingItems as $key => $data){\r\n\t\t\t$result[$data[1]] = $data[0];\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\t\r\n\tprivate function makeLotId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '99';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t//$msec = explode('.', $msec); \r\n\t\t//if( !isset($msec[1]) ){\r\n\t\t//\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t//}\r\n\r\n\t\t$rand = rand( 1, 9999);\r\n\r\n\t\t$id .= str_pad($rand, 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n}"
  },
    {
   "id": "custom_module_mst39816",
   "name": "RegOrder",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegOrder{\r\n\r\n    private $spiralDataBase;\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    public function order(string $orderNum,string $orderAuthKey,string $orderComment){\r\n        return $this->updateOrderHistoryDB($orderNum,$orderAuthKey,$orderComment);\r\n    }\r\n\r\n    public function updateOrderComment(string $orderNum,string $orderAuthKey,string $orderComment){\r\n        return $this->updateOrderHistoryDBForComment($orderNum,$orderAuthKey,$orderComment);\r\n    }\r\n\r\n    private function updateOrderHistoryDBForComment(string $orderNum,string $orderAuthKey,string $orderComment){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderNumber',$orderNum);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderAuthKey',$orderAuthKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array('name'=> 'ordercomment','value'=>urldecode($orderComment))));\r\n    }\r\n\r\n    private function updateOrderHistoryDB(string $orderNum,string $orderAuthKey,string $orderComment){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderNumber',$orderNum);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderAuthKey',$orderAuthKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array('name'=> 'orderTime','value'=>'now'),array('name'=> 'orderStatus','value'=>2),array('name'=> 'ordercomment','value'=>urldecode($orderComment))));\r\n    }\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39817",
   "name": "RegPayout",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegPayout{\r\n\r\n    private $spiralDataBase;\r\n    private $sourceDivisionId;\r\n    private $sourceDivisionName;\r\n    private $targetDivisionId;\r\n    private $targetDivisionName;\r\n    public $payoutId;\r\n    private $userInfo;\r\n    \r\n    \r\n    private $historyDatabase = 'NJ_PayoutHDB';\r\n    private $childDatabase = 'NJ_PayoutDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setSourceDivisionId(string $sourceDivisionId, string $sourceDivisionName){\r\n        $this->sourceDivisionId = $sourceDivisionId;\r\n        $this->sourceDivisionName = $sourceDivisionName;\r\n    }\r\n\t\r\n\tprivate function setTargetDivisionId(string $targetDivisionId, string $targetDivisionName){\r\n        $this->targetDivisionId = $targetDivisionId;\r\n        $this->targetDivisionName = $targetDivisionName;\r\n\t}\r\n\t\r\n    public function register(array $array, string $sourceDivisionId, string $sourceDivisionName, string $targetDivisionId, string $targetDivisionName){\r\n\t\t$array = $this->requestUrldecode($array);\r\n\t\t$sourceDivisionName = urldecode($sourceDivisionName);\r\n\t\t$targetDivisionName = urldecode($targetDivisionName);\r\n\r\n\t\t$this->setSourceDivisionId($sourceDivisionId,$sourceDivisionName);\r\n\t\t$this->setTargetDivisionId($targetDivisionId,$targetDivisionName);\r\n\t\t\r\n    \t$this->payoutId = $this->makePayoutId();\r\n  \r\n    \t$childData = $this->makePayout($array);\r\n    \t\r\n    \tif(count($childData) === 0){\r\n    \t\tvar_dump($childData);\r\n    \t\treturn false;\r\n    \t}\r\n  \r\n    \t$historyData = $this->makePayoutHistory($childData);\r\n    \t\r\n    \t$response = $this->regPayoutHistory($historyData);\r\n    \tif($response['code'] != 0){\r\n    \t\tvar_dump($response);\r\n    \t\treturn false;\r\n        }\r\n        \r\n    \t$responseChild = $this->regPayout($childData);\r\n    \tif($responseChild['code'] != 0){\r\n    \t\tvar_dump($responseChild);\r\n    \t\treturn false;\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    private function makePayoutHistory(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"payoutHistoryId\",\r\n\t\t\t\t\t\"value\" => $this->payoutId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"sourceDivisionId\",\r\n\t\t\t\t\t\"value\" => $this->sourceDivisionId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"sourceDivision\",\r\n\t\t\t\t\t\"value\" => $this->sourceDivisionName,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"targetDivisionId\",\r\n\t\t\t\t\t\"value\" => $this->targetDivisionId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"targetDivision\",\r\n\t\t\t\t\t\"value\" => $this->targetDivisionName,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => count($array)\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"totalAmount\",\r\n\t\t\t\t\t\"value\" => $this->totalAmount($array)\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function regPayoutHistory(array $insertData){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n        //return $this->spiralDataBase->doInsert($insertData);\r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function makePayout(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','inHospitalItemId','billingNumber','price','billingQuantity','billingAmount','hospitalId','divisionId');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPid => $data){\r\n\t\t\tif( (int)$data['countNum']  > 0 ){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t'',\r\n\t\t\t\t$this->payoutId,\r\n\t\t\t\t'',\r\n\t\t\t\t$inHPid,\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t\t$this->sourceDivisionId,\r\n\t\t\t\t$this->targetDivisionId,\r\n\t\t\t\t$data['irisu'],\r\n\t\t\t\t$data['unit'],\r\n\t\t\t\t$data['itemUnit'],\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']),\r\n\t\t\t\t(int)$data['countNum'],\r\n\t\t\t\t(string)(number_format(str_replace(',', '', $data['kakaku']) / $data['irisu'], 2) * (int)$data['countNum']),\r\n\t\t\t\t$data['payoutCount'],\r\n\t\t\t\t$data['countLabelNum'],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n    \r\n    private function regPayout(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','updateTime','payoutHistoryId','payoutId','inHospitalItemId','hospitalId','sourceDivisionId','targetDivisionId','quantity','quantityUnit','itemUnit','price','payoutQuantity','payoutAmount','payoutCount','payoutLabelCount');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function makePayoutId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '05';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function totalAmount(array $array){\r\n    \t$num = 0;\r\n    \tforeach($array as $data){\r\n    \t\t$num += $data[13];\r\n    \t}\r\n    \treturn $num;\r\n\t}\r\n\t\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39818",
   "name": "RegReceiving",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegReceiving{\r\n\r\n    private $spiralDataBase;\r\n    private $divisionId;\r\n    private $orderId;\r\n\tprivate $userInfo;\r\n\tpublic $ReceivingHistoryId;\r\n\tprivate $orderHistoryId;\r\n\t\r\n\tprivate $itemsNumber;\r\n\t\r\n    private $historyDatabase = 'NJ_ReceivingHDB';\r\n\tprivate $childDatabase = 'NJ_ReceivingDB';\r\n\t\r\n\t\r\n    private $orderDatabase = 'NJ_OrderDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\t\r\n    public function register(string $orderHistoryId,string $distributorId,string $divisionId,array $array){\r\n\t\t$array = $this->requestUrldecode($array);\r\n\r\n\t\t$this->distributorId = $distributorId;\r\n\t\t$this->orderHistoryId = $orderHistoryId;\r\n\t\t$this->ReceivingHistoryId = $this->makeReceivingHId();\r\n\t\t\r\n\t\t$makeReceiving = $this->makeReceiving($array,$divisionId);\r\n\r\n\t\tif(count($makeReceiving) == \"0\"){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\t$this->itemsNumber = count($makeReceiving);\r\n\r\n\t\t$makeReceivingHistory = $this->makeReceivingHistory();\r\n\r\n\t\t$result = $this->regReceivingHistory($makeReceivingHistory);\r\n\r\n\t\tif($result['code'] != '0'){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t$result = $this->regReceiving($makeReceiving);\r\n\r\n\t\tif($result['code'] != '0'){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$makeOrderData = $this->makeOrderData($array);\r\n\r\n        $result = $this->updateOrderDB($makeOrderData);\r\n\t\tif($result['code'] != '0'){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n    \treturn true;\r\n    }\r\n    \r\n\tprivate function regReceivingHistory(array $insertData){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n\t}\r\n\t\r\n\tprivate function makeReceivingHistory(){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //array('registrationTime','orderTime','receivingTime','orderNumber','hospitalId','divisionId','itemsNumber','totalAmount','orderStatus','hachuRarrival');\r\n\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"receivingHId\",\r\n\t\t\t\t\t\"value\" => $this->ReceivingHistoryId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"distributorId\",\r\n\t\t\t\t\t\"value\" => $this->distributorId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"orderHistoryId\",\r\n\t\t\t\t\t\"value\" => $this->orderHistoryId,\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => $this->itemsNumber\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    private function regReceiving(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','orderCNumber','receivingCount','receivingHId','inHospitalItemId','price','receivingPrice','hospitalId','divisionId');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n\r\n\tprivate function makeReceiving(array $array,string $divisionId){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','receivingTime','dueDate','orderCNumber','hospitalId','inHospitalItemId','orderNumber','price','orderQuantity','orderPrice','receivingFlag');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\tif($data['receivingCount'] > 0){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t$data['orderCNumber'],\r\n\t\t\t\t$data['receivingCount'],\r\n\t\t\t\t$this->ReceivingHistoryId,\r\n\t\t\t\t$inHPItemid,\r\n\t\t\t\t$data['price'],\r\n\t\t\t\t$data['receivingCount'] * $data['price'],\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t\t$divisionId\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n\tprivate function makeReceivingHId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '04';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n\t}\r\n\r\n\tprivate function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n\tprivate function makeOrderData(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\t//if($data['orderQuantity'] - ( (int)$data['receivingNowCount']  + (int)$data['receivingBeforeCount'] ) <= 0){\r\n\t\t\tif($data['orderQuantity'] - ( (int)$data['receivingNowCount']  + (int)$data['receivingCount'] ) <= 0){\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                'now',\r\n\t\t\t\t'1',\r\n\t\t\t\t(int)$data['receivingNowCount']+(int)$data['receivingCount'],\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                'now',\r\n\t\t\t\t'0',\r\n\t\t\t\t(int)$data['receivingNowCount']+(int)$data['receivingCount'],\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $itemList;\r\n\t}\r\n\t\r\n\tprivate function updateOrderDB(array $array){\r\n        \r\n        $columns = array('orderCNumber','receivingTime','receivingFlag','receivingNum');\r\n\r\n        $this->spiralDataBase->setDataBase($this->orderDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkUpdate('orderCNumber',$columns ,$array);\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39819",
   "name": "RegReturn",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegReturn{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $divisionId;\r\n\t\r\n\tprivate $userInfo;\r\n\r\n\tpublic $returnHistoryId;\r\n\tprivate $receivingHistoryId;\r\n\t\r\n\tprivate $itemsNumber;\r\n\tprivate $returnTotalPrice = 0;\r\n\t\r\n    private $historyDatabase = 'NJ_ReturnHDB';\r\n\tprivate $childDatabase = 'NJ_ReturnDB';\r\n\t\r\n\t\r\n    private $receivingDatabase = 'NJ_ReceivingDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n\t}\r\n\t\r\n    public function register(string $receivingHistoryId,string $distributorId,array $array){\r\n\t\t$array = $this->requestUrldecode($array);\r\n\r\n\t\t$this->distributorId = $distributorId;\r\n\t\t$this->receivingHistoryId = $receivingHistoryId;\r\n\t\t$this->returnHistoryId = $this->makeReturnHId();\r\n\t\t\r\n\t\t$makeReturn = $this->makeReturn($array);\r\n\t\tif(count($makeReturn) == \"0\"){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\t$this->itemsNumber = count($makeReturn);\r\n\t\t$this->returnTotalPrice = $this->returnTotalPrice($makeReturn);\r\n\t\t$makeReturnHistory = $this->makeReturnHistory();\r\n\r\n\t\t$result = $this->regReturnHistory($makeReturnHistory);\r\n\r\n\t\tif($result['code'] != '0'){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\r\n\t\t$result = $this->regReturn($makeReturn);\r\n\r\n\t\tif($result['code'] != '0'){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$makeReceivingData = $this->makeReceivingData($array);\r\n        $result = $this->updateReceivingDB($makeReceivingData);\r\n\t\tif($result['code'] != '0'){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n    \treturn true;\r\n    }\r\n    \r\n\tprivate function regReturnHistory(array $insertData){\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n\t}\r\n\t\r\n\tprivate function makeReturnHistory(){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //array('registrationTime','orderTime','receivingTime','orderNumber','hospitalId','divisionId','itemsNumber','totalAmount','orderStatus','hachuRarrival');\r\n\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"receivingHId\",\r\n\t\t\t\t\t\"value\" => $this->receivingHistoryId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"distributorId\",\r\n\t\t\t\t\t\"value\" => $this->distributorId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"returnHistoryID\",\r\n\t\t\t\t\t\"value\" => $this->returnHistoryId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => $this->itemsNumber\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"returnTotalPrice\",\r\n\t\t\t\t\t\"value\" => $this->returnTotalPrice\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    private function regReturn(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','receivingNumber','price','returnCount','returnPrice','hospitalId','returnHistoryID','orderCNumber','receivingHId','inHospitalItemId');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n\t}\r\n\t\r\n\tprivate function returnTotalPrice(array $array){\r\n\t\t$count = 0;\r\n\t\tforeach($array as $data){\r\n\t\t\t$count += $data[4];\r\n\t\t}\r\n\t\treturn $count;\r\n\t}\r\n\r\n\tprivate function makeReturn(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','receivingNumber','price','returnCount','returnPrice','hospitalId','returnHistoryID');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\tif($data['returnCount'] > 0){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t$data['receivingNumber'],\r\n\t\t\t\t$data['price'],\r\n\t\t\t\t$data['returnCount'],\r\n\t\t\t\t$data['price'] * $data['returnCount'],\r\n\t\t\t\t$this->userInfo->getHospitalId(),\r\n\t\t\t\t$this->returnHistoryId,\r\n\t\t\t\t$data['orderCNumber'],\r\n\t\t\t\t$this->receivingHistoryId,\r\n\t\t\t\t$inHPItemid\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n\tprivate function makeReturnHId(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '06';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n\t}\r\n\r\n\tprivate function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n\tprivate function makeReceivingData(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\t$itemList[] = array(\r\n                $data['receivingNumber'],\r\n\t\t\t\t(int)$data['totalReturnCount'] + (int)$data['returnCount'],\r\n\t\t\t\t);\r\n\t\t\t\r\n\t\t}\r\n\t\treturn $itemList;\r\n\t}\r\n\t\r\n\tprivate function updateReceivingDB(array $array){\r\n        \r\n        $columns = array('receivingNumber','totalReturnCount');\r\n\r\n        $this->spiralDataBase->setDataBase($this->receivingDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkUpdate('receivingNumber',$columns ,$array);\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39820",
   "name": "RegUnordered",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass RegUnordered{\r\n\r\n    private $spiralDataBase;\r\n    private $divisionId;\r\n    private $orderId;\r\n    private $userInfo;\r\n    private $distributorId;\r\n    \r\n    private $distributorDB = 'NJ_distributorDB';\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n    private $childDatabase = 'NJ_OrderDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n    }\r\n    \r\n    public function register(array $array, string $divisionId){\r\n    \t$array = $this->requestUrldecode($array);\r\n    \t\r\n        $this->setDivisionId($divisionId);\r\n        $distributorDB = $this->getDistributorDB();\r\n        if($distributorDB['count'] == 0){\r\n        \treturn false;\r\n        }\r\n        \r\n        foreach($distributorDB['data'] as $data){\r\n        \t$result = $this->arrayEachDistributor($data[1],$array);\r\n\t    \t\r\n\t    \t$this->distributorId = $data[1];\r\n\t    \t\r\n\t    \t$this->orderId = $this->makeOrderNumber();\r\n\t    \t$childData = $this->makeOrder($result);\r\n\t\t\tif(count($childData) == 0){\r\n\t    \t\tcontinue;\r\n\t    \t}\r\n\t  \r\n\t        $historyData = $this->makeOrderHistory($childData);\r\n\t        \r\n\t        $response = $this->regOrderHistory($historyData);\r\n\t        \r\n\t        if($response['code'] != 0){\r\n\t\t\t\tvar_dump($response);\r\n\t    \t\treturn false;\r\n\t        }\r\n\t\r\n\t        $response = $this->regOrder($childData);\r\n\t        \r\n\t        if($response['code'] != 0){\r\n\t\t\t\tvar_dump($response);\r\n\t    \t\treturn false;\r\n\t        }\r\n        }\r\n    \treturn true;\r\n    }\r\n    \r\n    private function arrayEachDistributor(string $distributorId , array $array){\r\n    \t$result = array();\r\n    \tforeach($array as $key => $data){\r\n    \t\tif($data['distributorId'] == $distributorId){\r\n    \t\t\t$result[$key] = $data;\r\n    \t\t}\r\n    \t}\r\n    \t\r\n    \treturn $result;\r\n    }\r\n    \r\n    private function makeOrderHistory(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //array('registrationTime','orderTime','receivingTime','orderNumber','hospitalId','divisionId','itemsNumber','totalAmount','orderStatus','hachuRarrival');\r\n\r\n\t\t$insertData = array(\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"registrationTime\",\r\n\t\t\t\t\t\"value\" => \"now\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"orderTime\",\r\n\t\t\t\t\t\"value\" => \"\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"receivingTime\",\r\n\t\t\t\t\t\"value\" => \"\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"orderNumber\",\r\n\t\t\t\t\t\"value\" => $this->orderId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hospitalId\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getHospitalId()\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"divisionId\",\r\n\t\t\t\t\t\"value\" => $this->divisionId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"itemsNumber\",\r\n\t\t\t\t\t\"value\" => count($array)\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"totalAmount\",\r\n\t\t\t\t\t\"value\" => $this->totalAmount($array)\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"orderStatus\",\r\n\t\t\t\t\t\"value\" => \"1\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"hachuRarrival\",\r\n\t\t\t\t\t\"value\" => \"未入庫\"\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"distributorId\",\r\n\t\t\t\t\t\"value\" => $this->distributorId\r\n\t\t\t\t),\r\n\t\t\t\tarray(\r\n\t\t\t\t\t\"name\" => \"ordererUserName\",\r\n\t\t\t\t\t\"value\" => $this->userInfo->getName()\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\treturn $insertData;\r\n     \r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function regOrderHistory(array $insertData){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n        return $this->spiralDataBase->doInsert($insertData);\r\n        //throw new Exception(\"エラーハンドリング\");\r\n    }\r\n    \r\n    private function makeOrder(array $array){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        //$columns = array('registrationTime','updateTime','receivingTime','dueDate','orderCNumber','hospitalId','inHospitalItemId','orderNumber','price','orderQuantity','orderPrice','receivingFlag');\r\n\r\n\t\t$itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\tif(floor((int)$data['countNum'] / (int)$data['irisu']) > 0){\r\n\t\t\t$itemList[] = array(\r\n\t\t\t\t'now',\r\n\t\t\t\t'',\r\n\t\t\t\t'',\r\n\t\t\t\t'',\r\n                '',\r\n                $this->userInfo->getHospitalId(),\r\n\t\t\t\t$inHPItemid,\r\n\t\t\t\t$this->orderId,\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']),\r\n\t\t\t\tfloor((int)$data['countNum'] / (int)$data['irisu']),\r\n\t\t\t\tstr_replace(',', '', $data['kakaku']) * floor((int)$data['countNum'] / (int)$data['irisu']),\r\n\t\t\t\t'0',\r\n\t\t\t\t$data['irisu'],\r\n\t\t\t\t$data['unit'],\r\n\t\t\t\t$data['itemUnit'],\r\n\t\t\t\t$this->divisionId,\r\n\t\t\t\t$this->distributorId\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n    \r\n    private function regOrder(array $itemList){\r\n\r\n        /**\r\n         * ここに処理を書く\r\n         */\r\n        $columns = array('registrationTime','updateTime','receivingTime','dueDate','orderCNumber','hospitalId','inHospitalItemId','orderNumber','price','orderQuantity','orderPrice','receivingFlag','quantity','quantityUnit','itemUnit','divisionId','distributorId');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkInsert($columns ,$itemList);\r\n\r\n        //throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function makeOrderNumber(){\r\n\t\r\n        /**\r\n         * ここに処理を書く\r\n\t\t */\r\n\t\t$id = '03';\r\n\t\t\r\n\t\t//$id .= str_pad($this->userInfo->getHospitalId(), 3, 0, STR_PAD_LEFT);;\r\n\t\t\r\n\t\t$id .= date(\"ymdHis\");\r\n\t\t\r\n\t\t$msec = microtime(true); \r\n \r\n\t\t$msec = explode('.', $msec); \r\n\t\t \r\n\t\tif( !isset($msec[1]) ){\r\n\t\t\t$msec[1] = \"0000\";\t// $msec[1]がセットされたかどうかをチェックし、なければ0をセット\r\n\t\t}\r\n\r\n\t\t$id .= str_pad(substr($msec[1],0,3) , 4, \"0\"); \r\n\t\t\r\n\t\treturn $id;\r\n\t\r\n\t\t//throw new Exception('エラーハンドリング');\r\n    }\r\n    \r\n    private function totalAmount(array $array){\r\n    \t$num = 0;\r\n    \tforeach($array as $data){\r\n    \t\t$num += $data[10];\r\n    \t}\r\n    \treturn $num;\r\n    }\r\n    \r\n    \r\n\tprivate function getDistributorDB(){\r\n\t\t$this->spiralDataBase->setDataBase($this->distributorDB);\r\n\t\t$this->spiralDataBase->addSelectFields('distributorName','distributorId');\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\t\r\n\t\treturn $this->spiralDataBase->doSelect();\r\n\t}\r\n\t\r\n\tprivate function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39821",
   "name": "ReqOrderItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass ReqOrderItems{\r\n\r\n    private $spiralDataBase;\r\n    private $database = 'NJ_OrderDB';\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    public function bulkUpdate(array $updateData){\r\n        if(count($updateData) == 0){\r\n            return array('code' => '1', 'message' => 'no data');\r\n        }\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        return $this->spiralDataBase->doBulkUpdate('orderCNumber',array('orderCNumber','orderQuantity') ,$updateData);\r\n    } \r\n\r\n    public function delete(array $deleteData){\r\n        if(count($deleteData) == 0){\r\n            return array('code' => '1', 'message' => 'no data');\r\n        }\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n        foreach($deleteData as $num){\r\n            $this->spiralDataBase->addSearchCondition('orderCNumber',$num,'=','or');\r\n        }\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doDelete();\r\n    }\r\n\r\n    private function requestUrldecode(array $array){\r\n\t\t$result = array();\r\n\t\tforeach($array as $key => $value){\r\n\t\t\tif(is_array($value)){\r\n\t\t\t\t$result[$key] = $this->requestUrldecode($value);\r\n\t\t\t} else {\r\n\t\t\t\t$result[$key] = urldecode($value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39822",
   "name": "ResetStock",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass ResetStock{\r\n\r\n    private $spiralDataBase;\r\n\tprivate $userInfo;\r\n\r\n    private $divisionId;\r\n    \r\n    private $database = 'NJ_stockDB';\r\n    private $mstDatabase = 'NJ_inHPItemDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    private function setDivisionId(string $divisionId){\r\n        $this->divisionId = $divisionId;\r\n\t}\r\n\r\n    public function resetInHPItem(array $items){\r\n\t\t$bulkUpdateData = $this->makeBulkUpdateData($items);\r\n\t\t$result = $this->resetInHPItemDB($bulkUpdateData);\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t} \r\n    \r\n    public function resetStock(string $divisionId){\r\n        $this->setDivisionId($divisionId);\r\n\t\t$result = $this->resetStockDB();\r\n\t\tif($result['code'] != \"0\"){\r\n\t\t\tvar_dump($result);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tpublic function getStock(array $divisionIdArray){\r\n\t\treturn $result = $this->getStockDB($divisionIdArray);\r\n    }\r\n    \r\n    private function resetStockDB(){\r\n    \t$this->spiralDataBase->setDataBase($this->database);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSearchCondition('divisionId',$this->divisionId);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n\t\treturn $this->spiralDataBase->doUpdate(array(array('name'=> 'invFinishTime','value'=>'now'),array('name'=> 'stockQuantity','value'=>'0')));\r\n\t}\r\n\t\r\n    private function getStockDB(array $divisionIdArray){\r\n    \t$this->spiralDataBase->setDataBase($this->database);\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\tforeach($divisionIdArray as $divisionId){\r\n\t\t\t$this->spiralDataBase->addSearchCondition('divisionId',$divisionId,'!=',\"and\");\r\n\t\t}\r\n        $this->spiralDataBase->addSelectFields('inHospitalItemId','stockQuantity');\r\n\t\treturn $this->spiralDataBase->doSelectLoop();\r\n\t}\r\n\r\n\tprivate function makeBulkUpdateData(array $items){\r\n\t\t$result = array();\r\n\t\tforeach($items as $inHpItemId => $array){\r\n\t\t\t$result[] = array($inHpItemId,$array['countNum']);\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n\tprivate function resetInHPItemDB(array $blukUpdateData){\r\n\t\t$this->spiralDataBase->setDataBase($this->mstDatabase);\r\n        $columns = array('inHospitalItemId','HPstock');\r\n\t\t$this->spiralDataBase->addSelectNameCondition('');\r\n\t\t$this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n\t\treturn $this->spiralDataBase->doBulkUpdate('inHospitalItemId',$columns,$blukUpdateData);\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39823",
   "name": "SearchBarcode",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass SearchBarcode{\r\n\r\n    private $spiralDataBase;\r\n    private $userInfo;\r\n    private $spiralTable;\r\n    \r\n    private $billingHDB = 'NJ_BillingHDB';\r\n\r\n    private $orderHDB = 'NJ_OrderHDB';\r\n\r\n    private $receivingHDB = 'NJ_ReceivingHDB';\r\n    \r\n    private $returnHDB = 'NJ_ReturnHDB';\r\n    private $payoutHDB = 'NJ_PayoutHDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase,\\App\\Lib\\SpiralTable $spiralTable, \\App\\Lib\\UserInfo $userInfo){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n        $this->spiralTable = $spiralTable;\r\n        $this->userInfo = $userInfo;\r\n    }\r\n\r\n    /**\r\n     * $cardTitles = array(\r\n     * '02' => url,\r\n     * '03_unorder' => url,\r\n     * '03_order' => url,\r\n     * '04' => url,\r\n     * '05' => url,\r\n     * '06' => url,\r\n     * '08' => url,\r\n     * )\r\n     */\r\n    public function search(string $systemCheckId,string $jsessonId,string $myAreaTitle,array $cardTitles){\r\n        if(preg_match('/^02/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //物品請求\r\n            $result = $this->getBillingHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => 1,'urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $cardTitle = '';\r\n            if(isset($cardTitles['02'])){\r\n                $cardTitle = $cardTitles['02'];\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n\r\n            return $result;\r\n        }\r\n        if(preg_match('/^03/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //注文書\r\n            $result = $this->getOrderHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => 1,'urls'=>array(),'message'=>'no urls');\r\n            }\r\n            \r\n            $cardTitle = '';\r\n            \r\n            if(isset($cardTitles['03_order'])){\r\n                $cardTitle = $cardTitles['03_order'];\r\n            }\r\n\r\n            if($result['data'][0][1] == '1' && isset($cardTitles['03_unorder'])){\r\n                $cardTitle = $cardTitles['03_unorder'];\r\n            }\r\n\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            return $result;\r\n        }\r\n        if(preg_match('/^04/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //検収書\r\n            $result = $this->getReceivingHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => 1,'urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $cardTitle = '';\r\n            if(isset($cardTitles['04'])){\r\n                $cardTitle = $cardTitles['04'];\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n\r\n            return $result;\r\n        }\r\n        if(preg_match('/^06/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //返品書\r\n            $result = $this->getReturnHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => 1,'urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $cardTitle = '';\r\n            if(isset($cardTitles['06'])){\r\n                $cardTitle = $cardTitles['06'];\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n\r\n            return $result;\r\n        }\r\n        if(preg_match('/^05/', $systemCheckId) && strlen($systemCheckId) == 18){\r\n            //払出\r\n            $result = $this->getPayoutHDB($systemCheckId);\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n            if($result['count'] == '0'){\r\n                return array('code' => 1,'urls'=>array(),'message'=>'no urls');\r\n            }\r\n\r\n            $cardTitle = '';\r\n            if(isset($cardTitles['05'])){\r\n                $cardTitle = $cardTitles['05'];\r\n            }\r\n\r\n            $result = $this->getUrl($result['data'][0][0], $jsessonId, $myAreaTitle, $cardTitle);\r\n\r\n            if($result['code'] != '0'){\r\n                return array('code' => $result['code'],'urls'=>array(),'message'=>$result['message']);\r\n            }\r\n\r\n            return $result;\r\n        }\r\n\r\n        return array('code' => 99,'urls'=>array(),'message'=>'no urls');\r\n    }\r\n\r\n    private function getBillingHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->billingHDB);\r\n        $this->spiralDataBase->addSearchCondition('billingNumber',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        if($this->userInfo->getUserPermission() != '1' ){\r\n            $this->spiralDataBase->addSearchCondition('divisionId',$this->userInfo->getDivisionId());\r\n        }\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n    private function getOrderHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->orderHDB);\r\n        $this->spiralDataBase->addSearchCondition('orderNumber',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('id','orderStatus');\r\n        if($this->userInfo->getUserPermission() != '1' ){\r\n            $this->spiralDataBase->addSearchCondition('divisionId',$this->userInfo->getDivisionId());\r\n        }\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n    \r\n    private function getReceivingHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->receivingHDB);\r\n        $this->spiralDataBase->addSearchCondition('receivingHId',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        if($this->userInfo->getUserPermission() != '1' ){\r\n            $this->spiralDataBase->addSearchCondition('divisionId',$this->userInfo->getDivisionId());\r\n        }\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n    \r\n    private function getReturnHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->returnHDB);\r\n        $this->spiralDataBase->addSearchCondition('returnHistoryID',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        if($this->userInfo->getUserPermission() != '1' ){\r\n            $this->spiralDataBase->addSearchCondition('divisionId',$this->userInfo->getDivisionId());\r\n        }\r\n        return $this->spiralDataBase->doSelect(); \r\n    }\r\n    \r\n    private function getPayoutHDB(string $systemCheckId){\r\n        $this->spiralDataBase->setDataBase($this->payoutHDB);\r\n        $this->spiralDataBase->addSearchCondition('payoutHistoryId',$systemCheckId);\r\n        $this->spiralDataBase->addSearchCondition('hospitalId',$this->userInfo->getHospitalId());\r\n        $this->spiralDataBase->addSelectFields('id');\r\n        if($this->userInfo->getUserPermission() != '1' ){\r\n            $this->spiralDataBase->addSearchCondition('sourceDivisionId',$this->userInfo->getDivisionId());\r\n        }\r\n        return $this->spiralDataBase->doSelect();\r\n    }\r\n\r\n    private function getUrl(string $id,string $jsessonId,string $myAreaTitle,string $cardTitle){\r\n        $this->spiralTable->setJsessionid($jsessonId);\r\n        $this->spiralTable->setMyAreaTitle($myAreaTitle);\r\n        $this->spiralTable->setCardTitle($cardTitle);\r\n        $this->spiralTable->addIds($id);\r\n        return $this->spiralTable->getCardUrls();\r\n    }\r\n\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39824",
   "name": "UpdateInHPItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass UpdateInHPItems{\r\n\r\n    private $database = \"NJ_inHPItemDB\";\r\n    private $itemId = \"\";\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    } \r\n\r\n    public function updateInHPItems(string $itemId){\r\n        $this->itemId = $itemId;\r\n        return $this->updateInHPItemDB();\r\n    }\r\n\r\n    private function updateInHPItemDB(){\r\n        $this->spiralDataBase->setDataBase($this->database);\r\n\t\t$this->spiralDataBase->addSearchCondition('itemId',$this->itemId);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate(array(array(\"name\" => \"updateTime\",\"value\" => \"now\")));\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39825",
   "name": "UpdateOrder",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass UpdateOrder{\r\n\r\n    private $spiralDataBase;\r\n    private $price;\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n    private $childDatabase = 'NJ_OrderDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    public function update(string $orderNum,string $orderAuthKey,array $array){\r\n        $makeOrderData = array();\r\n        $makeOrderData = $this->makeOrderData($array);\r\n\r\n        //$result = $this->updateOrderDB($makeOrderData); //更新しない\r\n        /*\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n        */\r\n        \r\n        $this->pattern = $this->checkPattern($array);\r\n        \r\n        $makeOrderHistoryData = $this->makeOrderHistoryData($makeOrderData);\r\n        $result = $this->updateOrderHistoryDB($orderNum,$orderAuthKey,$makeOrderHistoryData);\r\n\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public function updateWithDelAcceptance(string $orderNum,string $orderAuthKey,array $array){\r\n        $makeOrderData = array();\r\n        $makeOrderData = $this->makeOrderDataWithDelAcceptance($array);\r\n        \r\n        $result = $this->updateOrderDB($makeOrderData); \r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n        \r\n        $this->pattern = '7';//納品取消\r\n        \r\n        $makeOrderHistoryData = $this->makeOrderHistoryData($makeOrderData);\r\n        $result = $this->updateOrderHistoryDB($orderNum,$orderAuthKey,$makeOrderHistoryData);\r\n        \r\n\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n    \r\n\r\n    private function checkPattern(array $array){\r\n    \t$checkList1 = array();\r\n    \t$checkList2 = array();\r\n\t\tforeach($array as $record){\r\n\t\t\tif($record['receivingNowCount'] != 0){\r\n\t\t\t\t$checkList1[] = $record;\r\n            }\r\n            if($record['receivingFlag']){\r\n\t\t\t\t$checkList2[] = $record;\r\n            }\r\n\t\t}\r\n\t\t\r\n\t\tif(count($array) == count($checkList2)){\r\n\t\t\treturn 6;\r\n\t\t}\r\n\t\tif(count($checkList1) != 0 ){\r\n\t\t\treturn 5;\r\n\t\t}\r\n\t\treturn 0;\r\n    }\r\n\r\n    private function makeOrderData(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\tif($data['orderQuantity'] - $data['receivingNowCount'] <= 0){\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                'now',\r\n\t\t\t\t'1',\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n    private function makeOrderDataWithDelAcceptance(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                '',\r\n\t\t\t\t'0',\r\n\t\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n    private function updateOrderDB(array $array){\r\n        \r\n        $columns = array('orderCNumber','receivingTime','receivingFlag');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n\r\n        return $this->spiralDataBase->doBulkUpdate('orderCNumber',$columns ,$array);\r\n    }\r\n\r\n    private function makeOrderHistoryData(array $array){\r\n        $receivingTime = null;\r\n        if($this->pattern == '7'){\r\n            $receivingTime = '';\r\n        }\r\n        if($this->pattern == '6'){\r\n            $receivingTime = 'now';\r\n        }\r\n        \r\n\t\t$insertData = array(\r\n            array(\r\n                \"name\" => \"receivingTime\",\r\n                \"value\" => $receivingTime,\r\n            )\r\n        );\r\n\r\n        if($this->pattern == '7' || $this->pattern == '6' || $this->pattern == '5'){\r\n            $insertData[] = array(\r\n                \"name\" => \"orderStatus\",\r\n                \"value\" => $this->pattern,\r\n            );\r\n        }\r\n        return $insertData;\r\n    }\r\n\r\n    private function updateOrderHistoryDB(string $orderNum,string $orderAuthKey,array $array){\r\n        \r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderNumber',$orderNum);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderAuthKey',$orderAuthKey);\r\n        return $this->spiralDataBase->doUpdate($array);\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39826",
   "name": "UpdateOrderFixing",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass UpdateOrderFixing{\r\n\r\n    private $spiralDataBase;\r\n    private $price;\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n    private $childDatabase = 'NJ_OrderDB';\r\n\r\n    private $hachuRarrival = '';\r\n    private $pattern = '';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDataBase $spiralDataBase){\r\n        $this->spiralDataBase = $spiralDataBase;\r\n    }\r\n\r\n    public function update(string $orderNum,string $orderAuthKey,array $array){\r\n        $makeOrderData = array();\r\n\r\n        $this->pattern =  '3';\r\n\r\n        $makeOrderData = $this->makeOrderData($array);\r\n        \r\n        $result = $this->updateOrderDB($makeOrderData);\r\n\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n\r\n        $makeOrderHistoryData = $this->makeOrderHistoryData();\r\n        $result = $this->updateOrderHistoryDB($orderNum,$orderAuthKey,$makeOrderHistoryData);\r\n\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public function delete(string $orderNum,string $orderAuthKey,array $array){\r\n        $makeOrderData = array();\r\n\r\n        $this->pattern =  '2';\r\n\r\n        $makeOrderHistoryData = $this->makeOrderHistoryData();\r\n        $result = $this->updateOrderHistoryDB($orderNum,$orderAuthKey,$makeOrderHistoryData);\r\n\r\n        if($result['code'] != 0){\r\n            var_dump($result);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n    private function makeOrderData(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n            if($data['dueDate'] != ''){\r\n                $this->pattern =  '4';\r\n            }\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                $data['dueDate'],\r\n\t\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n    private function makeOrderDataWithDelAcceptance(array $array){\r\n        $itemList = array();\r\n\t\tforeach($array as $inHPItemid => $data){\r\n\t\t\t$itemList[] = array(\r\n                $data['orderCNumber'],\r\n                '',\r\n\t\t\t\t'0',\r\n\t\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn $itemList;\r\n    }\r\n\r\n    private function updateOrderDB(array $array){\r\n        \r\n        $columns = array('orderCNumber','dueDate');\r\n\r\n        $this->spiralDataBase->setDataBase($this->childDatabase);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doBulkUpdate('orderCNumber',$columns ,$array);\r\n    }\r\n\r\n    private function makeOrderHistoryData(){\r\n\t\t$insertData = array(\r\n            array(\r\n                \"name\" => \"orderStatus\",\r\n                \"value\" => $this->pattern,\r\n            ),\r\n            array(\r\n                \"name\" => \"hachuRarrival\",\r\n                \"value\" => $this->hachuRarrival,\r\n            )\r\n        );\r\n\r\n        return $insertData;\r\n    }\r\n\r\n    private function updateOrderHistoryDB(string $orderNum,string $orderAuthKey,array $array){\r\n        \r\n        $this->spiralDataBase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderNumber',$orderNum);\r\n\t\t$this->spiralDataBase->addSearchCondition('orderAuthKey',$orderAuthKey);\r\n        $this->spiralDataBase->addSelectNameCondition('');\r\n        return $this->spiralDataBase->doUpdate($array);\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39827",
   "name": "UpdateRequestStatus",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass UpdateRequestStatus{\r\n\r\n    private $spiralDatabase;\r\n\r\n    private $status = \"\";\r\n    \r\n    private $historyDatabase = 'NJ_QRequestDB';\r\n    private $childDatabase = 'NJ_reqItemDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDatabase $spiralDatabase){\r\n        $this->spiralDatabase = $spiralDatabase;\r\n    }\r\n\r\n    public function open(string $requestId){\r\n        $this->status = \"2\";\r\n        $updateQRequestDB = $this->updateQRequestDB($requestId);\r\n        if($updateQRequestDB['code'] != \"0\"){\r\n            var_dump($updateQRequestDB);\r\n            return array();\r\n        }\r\n        return $updateQRequestDB;\r\n    }\r\n\r\n    public function itemsReg(string $requestId){\r\n        $this->status = \"3\";\r\n        $updateQRequestDB = $this->updateQRequestDB($requestId);\r\n        if($updateQRequestDB['code'] != \"0\"){\r\n            var_dump($updateQRequestDB);\r\n            return array();\r\n        }\r\n        return $updateQRequestDB;\r\n    }\r\n\r\n    public function hospitalCheck(string $requestId){\r\n        $this->status = \"\";\r\n        $getReqItemDB = $this->getReqItemDB($requestId);\r\n        \r\n        if($getReqItemDB['code'] != \"0\"){\r\n            var_dump($getReqItemDB);\r\n            return array();\r\n        }\r\n        $this->status = $this->checkStaus($getReqItemDB['data']);\r\n        $updateQRequestDB = $this->updateQRequestDB($requestId);\r\n        if($updateQRequestDB['code'] != \"0\"){\r\n            var_dump($updateQRequestDB);\r\n            return array();\r\n        }\r\n        return $updateQRequestDB;\r\n    }\r\n\r\n    private function checkStaus(array $reqItemData){\r\n        \r\n        /**\r\n         *  1\t未開封\r\n         *  2\t開封\r\n         *  3\t商品記載有\r\n         *  4\t一部却下\r\n         *  5\t一部採用\r\n         *  6\t却下\r\n         *  7\t採用\r\n         */\r\n        $recordCount = count($reqItemData);\r\n        $rec = 0;\r\n        $not = 0;\r\n        foreach($reqItemData as $record){\r\n           if($record['1'] == '1'){\r\n            $rec++;\r\n           }\r\n           \r\n           if($record['1'] == '2'){\r\n            $not++;\r\n           }\r\n        }\r\n        if($recordCount == $rec){\r\n            return 7;\r\n        }\r\n        if($recordCount == $not){\r\n            return 6;\r\n        }\r\n        if($rec > 0){\r\n            return 5;\r\n        }\r\n        if($not > 0){\r\n            return 4;\r\n        }\r\n    }\r\n\r\n    private function getReqItemDB(string $requestId){\r\n        /** requestFlg\r\n         * 1\t採用\r\n         * 2\t不採用\r\n         */\r\n        $this->spiralDatabase->setDataBase($this->childDatabase);\r\n        $this->spiralDatabase->addSelectFields('id','requestFlg');\r\n        $this->spiralDatabase->addSearchCondition('requestId',$requestId);\r\n        return $this->spiralDatabase->doSelectLoop();\r\n    }\r\n\r\n    private function updateQRequestDB(string $requestId){\r\n        $updateData = array(\r\n            array(\r\n                \"name\" => \"requestStatus\",\r\n                \"value\" => $this->status,\r\n            )\r\n        );\r\n        $this->spiralDatabase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDatabase->addSearchCondition('requestId',$requestId);\r\n        $this->spiralDatabase->addSelectNameCondition('');\r\n        return $this->spiralDatabase->doUpdate($updateData);\r\n    }\r\n\r\n    public function selectQRequestDB(string $requestId){\r\n        $this->spiralDatabase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDatabase->addSearchCondition('requestId',$requestId);\r\n        $this->spiralDatabase->addSelectFields('id','requestTitle','distributorUName');\r\n        $this->spiralDatabase->addSelectNameCondition('');\r\n        return $this->spiralDatabase->doSelect();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39828",
   "name": "UpdateUnordered",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/api/",
   "php_script": "<?php\r\n\r\nnamespace App\\Api;\r\n\r\nclass UpdateUnordered{\r\n\r\n    private $spiralDatabase;\r\n    private $price;\r\n    \r\n    private $historyDatabase = 'NJ_OrderHDB';\r\n    private $childDatabase = 'NJ_OrderDB';\r\n\r\n    public function __construct(\\App\\Lib\\SpiralDatabase $spiralDatabase){\r\n        $this->spiralDatabase = $spiralDatabase;\r\n    }\r\n\r\n    public function update(string $orderNum){\r\n        $result = $this->selectOrderInfo($orderNum);\r\n        if($result['code'] != 0){\r\n            return array(\"code\"=>$result['code'],\"pattern\"=>\"update\");\r\n        }\r\n\r\n        if($result['count'] == 0){\r\n            $delete = $this->deleteOrderHistoryDB($orderNum);\r\n            if($delete['code'] != 0){\r\n                return array(\"code\"=>$delete['code'],\"pattern\"=>\"delete\");\r\n            }\r\n            return array(\"code\"=>$delete['code'],\"pattern\"=>\"delete\");\r\n        }\r\n\r\n        $this->price = $this->orderPriceCalculation($result['data']);\r\n\r\n        $result = $this->updateOrderHistoryDB($orderNum);\r\n        \r\n        if($result['code'] != 0){\r\n            return array(\"code\"=>$result['code'],\"pattern\"=>\"update\");\r\n        }\r\n\r\n        return array(\"code\"=>$result['code'],\"pattern\"=>\"update\");\r\n    }\r\n\r\n    private function orderPriceCalculation($data){ \r\n        //('orderNumber','orderPrice');\r\n        $price = 0;\r\n        foreach($data as $d){\r\n            $price += $d[1];\r\n        }\r\n        return $price;\r\n    }\r\n    \r\n    private function selectOrderInfo(string $orderNum){\r\n\r\n        $this->spiralDatabase->setDataBase($this->childDatabase);\r\n\t\t$this->spiralDatabase->addSearchCondition('orderNumber',$orderNum);\r\n        $this->spiralDatabase->addSelectFields('orderNumber','orderPrice');\r\n        return $this->spiralDatabase->doSelectLoop();\r\n    }\r\n\r\n    private function updateOrderHistoryDB(string $orderNum){\r\n        \r\n        $this->spiralDatabase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDatabase->addSearchCondition('orderNumber',$orderNum);\r\n        return $this->spiralDatabase->doUpdate(array(array('name'=> 'totalAmount','value'=>$this->price)));\r\n    }\r\n\r\n    private function deleteOrderHistoryDB(string $orderNum){\r\n        \r\n        $this->spiralDatabase->setDataBase($this->historyDatabase);\r\n\t\t$this->spiralDatabase->addSearchCondition('orderNumber',$orderNum);\r\n        return $this->spiralDatabase->doDelete();\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst40180",
   "name": "ReqItemNot",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once 'NewJoyPla/lib/Define.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/UpdateRequestStatus.php';\r\n\r\n$UserInfo = new \\App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$updateRequestStatus = new \\App\\Api\\UpdateRequestStatus($spiralDataBase);\r\n$updateRequestStatus->hospitalCheck($SPIRAL->getContextByFieldTitle(\"requestId\"));\r\n"
  },
    {
   "id": "custom_module_mst40181",
   "name": "ReqItemRec",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once 'NewJoyPla/lib/Define.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/UpdateRequestStatus.php';\r\n\r\n$UserInfo = new \\App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$updateRequestStatus = new \\App\\Api\\UpdateRequestStatus($spiralDataBase);\r\n$updateRequestStatus->hospitalCheck($SPIRAL->getContextByFieldTitle(\"requestId\"));\r\n"
  },
    {
   "id": "custom_module_mst39832",
   "name": "DelBilling",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\n\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/DelBilling.php';\r\n\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$billingAuthKey = $crypt->decrypt($_POST['billingAuthKey'], 'JoyPla');\r\n\r\n$delBilling = new App\\Api\\delBilling($spiralDataBase);\r\n$result = $delBilling->delete($_POST['billingNumber'],$billingAuthKey);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$orderCount = $_POST['billingData'];\r\n\r\nforeach($orderCount as $key => $record){\r\n\t$orderCount[$key]['countNum'] = $record['billingQuantity'];\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n$result = $regInventoryTrdb->orderCount($orderCount,$_POST['divisionId'],'1');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39835",
   "name": "DelPayout",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/DelPayout.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$payoutAuthKey = $crypt->decrypt($_POST['payoutAuthKey'], 'JoyPla');\r\n\r\n$delPayout = new App\\Api\\delPayout($spiralDataBase);\r\n$result = $delPayout->delete($_POST['payoutHistoryId'],$payoutAuthKey);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$orderCount = $_POST['payoutData'];\r\n\r\nforeach($orderCount as $key => $record){\r\n\t$orderCount[$key]['countNum'] = $record['payoutQuantity'];\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n$result = $regInventoryTrdb->orderCount($orderCount,$_POST['sourceDivisionId'],'1');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$result = $regInventoryTrdb->orderCount($orderCount,$_POST['targetDivisionId'],'2');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39833",
   "name": "DeleteEndHistory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/DelInventory.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$delInventory= new App\\Api\\delInventory($spiralDataBase,$userInfo);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKey= $crypt->decrypt($_POST['authKey'], 'JoyPla');\r\n\r\n$result = $delInventory->deleteEndHistory($_POST['inventoryEndId'],$authKey);\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39834",
   "name": "DeleteInventoryHistory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/DelInventory.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$delInventory= new App\\Api\\DelInventory($spiralDataBase);\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKey= $crypt->decrypt($_POST['authKey'], 'JoyPla');\r\n\r\n$result = $delInventory->deleteHistory($_POST['inventoryHId'],$authKey);\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39836",
   "name": "GetDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDistributor.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$getDistributor = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n$result = $getDistributor->getDistributor();\r\n\r\nif($result['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\necho json_encode(array('result'=>true,'data'=>$result['data']));"
  },
    {
   "id": "custom_module_mst39837",
   "name": "GetDivision",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$getDivision= new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$result = $getDivision->select();\r\necho json_encode(array('result'=>true,'data'=>$result));"
  },
    {
   "id": "custom_module_mst39838",
   "name": "ItemsChange",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/UpdateInHPItems.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n\r\n$updateInHPItems = new App\\Api\\UpdateInHPItems($spiralDataBase);\r\n\r\n$itemId = $SPIRAL->getContextByFieldTitle(\"itemId\");\r\n$result = $updateInHPItems->updateInHPItems($itemId);\r\n"
  },
    {
   "id": "custom_module_mst39839",
   "name": "LabelBarcodeSAPI",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\n\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\r\ninclude_once \"NewJoyPla/api/LabelSearchBarcode.php\";\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n\r\n$LabelSearchBarcode = new App\\Api\\LabelSearchBarcode($spiralDataBase, $userInfo);\r\n\r\n$barcode = '';\r\nif(isset($_POST['barcode']) && $_POST['barcode'] != ''){\r\n\t$barcode = $_POST['barcode'];\r\n}\r\n$result = $LabelSearchBarcode->search($barcode);\r\n\r\necho json_encode($result);\r\n"
  },
    {
   "id": "custom_module_mst39840",
   "name": "OrderComment",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\ninclude_once 'NewJoyPla/api/RegOrder.php';\r\n\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regOrder = new App\\Api\\RegOrder($spiralDataBase);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\");\r\n$card[\"data\"] = $spiralDataBase->arrayToNameArray($card[\"data\"],array(\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\"));\r\n\r\n$orderNumber = $card['data'][0]['orderNumber'];\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$orderAuthKey = $crypt->decrypt($_POST['orderAuthKey'], 'JoyPla');\r\n\r\n$result = $regOrder->updateOrderComment($orderNumber,$orderAuthKey,$_POST['ordercomment']);\r\n\r\necho json_encode(array('result'=>$result));\r\n"
  },
    {
   "id": "custom_module_mst39842",
   "name": "OrderFixing",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\ninclude_once 'NewJoyPla/api/RegOrder.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n//include_once 'NewJoyPla/api/GetHospitalData.php';\r\n\r\ninclude_once \"NewJoyPla/lib/SpiralDBFilter.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regOrder = new App\\Api\\RegOrder($spiralDataBase);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\");\r\n$card[\"data\"] = $spiralDataBase->arrayToNameArray($card[\"data\"],array(\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\"));\r\n\r\n$orderNumber = $card['data'][0]['orderNumber'];\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$orderAuthKey = $crypt->decrypt($_POST['orderAuthKey'], 'JoyPla');\r\n\r\n$result = $regOrder->order($orderNumber,$orderAuthKey,$_POST['ordercomment']);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$divisionData = $getDivision->select();\r\nif($divisionData['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$orderWithinCount = array();\r\nif(isset($_POST['order'])){\r\n\t$orderWithinCount = $_POST['order'];\r\n}\r\n\r\nforeach($orderWithinCount as $key => $record){\r\n\t$orderWithinCount[$key]['countNum'] = $record['quantity'] * $record['countNum'];\r\n}\r\n\r\n/*\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n*/\r\n\r\nif($card['data'][0]['receivingTarget'] == '1'){ //大倉庫\r\n\t$divisionId = $divisionData['store'][0][1];\r\n}\r\nif($card['data'][0]['receivingTarget'] == '2'){ //発注部署\r\n\t$divisionId = $card['data'][0]['divisionId'];\r\n}\r\n\r\n$result = $regInventoryTrdb->orderWithinCount($orderWithinCount,$divisionId,'1');\r\n\r\n\r\n$subject = \"[JoyPla] 発注が行われました\";\r\n\r\n\r\n$divisionId = $card['data'][0]['divisionId'];\r\n$hospitalName = $card['data'][0]['hospitalName'];\r\n$postalCode =  $card['data'][0]['postalCode'];\r\n$prefectures = $card['data'][0]['prefectures'];\r\n$address = $card['data'][0]['address'];\r\n$divisionName = $card['data'][0]['divisionName'];\r\n\r\n//$orderTime = $card['data'][0]['orderTime'];\r\n$orderTime = date(\"Y年m月d日 H時i分s秒\");\r\n$orderNumber = $card['data'][0]['orderNumber'];\r\n$itemsNumber = $card['data'][0]['itemsNumber'];\r\n\r\n$totalAmount = number_format($card['data'][0]['totalAmount']);\r\n$hospitalId =  $card['data'][0]['hospitalId'];\r\n$distributorId =  $card['data'][0]['distributorId'];\r\n\r\n$url = OROSHI_LOGIN_URL;\r\n$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n発注書が送信されておりますので、下記の通りお知らせします。\r\n\r\n[医療機関]\r\n施設名 $hospitalName\r\n〒$postalCode $prefectures $address\r\n部署名 $divisionName\r\n\r\n[発注内容]\r\n\r\n発注日時 $orderTime\r\n\r\n発注番号 $orderNumber\r\n\r\n発注品目 $itemsNumber (品目)\r\n\r\n\r\n合計金額 $totalAmount\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\nif(isset($distributorId)){\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_OUserDB';\r\n\t$selectName = 'S_O_'.$distributorId;\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'distributorId','label'=>'name_'.$distributorId,'value1'=>$distributorId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'oroshi_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$test = $SpiralDBFilter->create();\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}\r\n\t\r\n\r\necho json_encode(array('result'=>$result));\r\n"
  },
    {
   "id": "custom_module_mst39843",
   "name": "OrderItemDelete",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/ReqOrderItems.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$reqOrderItems = new App\\Api\\ReqOrderItems($spiralDataBase);\r\n\r\n$request = array();\r\n\r\nforeach($_POST['data'] as $key => $data){\r\n\t$request[] = $key;\r\n}\r\nif(count($request) == 0){\r\n   echo json_encode(array('result'=>true));\r\n   exit;\r\n}\r\n\r\n$result = $reqOrderItems->delete($request);\r\nif($result['code'] != 0){\r\n   echo json_encode(array('result'=>false));\r\n   exit;\r\n}\r\necho json_encode(array('result'=>true));"
  },
    {
   "id": "custom_module_mst39844",
   "name": "OrderItemUpdate",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/ReqOrderItems.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$reqOrderItems = new App\\Api\\ReqOrderItems($spiralDataBase);\r\n\r\n$request = array();\r\nforeach($_POST['data'] as $key => $data){\r\n\t$request[] = array($key,$data['num']);\r\n}\r\n\r\n$result = $reqOrderItems->bulkUpdate($request);\r\nif($result['code'] != 0){\r\n   echo json_encode(array('result'=>false));\r\n   exit;\r\n}\r\n\r\n$deleteRequest = array();\r\nforeach($_POST['data'] as $key => $data){\r\n   if($data['num'] != '0'){\r\n      continue;\r\n   }\r\n\t$deleteRequest[] = $key;\r\n}\r\n\r\nif(count($deleteRequest) != 0){\r\n   $result = $reqOrderItems->delete($deleteRequest);\r\n   if($result['code'] != 0){\r\n      echo json_encode(array('result'=>false));\r\n      exit;\r\n   }\r\n}\r\n\r\necho json_encode(array('result'=>true));"
  },
    {
   "id": "custom_module_mst39841",
   "name": "OrderedDelete",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/DeleteOrder.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\n\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$deleteOrder = new App\\Api\\deleteOrder($spiralDataBase);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\",\"orderAuthKey\");\r\n$card[\"data\"] = $spiralDataBase->arrayToNameArray($card[\"data\"],array(\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\",\"orderAuthKey\"));\r\n\r\n$orderNumber = $card['data'][0]['orderNumber'];\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$orderAuthKey = $crypt->decrypt($_POST['orderAuthKey'], 'JoyPla');\r\n\r\n$divisionId = $card['data'][0]['divisionId'];\r\n\r\n$result = $deleteOrder->delete($orderNumber,$orderAuthKey);\r\n\r\nif($_POST['countFlg'] == 'true'){\r\n\t\r\n\t$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n\t$hospitalData = $getHospitalData->select();\r\n\t\r\n\t$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\t$divisionData = $getDivision->select();\r\n\tif($divisionData['code'] != '0'){\r\n\t\techo json_encode(array('result'=>false));\r\n\t\texit;\r\n\t}\r\n\t\r\n\tif($hospitalData['data'][0]['receivingTarget'] == '1'){ //大倉庫\r\n\t\t$divisionId = $divisionData['store'][0][1];\r\n\t}\r\n\t\r\n\t$orderWithinCount = $_POST['orderData'];\r\n\tforeach($orderWithinCount as $key => $record){\r\n\t\t$orderWithinCount[$key]['countNum'] = $record['quantity'] * $record['countNum'];\r\n\t}\r\n\t\r\n\t$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\t$result = $regInventoryTrdb->orderWithinCount($orderWithinCount,$divisionId,'2');\r\n}\r\necho json_encode(array('result'=>$result));\r\nreturn true;"
  },
    {
   "id": "custom_module_mst39845",
   "name": "OroshiBarcodeSearchAPI",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\r\ninclude_once \"NewJoyPla/lib/SpiralTable.php\";\r\ninclude_once \"NewJoyPla/api/OroshiSearchBarcode.php\";\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralTable = new App\\Lib\\SpiralTable($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$oroshiSearchBarcode = new App\\Api\\OroshiSearchBarcode($spiralDataBase, $spiralTable, $userInfo);\r\n\r\n$jsessonId = '';\r\nif(isset($_COOKIE['JSESSIONID'])){\r\n\t$jsessonId = $_COOKIE['JSESSIONID'];\r\n}\r\n\r\n$searchValue = '';\r\nif(isset($_POST['searchValue'])){\r\n\t$searchValue = $_POST['searchValue'];\r\n}\r\n\r\n$cardTitles =array(\r\n      '03_order' => OROSHI_ORDER_PAGE,\r\n      '04' => OROSHI_RECEIVING_PAGE,\r\n      );\r\n\r\n$result = $oroshiSearchBarcode->search($searchValue,$jsessonId,OROSHI_MY_AREA_TITLE,$cardTitles);\r\n\r\necho json_encode($result);\r\n"
  },
    {
   "id": "custom_module_mst39846",
   "name": "OroshiOrderDelete",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/UpdateOrderFixing.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$updateOrderFixing = new App\\Api\\UpdateOrderFixing($spiralDataBase);\r\n\r\n\r\n$crypt = $SPIRAL->getSpiralCryptOpenSsl();\r\n$orderAuthKey = $crypt->decrypt($_POST['orderAuthKey'], 'JoyPla');\r\n\r\n$result = $updateOrderFixing->delete($_POST['orderHistoryId'],$orderAuthKey,$_POST['orderItems']);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39830",
   "name": "BarcodeSearchAPI",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\r\ninclude_once \"NewJoyPla/lib/SpiralTable.php\";\r\ninclude_once \"NewJoyPla/api/SearchBarcode.php\";\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$spiralTable = new App\\Lib\\SpiralTable($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$searchBarcode = new App\\Api\\SearchBarcode($spiralDataBase, $spiralTable, $userInfo);\r\n\r\n$jsessonId = '';\r\nif(isset($_COOKIE['JSESSIONID'])){\r\n\t$jsessonId = $_COOKIE['JSESSIONID'];\r\n}\r\n\r\n$searchValue = '';\r\nif(isset($_POST['searchValue'])){\r\n\t$searchValue = $_POST['searchValue'];\r\n}\r\n\r\n$cardTitles =array(\r\n      '02' => HP_BILLING_PAGE,\r\n      '03_unorder' => HP_UNORDER_PAGE,\r\n      '03_order' => HP_ORDER_PAGE,\r\n      '04' => HP_RECEIVING_PAGE,\r\n      '06' => HP_RETERN_PAGE,\r\n      '05' => HP_PAYOUT_PAGE,\r\n      );\r\n\r\n$result = $searchBarcode->search($searchValue,$jsessonId,MY_AREA_TITLE,$cardTitles);\r\n\r\necho json_encode($result);\r\n"
  },
    {
   "id": "custom_module_mst39848",
   "name": "RegComment",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/RegComment.php';\r\ninclude_once \"NewJoyPla/lib/SpiralDBFilter.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regComment = new App\\Api\\RegComment($spiralDataBase);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKey = $crypt->decrypt($_POST['authKey'], 'JoyPla');\r\n\r\n$result = $regComment->regComment($_POST['topicId'],$authKey,$_POST['commentData']);\r\n\r\nif($result['code'] != \"0\"){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"topicsDB\",$SPIRAL->getCardId(),\"topicId\",\"authKey\",\"topicTitle\",\"hospitalId\",\"distributorId\");\r\n\r\n$hospitalId = $card['data'][0][3];\r\n$distributorId = $card['data'][0][4];\r\n\r\n$topicTitle = $card['data'][0][2];\r\n$topicName = urldecode($_POST['commentData']['name']);\r\n$url = LOGIN_URL;\r\n$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n\r\n次のトピックに返信がありました。\r\n\r\n【タイトル】$topicTitle\r\n【作成者】$topicName\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n/****\r\n * 病院ユーザーへの送信 \r\n */\r\nif(isset($hospitalId)){\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_HUserDB';\r\n\t$selectName = 'S_H_'.$hospitalId;\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'hospitalId','label'=>'name_'.$hospitalId,'value1'=>$hospitalId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'hospital_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$subject = \"[JoyPla] \".$topicName.\"さんがトピック「\".$topicTitle.\"」に返信しました\";\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n\t\r\n}\r\n\r\n$url = OROSHI_LOGIN_URL;\r\n$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n\r\n次のトピックに返信がありました。\r\n\r\n【タイトル】$topicTitle\r\n【作成者】$topicName\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n/****\r\n * 卸ユーザーへの送信 \r\n */\r\nif(isset($distributorId)){\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_OUserDB';\r\n\t$selectName = 'S_O_'.$distributorId;\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\t$fields = array(\r\n\t\tarray('name'=>'distributorId','label'=>'name_'.$distributorId,'value1'=>$distributorId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'oroshi_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$subject = \"[JoyPla] \".$topicName.\"さんがトピック「\".$topicTitle.\"」に返信しました\";\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(OROSHI_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}\r\n\r\necho json_encode(array('result'=>true));"
  },
    {
   "id": "custom_module_mst39849",
   "name": "RegGoodsBilling",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegGoodsBilling.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetStock.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regGoodsBilling = new App\\Api\\RegGoodsBilling($spiralDataBase,$userInfo);\r\n\r\n$billingData = array();\r\nif(isset($_POST['billing'])){\r\n\t$billingData = $_POST['billing'];\r\n}\r\n$divisionId = '';\r\nif(isset($_POST['divisionId'])){\r\n\t$divisionId = $_POST['divisionId'];\r\n}\r\n\r\n$result = $regGoodsBilling->register($billingData,$divisionId);\r\n\r\nif($result != true){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$getStock = new App\\Api\\GetStock($spiralDataBase,$userInfo);\r\n$stockData = $getStock->getStockData($billingData,$divisionId);\r\n\r\nif($stockData['code'] != '0'){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\nforeach($billingData as $inHpitemId => $item){\r\n\t$checkFlg = false;\r\n\tforeach($stockData['data'] as $stock){\r\n\t\tif($inHpitemId == $stock[0]){\r\n\t\t\t$num = (int)$stock[1] - (int)$billingData[$inHpitemId]['countNum'];\r\n\t\t\tif($num > 0){\r\n\t\t\t\t$num = 0;\r\n\t\t\t}\r\n\t\t\t$billingData[$inHpitemId]['countNum'] = (int)$billingData[$inHpitemId]['countNum'] + $num;\r\n\t\t\t$checkFlg = true;\r\n\t\t}\r\n\t}\r\n\tif($checkFlg == false){\r\n\t\t$billingData[$inHpitemId]['countNum'] = 0;\r\n\t}\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n$result = $regInventoryTrdb->orderCount($billingData,$divisionId,'2');\r\n\r\necho json_encode(array('result'=>$result));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39850",
   "name": "RegInHPitemsBluk",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegInHPitemsBlukIns.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$blukinsert = new App\\Api\\RegInHPitemsBlukIns($spiralDataBase,$userInfo);\r\n$blukinsertData = $blukinsert->blukinsert($_POST['insertData']);\r\n\r\n$result = true;\r\nif($blukinsertData['code'] != \"0\"){\r\n\t$result = false;\r\n}\r\n\r\necho json_encode(array('result'=>$result,'response'=>$blukinsertData));"
  },
    {
   "id": "custom_module_mst39851",
   "name": "RegInventory",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetInventoryEndHistoryId.php';\r\ninclude_once 'NewJoyPla/api/GetInventoryHistoryId.php';\r\ninclude_once 'NewJoyPla/api/RegInventory.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryHistory.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryEndHistory.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getInventoryEndHistory = new App\\Api\\GetInventoryEndHistoryId($spiralDataBase,$userInfo);\r\n$inventoryEndHistoryId = $getInventoryEndHistory->getInventoryEndHistoryId();\r\n\r\n\r\n$getInventoryHistory = new App\\Api\\GetInventoryHistoryId($spiralDataBase,$userInfo);\r\n$InventoryHistoryId = $getInventoryHistory->getInventoryHistoryId($_POST['divisionId'],$inventoryEndHistoryId);\r\n\r\n\r\n$regInventory = new App\\Api\\RegInventory($spiralDataBase,$userInfo);\r\n$result = $regInventory->register( $_POST['inventory'],  $_POST['divisionId'],  $inventoryEndHistoryId ,  $InventoryHistoryId);\r\n\r\nif(!$result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n\r\n$regInventoryHistory = new App\\Api\\RegInventoryHistory($spiralDataBase,$userInfo);\r\n$result = $regInventoryHistory->updateHistory($InventoryHistoryId);\r\nif(!$result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$regInventoryEndHistory = new App\\Api\\RegInventoryEndHistory($spiralDataBase,$userInfo);\r\n\r\n\r\n$result = $regInventoryEndHistory->updateHistory($inventoryEndHistoryId);\r\n\r\nif(!$result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n//$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n//$result = $regInventoryTrdb->orderCount($_POST['billing'],$_POST['divisionId'],'2');\r\n\r\necho json_encode(array('result'=>$result));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39852",
   "name": "RegInventoryFinish",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\n\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryFinish.php';\r\ninclude_once 'NewJoyPla/api/GetInventory.php';\r\ninclude_once 'NewJoyPla/api/ResetStock.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$resetStock = new App\\Api\\ResetStock($spiralDataBase,$userInfo);\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$inventoryEAuthkey = $crypt->decrypt($_POST['inventoryEAuthkey'], 'JoyPla');\r\n\r\n//棚卸情報取得\r\n$getInventory = new App\\Api\\GetInventory($spiralDataBase,$userInfo);\r\n$result = $getInventory->getInventory($_POST['inventoryEndHistoryId']);\r\n\r\nif($result['code'] != '0'){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$inventoryData = $spiralDataBase->arrayToNameArray($result[\"data\"],array('id','divisionId','inventryNum','inHospitalItemId'));\r\n\r\n//棚卸情報加工\r\n$items = array();\r\nforeach($inventoryData as $record){\r\n\tif(!array_key_exists($record['divisionId'], $items)){\r\n\t\t$items[$record['divisionId']] = array();\r\n\t}\r\n\t$items[$record['divisionId']][$record['inHospitalItemId']] = array('countNum'=>$record['inventryNum']);\r\n}\r\n\r\n//棚卸結果でデータ更新\r\nforeach($items as $divisionId => $item){\r\n\r\n\t$result = $resetStock->resetStock($divisionId);\r\n\tif(!$result){\r\n\t\tvar_dump($result);\r\n\t\techo json_encode(array('result'=>false));\r\n\t\texit;\r\n\t}\r\n\t\r\n\t$itemsforBluk = array_chunk($item, 999,true);\r\n\tforeach($itemsforBluk as $items_1000){\r\n\t\t\r\n\t\t$result = $regInventoryTrdb->orderCount($items_1000,$divisionId,'1');\r\n\t\tif(!$result){\r\n\t\t\tvar_dump($result);\r\n\t\t\techo json_encode(array('result'=>false));\r\n\t\t\texit;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif(!$result){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n//在庫初期化\r\n\r\n$divisionIdArray = array();\r\n\r\n//foreach($items as $divisionId => $item){\r\n\t//$divisionIdArray[] = $divisionId;\r\n//}\r\n\r\n//現在在庫数取得\r\n$result = $resetStock->getStock($divisionIdArray);\r\nif($result['code'] != \"0\"){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$request = array();\r\n\r\nforeach($result['data'] as $record){\r\n\t$count = 0 ;\r\n\tif(array_key_exists($record[0], $request)){\r\n\t\t$count = (int)$request[$record[0]]['countNum'];\r\n\t}\r\n\t$request[$record[0]] = array('countNum' => (int)$record[1] + $count);\r\n}\r\n\r\n/**\r\n * 院内商品総数で更新 \r\n */\r\n$requestforBluk = array_chunk($request, 999,true);\r\n\r\nforeach($requestforBluk as $items_1000){\r\n\t$result = $resetStock->resetInHPItem($items_1000);\r\n\tif(!$result){\r\n\t\tvar_dump($result);\r\n\t\techo json_encode(array('result'=>false));\r\n\t\texit; \r\n\t}\r\n}\r\n\r\n\r\n//ステータス更新\r\n$regInventoryFinish = new App\\Api\\RegInventoryFinish($spiralDataBase,$userInfo);\r\n$result = $regInventoryFinish->updateHistory($_POST['inventoryEndHistoryId'],$inventoryEAuthkey);\r\n\r\nif(!$result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n\r\necho json_encode(array('result'=>true));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39853",
   "name": "RegItemsBlukIns",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegItemsBlukIns.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$blukinsert = new App\\Api\\RegItemsBlukIns($spiralDataBase,$userInfo);\r\n$blukinsertData = $blukinsert->blukinsert($_POST['insertData']);\r\n\r\n$result = true;\r\nif($blukinsertData['code'] != \"0\"){\r\n\t$result = false;\r\n}\r\n\r\necho json_encode(array('result'=>$result,'response'=>$blukinsertData));"
  },
    {
   "id": "custom_module_mst39854",
   "name": "RegPayout",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegPayout.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regPayout= new App\\Api\\RegPayout($spiralDataBase,$userInfo);\r\n\r\n$payoutData = $_POST['payout'];\r\nforeach($payoutData as $payoutKey => $payoutRecord){\r\n\t$payoutData[$payoutKey]['countNum'] = (int)$payoutRecord['countNum'] * (int)$payoutRecord['countLabelNum'] ;\r\n\t$payoutData[$payoutKey]['payoutCount'] = $payoutRecord['countNum'];\r\n}\r\n\r\n$result = $regPayout->register($payoutData,$_POST['sourceDivisionId'],$_POST['sourceDivisionName'],$_POST['targetDivisionId'],$_POST['targetDivisionName']);\r\n\r\nif($result != true){\r\n\tvar_dump(\"test\");\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$result = $regInventoryTrdb->orderCount($payoutData,$_POST['sourceDivisionId'],'2');\r\n\r\nif($result != true){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$result = $regInventoryTrdb->orderCount($payoutData,$_POST['targetDivisionId'],'1');\r\nif($result != true){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\necho json_encode(array('result'=>$result));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39855",
   "name": "RegReceiving",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegReceiving.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/api/RegLot.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regReceiving = new App\\Api\\RegReceiving($spiralDataBase,$userInfo);\r\n\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$divisionData = $getDivision->select();\r\nif($divisionData['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$divisionId = '';\r\n\r\nif($hospitalData['data'][0]['receivingTarget'] == '1'){ //大倉庫\r\n\t$divisionId = $divisionData['store'][0][1];\r\n}\r\nif($hospitalData['data'][0]['receivingTarget'] == '2'){ //発注部署\r\n\t$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n\t$divisionId = $crypt->decrypt($_POST['divisionId'], 'JoyPla');\r\n}\r\n\r\n$result = $regReceiving->register($_POST['orderHistoryId'],$_POST['distributorId'],$divisionId,$_POST['receiving']);\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$remakeData = array();\r\n\r\nforeach($_POST['receiving'] as $itemId => $data){\r\n\t$remakeData[$itemId] = array();\r\n\t$remakeData[$itemId]['countNum'] = $data['quantity'] * $data['receivingCount'];\r\n}\r\n\r\n$result = $regInventoryTrdb->orderWithinCount($remakeData,$divisionId,'2');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$result = $regInventoryTrdb->orderCount($remakeData,$divisionId,'1');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$regLot = new App\\Api\\RegLot($spiralDataBase,$userInfo);\r\n\r\n\r\n$result = $regLot->regLot($_POST['lotData'],$divisionId,$regReceiving->ReceivingHistoryId,null);\r\nif($result['code'] != \"0\"){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\necho json_encode(array('result'=>$result));\r\n\r\n\r\n"
  },
    {
   "id": "custom_module_mst39856",
   "name": "RegReqItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/UpdateRequestStatus.php';\r\n\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$updateRequestStatus = new App\\Api\\UpdateRequestStatus($spiralDataBase);\r\n$updateRequestStatus->itemsReg($SPIRAL->getContextByFieldTitle(\"requestId\"));\r\n\r\n$requestData = $updateRequestStatus->selectQRequestDB($SPIRAL->getContextByFieldTitle(\"requestId\"));\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$result = $SpiralSendMail->thanks(MITSUMORI_ITEMS_REG,$requestData['data'][0][0]);\r\n\r\nif($result['code'] != '0'){\r\n    var_dump($result);\r\n}"
  },
    {
   "id": "custom_module_mst39857",
   "name": "RegRequest",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDBFilter.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\n\r\n/****\r\n * 卸ユーザーへの送信 \r\n */\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_OUserDB';\r\n\t$selectName = 'S_O_'.$SPIRAL->getContextByFieldTitle(\"distributorId\");\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\t$distributorId = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"distributorId\"));\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'distributorId','label'=>'name_'.$distributorId,'value1'=>$distributorId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'oroshi_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$requestTitle = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"requestTitle\"));\r\n\t$requestUName = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"requestUName\"));\r\n\t\r\n\t$subject = \"[JoyPla] \".$requestUName.\"さんが見積依頼「\".$requestTitle.\"」を作成しました\";\r\n\t\r\n\t$url = OROSHI_LOGIN_URL;\r\n\r\n\t$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n\r\n新しい見積依頼が生成されました。\r\n\r\n【タイトル】$requestTitle\r\n【作成者】$requestUName\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n"
  },
    {
   "id": "custom_module_mst39858",
   "name": "RegReturn",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegReturn.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regReturn = new App\\Api\\RegReturn($spiralDataBase,$userInfo);\r\n$result = $regReturn->register($_POST['receivingHistoryId'],$_POST['distributorId'],$_POST['returnData']);\r\nif(! $result){\r\nvar_dump($result);\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$divisionData = $getDivision->select();\r\nif($divisionData['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$remakeData = array();\r\n\r\nforeach($_POST['returnData'] as $itemId => $data){\r\n\t$remakeData[$itemId] = array();\r\n\t$remakeData[$itemId]['countNum'] = $data['quantity'] * $data['returnCount'];\r\n}\r\n\r\n$result = $regInventoryTrdb->orderCount($remakeData,$divisionData['store'][0][1],'2');\r\n\r\nif(! $result){\r\n\tvar_dump($result);\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39859",
   "name": "RegTopic",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDBFilter.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\n\r\n\r\n/****\r\n * 病院ユーザーへの送信 \r\n */\r\nif($SPIRAL->getContextByFieldTitle(\"hospitalId\") != ''){\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_HUserDB';\r\n\t$selectName = 'S_H_'.$SPIRAL->getContextByFieldTitle(\"hospitalId\");\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\t$hospitalId = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"hospitalId\"));\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'hospitalId','label'=>'name_'.$hospitalId,'value1'=>$hospitalId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'hospital_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$topicTitle = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"topicTitle\"));\r\n\t$topicName = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"topicName\"));\r\n\t\r\n\t$subject = \"[JoyPla] \".$topicName.\"さんがトピック「\".$topicTitle.\"」を作成しました\";\r\n\t\r\n\t$url = LOGIN_URL;\r\n\t\r\n\t$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n\r\n新しいトピックが生成されました。\r\n\r\n【タイトル】$topicTitle\r\n【作成者】$topicName\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n\t\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}\r\n\r\n/****\r\n * 卸ユーザーへの送信 \r\n */\r\nif($SPIRAL->getContextByFieldTitle(\"distributorId\")  != '' ){\r\n\t\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_OUserDB';\r\n\t$selectName = 'S_O_'.$SPIRAL->getContextByFieldTitle(\"distributorId\");\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\t$distributorId = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"distributorId\"));\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'distributorId','label'=>'name_'.$distributorId ,'value1'=>$distributorId ,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'oroshi_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$topicTitle = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"topicTitle\"));\r\n\t$topicName = App\\Lib\\html($SPIRAL->getContextByFieldTitle(\"topicName\"));\r\n\t\r\n\t$subject = \"[JoyPla] \".$topicName.\"さんがトピック「\".$topicTitle.\"」を作成しました\";\r\n\t\r\n\t$url = LOGIN_URL;\r\n\r\n\t$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n\r\n新しいトピックが生成されました。\r\n\r\n【タイトル】$topicTitle\r\n【作成者】$topicName\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39860",
   "name": "RegUnordereByDiv",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegUnordered.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regUnordered = new App\\Api\\RegUnordered($spiralDataBase,$userInfo);\r\n\r\nforeach($_POST['ordered'] as $divisionId => $ordered){\r\n  $result = $regUnordered->register($ordered,$divisionId );\r\n\r\n  if(! $result){\r\n     echo json_encode(array('result'=>$result));\r\n  }\r\n}\r\n\r\n\r\necho json_encode(array('result'=>$result));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39861",
   "name": "RegUnordered",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/RegUnordered.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$regUnordered = new App\\Api\\RegUnordered($spiralDataBase,$userInfo);\r\n\r\n$result = $regUnordered->register($_POST['ordered'],$_POST['divisionId']);\r\n\r\necho json_encode(array('result'=>$result));\r\n\r\n"
  },
    {
   "id": "custom_module_mst39847",
   "name": "OroshiOrderFixing",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/UpdateOrderFixing.php';\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\n\r\n\r\ninclude_once \"NewJoyPla/lib/SpiralDBFilter.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralSendMail.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$updateOrderFixing = new App\\Api\\UpdateOrderFixing($spiralDataBase);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\",\"orderAuthKey\",\"distributorName\");\r\n$card[\"data\"] = $spiralDataBase->arrayToNameArray($card[\"data\"],array(\"orderNumber\",\"receivingTarget\",\"divisionId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"divisionName\",\"orderTime\",\"orderNumber\",\"itemsNumber\",\"totalAmount\",\"hospitalId\",\"distributorId\",\"orderAuthKey\",\"distributorName\"));\r\n\r\n$orderItems = array();\r\nif(isset($_POST['orderItems'])){\r\n\t$orderItems = $_POST['orderItems'];\r\n}\r\n\r\n$result = $updateOrderFixing->update($card[\"data\"][0][\"orderNumber\"],$card[\"data\"][0][\"orderAuthKey\"],$orderItems);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n\r\n$subject = \"[JoyPla] 受注されました\";\r\n$text = \"受注\";\r\n\r\nforeach($orderItems as $record){\r\n\tif($record[\"dueDate\"] != \"\"){\r\n\t\t$subject = \"[JoyPla] 受注（納期報告）されました\";\r\n\t\t$text = \"受注（納期報告）\";\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\n$divisionId = $card['data'][0]['divisionId'];\r\n$hospitalName = $card['data'][0]['hospitalName'];\r\n$postalCode =  $card['data'][0]['postalCode'];\r\n$prefectures = $card['data'][0]['prefectures'];\r\n$address = $card['data'][0]['address'];\r\n$divisionName = $card['data'][0]['divisionName'];\r\n\r\n$orderTime = $card['data'][0]['orderTime'];\r\n$orderNumber = $card['data'][0]['orderNumber'];\r\n$itemsNumber = $card['data'][0]['itemsNumber'];\r\n\r\n$totalAmount = number_format($card['data'][0]['totalAmount']);\r\n$hospitalId =  $card['data'][0]['hospitalId'];\r\n$distributorId =  $card['data'][0]['distributorId'];\r\n$distributorName = $card['data'][0]['distributorName'];\r\n\r\n$staffName = $userInfo->getName();\r\n\r\n$url = LOGIN_URL;\r\n$bodyText = <<<EOM\r\n%val:usr:name% 様\r\n\r\nJoyPla からお知らせです。\r\n$text がされましたので、下記の通りお知らせします。\r\n\r\n[卸業者]\r\n業者名 $distributorName\r\n担当者 $staffName\r\n\r\n[発注内容]\r\n\r\n発注日時 $orderTime\r\n\r\n発注番号 $orderNumber\r\n\r\n発注品目 $itemsNumber (品目)\r\n\r\n\r\n合計金額 $totalAmount\r\n\r\n下記URLよりログインしてご確認ください\r\n$url\r\n\r\n※このメールへの返信は受け付けていません。\r\nEOM;\r\n\r\n\r\n//部署担当者用\r\nif(isset($hospitalId)){\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_HUserDB';\r\n\t$selectName = 'S_H_'.$divisionId.'_'.$hospitalId;\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\t$fields = array(\r\n\t\tarray('name'=>'hospitalId','label'=>'name_'.$hospitalId,'value1'=>$hospitalId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'hospital_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\tarray('name'=>'userPermission','label'=>'up_tantou','value1'=>'2','condition'=>'contains'),\r\n\t\tarray('name'=>'divisionId','label'=>$divisionId,'value1'=>$divisionId,'condition'=>'matches'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}\r\n\r\n//管理者用\r\nif(isset($hospitalId)){\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralDBFilter = new App\\Lib\\SpiralDBFilter($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$database = 'NJ_HUserDB';\r\n\t$selectName = 'S_H_Admin_'.$hospitalId;\r\n\t\r\n\t$SpiralDBFilter->setDataBase($database);\r\n\t\r\n\r\n\t$fields = array(\r\n\t\tarray('name'=>'hospitalId','label'=>'name_'.$hospitalId,'value1'=>$hospitalId,'condition'=>'matches'),\r\n\t\t//array('name'=>'deletionFlag','label'=>'hospital_not_del','value1'=>'t','condition'=>'is_boolean','exclude'=>'t'),\r\n\t\tarray('name'=>'userPermission','label'=>'up_kanri','value1'=>'1','condition'=>'contains'),\r\n\t\t);\r\n\t\r\n\t$SpiralDBFilter->addSelectName($selectName);\r\n\t\r\n\tforeach($fields as $field){\r\n\t\t$SpiralDBFilter->addFields($field);\r\n\t}\r\n\t\r\n\t$SpiralDBFilter->create();\r\n\t\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$SpiralSendMail = new App\\Lib\\SpiralSendMail($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$SpiralSendMail->setDataBase($database);\r\n\t$SpiralSendMail->addMailFieldTitle(HP_MAIL_FIELD_TITLE);\r\n\t$SpiralSendMail->addSubject($subject);\r\n\t$SpiralSendMail->addBodyText($bodyText);\r\n\t$SpiralSendMail->addFromAddress(FROM_ADDRESS);\r\n\t$SpiralSendMail->addFromName(FROM_NAME);\r\n\t$SpiralSendMail->addSelectName($selectName);\r\n\t$SpiralSendMail->regist();\r\n\r\n}\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39831",
   "name": "DelAcceptance",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/controller/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/DelAcceptance.php';\r\ninclude_once 'NewJoyPla/api/RegInventoryTrdb.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/api/UpdateOrder.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$delAcceptance = new App\\Api\\delAcceptance($spiralDataBase);\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n\r\n$receivingAuthKey = '';\r\nif(isset($_POST['receivingAuthKey']) && $_POST['receivingAuthKey'] != ''){\r\n\t$receivingAuthKey = $crypt->decrypt($_POST['receivingAuthKey'], 'JoyPla');\r\n}\r\n\r\n$orderAuthKey = '';\r\nif(isset($_POST['orderAuthKey']) && $_POST['orderAuthKey'] != ''){\r\n\t$orderAuthKey = $crypt->decrypt($_POST['orderAuthKey'], 'JoyPla');\r\n}\r\n\r\n$result = $delAcceptance->delete($_POST['receivingHId'],$receivingAuthKey);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\t\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\nif($divisionData['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$orderWithinCount = $_POST['acceptanceData'];\r\n\r\nforeach($orderWithinCount as $key => $record){\r\n\t$orderWithinCount[$key]['countNum'] = $record['quantity'] * $record['receivingCount'];\r\n}\r\n\r\n$regInventoryTrdb = new App\\Api\\RegInventoryTrdb($spiralDataBase,$userInfo);\r\n\r\n$result = $regInventoryTrdb->orderWithinCount($orderWithinCount,$divisionData['store'][0][1],'1');\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$result = $regInventoryTrdb->orderCount($orderWithinCount,$divisionData['store'][0][1],'2');\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\n$updateOrder = new App\\Api\\UpdateOrder($spiralDataBase);\r\n\r\n$result = $updateOrder->updateWithDelAcceptance($_POST['orderNum'],$orderAuthKey,$_POST['acceptanceData']);\r\n\r\nif(! $result){\r\n\techo json_encode(array('result'=>$result));\r\n\texit;\r\n}\r\n\r\necho json_encode(array('result'=>$result));"
  },
    {
   "id": "custom_module_mst39863",
   "name": "ApiSpiral",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php \r\n\r\nnamespace App\\Lib ;\r\n\r\n/**\r\n * SPIRAL API をラッピングしたアクセスクラスです。\r\n *\r\n * @access public\r\n * @author ito.shun <ito.shun@pi-pe.co.jp>\r\n * @copyright  PipedBits All Rights Reserved\r\n * @category Message\r\n * @package ApiSpiral\r\n */\r\n class ApiSpiral{\r\n\r\n\tprotected $spiral;\r\n\tprotected $request;\r\n\tprotected $apiCommunicator;\r\n\r\n\t/**\r\n\t *  Public requestAPI \r\n\t *\r\n\t *  SPIRAL API を利用するための機能\r\n\t *\r\n\t * @access public\r\n\t * @param Array $apiHeader　SpiralApiRiquestHeader\r\n\t * @param Array $parameters ApiRiquestParam\r\n\t * @return Array $responseArray SpiralApiReturnData(htmlspecialchars)\r\n\t * @see $SPIRAL SpiralApiRequest()\r\n\t * @throws なし　返却値をもとにハンドリング\r\n\t * @todo 未対応（改善）事項等\r\n\t */\r\n\tpublic function __construct(\\Spiral $SPIRAL){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t}\r\n\r\n\tpublic function setApiCommunicator($apiCommunicator){\r\n\t\t$this->apiCommunicator = $apiCommunicator;\r\n\t}\r\n\r\n\tpublic function setSpiralApiRequest(\\SpiralApiRequest $spiralApiRequest){\r\n\t\t$this->request =  $spiralApiRequest;\r\n\t}\r\n\r\n\tpublic function requestAPI($apiHeader, $parameters){\r\n\r\n\t\t//$this->spiral->setApiTokenTitle(APITITLE); //APIタイトル\r\n\t\t//$apiCommunicator = $this->spiral->getSpiralApiCommunicator();\r\n\r\n\t\tforeach($parameters as $param_name => $param_value){\r\n\t\t\t$this->request->put($param_name, $param_value);\r\n\t\t}\r\n\t\t$response = $this->apiCommunicator->request($apiHeader[0], $apiHeader[1], $this->request);\r\n\r\n\t\t$responseArray = array();\r\n\t\tforeach($response->entrySet() as $key => $val){\r\n\t\t\t$responseArray[$key] = $this->obj2arr($val);\r\n\t\t}\r\n\t\t\r\n\t\treturn $responseArray;\r\n\t}\r\n\t\r\n\t/**\r\n\t *  Public Object->Array \r\n\t *\r\n\t *  SPIRAL API の返却値をArrayに変換\r\n\t *\r\n\t * @access private\r\n\t * @param Object or Array or String $obj \r\n\t * @return Array $arrayData SpiralApiReturnData(htmlspecialchars)\r\n\t * @throws なし\r\n\t * @todo 未対応（改善）事項等\r\n\t */\r\n\tprivate function obj2arr($obj){\r\n\t\t\r\n\t\tif ( ! is_object($obj) && ! is_array($obj)  ) return htmlspecialchars($obj, ENT_QUOTES, \"UTF-8\");//PHPサーバーはUTF-8\r\n\t\r\n\t\t$arr = (array) $obj;\r\n\t\r\n\t\tforeach ( $arr as &$a )\r\n\t\t{\r\n\t\t\t$a = $this->obj2arr($a);\r\n\t\t}\r\n\t\treturn $arr;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39864",
   "name": "Define",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\ndefine('LOGIN_URL', \"https://area18.smp.ne.jp/area/p/mjtf5pgodl1lglirg6/BHOv85/login.html\");\r\ndefine('OROSHI_LOGIN_URL', \"https://area18.smp.ne.jp/area/p/mjtf5pgoct9lgliqh7/1fQl4H/login.html\");\r\n\r\ndefine('MY_AREA_TITLE', \"NJ_HPLogin\");\r\ndefine('OROSHI_MY_AREA_TITLE', \"NJ_OUser\");\r\n\r\ndefine('APITITLE', \"JoyPla\");\r\ndefine('CHARSET', 'UTF-8');\r\ndefine('REPLACE_FLAGS', ENT_QUOTES);\r\n\r\ndefine('FROM_ADDRESS', \"joypla-spd@pi-pe.co.jp\");\r\ndefine('FROM_NAME', \"joypla\");\r\ndefine('HP_MAIL_FIELD_TITLE', \"mailAddress\");\r\ndefine('OROSHI_MAIL_FIELD_TITLE', \"mailAddress\");\r\n\r\ndefine('MITSUMORI_ITEMS_REG', \"10231440\");//NJ_見積依頼 見積商品登録通知 見積商品登録完了\r\n\r\n\r\n/***\r\n * barcode search For HP\r\n */\r\n\r\ndefine('HP_BILLING_PAGE', \"page_263400\");\r\ndefine('HP_UNORDER_PAGE', \"page_262926\");\r\ndefine('HP_ORDER_PAGE', \"page_263320\");\r\ndefine('HP_RECEIVING_PAGE', \"page_266892\");\r\ndefine('HP_RETERN_PAGE', \"page_265604\");\r\ndefine('HP_PAYOUT_PAGE', \"page_263580\");\r\n\r\ndefine('OROSHI_ORDER_PAGE', \"page_266218\");\r\ndefine('OROSHI_RECEIVING_PAGE', \"page_266907\");\r\n\r\n"
  },
    {
   "id": "custom_module_mst39865",
   "name": "Func",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\nnamespace App\\Lib;\r\n\r\ndefine('CHARSET', 'UTF-8');\r\ndefine('REPLACE_FLAGS', ENT_QUOTES);\r\n\r\nfunction html($string) {\r\n    return htmlspecialchars($string, REPLACE_FLAGS, CHARSET);\r\n}\r\n\r\nfunction changeDateFormat($formats , $date , $format){\r\n\tif($date == \"\"){return \"\";}\r\n\t$date = \\DateTime::createFromFormat($formats, $date);\r\n\treturn $date->format($format);\r\n}\r\n\r\nfunction requestUrldecode(array $array){\r\n    $result = array();\r\n    foreach($array as $key => $value){\r\n        if(is_array($value)){\r\n            $result[$key] = \\App\\Lib\\requestUrldecode($value);\r\n        } else {\r\n            $result[$key] = urldecode($value);\r\n        }\r\n    }\r\n    return $result;\r\n}\r\n\r\nfunction viewNotPossible(){\r\n    ?>\r\n    <!DOCTYPE html>\r\n    <html>\r\n        <head>\r\n            <title>閲覧不可<\/title>\r\n        <\/head>\r\n        <body>\r\n            <p>閲覧権限はありません<\/p>\r\n        <\/body>\r\n    <\/html>\r\n    <?php\r\n    return true;\r\n}\r\n\r\nfunction pager($c, $t, $limit) {\r\n    $current_page = $c;     //現在のページ \r\n    $total_rec = $t;    //総レコード数\r\n    $page_rec   = $limit;   //１ページに表示するレコード\r\n    $total_page = ceil($total_rec / $page_rec); //総ページ数\r\n    $show_nav = 5;  //表示するナビゲーションの数\r\n     \r\n    //全てのページ数が表示するページ数より小さい場合、総ページを表示する数にする\r\n    if ($total_page < $show_nav) {\r\n        $show_nav = $total_page;\r\n    }\r\n    //トータルページ数が2以下か、現在のページが総ページより大きい場合\r\n    if ($total_page <= 1 || $total_page < $current_page ): \r\n        ?>\r\n        <div id=\"pagination\">\r\n            <ul class=\"uk-pagination\">\r\n                <li class=\"prev\">1<\/li>\r\n            <\/ul>\r\n        <\/div>\r\n        <?php\r\n        return;\r\n    endif;\r\n    //総ページの半分\r\n    $show_navh = ceil($show_nav / 2);\r\n    //現在のページをナビゲーションの中心にする\r\n    $loop_start = $current_page - $show_navh;\r\n    $loop_end = $current_page + $show_navh;\r\n    //現在のページが両端だったら端にくるようにする\r\n    if ($loop_start <= 0) {\r\n        $loop_start  = 1;\r\n        $loop_end = $show_nav;\r\n    }\r\n    if ($loop_end > $total_page) {\r\n        $loop_start  = $total_page - $show_nav +1;\r\n        $loop_end =  $total_page;\r\n    }\r\n    ?>\r\n    <div id=\"pagination\">\r\n        <ul class=\"uk-pagination\">\r\n            <?php \r\n            if ( $current_page > 4 && $total_page > $show_nav ) echo '<li class=\"prev\"><a href=\"javascript:pageSubmit(1)\">1<\/a><\/li>';\r\n            if ( $current_page > 4 && $total_page > $show_nav ) echo '<li class=\"uk-disabled\"><span>...<\/span><\/li>';\r\n            for ($i=$loop_start; $i <= $loop_end; $i++) {\r\n                if ($i > 0 && $total_page >= $i) {\r\n                    if($i == $current_page) echo '<li class=\"uk-active\">';\r\n                    else echo '<li>';\r\n                    echo '<a href=\"javascript:pageSubmit('.$i.')\">'.$i.'<\/a>';\r\n                    echo '<\/li>';\r\n                }\r\n            }\r\n            if ( $current_page < $total_page - 3 && $total_page > $show_nav ) echo '<li class=\"uk-disabled\"><span>...<\/span><\/li>';\r\n            if ( $current_page < $total_page - 3 && $total_page > $show_nav ) echo '<li class=\"next\"><a href=\"javascript:pageSubmit('.$total_page.')\">'.$total_page.'<\/a><\/li>';\r\n            ?>\r\n        <\/ul>\r\n    <\/div>\r\n    <?php\r\n}\r\n?>"
  },
    {
   "id": "custom_module_mst39867",
   "name": "SpiralDBFilter",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\nnamespace App\\Lib;\r\n\r\nclass SpiralDBFilter{\r\n\r\n    protected $database;\r\n    protected $selectName = '';\r\n\tprotected $fields = array();\r\n\t\r\n\tprotected $apiSpiral;\r\n\t\r\n\tpublic function __construct(\\Spiral $SPIRAL,\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t\t$this->setApiSpiral($PbSpiralApiCommunicator,$SpiralApiRequest);\r\n\t}\r\n\t\r\n\tprivate function setApiSpiral(\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t//$this->spiral->setApiTokenTitle(APITITLE); //APIタイトル\r\n\t\t$this->apiSpiral = new \\App\\Lib\\ApiSpiral($this->spiral);\r\n\t\t$this->apiSpiral->setApiCommunicator($PbSpiralApiCommunicator);\r\n\t\t$this->apiSpiral->setSpiralApiRequest($SpiralApiRequest);\r\n\t}\r\n\t\r\n\tpublic function setDataBase(string $database){\r\n\t\t$this->database = $database;\r\n\t}\r\n\t\r\n\tpublic function addSelectName(string $selectName){\r\n        $this->selectName = $selectName;\r\n\t}\r\n\t\r\n\tpublic function addFields(array $fields){\r\n        $this->fields[] = $fields;\r\n\t}\r\n\r\n\tpublic function create(){\r\n\t\t$apiHeader = array(\"db_filter\",\"create\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['select_name'] = $this->selectName;\r\n\t\t$parameters['fields'] = $this->fields;\r\n\r\n\t\t$listData = $this->list();\r\n\t\tif($listData['code'] != '0'){\r\n\t\t\treturn $listData;\r\n\t\t}\r\n\r\n\t\tforeach($listData['data'] as $selectName){\r\n\t\t\tif($selectName['select_name'] == $this->selectName){\r\n\t\t\t\treturn array('code'=> '0','select_name'=>$this->selectName,'message'=>'registered');\r\n\t\t\t}\r\n\t\t}\r\n\t\t$this->clearData();\r\n\t\t\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function list(){\r\n\t\t$apiHeader = array(\"db_filter\",\"list\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['select_name'] = $this->selectName;\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tprivate function clearData(){\r\n\t\t$this->database = '';\r\n\t\t$this->selectName = '';\r\n\t\t$this->fields = '';\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39866",
   "name": "SpiralDataBase",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\nnamespace App\\Lib;\r\n\r\nclass SpiralDataBase {\r\n\r\n    protected $database;\r\n    protected $selectColumns = array();\r\n    protected $searchCondition = array();\r\n    protected $selectName;\r\n    protected $sort = array();\r\n\tprotected $groupBy = array();\r\n\tprotected $page = 1;\r\n\tprotected $linesPerPage = 10;\r\n\tprotected $apiSpiral ;\r\n\r\n\tpublic function __construct(\\Spiral $SPIRAL,\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t\t$this->setApiSpiral($PbSpiralApiCommunicator,$SpiralApiRequest);\r\n\t}\r\n\t\r\n\tprivate function setApiSpiral(\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t//$this->spiral->setApiTokenTitle(APITITLE); //APIタイトル\r\n\t\t$this->apiSpiral = new \\App\\Lib\\ApiSpiral($this->spiral);\r\n\t\t$this->apiSpiral->setApiCommunicator($PbSpiralApiCommunicator);\r\n\t\t$this->apiSpiral->setSpiralApiRequest($SpiralApiRequest);\r\n\t}\r\n\t\r\n\tpublic function addSelectFields(string ...$fields){\r\n        $this->selectColumns = $fields;\r\n\t}\r\n\t\r\n\tpublic function addSelectFieldsToArray(array $fields){\r\n        $this->selectColumns = $fields;\r\n    }\r\n\r\n    public function addSearchCondition(string $fieldTitle, string $value, string $operator = '=', string $connection  = 'and'){\r\n        $this->searchCondition[] = array( 'name' => $fieldTitle , 'value' => $value , 'operator' => $operator , 'logical_connection' => $connection );\r\n    }\r\n\r\n    public function addSortField(string $fieldTitle , string $order ){\r\n        $this->sort[] = array( 'name' => $fieldTitle , 'order' => $order );\r\n\t}\r\n\t\r\n\tpublic function addSelectNameCondition(string $selectName){\r\n\t\t$this->selectName = $selectName;\r\n\t}\r\n\r\n    public function setGroupByFields(string ...$fields){\r\n\t\t$this->groupBy = $fields;\r\n\t}\r\n\r\n\tpublic function setDataBase(string $databaseTitle){\r\n\t\t$this->database = $databaseTitle;\r\n\t}\r\n\r\n\tpublic function setPage(int $page){\r\n\t\t$this->page = $page;\r\n\t}\r\n\tpublic function setLinesPerPage(int $linesPerPage){\r\n\t\t$this->linesPerPage = $linesPerPage;\r\n\t}\r\n\r\n\tpublic function doSelect(bool $flag = true){\r\n\t\t$apiHeader = array(\"database\",\"select\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['select_columns'] = $this->selectColumns;\r\n\t\t$parameters['search_condition'] = $this->searchCondition;\r\n\t\t$parameters['sort'] = $this->sort;\r\n\t\t$parameters['group_by'] = $this->groupBy;\r\n\t\t$parameters['lines_per_page'] = $this->linesPerPage;\r\n\t\t$parameters['page'] = $this->page;\r\n\t\tif($flag){\r\n\t\t\t$this->clearData();\r\n\t\t}\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doInsert(array $insertData){\r\n\t\t$apiHeader = array(\"database\",\"insert\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['data'] = $this->obj2arr($insertData);\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\t\r\n\tpublic function doBulkInsert(array $columns ,array $insertData){\r\n\t\t$apiHeader = array(\"database\",\"bulk_insert\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['columns'] = $columns;\r\n\t\t$parameters['data'] = $this->obj2arr($insertData);\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\t\r\n\tpublic function doUpdate(array $updateData){\r\n\t\t$apiHeader = array(\"database\",\"update\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['select_name'] = $this->selectName;\r\n\t\t$parameters['search_condition'] = $this->searchCondition;\r\n\t\t$parameters['data'] = $this->obj2arr($updateData);\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doDelete(){\r\n\t\t$apiHeader = array(\"database\",\"delete\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['select_name'] = $this->selectName;\r\n\t\t$parameters['search_condition'] = $this->searchCondition;\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doBulkUpdate(string $keyTitle ,array $columns ,array $updateData){\r\n\t\t$apiHeader = array(\"database\",\"bulk_update\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['key'] = $keyTitle;\r\n\t\t$parameters['columns'] = $columns;\r\n\t\t$parameters['data'] = $this->obj2arr($updateData);\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doUpsert(string $keyTitle ,array $upsertData){\r\n\t\t$apiHeader = array(\"database\",\"upsert\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['key'] = $keyTitle;\r\n\t\t$parameters['data'] = $this->obj2arr($upsertData);\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doBulkUpsert(string $keyTitle ,array $columns ,array $bulkData){\r\n\t\t$apiHeader = array(\"database\",\"bulk_upsert\");\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['key'] = $keyTitle;\r\n\t\t$parameters['columns'] = $columns;\r\n\t\t$parameters['data'] = $this->obj2arr($bulkData);\r\n\t\t$this->clearData();\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function doSelectLoop(){\r\n\t\t$count = 1; // 1件以上ある想定\r\n\t\t$this->setLinesPerPage(1000);\r\n\t\t$loopdata = array();\r\n\t\t$resdata = array();\r\n\t\tfor($page = 1; $page <= ceil($count / $this->linesPerPage ); $page++) {\r\n\t\t\t$this->setPage($page);\r\n\t\t\t$flag = false;\r\n\t\t\t$response = $this->doSelect($flag);\r\n\t\t\tif($response['code'] != \"0\"){\r\n\t\t\t\treturn $response;\r\n\t\t\t}\r\n\t\t\t$count = $response['count'];\r\n\t\t\t$resdata = array_merge($resdata, $response['data']);\r\n\t\t}\r\n\t\t$this->clearData();\r\n\t\treturn array( 'data' => $resdata , 'count' => $response['count'] , 'code' => '0' ,'message' => $response['message']);\r\n\t}\r\n\r\n\tprivate function clearData(){\r\n\t\t$this->database = \"\";\r\n\t\t$this->selectColumns = array();\r\n\t\t$this->searchCondition = array();\r\n\t\t$this->selectName = \"\";\r\n\t\t$this->sort = array();\r\n\t\t$this->groupBy = array();\r\n\t\t$this->page = 1;\r\n\t\t$this->linesPerPage = 10;\r\n\t}\r\n\r\n\t\r\n\tpublic function arrayToNameArray(array $selectData , array $selectColumns){\r\n\t\t$result = array();\r\n\t\tforeach($selectData as $rnum => $record){\r\n\t\t\t$result[$rnum] = array();\r\n\t\t\tforeach($record as $key => $data){\r\n\t\t\t\t$result[$rnum][$selectColumns[$key]] = $data;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $result;\r\n\t}\r\n\r\n\tprivate function obj2arr($obj){\r\n\t\tif ( ! is_object($obj) && ! is_array($obj)  ) return htmlspecialchars($obj, ENT_QUOTES, \"UTF-8\");\r\n\t\r\n\t\t$arr = (array) $obj;\r\n\t\r\n\t\tforeach ( $arr as &$a )\r\n\t\t{\r\n\t\t\t$a = $this->obj2arr($a);\r\n\t\t}\r\n\t\treturn $arr;\r\n\t}\r\n}"
  },
    {
   "id": "custom_module_mst39868",
   "name": "SpiralSendMail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\nnamespace App\\Lib;\r\n\r\nclass SpiralSendMail{\r\n\r\n    protected $database;\r\n    protected $mailFieldTitle = '';\r\n    protected $reserveDate = 'now';\r\n    protected $subject = '';\r\n    protected $bodyText = '';\r\n    protected $fromAddress = '';\r\n    protected $fromName = '';\r\n    protected $replyTo = '';\r\n    protected $selectName = '';\r\n    protected $searchCondition = array();\r\n    protected $apiSpiral;\r\n\r\n\tpublic function __construct(\\Spiral $SPIRAL,\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t\t$this->setApiSpiral($PbSpiralApiCommunicator,$SpiralApiRequest);\r\n\t}\r\n\t\r\n\tprivate function setApiSpiral(\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t//$this->spiral->setApiTokenTitle(APITITLE); //APIタイトル\r\n\t\t$this->apiSpiral = new \\App\\Lib\\ApiSpiral($this->spiral);\r\n\t\t$this->apiSpiral->setApiCommunicator($PbSpiralApiCommunicator);\r\n\t\t$this->apiSpiral->setSpiralApiRequest($SpiralApiRequest);\r\n\t}\r\n\r\n\tpublic function setDataBase(string $database){\r\n\t\t$this->database = $database;\r\n\t}\r\n\t\r\n\tpublic function addMailFieldTitle(string $field){\r\n        $this->mailFieldTitle = $field;\r\n\t}\r\n\t\r\n\tpublic function addReserveDate(string $date){\r\n        $this->reserveDate = $date;\r\n\t}\r\n\t\r\n\tpublic function addSubject(string $subject){\r\n        $this->subject = $subject;\r\n\t}\r\n\t\r\n\tpublic function addBodyText(string $bodyText){\r\n        $this->bodyText = $bodyText;\r\n\t}\r\n\t\r\n\tpublic function addFromAddress(string $fromAddress){\r\n        $this->fromAddress = $fromAddress;\r\n\t}\r\n\t\r\n\tpublic function addFromName(string $fromName){\r\n        $this->fromName = $fromName;\r\n\t}\r\n\t\r\n\tpublic function addReplyTo(string $replyTo){\r\n        $this->replyTo = $replyTo;\r\n\t}\r\n\t\r\n\tpublic function addSelectName(string $selectName){\r\n        $this->selectName = $selectName;\r\n\t}\r\n\t\r\n\tpublic function addSearchCondition(array $searchCondition){\r\n        $this->searchCondition[] = $searchCondition;\r\n\t}\r\n\r\n\tpublic function regist(){\r\n\t\t$apiHeader = array(\"deliver_express2\",\"regist\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['mail_field_title'] = $this->mailFieldTitle;\r\n\t\t$parameters['reserve_date'] = $this->reserveDate;\r\n\t\t$parameters['subject'] = $this->subject;\r\n\t\t$parameters['body_text'] = $this->bodyText;\r\n\t\t$parameters['from_address'] = $this->fromAddress;\r\n\t\t$parameters['from_name'] = $this->fromName;\r\n\t\t$parameters['reply_to'] = $this->replyTo;\r\n\t\t$parameters['select_name'] = $this->selectName;\r\n\t\t$this->clearData();\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function list(){\r\n\t\t$apiHeader = array(\"deliver_express2\",\"list\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['search_condition'] = $this->searchCondition;\r\n\t\t$this->clearData();\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function cancel(){\r\n\t\t$apiHeader = array(\"deliver_express2\",\"cancel\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['db_title'] = $this->database;\r\n\t\t$parameters['search_condition'] = $this->searchCondition;\r\n\t\t$this->clearData();\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tpublic function thanks($rule_id,$id){\r\n\t\t$apiHeader = array(\"deliver_thanks\",\"send\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['rule_id'] = $rule_id;\r\n\t\t$parameters['id'] = $id;\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tprivate function clearData(){\r\n\t\t$this->database;\r\n\t\t$this->mailFieldTitle = '';\r\n\t\t$this->reserveDate = 'now';\r\n\t\t$this->subject = '';\r\n\t\t$this->bodyText = '';\r\n\t\t$this->fromAddress = '';\r\n\t\t$this->fromName = '';\r\n\t\t$this->replyTo = '';\r\n\t\t$this->selectName = '';\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39869",
   "name": "SpiralTable",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php\r\n\r\nnamespace App\\Lib;\r\n\r\nclass SpiralTable {\r\n\r\n\tprotected $jsessionid = '';\r\n\tprotected $myAreaTitle = '';\r\n\tprotected $cardTitle = '';\r\n\tprotected $ids = array();\r\n\tprotected $apiSpiral;\r\n\r\n\tpublic function __construct(\\Spiral $SPIRAL,\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t\t$this->setApiSpiral($PbSpiralApiCommunicator,$SpiralApiRequest);\r\n\t}\r\n\t\r\n\tprivate function setApiSpiral(\\PbSpiralApiCommunicator $PbSpiralApiCommunicator ,\\SpiralApiRequest $SpiralApiRequest){\r\n\t\t//$this->spiral->setApiTokenTitle(APITITLE); //APIタイトル\r\n\t\t$this->apiSpiral = new \\App\\Lib\\ApiSpiral($this->spiral);\r\n\t\t$this->apiSpiral->setApiCommunicator($PbSpiralApiCommunicator);\r\n\t\t$this->apiSpiral->setSpiralApiRequest($SpiralApiRequest);\r\n\t}\r\n\r\n\tpublic function setJsessionid(string $jsessionid){\r\n\t\t$this->jsessionid = $jsessionid;\r\n\t}\r\n\t\r\n\tpublic function setMyAreaTitle(string $myAreaTitle){\r\n        $this->myAreaTitle = $myAreaTitle;\r\n\t}\r\n\r\n\tpublic function setCardTitle(string $cardTitle){\r\n        $this->cardTitle = $cardTitle;\r\n\t}\r\n\t\r\n\tpublic function addIds(string $id){\r\n        $this->ids[] = $id;\r\n\t}\r\n\r\n\tpublic function getCardUrls(){\r\n\t\t$apiHeader = array(\"table\",\"card\");\r\n\t\t$parameters = array();\r\n\t\t$parameters['jsessionid'] = $this->jsessionid;\r\n\t\t$parameters['my_area_title'] = $this->myAreaTitle;\r\n\t\t$parameters['card_title'] = $this->cardTitle;\r\n\t\t$parameters['ids'] = $this->ids;\r\n\t\t$parameters['url_type'] = '2';\r\n\t\t$this->clearData();\r\n\r\n\t\treturn $this->apiSpiral->requestAPI($apiHeader, $parameters);\r\n\t}\r\n\r\n\tprivate function clearData(){\r\n\t\t$this->jsessionid = '';\r\n\t\t$this->myAreaTitle = '';\r\n\t\t$this->cardTitle = '';\r\n\t\t$this->ids = array();\r\n\t}\r\n\r\n}"
  },
    {
   "id": "custom_module_mst39870",
   "name": "UserInfo",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/lib/",
   "php_script": "<?php \r\n\r\nnamespace App\\Lib;\r\n\r\nclass UserInfo{\r\n\r\n    private $spiral ;\r\n\r\n    public function __construct(\\Spiral $SPIRAL){\r\n\t\t$this->spiral = $SPIRAL;\r\n\t}\r\n\r\n    public function getSPIRAL(){\r\n        return $this->spiral;\r\n    }\r\n\r\n    public function getHospitalId(){\r\n        return $this->spiral->getContextByFieldTitle(\"hospitalId\");\r\n    }\r\n\r\n    public function getDivisionId(){\r\n        return $this->spiral->getContextByFieldTitle(\"divisionId\");\r\n    }\r\n    \r\n    public function getLoginId(){\r\n        return $this->spiral->getContextByFieldTitle(\"loginId\");\r\n    }\r\n\r\n    public function getName(){\r\n        return $this->spiral->getContextByFieldTitle(\"name\");\r\n    }\r\n\r\n    public function getMailAddress(){\r\n        return $this->spiral->getContextByFieldTitle(\"mailAddress\");\r\n    }\r\n    \r\n    public function getTenantId(){\r\n        return $this->spiral->getContextByFieldTitle(\"tenantId\");\r\n    }\r\n\r\n    public function getDistributorId(){\r\n        return $this->spiral->getContextByFieldTitle(\"distributorId\");\r\n    }\r\n    \r\n    public function getUserPermission(){\r\n        return $this->spiral->getContextByFieldTitle(\"userPermission\");\r\n    }\r\n}"
  },
    {
   "id": "custom_module_mst39872",
   "name": "AdminMenu",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/src/",
   "php_script": "<div class=\"uk-background-muted uk-padding-small\"  uk-height-viewport=\"offset-top: true\" style=\"border-right:#98CB00 1px solid\">\r\n\t<a href=\"#\" class=\"uk-navbar-item uk-logo\">\r\n\t<img src=\"https://i02.smp.ne.jp/u/joypla/images/logo_png.png\" />\r\n\t<\/a>\r\n\t<ul class=\"uk-nav-default uk-nav-parent-icon\" uk-nav>\r\n\t\t<li><a href=\"%url/rel:mpgt:page_263720%\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: thumbnails\"><\/span> テナント管理<\/a><\/li>\r\n\t\t<li><a href=\"#\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: users\"><\/span> 病院管理<\/a><\/li>\r\n\t\t<li><a href=\"#\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: users\"><\/span> 卸業者管理<\/a><\/li>\r\n\t\t<li><a href=\"#\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: album\"><\/span> 商品マスタ管理<\/a><\/li>\r\n\t\t<li class=\"uk-nav-divider\"><\/li>\r\n\t\t<li><a href=\"#\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: question\"><\/span> お問合せ管理<\/a><\/li>\r\n\t\t<li class=\"uk-nav-divider\"><\/li>\r\n\t\t<li><a href=\"#\"><span class=\"uk-margin-small-right\" uk-icon=\"icon: sign-out\"><\/span> ログアウト<\/a><\/li>\r\n\t<\/ul>\r\n<\/div>"
  },
    {
   "id": "custom_module_mst39873",
   "name": "AgreementText",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/src/",
   "php_script": "<div class=\"uk-container\">\r\n    <h3>利用規約<\/h3>\r\n    <hr>\t\t\r\n    <div class=\"uk-grid-match uk-padding-small uk-height-large\" uk-height-viewport=\"min-height: 300\">\r\n    <object data=\"https://i02.smp.ne.jp/u/joypla/new/pdf/joypla-spdkiyaku20.pdf\" type=\"application/pdf\" width=\"100%\" height=\"100%\">\r\n        <iframe src=\"https://i02.smp.ne.jp/u/joypla/new/pdf/joypla-spdkiyaku20.pdf\" width=\"100%\" height=\"100%\">\r\n            <p><b>閲覧できない方はこちら<\/b>: <a href=\"https://i02.smp.ne.jp/u/joypla/new/pdf/joypla-spdkiyaku20.pdf\">PDF をダウンロード<\/a>.<\/p>\r\n        <\/iframe>\r\n    <\/object>\r\n\r\n    <\/div>\r\n            \r\n<\/div>"
  },
    {
   "id": "custom_module_mst39874",
   "name": "Head",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/src/",
   "php_script": "<link rel=\"icon\" href=\"https://i02.smp.ne.jp/u/joypla/new/favicon.ico\">\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n    <!-- UIkit CSS -->\r\n\t<link rel=\"stylesheet\" href=\"https://i02.smp.ne.jp/u/joypla/new/css/uikit.min.css\" />\r\n\t<link rel=\"stylesheet\" href=\"https://i02.smp.ne.jp/u/joypla/new/css/normalize.css\" />\r\n \r\n\t<!-- UIkit JS -->\r\n\t<script src=\"https://i02.smp.ne.jp/u/joypla/new/js/uikit.min.js\"><\/script>\r\n\t<script src=\"https://i02.smp.ne.jp/u/joypla/new/js/uikit-icons.min.js\"><\/script>\r\n \r\n    <script src=\"https://i02.smp.ne.jp/u/joypla/new/js/jquery-3.5.1.js\"><\/script>\r\n\r\n\t<link rel=\"stylesheet\" href=\"https://i02.smp.ne.jp/u/joypla/new/css/animsition.min.css\">\r\n\t<script type=\"text/javascript\" src=\"https://i02.smp.ne.jp/u/joypla/new/js/animsition.min.js\"><\/script>\r\n\t\r\n    <script src=\"https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js\"><\/script>\r\n    \r\n    <script>\r\n\t$(function(){\r\n\t  $('input[type=\"number\"]').on('change', function(e){\r\n\t\tchangeForInputNumber(this);\r\n\t  });\r\n\t});\r\n\r\n\tfunction changeForInputNumber(elm){\r\n\t    var month = parseInt($(elm).val());\r\n\t    var monthMax = parseInt($(elm).attr('max'));\r\n\t    var monthMin = parseInt($(elm).attr('min'));\r\n\t    if(month > monthMax){ $(elm).val(monthMax); }\r\n\t    if(month < monthMin){ $(elm).val(monthMin); }\r\n\t    if(isNaN(month)){ \r\n\t\t\tif(monthMin){ $(elm).val(monthMin); \r\n\t\t\t} else {$(elm).val(monthMin);}\r\n\t\t}\r\n\t}\r\n\r\n    $(document).ready(function() {\r\n    \t//$(\".animsition\").show();\r\n\r\n    \t$(\".animsition\").animsition({\r\n\t\t\tinClass: 'fade-in', // ロード時のエフェクト\r\n\t\t\toutClass: 'fade-out', // 離脱時のエフェクト\r\n\t\t\tinDuration: 500, // ロード時の演出時間\r\n\t\t\toutDuration: 80, // 離脱時の演出時間\r\n\t\t\t//linkElement: '.animsition-link', // アニメーションを行う要素\r\n\t\t\t// e.g. linkElement: 'a:not([target=\"_blank\"]):not([href^=\"#\"])'\r\n\t\t\tloading: true, // ローディングの有効/無効\r\n\t\t\tloadingParentElement: 'body', // ローディング要素のラッパー\r\n\t\t\tloadingClass: 'animsition-loading', // ローディングのクラス\r\n\t\t\tloadingInner: '', // e.g '' ローディングの内容\r\n\t\t\ttimeout: true, // 一定時間が経ったらアニメーションをキャンセルの有効/無効\r\n\t\t\ttimeoutCountdown: 500, // アニメーションをキャンセルするまでの時間\r\n\t\t\tonLoadEvent: true, // onLoadイベント後にアニメーションをするかの有効/無効\r\n\t\t\tbrowser: [ 'animation-duration', '-webkit-animation-duration'],\r\n\t\t\t// \"browser\" option allows you to disable the \"animsition\" in case the css property in the array is not supported by your browser.\r\n\t\t\t// The default setting is to disable the \"animsition\" in a browser that does not support \"animation-duration\".\r\n\t\t\t// ブラウザが配列内のCSSプロパティをサポートしていない場合、アニメーションを中止します。デフォルトは「animation-duration」をサポートしていない場合です。\r\n\t\t\t//overlay : false, // オーバーレイの有効/無効\r\n\t\t\t//overlayClass : 'animsition-overlay-slide', // オーバーレイのクラス\r\n\t\t\t//overlayParentElement : 'body', // オーバーレイ要素のラッパー\r\n\t\t\t//transition: function(url){ window.location.href = url; } // transition後にどこに遷移させるかを設定、urlは「linkElement」のhref\r\n\t\t\t}\r\n\t\t );\r\n    });\t\r\n    \r\n    \r\n\tfunction loading(){\r\n\t\t$(\".animsition\").animsition({\r\n\t\t\tinDuration: 500, // ロード時の演出時間\r\n\t\t\toutDuration: 80, // 離脱時の演出時間\r\n\t\t\tlinkElement: '.animsition-link', // アニメーションを行う要素\r\n\t\t\t// e.g. linkElement: 'a:not([target=\"_blank\"]):not([href^=\"#\"])'\r\n\t\t\tloading: true, // ローディングの有効/無効\r\n\t\t\tloadingParentElement: 'body', // ローディング要素のラッパー\r\n\t\t\tloadingClass: 'animsition-loading', // ローディングのクラス\r\n\t\t\tloadingInner: '', // e.g '' ローディングの内容\r\n\t\t\ttimeout: false, // 一定時間が経ったらアニメーションをキャンセルの有効/無効\r\n\t\t\ttimeoutCountdown: 500, // アニメーションをキャンセルするまでの時間\r\n\t\t\tonLoadEvent: true, // onLoadイベント後にアニメーションをするかの有効/無効\r\n\t\t\tbrowser: [ 'animation-duration', '-webkit-animation-duration'],\r\n\t\t\t// \"browser\" option allows you to disable the \"animsition\" in case the css property in the array is not supported by your browser.\r\n\t\t\t// The default setting is to disable the \"animsition\" in a browser that does not support \"animation-duration\".\r\n\t\t\t// ブラウザが配列内のCSSプロパティをサポートしていない場合、アニメーションを中止します。デフォルトは「animation-duration」をサポートしていない場合です。\r\n\t\t\toverlay : false, // オーバーレイの有効/無効\r\n\t\t\toverlayClass : 'animsition-overlay-slide', // オーバーレイのクラス\r\n\t\t\toverlayParentElement : 'body', // オーバーレイ要素のラッパー\r\n\t\t\t//transition: function(url){ window.location.href = url; } // transition後にどこに遷移させるかを設定、urlは「linkElement」のhref\r\n\t\t}\r\n\t );\r\n\t}\r\n\t\r\n\tfunction loading_remove(){\r\n\t\t$('.animsition-loading').remove();\r\n\t}\r\n\t\r\n\tfunction generateBarcode(idname,value){\r\n    \tJsBarcode(\"#\"+idname,value,{format: \"ITF\", width: 1.8, height: 50,fontSize: 14});\r\n    \t//JsBarcode(\"#\"+idname,value,{format: \"CODE128\", width: 1.8, height: 50,fontSize: 14});\r\n    \t//JsBarcode(\"#\"+idname,value,{ width: 1.8, height: 50,fontSize: 14});\r\n\t//$(elm).barcode(value.replace(/\\r?\\n/g,\"\").trim(), btype, settings);\r\n\t}\r\n        \r\n    gs1128_object = {'01':'','17':'','10':'','21':'','30':''};\r\n\r\n\tfunction addCheckDigit(barcodeStr) { // 引数は文字列\r\n        // 短縮用処理\r\n        barcodeStr = ('00000' + barcodeStr).slice(-13);\r\n        let evenNum = 0, oddNum = 0;\r\n        for (var i = 0; i < barcodeStr.length - 1; i++) {\r\n            if (i % 2 == 0) { // 「奇数」かどうか（0から始まるため、iの偶数と奇数が逆）\r\n                oddNum += parseInt(barcodeStr[i]);\r\n            } else {\r\n                evenNum += parseInt(barcodeStr[i]);\r\n            }\r\n        }\r\n        // 結果\r\n        return String(barcodeStr.slice(0,12)) + String(10 - parseInt((evenNum * 3 + oddNum).toString().slice(-1)));\r\n    }\r\n\t\r\n\tfunction check_gs1128(code){\r\n\t\tlet allcheck = false;\r\n\t\tif(code.indexOf(\"01\") === 0){\r\n\t\t\tcode = code.slice( 2 );\r\n\t\t\tgs1128_object['01'] = code.slice( 0, 14 );\r\n\t\t\tcode = code.slice( 14 );\r\n\t\t}else if(code.indexOf(\"17\") === 0){\r\n\t\t\tcode = code.slice( 2 );\r\n\t\t\tgs1128_object['17'] = code.slice( 0, 6 );\r\n\t\t\tcode = code.slice( 6 );\r\n\t\t}else if(code.indexOf(\"10\") === 0){\r\n\t\t\tcode = code.slice( 2 );\r\n\t\t\tif(code.indexOf(\" \") == -1){\r\n\t\t\t\tgs1128_object['10'] = code;\r\n\t\t\t\tcode = '';\r\n\t\t\t} else {\r\n\t\t\t\tgs1128_object['10'] = code.slice( 0, code.indexOf(\" \"));\r\n\t\t\t\tcode = code.slice( code.indexOf(\" \") + 1 );\r\n\t\t\t}\r\n\t\t}else if(code.indexOf(\"21\") === 0){\r\n\t\t\tcode = code.slice( 2 );\r\n\t\t\tif(code.indexOf(\" \") == -1){\r\n\t\t\t\tgs1128_object['21'] = code;\r\n\t\t\t\tcode = '';\r\n\t\t\t} else {\r\n\t\t\t\tgs1128_object['21'] = code.slice( 0, code.indexOf(\" \"));\r\n\t\t\t\tcode = code.slice( code.indexOf(\" \") + 1 );\r\n\t\t\t}\r\n\t\t}else if(code.indexOf(\"30\") === 0){\r\n\t\t\tcode = code.slice( 2 );\r\n\t\t\tif(code.indexOf(\" \") == -1){\r\n\t\t\t\tgs1128_object['30'] = code;\r\n\t\t\t\tcode = '';\r\n\t\t\t} else {\r\n\t\t\t\tgs1128_object['30'] = code.slice( 0, code.indexOf(\" \"));\r\n\t\t\t\tcode = code.slice( code.indexOf(\" \") + 1 );\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tallcheck = true;\r\n\t\t}\r\n\t\t\r\n\t\tif(code.length != 0 && !allcheck){\r\n\t\t\treturn check_gs1128(code);\r\n\t\t}\r\n\t\treturn gs1128_object;\r\n\t}  \r\n\t    function price(num){\r\n\t\t\tif(num === \"\") {\r\n\t\t\t\tnum = \"0\";\r\n\t\t\t}\r\n\t\t\tlet _num = num.replace( /^(-?\\d+)(\\d{3})/, \"$1,$2\" );\r\n\t\t\tif(_num !== num) {\r\n\t\t\t\treturn price(_num);\r\n\t\t    }\r\n\t\t    document.write(_num);\r\n\t\t}\r\n\t\tfunction price_text(num){\r\n\t\t\tif(num === \"\") {\r\n\t\t\t\tnum = \"0\";\r\n\t\t\t}\r\n\t\t\tlet _num = num.replace( /^(-?\\d+)(\\d{3})/, \"$1,$2\" );\r\n\t\t\tif(_num !== num) {\r\n\t\t\t\treturn price(_num);\r\n\t\t    }\r\n\t\t    return _num;\r\n\t\t}\r\n\t\tfunction fixed(num){\r\n\t\t\r\n\t\t\treturn parseFloat(num).toFixed(2);\r\n\t\t}\r\n\t\t\r\n\t\tfunction objectValueToURIencode(object){\r\n\t\t\tlet result = {};\r\n\t\t\t\r\n\t\t\tif(object == null){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tObject.keys(object).forEach(function (key) {\r\n\t\t\t\tif( typeof object[key] == \"object\"){\r\n\t\t\t\t\tresult[key] = objectValueToURIencode(object[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult[key] = encodeURI(object[key]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\t\t}\r\n\t<\/script>\r\n    <style>\r\n\t\t.uk-input[type=\"number\"]{\r\n\t\t\ttext-align: right;\r\n\t\t}\r\n        table.uk-table-divider tr:last-of-type{\r\n          border-bottom: 1px solid #e5e5e5;\r\n        }\r\n        table#tbl-Items tr td{\r\n        \tpadding: 12px 0px 12px 12px !important;\r\n        }\r\n    \t.uk-navbar-container{\r\n    \t\tborder-bottom : solid 2px #98CB00;\r\n    \t}\r\n    \t.bk-application-color{\r\n    \t\tbackground : #98CB00;\r\n    \t}\r\n    \t\r\n\t\ttable td.active{\r\n\t\t    background-color: #AACC44 !important;\r\n\t\t}\r\n\t\ttable td{\r\n\t\t\tvertical-align: middle !important;\r\n\t\t}\r\n\t\ttable.uk-table td, table.uk-table th{\r\n\t\t\tfont-size: 1.0em;\r\n\t\t}\r\n\t\t\r\n\t\t.uk-navbar-container{\r\n\t\t\tborder-bottom : solid 2px #98CB00;\r\n\t\t}\r\n\t\t.bk-application-color{\r\n\t\t\tbackground : #98CB00;\r\n\t\t}\r\n\t\t\r\n\t\t.uk-table th{\r\n\t\t\ttext-transform: none !important;\r\n\t\t}\r\n\t\t\r\n\t\t.resultarea{\r\n\t\t\tdisplay:none;\r\n\t\t}\r\n    \t@media print{\r\n\t\t\t.print-width-1-1{\r\n\t\t\t\twidth:100% !important;\r\n\t\t\t}\r\n\t\t\ttable.uk-table-responsive{\r\n\t\t\t    display: table;\r\n\t\t\t} \r\n\t\t\ttable.uk-table-responsive tbody{\r\n\t\t\t    display: table-row-group;\r\n\t\t\t} \r\n\t\t\ttable.uk-table-responsive td, \r\n\t\t\ttable.uk-table-responsive th{\r\n\t\t\t    display: table-cell;\r\n\t\t\t\tpadding: 16px 12px !important;\r\n\t\t\t} \r\n\t\t\ttable.uk-table-responsive .uk-table-link:not(:last-child)>a, \r\n\t\t\ttable.uk-table-responsive td:not(:last-child):not(.uk-table-link), \r\n\t\t\ttable.uk-table-responsive th:not(:last-child):not(.uk-table-link){\r\n\t\t\t\tpadding: 16px 12px !important;\r\n\t\t\t}\r\n\t\t\ttable.uk-table-responsive .uk-table-link:not(:first-child)>a, \r\n\t\t\ttable.uk-table-responsive td:not(:first-child):not(.uk-table-link), \r\n\t\t\ttable.uk-table-responsive th:not(:first-child):not(.uk-table-link){\r\n\t\t\t\tpadding: 16px 12px !important;\r\n\t\t\t}\r\n\r\n\t\t\ttable.uk-table-responsive tr {\r\n\t\t\t    display: table-row;\r\n\t\t\t}\r\n\r\n\t\t\t.uk-text-nowrap{\r\n\t\t\t\twhite-space: normal;\r\n\t\t\t\t/*white-space:break-spaces !important;*/\r\n\t\t\t}\r\n\t\t\t.uk-table th{\r\n\t\t\t\twhite-space: nowrap !important;\r\n\t\t\t}\r\n\t    \t.no_print{\r\n\t\t        display: none;\r\n\t\t    }\r\n        \t.printarea{\r\n                page-break-after: always;\r\n                font-size: 12px;\r\n            }\r\n            body{\r\n            \tzoom: 60%; /* Equal to scaleX(0.7) scaleY(0.7) */\r\n            }\r\n            \r\n\t\t\t/* Single Widths\r\n\t\t\t ========================================================================== */\r\n\t\t\t/*\r\n\t\t\t * 1. `max-width` is needed for the pixel-based classes\r\n\t\t\t */\r\n\t\t\t[class*='uk-width'] {\r\n\t\t\t  box-sizing: border-box;\r\n\t\t\t  width: 100%;\r\n\t\t\t  /* 1 */\r\n\t\t\t  max-width: 100%;\r\n\t\t\t}\r\n\t\t\t/* Halves */\r\n\t\t\t.uk-width-1-2,\r\n\t\t\t.uk-width-1-2\\@s,\r\n\t\t\t.uk-width-1-2\\@m,\r\n\t\t\t.uk-width-1-2\\@l{\r\n\t\t\t  width: 50%;\r\n\t\t\t}\r\n\t\t\t/* Thirds */\r\n\t\t\t.uk-width-1-3,\r\n\t\t\t.uk-width-1-3\\@s,\r\n\t\t\t.uk-width-1-3\\@m,\r\n\t\t\t.uk-width-1-3\\@l {\r\n\t\t\t  width: calc(100% * 1 / 3.001);\r\n\t\t\t}\r\n\t\t\t.uk-width-2-3,\r\n\t\t\t.uk-width-2-3\\@s,\r\n\t\t\t.uk-width-2-3\\@m,\r\n\t\t\t.uk-width-2-3\\@l {\r\n\t\t\t  width: calc(100% * 2 / 3.001);\r\n\t\t\t}\r\n\t\t\t/* Quarters */\r\n\t\t\t.uk-width-1-4,\r\n\t\t\t.uk-width-1-4\\@s,\r\n\t\t\t.uk-width-1-4\\@m,\r\n\t\t\t.uk-width-1-4\\@l {\r\n\t\t\t  width: 25%;\r\n\t\t\t}\r\n\t\t\t.uk-width-3-4,\r\n\t\t\t.uk-width-3-4\\@s,\r\n\t\t\t.uk-width-3-4\\@m,\r\n\t\t\t.uk-width-3-4\\@l {\r\n\t\t\t  width: 75%;\r\n\t\t\t}\r\n\t\t\t/* Fifths */\r\n\t\t\t.uk-width-1-5,\r\n\t\t\t.uk-width-1-5\\@s,\r\n\t\t\t.uk-width-1-5\\@m,\r\n\t\t\t.uk-width-1-5\\@l {\r\n\t\t\t  width: 20%;\r\n\t\t\t}\r\n\t\t\t.uk-width-2-5,\r\n\t\t\t.uk-width-2-5\\@s,\r\n\t\t\t.uk-width-2-5\\@m,\r\n\t\t\t.uk-width-2-5\\@l {\r\n\t\t\t  width: 40%;\r\n\t\t\t}\r\n\t\t\t.uk-width-3-5,\r\n\t\t\t.uk-width-3-5\\@s,\r\n\t\t\t.uk-width-3-5\\@m,\r\n\t\t\t.uk-width-3-5\\@l {\r\n\t\t\t  width: 60%;\r\n\t\t\t}\r\n\t\t\t.uk-width-4-5,\r\n\t\t\t.uk-width-4-5\\@s,\r\n\t\t\t.uk-width-4-5\\@m,\r\n\t\t\t.uk-width-4-5\\@l {\r\n\t\t\t  width: 80%;\r\n\t\t\t}\r\n\t\t\t/* Sixths */\r\n\t\t\t.uk-width-1-6,\r\n\t\t\t.uk-width-1-6\\@s,\r\n\t\t\t.uk-width-1-6\\@m,\r\n\t\t\t.uk-width-1-6\\@l {\r\n\t\t\t  width: calc(100% * 1 / 6.001);\r\n\t\t\t}\r\n\t\t\t.uk-width-5-6,\r\n\t\t\t.uk-width-5-6\\@s,\r\n\t\t\t.uk-width-5-6\\@m,\r\n\t\t\t.uk-width-5-6\\@l {\r\n\t\t\t  width: calc(100% * 5 / 6.001);\r\n\t\t\t}\r\n\t\t\t/* Pixel */\r\n\t\t\t.uk-width-small {\r\n\t\t\t  width: 150px;\r\n\t\t\t}\r\n\t\t\t.uk-width-medium {\r\n\t\t\t  width: 300px;\r\n\t\t\t}\r\n\t\t\t.uk-width-large {\r\n\t\t\t  width: 450px;\r\n\t\t\t}\r\n\t\t\t.uk-width-xlarge {\r\n\t\t\t  width: 600px;\r\n\t\t\t}\r\n\t\t\t.uk-width-2xlarge {\r\n\t\t\t  width: 750px;\r\n\t\t\t}\r\n\t\t\t/* Auto */\r\n\t\t\t.uk-width-auto {\r\n\t\t\t  width: auto;\r\n\t\t\t}\r\n\t\t\t/* Expand */\r\n\t\t\t.uk-width-expand {\r\n\t\t\t  flex: 1;\r\n\t\t\t  min-width: 1px;\r\n\t\t\t} \r\n\t\t\t.uk-table .fix .uk-button, .uk-table .no_fix .uk-button, .uk-table .labelCreate .uk-button{\r\n\t\t\t\tdisplay: none;\r\n\t\t\t}\r\n    \t}\r\n/*\r\n * Primary\r\n */\r\n.uk-button-primary {\r\n  background-color: #7AAE36;\r\n  color: #fff;\r\n  border: 1px solid transparent;\r\n}\r\n/* Hover + Focus */\r\n.uk-button-primary:hover,\r\n.uk-button-primary:focus {\r\n  background-color: #93BD5B;\r\n  color: #fff;\r\n}\r\n.uk-button-primary:disabled:hover,\r\n.uk-button-primary:disabled:focus {\r\n  background-color: transparent;\r\n  color: #999;\r\n}\r\n/* OnClick + Active */\r\n.uk-button-primary:active,\r\n.uk-button-primary.uk-active {\r\n  background-color: #B2D08B;\r\n  color: #fff;\r\n}\r\n/*\r\n * Success\r\n */\r\n.uk-label-success {\r\n  background-color: #7AAE36;\r\n  color: #fff;\r\n}\r\n\r\n.uk-table tr:last-child{\r\n\tborder-bottom: 1px solid #e5e5e5;\r\n}\r\n\r\n.uk-table tr.tr-gray{\r\n  background: #e5e5e5;\r\n}\r\n<\/style>"
  },
    {
   "id": "custom_module_mst39875",
   "name": "Header",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/src/",
   "php_script": "<nav class=\"uk-navbar-container no_print\" uk-navbar>\r\n    <div class=\"uk-navbar-left\">\r\n        <a href=\"#\" class=\"uk-navbar-item uk-logo\">\r\n            <img src=\"https://i02.smp.ne.jp/u/joypla/images/logo_png.png\" />\r\n        <\/a>\r\n    <\/div>\r\n<\/nav>"
  },
    {
   "id": "custom_module_mst39876",
   "name": "HeaderForMypage",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/src/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once 'NewJoyPla/api/GetDistributor.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\nif($userInfo->getDistributorId() == ''){\r\n\t$getUserData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n\t$byouinResult = $getUserData->select();\r\n} else {\r\n\t$getUserData = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n\t$oroshiResult = $getUserData->getMyDistributor($userInfo->getDistributorId());\r\n}\r\n?>\r\n\r\n<nav class=\"uk-navbar-container no_print\" uk-navbar>\r\n\t<div class=\"uk-navbar-left\">\r\n\t\t<a href=\"%url/rel:mpg:top%\" class=\"uk-navbar-item uk-logo\">\r\n\t\t\t<img src=\"https://i02.smp.ne.jp/u/joypla/images/logo_png.png\" />\r\n\t\t<\/a>\r\n\t<\/div>\r\n\r\n\t<div class=\"uk-navbar-right uk-margin-right\" style=\"flex-wrap: nowrap;\">\r\n\t\t<p class=\"uk-margin-auto-vertical uk-visible@s uk-margin-right uk-text-right\">\r\n\t\t\t<?php echo ($oroshiResult['data'][0][0] != '')? $oroshiResult['data'][0][0].'<br>' : '' ; ?>\r\n\t\t\t<?php echo ($byouinResult['data'][0]['hospitalName'] != '')? $byouinResult['data'][0]['hospitalName'].'<br>' : '' ; ?>\r\n\t\t\t<?php echo $userInfo->getName();?> 様\r\n\t\t<\/p>\r\n\t\t<a href=\"%url/rel:mpg:top%\" class=\"uk-icon-button uk-margin-right\" uk-icon=\"icon: home; ratio: 1.5\" title=\"TOPへ戻る\"><\/a>\r\n\t\t<a href=\"#\" class=\"uk-icon-button uk-margin-right\" uk-icon=\"icon: mail; ratio: 1.5\" title=\"お問合せ\" onclick=\"document.contactUs.submit()\"><\/a>\r\n\t\t<form method=\"post\" action=\"/regist/is\" name=\"contactUs\" target=\"_blank\">\r\n\t\t\t%SMPAREA%\r\n\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:contactUs%\">\r\n\t\t<\/form>\r\n\t\t<a href=\"%form:act:logout%\" class=\"uk-icon-button\" uk-icon=\"icon: sign-out; ratio: 1.5\" title=\"ログアウト\"><\/a>\r\n\t<\/div>\r\n\r\n<\/nav>"
  },
    {
   "id": "custom_module_mst39878",
   "name": "AcceptanceDocument",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemReceipt.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"receiptHDB\",$SPIRAL->getCardId(),\"receivingHId\",\"authKey\",\"orderAuthKey\",\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][3] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n\r\n$getItemReceipt = new App\\Api\\GetItemReceipt($spiralDataBase,$userInfo);\r\n\r\n$receiptItem = $getItemReceipt->getItemReceipt($card[\"data\"][0][0]);\r\n//$receivingData = $spiralDataBase->arrayToNameArray($receiptItem[\"data\"],array(\"id\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"quantity\",\"quantityUnit\",\"itemUnit\",\"itemJANCode\",\"orderQuantity\",\"receivingCount\",\"orderCNumber\",\"inHospitalItemId\"));\r\n$receivingData = $receiptItem[\"data\"];\r\n\r\nforeach($receivingData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"receivingCount\"=> $record[\"receivingCount\"],\r\n\t\t\"quantity\"=> $record[\"quantity\"],\r\n\t\t\"orderCNumber\" => $record[\"orderCNumber\"],\r\n\t\t\"makerName\" => $record[\"makerName\"],\r\n\t\t\"itemName\" => $record[\"itemName\"],\r\n\t\t\"itemCode\" => $record[\"itemCode\"],\r\n\t\t\"itemStandard\" => $record[\"itemStandard\"],\r\n\t\t\"quantityUnit\" => $record[\"quantityUnit\"],\r\n\t\t\"itemUnit\" => $record[\"itemUnit\"],\r\n\t\t\"itemJANCode\" => $record[\"itemJANCode\"],\r\n\t\t\"orderQuantity\" => $record[\"orderQuantity\"],\r\n\t\t\"labelId\" => $record[\"labelId\"],\r\n\t\t\"totalReturnCount\"=>$record[\"totalReturnCount\"]\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][1], \"JoyPla\");\r\nif($card[\"data\"][0][2] != \"\"){\r\n\t$orderAuthKey = $crypt->encrypt($card[\"data\"][0][2], \"JoyPla\");\r\n}\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266908%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>検収書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>検収書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"返品伝票作成\" onclick=\"location.href='%url/card:page_266904%'\">\r\n\t\t\t\t\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"print_hidden uk-inline\">\r\n\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"ラベル発行\" onclick=\"createLabel()\">\r\n\t\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t\t\t\t\t<input type=\"hidden\" value=\"%val:usr:distributorName%\" name=\"distributorName\">\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">検　収　書<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:registrationTime%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:orderHistoryId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div id=\"nouhin_barcode\" class=\"uk-text-center\">\r\n\t    \t\t\t\t\t\t<span id=\"nouhin_num\">%val:usr:receivingHId%<\/span>\r\n\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入荷状況<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($receivingData as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\t$text = \"入庫完了\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"orderQuantity\"] > (int)$record[\"receivingCount\"]){\r\n\t\t\t\t    \t\t\t\t\t\t\t$text = \"一部入庫(\".$record[\"receivingCount\"].\" / \".$record[\"orderQuantity\"].\")\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t    \t\t\t\t\t\t$returnText = \"\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"totalReturnCount\"] > 0){\r\n\t\t\t\t    \t\t\t\t\t\t\t$returnText = \"<span class='uk-text-danger'>返品(\".$record[\"totalReturnCount\"].\" / \".$record[\"receivingCount\"].\")<\/span>\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$text.\"<br>\".$returnText.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\r\n<div class=\"uk-margin-large\" id=\"lot_tablearea\">\r\n\t<h4>ロット情報一覧<\/h4>\r\n\t\t    \t\t%sf:usr:search76:mstfilter:table%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t$(function(){\r\n\t\t let nouhin_num = $(\"#nouhin_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#nouhin_barcode\").html(\"<svg id='barcode_nouhin'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_nouhin\",nouhin_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t\t\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\t\r\n\t\tfunction createLabel(){\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( itemsToJs ));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39879",
   "name": "AcceptanceFormByProduct",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemReceipt.php\";\r\ninclude_once \"NewJoyPla/api/GetReceivingHistory.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n\r\ninclude_once \"NewJoyPla/api/GetDivision.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\nif($userInfo->getUserPermission() != \"1\"){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"receivingdata\",$SPIRAL->getCardId(),\"receivingHId\");\r\n\r\n$getReceivingHistory = new App\\Api\\GetReceivingHistory($spiralDataBase,$userInfo);\r\n\r\n$receivingHistory = $getReceivingHistory->select($card[\"data\"][0][0]);\r\n//$receivingHistory = $spiralDataBase->arrayToNameArray($receivingHistory[\"data\"],array(\"registrationTime\",\"distributorName\",\"orderHistoryId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"phoneNumber\",\"ordererUserName\",\"authKey\",\"orderAuthKey\"));\r\n$receivingHistory  = $receivingHistory[\"data\"];\r\n\r\n$getItemReceipt = new App\\Api\\GetItemReceipt($spiralDataBase,$userInfo);\r\n\r\n$receiptItem = $getItemReceipt->getItemReceipt($card[\"data\"][0][0]);\r\n$receivingData = $receiptItem[\"data\"];\r\n\r\n$ItemsToJs = array();\r\nforeach($receivingData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"receivingCount\"=> $record[\"receivingCount\"],\r\n\t\t\"quantity\"=> $record[\"quantity\"],\r\n\t\t\"orderCNumber\" => $record[\"orderCNumber\"],\r\n\t\t\"makerName\" => $record[\"makerName\"],\r\n\t\t\"itemName\" => $record[\"itemName\"],\r\n\t\t\"itemCode\" => $record[\"itemCode\"],\r\n\t\t\"itemStandard\" => $record[\"itemStandard\"],\r\n\t\t\"quantityUnit\" => $record[\"quantityUnit\"],\r\n\t\t\"itemUnit\" => $record[\"itemUnit\"],\r\n\t\t\"itemJANCode\" => $record[\"itemJANCode\"],\r\n\t\t\"orderQuantity\" => $record[\"orderQuantity\"],\r\n\t\t\"labelId\" => $record[\"labelId\"],\r\n\t\t\"totalReturnCount\"=>$record[\"totalReturnCount\"]\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n\r\nif($receivingHistory[0][\"authKey\"] != \"\"){\r\n\t$authKeyCrypt = $crypt->encrypt($receivingHistory[0][\"authKey\"], \"JoyPla\");\r\n}\r\nif($receivingHistory[0][\"orderAuthKey\"] != \"\"){\r\n\t$orderAuthKey = $crypt->encrypt($receivingHistory[0][\"orderAuthKey\"], \"JoyPla\");\r\n}\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$divisionData = $getDivision->select($receivingHistory[0][\"divisionId\"]);\r\n\r\nif($divisionData['code'] != '0'){\r\n\techo json_encode(array('result'=>false));\r\n\texit;\r\n}\r\n\r\n$divisionName = \"\";\r\nforeach($divisionData[\"store\"] as $record ){\r\n\t$divisionName = $record[3];\r\n}\r\nforeach($divisionData[\"division\"] as $record ){\r\n\t$divisionName = $record[3];\r\n}\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\"><span>商品別照合一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>検収書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"返品伝票作成\" onclick=\"location.href='%url/card:page_265590%'\">\r\n\t\t\t\t\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"print_hidden uk-inline\">\r\n\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"ラベル発行\" onclick=\"createLabel()\">\r\n\t\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t\t\t\t\t<input type=\"hidden\" value=\"<?php echo $receivingHistory[0][\"distributorName\"] ?>\" name=\"distributorName\">\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">検　収　書<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b><?php echo $receivingHistory[0][\"distributorName\"] ?> 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td><?php echo $receivingHistory[0][\"registrationTime\"] ?><\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td><?php echo $receivingHistory[0][\"orderHistoryId\"] ?><\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div id=\"nouhin_barcode\" class=\"uk-text-center\">\r\n\t    \t\t\t\t\t\t<span id=\"nouhin_num\">%val:usr:receivingHId%<\/span>\r\n\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span><?php echo $receivingHistory[0][\"hospitalName\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒<?php echo $receivingHistory[0][\"postalCode\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span><?php echo $receivingHistory[0][\"prefectures\"] ?> <?php echo $receivingHistory[0][\"address\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：<?php echo $receivingHistory[0][\"phoneNumber\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：<?php echo $receivingHistory[0][\"ordererUserName\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：<?php echo $divisionName ?><\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入荷状況<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($receivingData as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\t$text = \"入庫完了\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"orderQuantity\"] > (int)$record[\"receivingCount\"]){\r\n\t\t\t\t    \t\t\t\t\t\t\t$text = \"一部入庫(\".$record[\"receivingCount\"].\" / \".$record[\"orderQuantity\"].\")\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t    \t\t\t\t\t\t$returnText = \"\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"totalReturnCount\"] > 0){\r\n\t\t\t\t    \t\t\t\t\t\t\t$returnText = \"<span class='uk-text-danger'>返品(\".$record[\"totalReturnCount\"].\" / \".$record[\"receivingCount\"].\")<\/span>\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$text.\"<br>\".$returnText.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n<div class=\"uk-margin-large\" id=\"lot_tablearea\">\r\n\t<h4>ロット情報一覧<\/h4>\r\n\t\t    \t\t%sf:usr:search76:mstfilter:table%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t$(function(){\r\n\t\t let nouhin_num = $(\"#nouhin_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#nouhin_barcode\").html(\"<svg id='barcode_nouhin'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_nouhin\",nouhin_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t\t\r\n    \t\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\t\r\n\t\tfunction createLabel(){\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( itemsToJs ));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39880",
   "name": "AcceptanceFormForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemReceipt.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"receiptHDB\",$SPIRAL->getCardId(),\"receivingHId\",\"authKey\",\"orderAuthKey\");\r\n\r\n$getItemReceipt = new App\\Api\\GetItemReceipt($spiralDataBase,$userInfo);\r\n\r\n$receiptItem = $getItemReceipt->getItemReceipt($card[\"data\"][0][0]);\r\n//$receivingData = $spiralDataBase->arrayToNameArray($receiptItem[\"data\"],array(\"id\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"quantity\",\"quantityUnit\",\"itemUnit\",\"itemJANCode\",\"orderQuantity\",\"receivingCount\",\"orderCNumber\",\"inHospitalItemId\"));\r\n$receivingData = $receiptItem[\"data\"];\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\"><span>検収書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>検収書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">検　収　書<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:registrationTime%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:orderHistoryId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div id=\"nouhin_barcode\" class=\"uk-text-center\">\r\n\t    \t\t\t\t\t\t<span id=\"nouhin_num\">%val:usr:receivingHId%<\/span>\r\n\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入荷状況<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t    \t\t\t\t\tforeach($receivingData as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\t$text = \"入庫完了\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"orderQuantity\"] > (int)$record[\"receivingCount\"]){\r\n\t\t\t\t    \t\t\t\t\t\t\t$text = \"一部入庫(\".$record[\"receivingCount\"].\" / \".$record[\"orderQuantity\"].\")\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t    \t\t\t\t\t\t$returnText = \"\";\r\n\t\t\t\t    \t\t\t\t\t\tif((int)$record[\"totalReturnCount\"] > 0){\r\n\t\t\t\t    \t\t\t\t\t\t\t$returnText = \"<span class='uk-text-danger'>一部返品(\".$record[\"totalReturnCount\"].\" / \".$record[\"receivingCount\"].\")<\/span>\";\r\n\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$text.\"<br>\".$returnText.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t$(function(){\r\n\t\t let nouhin_num = $(\"#nouhin_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#nouhin_barcode\").html(\"<svg id='barcode_nouhin'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_nouhin\",nouhin_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39881",
   "name": "AcceptanceFormList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>検収書一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">検収書一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search100:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39882",
   "name": "AcceptanceFormListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>検収書一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">検収書一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search101%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39883",
   "name": "BulkInHPInsert",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 一括院内商品情報登録<\/title>\r\n\r\n     <script>\r\n\t let canAjax = true;\r\n     const column = [[\"商品ID:itemId\",\"卸業者ID:distributorId\",\"カタログNo:catalogNo\",\"シリアルNo:serialNo\",\"入数:quantity\",\"個数単位:itemUnit\",\"保険請求分類（医科）:medicineCategory\",\"保険請求分類（在宅）:homeCategory\",\"不使用フラグ:notUsedFlag\",\"備考:notice\",\"旧JoyPlaラベルId:labelId\"]];\r\n     let filesData = {};\r\n\t\tfunction exportCSV(records) {\r\n\t\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\t\r\n\t\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\t\tlet link = document.createElement('a');\r\n\t\t\tlink.download = 'header_inHospital_iteminsert.tsv';\r\n\t\t\tlink.href = url;\r\n\t\t\tdocument.body.appendChild(link);\r\n\t\t\tlink.click();\r\n\t\t\tdocument.body.removeChild(link);\r\n\t\t};\r\n     \t// CSVをパース\r\n\t\tfunction parseCsv(csvStr, delimiter) {\r\n\t\t    var rowRegex = /(?:(?:\"[^\"]*\")*[^\\r\\n\"]*)+/g,\r\n\t\t        colRegex = new RegExp('(?:(?:\"[^\"]*\")*[^' + delimiter + '\"]*)+', 'g'),\r\n\t\t        rows = [],\r\n\t\t        row, cells, cell, rowMaches, colMaches;\r\n\t\t    //行を切り出す\r\n\t\t    while ((rowMaches = rowRegex.exec(csvStr)) !== null) {\r\n\t\t        if (rowMaches[0] !== '') {\r\n\t\t            cells = [];\r\n\t\t            row = rowMaches[0];\r\n\t\t            //セルを切り出す\r\n\t\t            while ((colMaches = colRegex.exec(row)) !== null) {\r\n\t\t                cell = colMaches[0].replace(/^\\s+|\\s+$/g, '');\r\n\t\t                if (cell.charAt(0) == '\"' && cell.charAt(cell.length - 1) == '\"') {\r\n\t\t                    cell = cell.slice(1, -1);\r\n\t\t                }\r\n\t\t                cell = cell.replace(/\"\"/g, '\"');\r\n\t\t                cells.push(cell);\r\n\t\t                colRegex.lastIndex++; //一歩前へ！\r\n\t\t            }\r\n\t\t            rows.push(cells);\r\n\t\t        }\r\n\t\t        rowRegex.lastIndex++; //一歩前へ！\r\n\t\t    }\r\n\t\t    return rows;\r\n\t\t}\r\n\t\t\r\n\t\tfunction checkfile(){\r\n\t\t    $('.resultarea').hide();\r\n\t\t    //FileReaderのインスタンスを作成する\r\n\t\t    var reader = new FileReader();\r\n\t\t  \r\n\t\t    //読み込んだファイルの中身を取得する\r\n\t\t    reader.readAsText( $('input[type=\"file\"]')[0].files[0] );\r\n\t\t  \r\n\t\t    //ファイルの中身を取得後に処理を行う\r\n\t\t    reader.addEventListener( 'load', function() {\r\n\t\t       filesData = parseCsv(reader.result, \"\\t\");\r\n\t\t       if(!headerCheck(filesData[0],column[0])){\r\n\t\t\t\t   return false;\r\n\t\t\t   }\r\n\t\t       \r\n\t\t       convertArrayForHeader(column);\r\n\t\t       filesData.shift();\r\n\t\t       convertArray(filesData);\r\n\t\t       $('.resultarea').show();\r\n\t\t    })\r\n\t\t}\r\n\t\t\r\n\t\tfunction headerCheck(head,columns){\r\n\t\t\tif(columns.length != head.length){\r\n\t\t\t\tUIkit.modal.alert(\"ヘッダーが一致しません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tlet flag = true;\r\n\t\t\tfor(let i = 0 ; i < columns.length; i++){\r\n\t\t\t\t\r\n\t\t\t\tif(head[i] != columns[i]){\r\n\t\t\t\t\tflag = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(! flag){\r\n\t\t\t\tUIkit.modal.alert(\"ヘッダーが正しくありません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction insert(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"取り込みを開始します\").then(function () {\r\n\t\t\t\tdata = {};\r\n\t\t\t\tfor(let i = 0 ; i < filesData.length ; i++){\r\n\t\t\t\t\tif(i >= 1000){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[i] = filesData[i];\r\n\t\t\t\t}\r\n        \t\t\r\n\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:'%url/rel:mpgt:regInHPitemsBluk%',\r\n\t\t\t\t\ttype:'POST',\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tinsertData : JSON.stringify( objectValueToURIencode(data) )\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: 'json'\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"取り込みに失敗しました<br>error:\"+data.response.code+\"<br>message:\"+data.response.message).then(function(){\r\n\t\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"取り込みが完了しました\").then(function(){\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\tUIkit.modal.alert(\"取り込みに失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert('中止しました');\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction convertArrayForHeader(dataArray) {\r\n\t\t\tlet insertElement = '';\r\n\t\t\tdataArray.forEach((element) => {\r\n\t\t\t\tinsertElement += '<tr>';\r\n\t\t\t\telement.forEach((childElement) => {\r\n\t\t\t\t\tinsertElement += `<th>${childElement}<\/th>`\r\n\t\t\t\t});\r\n\t\t\t\tinsertElement += '<\/tr>';\r\n\t\t\t});\r\n\t\t\t$(\"#output_head\").html(insertElement) ;\r\n\t\t}\r\n\t\t\r\n\t\tfunction convertArray(dataArray) {\r\n\t\t\tlet insertElement = '';\r\n\t\t\tdataArray.forEach((element) => {\r\n\t\t\t\tinsertElement += '<tr>';\r\n\t\t\t\telement.forEach((childElement) => {\r\n\t\t\t\t\tinsertElement += `<td>${childElement}<\/td>`\r\n\t\t\t\t});\r\n\t\t\t\tinsertElement += '<\/tr>';\r\n\t\t\t});\r\n\t\t\t$(\"#output_body\").html(insertElement) ;\r\n\t\t}\r\n     <\/script>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>一括院内商品情報登録<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">一括院内商品情報登録<\/h2>\r\n\t\t\t\t<div class=\"uk-width-2-3@m uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-horizontal uk-margin-large\" name=\"myform\">\r\n\r\n\t\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\">登録用ヘッダー<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t\t\t        <div uk-form-custom=\"target: true\">\r\n\t\t\t\t\t\t            <button class=\"uk-button uk-button-secondary\" type=\"button\" onclick=\"exportCSV(column)\">ダウンロード<\/button>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <hr>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" for=\"file\">ファイル選択<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t\t\t        <div uk-form-custom=\"target: true\">\r\n\t\t\t\t\t\t            <input type=\"file\" accept=\".tsv\" name=\"fileinput\">\r\n\t\t\t\t\t\t            <input class=\"uk-input uk-form-width-large\" type=\"text\" id=\"file\" placeholder=\"TSVファイルを選択してください\" disabled>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t        <button class=\"uk-button uk-button-secondary\" type=\"button\" onclick=\"checkfile()\">解析<\/button><br>\r\n\t\t\t\t\t        \t<span class=\"uk-text-danger\">※一度に取り込める件数は1000件までです<\/span>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <hr>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    <div class=\"uk-margin uk-text-center\">\r\n\t\t\t\t\t    \t<input type=\"reset\" value=\"リセット\" class=\"uk-button uk-button-default\">\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div class=\"uk-width-1-1 resultarea\">\r\n\t\t\t\t    <h4>解析結果<\/h4>\r\n\t\t\t\t\t<input type=\"button\" value=\"取込実行\" class=\"uk-button uk-button-primary\" onclick=\"insert()\">\r\n\t\t\t\t    <div class=\"uk-overflow-auto\">\r\n\t\t\t\t    <table class=\"uk-table uk-table-striped uk-text-nowrap uk-width-auto uk-margin-auto\">\r\n\t\t\t\t     <tbody id=\"output_head\"><\/tbody>\r\n\t\t\t\t\t <tbody id=\"output_body\"><\/tbody>\r\n\t\t\t\t\t<\/table>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39884",
   "name": "BulkInsertItems",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\r\ninclude_once 'NewJoyPla/api/GetTenantData.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select($userInfo->getTenantId());\r\n\r\n//シングルテナント以外は閲覧不可\r\nif($tenantData['data'][0]['tenantKind'] != '1'){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 一括商品登録<\/title>\r\n\r\n    \r\n     <script>\r\n\t let canAjax = true;\r\n     const column = [[\"商品名:itemName\",\"製品コード:itemCode\",\"規格:itemStandard\",\"JANコード:itemJANCode\",\"メーカー名:makerName\",\"償還価フラグ:officialFlag\",\"旧償還価:officialpriceOld\",\"償還価:officialprice\",\"入数:quantity\",\"入数単位:quantityUnit\",\"個数単位:itemUnit\",\"最小入数価格:minPrice\"]];\r\n     let filesData = {};\r\n\t\tfunction exportCSV(records) {\r\n\t\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\t\r\n\t\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\t\tlet link = document.createElement('a');\r\n\t\t\tlink.download = 'header_iteminsert.tsv';\r\n\t\t\tlink.href = url;\r\n\t\t\tdocument.body.appendChild(link);\r\n\t\t\tlink.click();\r\n\t\t\tdocument.body.removeChild(link);\r\n\t\t};\r\n     \t// CSVをパース\r\n\t\tfunction parseCsv(csvStr, delimiter) {\r\n\t\t    var rowRegex = /(?:(?:\"[^\"]*\")*[^\\r\\n\"]*)+/g,\r\n\t\t        colRegex = new RegExp('(?:(?:\"[^\"]*\")*[^' + delimiter + '\"]*)+', 'g'),\r\n\t\t        rows = [],\r\n\t\t        row, cells, cell, rowMaches, colMaches;\r\n\t\t    //行を切り出す\r\n\t\t    while ((rowMaches = rowRegex.exec(csvStr)) !== null) {\r\n\t\t        if (rowMaches[0] !== '') {\r\n\t\t            cells = [];\r\n\t\t            row = rowMaches[0];\r\n\t\t            //セルを切り出す\r\n\t\t            while ((colMaches = colRegex.exec(row)) !== null) {\r\n\t\t                cell = colMaches[0].replace(/^\\s+|\\s+$/g, '');\r\n\t\t                if (cell.charAt(0) == '\"' && cell.charAt(cell.length - 1) == '\"') {\r\n\t\t                    cell = cell.slice(1, -1);\r\n\t\t                }\r\n\t\t                cell = cell.replace(/\"\"/g, '\"');\r\n\t\t                cells.push(cell);\r\n\t\t                colRegex.lastIndex++; //一歩前へ！\r\n\t\t            }\r\n\t\t            rows.push(cells);\r\n\t\t        }\r\n\t\t        rowRegex.lastIndex++; //一歩前へ！\r\n\t\t    }\r\n\t\t    return rows;\r\n\t\t}\r\n\t\t\r\n\t\tfunction checkfile(){\r\n\t\t    $('.resultarea').hide();\r\n\t\t    //FileReaderのインスタンスを作成する\r\n\t\t    var reader = new FileReader();\r\n\t\t  \r\n\t\t    //読み込んだファイルの中身を取得する\r\n\t\t    reader.readAsText( $('input[type=\"file\"]')[0].files[0] );\r\n\t\t  \r\n\t\t    //ファイルの中身を取得後に処理を行う\r\n\t\t    reader.addEventListener( 'load', function() {\r\n\t\t       filesData = parseCsv(reader.result, \"\\t\");\r\n\t\t       if(!headerCheck(filesData[0],column[0])){\r\n\t\t\t\t   return false;\r\n\t\t\t   }\r\n\t\t       \r\n\t\t       convertArrayForHeader(column);\r\n\t\t       filesData.shift();\r\n\t\t       convertArray(filesData);\r\n\t\t       $('.resultarea').show();\r\n\t\t    })\r\n\t\t}\r\n\t\t\r\n\t\tfunction headerCheck(head,columns){\r\n\t\t\tif(columns.length != head.length){\r\n\t\t\t\tUIkit.modal.alert(\"ヘッダーが一致しません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tlet flag = true;\r\n\t\t\tfor(let i = 0 ; i < columns.length; i++){\r\n\t\t\t\t\r\n\t\t\t\tif(head[i] != columns[i]){\r\n\t\t\t\t\tflag = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(! flag){\r\n\t\t\t\tUIkit.modal.alert(\"ヘッダーが正しくありません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction insert(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"取り込みを開始します\").then(function () {\r\n\t\t\t\tdata = {};\r\n\t\t\t\tJANCheck = true;\r\n\t\t\t\tfor(let i = 0 ; i < filesData.length ; i++){\r\n\t\t\t\t\tif(i >= 1000){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(filesData[i][3].length != 13){\r\n\t\t\t\t\t\tJANCheck = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[i] = filesData[i];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(!JANCheck){\r\n\t\t\t\t\tUIkit.modal.alert('JANコードは13桁で入力してください');\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n        \t\t\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:'%url/rel:mpgt:regItemsBlukIns%',\r\n\t\t\t\t\ttype:'POST',\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tinsertData : JSON.stringify( objectValueToURIencode(data) )\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: 'json'\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"取り込みに失敗しました<br>error:\"+data.response.code+\"<br>message:\"+data.response.message).then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"取り込みが完了しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\tUIkit.modal.alert(\"取り込みに失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert('中止しました');\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction convertArrayForHeader(dataArray) {\r\n\t\t let insertElement = '';\r\n\t\t dataArray.forEach((element) => {\r\n\t\t  insertElement += '<tr>';\r\n\t\t  element.forEach((childElement) => {\r\n\t\t   insertElement += `<th>${childElement}<\/th>`\r\n\t\t  });\r\n\t\t  insertElement += '<\/tr>';\r\n\t\t });\r\n\t\t $(\"#output_head\").html(insertElement) ;\r\n\t\t}\r\n\t\t\r\n\t\tfunction convertArray(dataArray) {\r\n\t\t let insertElement = '';\r\n\t\t dataArray.forEach((element) => {\r\n\t\t  insertElement += '<tr>';\r\n\t\t  element.forEach((childElement) => {\r\n\t\t   insertElement += `<td>${childElement}<\/td>`\r\n\t\t  });\r\n\t\t  insertElement += '<\/tr>';\r\n\t\t });\r\n\t\t $(\"#output_body\").html(insertElement) ;\r\n\t\t}\r\n     <\/script>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>一括商品登録<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">一括商品登録<\/h2>\r\n\t\t\t\t<div class=\"uk-width-2-3@m uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-horizontal uk-margin-large\" name=\"myform\">\r\n\r\n\t\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\">登録用ヘッダー<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t\t\t        <div uk-form-custom=\"target: true\">\r\n\t\t\t\t\t\t            <button class=\"uk-button uk-button-secondary\" type=\"button\" onclick=\"exportCSV(column)\">ダウンロード<\/button>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <hr>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" for=\"file\">ファイル選択<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t\t\t        <div uk-form-custom=\"target: true\">\r\n\t\t\t\t\t\t            <input type=\"file\" accept=\".tsv\" name=\"fileinput\">\r\n\t\t\t\t\t\t            <input class=\"uk-input uk-form-width-large\" type=\"text\" id=\"file\" placeholder=\"TSVファイルを選択してください\" disabled>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t        <button class=\"uk-button uk-button-secondary\" type=\"button\" onclick=\"checkfile()\">解析<\/button><br>\r\n\t\t\t\t\t        \t<span class=\"uk-text-danger\">※一度に取り込める件数は1000件までです<\/span>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <hr>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    <div class=\"uk-margin uk-text-center\">\r\n\t\t\t\t\t    \t<input type=\"reset\" value=\"リセット\" class=\"uk-button uk-button-default\">\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div class=\"uk-width-1-1 resultarea\">\r\n\t\t\t\t    <h4>解析結果<\/h4>\r\n\t\t\t\t\t<input type=\"button\" value=\"取込実行\" class=\"uk-button uk-button-primary\" onclick=\"insert()\">\r\n\t\t\t\t    <div class=\"uk-overflow-auto\">\r\n\t\t\t\t    <table class=\"uk-table uk-table-striped uk-text-nowrap uk-width-auto uk-margin-auto\">\r\n\t\t\t\t     <tbody id=\"output_head\"><\/tbody>\r\n\t\t\t\t\t <tbody id=\"output_body\"><\/tbody>\r\n\t\t\t\t\t<\/table>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39885",
   "name": "ContractConfirm",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\n\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$result = $getHospitalData->select();\r\n?>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 契約情報確認<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>契約情報確認<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t    \t<div class='uk-width-1-1' uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>契約情報確認<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t    \t\t<p class=\"uk-text-warning\">契約情報の変更はお問合せよりご連絡ください。<\/p>\r\n\t\t    \t<div class='uk-width-4-5@m uk-margin-auto uk-margin-remove-top' >\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>登録日時<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['registrationTime'] ?><\/td>\r\n\t\t\t\t\t            <th>更新日時<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><?php echo $result['data'][0]['updateTime'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>契約病院名<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\"><?php echo $result['data'][0]['hospitalName'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>郵便番号<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\"><?php echo $result['data'][0]['postalCode'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>都道府県<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['prefectures'] ?><\/td>\r\n\t\t\t\t\t            <th>住所<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><?php echo $result['data'][0]['address'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>電話番号<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['phoneNumber'] ?><\/td>\r\n\t\t\t\t\t            <th>FAX番号<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><?php echo $result['data'][0]['faxNumber'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>責任者氏名<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['name'] ?><\/td>\r\n\t\t\t\t\t            <th>責任者氏名（カナ）<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><?php echo $result['data'][0]['nameKana'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>メールアドレス<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['mailAddress'] ?><\/td>\r\n\t\t\t\t\t            <th>責任者連絡先<\/th>\r\n\t\t\t\t\t            <td><?php echo $result['data'][0]['contactAddress'] ?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39886",
   "name": "CreateLabel",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\n$pattern = '';\r\nif(isset($_POST['pattern']) && $_POST['pattern'] != ''){\r\n\t$pattern = $_POST['pattern'];\r\n}\r\n\r\nif($pattern === ''){\r\n\r\n\tinclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n\t$itemsData = array();\r\n\t$distributorName = \"\";\r\n\r\n\tif(isset($_POST['itemsData']) && $_POST['itemsData'] != \"\"){\r\n\t\t$itemsData = \\App\\Lib\\requestUrldecode($_POST['itemsData']);\r\n\t}\r\n\tif(isset($_POST['distributorName']) && $_POST['distributorName'] != \"\"){\r\n\t\t$distributorName = App\\Lib\\html($_POST['distributorName']);\r\n\t}\r\n\t$nowTime = date('Y年m月d日 H時i分s秒');\r\n\r\n\t?>\r\n\r\n\t<!DOCTYPE html>\r\n\t<html>\r\n\t<head>\r\n\t\t<title>JoyPla 入庫ラベル発行<\/title>\r\n\t\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n\t\t<style>\r\n\t\t\t.printarea{\r\n\t\t\t\twidth:80mm;\r\n\t\t\t\theight:auto;\r\n\t\t\t\tfont-size:12px;\r\n\t\t\t\tborder: 1px solid gray;\r\n\t\t\t\tpadding: 5px;\r\n\t\t\t}\r\n\t\t\t.font-size-16{\r\n\t\t\t\tfont-size:16px;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t@media print{\r\n\t\t\t\t.printarea{\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t\tpadding: 0px;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t<\/style>\r\n\r\n\t<\/head>\r\n\t<body>\r\n\t\t<?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n\t\t<div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t\t\t<div class=\"uk-container uk-container-expand\">\r\n\t\t\t\t\t<h1 class=\"no_print\">入庫ラベル発行<\/h1>\r\n\t\t\t\t\t<div class=\"uk-margin-bottom no_print\" uk-grid>\r\n\t\t\t\t\t\t<div class=\"uk-width-1-2@m\">\r\n\t\t\t\t\t\t\t<button class=\"uk-button uk-button-default\" type=\"submit\" onclick=\"window.print();return false;\">印刷プレビュー<\/button>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div id=\"createLabel\">\r\n\t\t\t\t\t<?php \r\n\t\t\t\t\t$num = 1 ;\r\n\t\t\t\t\tforeach($itemsData as $inHPId => $item){\r\n\t\t\t\t\t\t$barcodeId = '';\r\n\t\t\t\t\t\tif($item['totalReturnCount'] == null){\r\n\t\t\t\t\t\t\t$item['totalReturnCount'] = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$quantity = '';\r\n\t\t\t\t\t\tif((int)$item['quantity'] >= 10000 ){\r\n\t\t\t\t\t\t\t$quantity = '9999';\r\n\t\t\t\t\t\t} else if((int)$item['quantity'] < 1 ){\r\n\t\t\t\t\t\t\t$quantity = str_pad(1 , 4, \"0\", STR_PAD_LEFT);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$quantity = str_pad((int)$item['quantity'] , 4, \"0\", STR_PAD_LEFT);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor($rnum = 1 ; $rnum <= (int)$item['receivingCount'] - (int)$item['totalReturnCount']; $rnum++){\r\n\t\t\t\t\t\t\t//$barcodeId = \"01\".$inHPId.$item['quantity'];\r\n\t\t\t\t\t\t\t$barcodeId = \"01\".$item[\"labelId\"].$quantity;\r\n\t\t\t\t\t\t\techo \"<div class='printarea'>\";\r\n\t\t\t\t\t\t\techo \"<span>\".$distributorName.\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>メーカー名：\".$item['makerName'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>商品名：\".$item['itemName'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>規格：\".$item['itemStandard'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>商品コード：\".$item['itemCode'].\"<\/span> \";\r\n\t\t\t\t\t\t\techo \"<span>入数：\".$item['quantity'].$item['quantityUnit'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>\".$nowTime.\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<div class='uk-text-center' id='barcode_\".$num.\"'>\".$barcodeId.\"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\t$num ++ ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t?>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t\t<script>\r\n\t\t\t$(function(){\r\n\t\t\tlet count = $('#createLabel').children().length;\r\n\t\t\tlet num ;\r\n\t\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\t\tnum = $('#barcode_' + i).text();\r\n\t\t\t\t$('#barcode_' + i).html('<svg id=\"barcode_area_'+i+'\"><\/svg>');\r\n\t\t\t\tgenerateBarcode('barcode_area_' + i,num);\r\n\t\t\t\t//$('td#barcode_' + i +' div').barcode(num, \"ean13\",{barWidth: 2 ,barHeight: 40 , output: 'css'});\r\n\t\t\t}\r\n\t\t\t});\r\n\t\t<\/script>\r\n\t<\/body>\r\n\t<\/html>\r\n<?php\r\n} else if($pattern === 'payout'){\r\n\r\n\tinclude_once 'NewJoyPla/lib/Func.php';\r\n\tinclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\n\tinclude_once \"NewJoyPla/lib/Define.php\";\r\n\tinclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\n\tinclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\tinclude_once 'NewJoyPla/api/GetStock.php';\r\n\r\n\t$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t\r\n\t$itemsData = array();\r\n\t\r\n\tif(isset($_POST['itemsData']) && $_POST['itemsData'] != \"\"){\r\n\t\t$itemsData = \\App\\Lib\\requestUrldecode($_POST['itemsData']);\r\n\t}\r\n\r\n\t$sourceDivision = \"\";\r\n\r\n\tif(isset($_POST['sourceDivision']) && $_POST['sourceDivision'] != \"\"){\r\n\t\t$sourceDivision = \\App\\Lib\\html($_POST['sourceDivision']);\r\n\t}\r\n\r\n\t$getStock = new App\\Api\\GetStock($spiralDataBase,$userInfo);\r\n\t$stockData = $getStock->getStockData($itemsData,$sourceDivision);\r\n\tforeach($stockData['data'] as $stockRecord){\r\n\t\t$itemsData[$stockRecord[0]]['sourceDivisionName'] = $stockRecord[3];\r\n\t\t$itemsData[$stockRecord[0]]['sourceRackName'] = $stockRecord[2];\r\n\t}\r\n\r\n\t$targetDivision = \"\";\r\n\r\n\tif(isset($_POST['targetDivision']) && $_POST['targetDivision'] != \"\"){\r\n\t\t$targetDivision = \\App\\Lib\\html($_POST['targetDivision']);\r\n\t}\r\n\tif($targetDivision != ''){\r\n\t\t$getStock = new App\\Api\\GetStock($spiralDataBase,$userInfo);\r\n\t\t$stockData = $getStock->getStockData($itemsData,$targetDivision);\r\n\t\tforeach($stockData['data'] as $stockRecord){\r\n\t\t\t$itemsData[$stockRecord[0]]['divisionName'] = $stockRecord[3];\r\n\t\t\t$itemsData[$stockRecord[0]]['rackName'] = $stockRecord[2];\r\n\t\t\t$itemsData[$stockRecord[0]]['constantByDiv'] = $stockRecord[4];\r\n\t\t\tif($itemsData[$stockRecord[0]]['distributorName'] == ''){\r\n\t\t\t\t$itemsData[$stockRecord[0]]['distributorName'] = $stockRecord[5];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t?>\r\n\r\n\t<!DOCTYPE html>\r\n\t<html>\r\n\t<head>\r\n\t\t<title>JoyPla 払出ラベル発行<\/title>\r\n\t\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n\t\t<style>\r\n\t\t\t.printarea{\r\n\t\t\t\twidth:80mm;\r\n\t\t\t\theight:auto;\r\n\t\t\t\tfont-size:12px;\r\n\t\t\t\tborder: 1px solid gray;\r\n\t\t\t\tpadding: 5px;\r\n\t\t\t}\r\n\t\t\t.font-size-16{\r\n\t\t\t\tfont-size:16px;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t@media print{\r\n\t\t\t\t.printarea{\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t\tpadding: 0px;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t<\/style>\r\n\t<\/head>\r\n\t<body>\r\n\t\t<?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n\t\t<div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t\t\t<div class=\"uk-container uk-container-expand\">\r\n\t\t\t\t\t<h1 class=\"no_print\">払出ラベル発行<\/h1>\r\n\t\t\t\t\t<div class=\"uk-margin-bottom no_print\" uk-grid>\r\n\t\t\t\t\t\t<div class=\"uk-width-1-2@m\">\r\n\t\t\t\t\t\t\t<button class=\"uk-button uk-button-default\" type=\"submit\" onclick=\"window.print();return false;\">印刷プレビュー<\/button>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div id=\"createLabel\">\r\n\t\t\t\t\t<?php \r\n\t\t\t\t\t$num = 1 ;\r\n\t\t\t\t\tforeach($itemsData as $inHPId => $item){\r\n\t\t\t\t\t\t$barcodeId = '';\r\n\t\t\t\t\t\t$quantity = '';\r\n\t\t\t\t\t\tif((int)$item['quantity'] >= 10000 ){\r\n\t\t\t\t\t\t\t$quantity = '9999';\r\n\t\t\t\t\t\t} else if((int)$item['quantity'] < 1 ){\r\n\t\t\t\t\t\t\t$quantity = str_pad(1 , 4, \"0\", STR_PAD_LEFT);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$quantity = str_pad((int)$item['quantity'] , 4, \"0\", STR_PAD_LEFT);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor($rnum = 1 ; $rnum <= (int)$item['printCount']; $rnum++){\r\n\t\t\t\t\t\t\t//$barcodeId = \"01\".$inHPId.$item['quantity'];\r\n\t\t\t\t\t\t\t$barcodeId = \"01\".$item[\"labelId\"].$quantity;\r\n\t\t\t\t\t\t\techo \"<div class='printarea'>\";\r\n\t\t\t\t\t\t\techo \"<div>\";\r\n\t\t\t\t\t\t\techo \"<b class='font-size-16'>\".$item['itemName'].\"<\/b>\";\r\n\t\t\t\t\t\t\techo \"<div class='uk-child-width-1-2' uk-grid>\";\r\n\t\t\t\t\t\t\techo \"<div>\";\r\n\t\t\t\t\t\t\techo \"<span>\".$item['maker'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>\".$item['catalogNo'].\" \".$item['itemStandard'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>\".$inHPId.\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<div class='uk-text-right uk-padding-remove'>\";\r\n\t\t\t\t\t\t\tif($item['sourceDivisionName'] != ''){\t\r\n\t\t\t\t\t\t\t\techo \"<b>\".$item['sourceDivisionName'].\"<\/b> <span>元棚番:\".$item['sourceRackName'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\techo \"<b>\".$item['divisionName'].\"<\/b> <span>払出棚番:\".$item['rackName'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>定数:\".$item['constantByDiv'].$item['unit'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<span>入数:\".$item['quantity'].$item['unit'].\"<\/span><br>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<div class='uk-text-center' id='barcode_\".$num.\"'>\".$barcodeId.\"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<div class='uk-text-right'>\".$item['distributorName'].\"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\techo \"<\/div>\";\r\n\t\t\t\t\t\t\t$num ++ ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t?>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t\t<script>\r\n\t\t\t$(function(){\r\n\t\t\tlet count = $('#createLabel').children().length;\r\n\t\t\tlet num ;\r\n\t\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\t\tnum = $('#barcode_' + i).text();\r\n\t\t\t\t$('#barcode_' + i).html('<svg id=\"barcode_area_'+i+'\"><\/svg>');\r\n\t\t\t\tgenerateBarcode('barcode_area_' + i,num);\r\n\t\t\t\t//$('td#barcode_' + i +' div').barcode(num, \"ean13\",{barWidth: 2 ,barHeight: 40 , output: 'css'});\r\n\t\t\t}\r\n\t\t\t});\r\n\t\t<\/script>\r\n\t<\/body>\r\n\t<\/html>\r\n\t<?php\r\n}\r\n\r\n\r\n\r\n\r\n?>"
  },
    {
   "id": "custom_module_mst39887",
   "name": "DistributorDetailForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n\r\ninclude_once 'NewJoyPla/api/GetTenantData.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select($hospitalData['data'][0]['tenantId']);\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 卸業者情報詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\">卸業者一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>卸業者情報詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1' && $tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"卸業者情報変更\" onclick=\"document.distributorChang.submit()\">\r\n\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"distributorChang\" target=\"_blank\">\r\n\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:distributorChang%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"authKey\" value=\"%val:usr:authKey%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorName\" value=\"%val:usr:distributorName%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"postalCode\" value=\"%val:usr:postalCode%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"prefectures\" value=\"%val:usr:prefectures%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"address\" value=\"%val:usr:address%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"phoneNumber\" value=\"%val:usr:phoneNumber%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"faxNumber\" value=\"%val:usr:faxNumber%\">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-4-5@m uk-margin-auto uk-margin-remove-top\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>卸業者ID<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:distributorId%<\/td>\r\n\t\t\t\t\t       <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>登録日時<\/th>\r\n\t\t\t\t\t            <td>%val:usr:registrationTime%<\/td>\r\n\t\t\t\t\t            <th>更新日時<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:updateTime%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>卸業者名<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:distributorName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>郵便番号<\/th>\r\n\t\t\t\t\t            <td>〒%val:usr:postalCode%<\/td>\r\n\t\t\t\t\t            <th>都道府県<\/th>\r\n\t\t\t\t\t            <td>%val:usr:prefectures%<\/td>\r\n\t\t\t\t\t            <th>住所<\/th>\r\n\t\t\t\t\t            <td>%val:usr:address%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>電話番号<\/th>\r\n\t\t\t\t\t            <td>%val:usr:phoneNumber%<\/td>\r\n\t\t\t\t\t            <th>FAX番号<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:faxNumber%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者ユーザー情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div class=\"uk-width-1-4@m uk-width-3-3 uk-text-right@m\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t    \t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\">\r\n\t\t    \t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:OoroshiUserReg%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"distAuthKey\" value=\"%val:usr:authKey%\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" value=\"卸業者ユーザー登録\" class=\"uk-button uk-button-primary\">\r\n\t\t    \t\t\t<\/form>\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-width-1-1 uk-margin-top\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t    \t\t%sf:usr:search79:mstfilter:table%\r\n\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t%sf:usr:oroshiUserList:mstfilter:table%\r\n\t\t\t\t\t<?php endif ?>\r\n               <\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tfunction deleteOroshiUserCheck(url,loginId){\r\n\t\t\tlet myLoginId = \"<?php echo $userInfo->getLoginId() ?>\";\r\n\t\t\tif(myLoginId == loginId){\r\n\t\t\t\tUIkit.modal.alert(\"ログイン者自身を削除することはできません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39888",
   "name": "DistributorInformationDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/api/GetTenantData.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 卸業者情報詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\">卸業者一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>卸業者情報詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1' && $tenantData['data'][0]['tenantKind'] == '1'): ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"卸業者情報変更\" onclick=\"document.distributorChang.submit()\">\r\n\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"distributorChang\" target=\"_blank\" class=\"uk-hidden\">\r\n\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:distributorChang%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"authKey\" value=\"%val:usr:authKey%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorName\" value=\"%val:usr:distributorName%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"postalCode\" value=\"%val:usr:postalCode%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"prefectures\" value=\"%val:usr:prefectures%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"address\" value=\"%val:usr:address%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"phoneNumber\" value=\"%val:usr:phoneNumber%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"faxNumber\" value=\"%val:usr:faxNumber%\">\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"卸業者ユーザー登録\" onclick=\"document.distributorUserReg.submit()\">\r\n\t\t\t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\" class=\"uk-hidden\" name=\"distributorUserReg\">\r\n\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:oroshiUserReg%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"distAuthKey\" value=\"%val:usr:authKey%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-4-5@m uk-margin-auto uk-margin-remove-top\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>卸業者ID<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:distributorId%<\/td>\r\n\t\t\t\t\t       <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>登録日時<\/th>\r\n\t\t\t\t\t            <td>%val:usr:registrationTime%<\/td>\r\n\t\t\t\t\t            <th>更新日時<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:updateTime%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>卸業者名<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:distributorName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>郵便番号<\/th>\r\n\t\t\t\t\t            <td>〒%val:usr:postalCode%<\/td>\r\n\t\t\t\t\t            <th>都道府県<\/th>\r\n\t\t\t\t\t            <td>%val:usr:prefectures%<\/td>\r\n\t\t\t\t\t            <th>住所<\/th>\r\n\t\t\t\t\t            <td>%val:usr:address%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>電話番号<\/th>\r\n\t\t\t\t\t            <td>%val:usr:phoneNumber%<\/td>\r\n\t\t\t\t\t            <th>FAX番号<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:faxNumber%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者ユーザー情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-width-1-1 uk-margin-top\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t    \t\t%sf:usr:search79:mstfilter:table%\r\n\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t%sf:usr:oroshiUserList:mstfilter:table%\r\n\t\t\t\t\t<?php endif ?>\r\n               <\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t\r\n\t$(function(){\r\n\t\tlet storage = JSON.parse(localStorage.getItem(\"joypla_inHpItemsList\"));\r\n\t\tlet dispObj = {};\r\n\t\tif(!storage){\r\n\t\t\tfor(let i = 1 ; i <= 22 ; i++){\r\n\t\t\t\tdispObj[i] = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdispObj = storage;\r\n\t\t}\r\n\t\tdispSet(dispObj);\r\n\t});\r\n\tfunction table_field_selector(){\r\n\t\tlet count = $(\"input[class^='uk-checkbox chk_']\").length;;\r\n\t\tlet disp = {};\r\n\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\tdisp[i] = false;\r\n\t\t\tif($(\"input.chk_\"+( \"00\" + i ).slice( -2 )).is(\":checked\")){\r\n\t\t\t\tdisp[i] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlocalStorage.setItem(\"joypla_inHpItemsList\", JSON.stringify(disp));\r\n\t\tlocation.reload();\r\n\t}\r\n\t\r\n\tfunction dispSet(settingObj){\r\n\t\tObject.keys(settingObj).forEach(function (key) {\r\n\t\t  $(\".chk_\"+( \"00\" + key ).slice( -2 )).prop(\"checked\", settingObj[key]);\r\n\t\t  if(settingObj[key]){\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).show();\r\n\t\t  } else {\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).hide();\r\n\t\t  }\r\n\t\t});\r\n\t}\r\n\t\tfunction deleteOroshiUserCheck(url,loginId){\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39889",
   "name": "DistributorList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/api/GetTenantData.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 卸業者一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>卸業者一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@l uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1' && $tenantData['data'][0]['tenantKind'] == '1'): ?>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t    \t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\">\r\n\t\t    \t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:distributorReg%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" value=\"卸業者登録\" class=\"uk-button uk-button-primary\">\r\n\t\t    \t\t\t<\/form>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t    \t<div class=\"uk-margin\">\r\n\t\t\t\t%sf:usr:search81:table%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39890",
   "name": "DistributorListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 卸業者一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>卸業者一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@l uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n<?php /*\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t    \t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\">\r\n\t\t    \t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:distributorReg%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" value=\"卸業者登録\" class=\"uk-button uk-button-primary\">\r\n\t\t    \t\t\t<\/form>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n*/ ?>\r\n\t\t    \t<div class=\"uk-margin\">\r\n\t\t\t\t%sf:usr:search87:table%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39891",
   "name": "DistributorListForTopicCreation",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla トピック作成-卸業者選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@l uk-width-2-3\">\r\n\t\t    \t\t\t<h2>卸業者選択<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t    \t<p>トピックを作成したい卸業者を選択してください<\/p>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-4-5@m\">\r\n\t\t\t\t%sf:usr:search90:table%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39894",
   "name": "AcceptanceFormListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 検収書一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>検収書一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search102:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39895",
   "name": "GoodsBillingListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 物品請求一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>物品請求一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search96:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39896",
   "name": "InventoryTableDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 在庫管理表 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>在庫管理表 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search84:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39897",
   "name": "LotManagementDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla ロット管理 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>ロット管理 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search104:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39898",
   "name": "OrderAdjustmentDivision",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetDivision.php\";\r\ninclude_once \"NewJoyPla/api/GetUnordered.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n\r\n$getUnordered = new App\\Api\\GetUnordered($spiralDataBase,$userInfo);\r\n\r\n$getUnorderedData = $getUnordered->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注調整<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<?php\r\n\t\t    \tif($getUnorderedData[\"count\"] > 0):\r\n\t\t    \t?>\t\r\n\t\t    \t<script>\r\n\t\t    \t\t$(function(){\r\n\t\t    \t\t\tUIkit.modal.alert(\"未発注伝票があります。<br>未発注伝票一覧へ移動します。\").then(function(){\r\n\t\t\t\t\t\t\tlocation.href=\"%url/rel:mpgt:page_266849%\";\r\n\t\t\t\t\t\t});\r\n\t\t    \t\t\t\r\n\t\t    \t\t});\r\n\t\t    \t<\/script>\r\n\t\t    \t\r\n\t\t    \t<?php\t\r\n\t\t    \telse:\r\n\t\t    \t?>\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print uk-margin-top\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注調整<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"表示内容で未発注伝票を作成\" onclick=\"sendUnorderedSlip();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title\">発注調整<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search75:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t    \t<?php\t\r\n\t\t    \tendif\r\n\t\t    \t?>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n   <script>\r\n   let canAjax = true;\r\n   myDivisiton = \"%val:@usr:divisionId%\";\r\n   const divisitonData = <?php echo json_encode($divisionData); ?>;\r\n   let listObject = {};\r\n   $(function(){\r\n\t  getItemsList();\r\n      makeDivitionSelect();\r\n   })\r\n\r\n\r\n   function makeDivitionSelect(){\r\n   \t\tlet selectval = $(\"#divisionName\").val();\r\n\t\t//html = \"<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">\";\r\n\t    html = document.createElement(\"div\");\r\n\t    select = document.createElement(\"select\");\r\n\t    select.className = \"uk-select\";\r\n\t    select.onchange  = function () { \r\n\t    \tonchangeSelect(this.value);\r\n\t    };\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = \"\";\r\n\t    option.text = \"----- 部署を選択してください -----\";\r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t    if(myDivisiton == divisitonData[\"store\"][0][1]){\r\n\t\t    option = document.createElement(\"option\");\r\n\t\t    option.value = divisitonData[\"store\"][0][3];\r\n\t\t    option.text = divisitonData[\"store\"][0][3] + \"(大倉庫)\";\r\n\t\t    \r\n\t\t    if(divisitonData[\"store\"][0][3] == selectval){\r\n\t\t    \toption.selected = \"selected\";\r\n\t\t    }\r\n\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\tselect.appendChild(option);\r\n\t\t\t\r\n\t\t    \r\n\t\t    //option = document.createElement(\"option\");\r\n\t\t    //option.value = \"\";\r\n\t\t    //option.text = \"---------------------------------------\";\r\n\t\t    //option.disabled = \"disabled\";\r\n\t\t\t//select.appendChild(option);\r\n\t    }\r\n\t    \r\n\t\tObject.keys(divisitonData[\"division\"]).forEach(function (key) {\r\n\t\t    if(divisitonData[\"division\"][key][5] != \"1\"){\r\n\t\t\t\tif(myDivisiton == divisitonData[\"division\"][key][1]){\r\n\t\t\t\t    option = document.createElement(\"option\");\r\n\t\t\t\t    option.value = divisitonData[\"division\"][key][3];\r\n\t\t\t\t    option.text = divisitonData[\"division\"][key][3];\r\n\t\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t\t    \r\n\t\t\t\t    if(divisitonData[\"division\"][key][3] == selectval){\r\n\t\t\t\t    \toption.selected = \"selected\";\r\n\t\t\t\t    }\r\n\t\t\t\t\tselect.appendChild(option);\r\n\t\t\t\t}\r\n\t\t    }\r\n\t\t});\r\n\t\r\n\t\thtml.appendChild(select);\r\n\t\t\r\n\t\t$(\"#divisionNameDiv\").append(html);\r\n   }\r\n   \r\n   function onchangeSelect(val){\r\n   \t$(\"#divisionName\").val(val);\r\n   }\r\n   \r\n   function active(elm,id,totalZaiko,quantity,busyoId,inHospitalItemId){\r\n   \telm.style.backgroundColor = \"rgb(255, 204, 153)\";\r\n   \torderQuantity = quantity * elm.value;\r\n   \t$(\"#orderQuantityPerCarton_\"+id).text(orderQuantity);\r\n   \t$(\"#adjustmentStock_\"+id).text(totalZaiko + orderQuantity);\r\n   \tlistObject[busyoId][inHospitalItemId][\"countNum\"] = orderQuantity;\r\n   }\r\n   \r\n   \r\n    function getItemsList(){\r\n\t\t$(\"#tablearea td.json\").each(function() {\r\n\t\t\tjson = JSON.parse($(this).text().replace(/\\r?\\n/g, \"\").trim());\r\n\t\t\tif(! listObject[json.divisionId]){\r\n\t\t\t\tlistObject[json.divisionId] = {};\r\n\t\t\t}\r\n\t\t\tlistObject[json.divisionId][json.inHospitalItemId] = json;\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction validateChack(){\r\n\t\tlet flag = false;\r\n\t\tObject.keys(listObject).forEach(function(divkey) {\r\n \r\n\t\t\tObject.keys(listObject[divkey]).forEach(function(key) {\r\n\t \r\n\t\t\t    if(listObject[divkey][key].countNum > 0){\r\n\t\t\t    \tflag = true;\r\n\t\t\t    }\r\n\t\t\t})\r\n\t\t \r\n\t\t})\r\n\t\tif(!flag){\r\n\t\t\tUIkit.modal.alert(\"発注する商品がありません\");\r\n\t\t}\r\n\t\t\r\n\t\treturn flag;\r\n\t}\r\n\r\n\tfunction sendUnorderedSlip(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\tif(!validateChack()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tloading();\r\n\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t$.ajax({\r\n\t\t\tasync: false,\r\n            url:\"%url/rel:mpgt:regUnordereByDiv%\",\r\n            type:\"POST\",\r\n            data:{\r\n            \tordered : JSON.stringify( objectValueToURIencode(listObject) ),\r\n            \tdivisionId : $('select[name=\"busyo\"]').val()\r\n            },\r\n            dataType: \"json\"\r\n        })\r\n        // Ajaxリクエストが成功した時発動\r\n        .done( (data) => {\r\n            \r\n            if(! data.result){\r\n        \t\tUIkit.modal.alert(\"未発注伝票の作成に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n        \t\treturn false;\r\n            }\r\n            \r\n            UIkit.modal.alert(\"未発注伝票を作成しました\").then(function(){\r\n\t\t\t\tUIkit.modal.alert(\"未発注伝票一覧へ移動します\").then(function(){\r\n\t\t\t\t\tlocation.href=\"%url/rel:mpgt:unorderedList%\";\r\n\t\t\t\t});\r\n\t\t\t});\r\n        })\r\n        // Ajaxリクエストが失敗した時発動\r\n        .fail( (data) => {\r\n            UIkit.modal.alert(\"未発注伝票の作成に失敗しました\").then(function(){\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t});\r\n        })\r\n        // Ajaxリクエストが成功・失敗どちらでも発動\r\n        .always( (data) => {\r\n\t\t\tloading_remove();\r\n        });\r\n\t}\r\n\t\r\n   <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39899",
   "name": "OrderAdjustmentListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注調整 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注調整 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search98:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39900",
   "name": "OrderHistoryListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注履歴詳細一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注履歴詳細一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:orderHdivSelect:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39901",
   "name": "OrderSlipListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注伝票一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注伝票一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search97:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39902",
   "name": "PayoutHistoryListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 払出履歴一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>払出履歴一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search105:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39903",
   "name": "ReturnListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 返品一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>返品一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search103:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39904",
   "name": "UnorderedSlipListDivisionSelection",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/Division/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 未発注書一覧 - 部署選択<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>未発注書一覧 - 部署選択<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">参照したい部署を選択してください<\/h2>\r\n\t\t    \t<hr>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search99:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39892",
   "name": "DivisionList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 部署一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>部署一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">部署一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t\r\n\t\t\t\t<div uk-grid uk-margin>\r\n\t\t\t\t\t<div class=\"uk-width-1-1\">\r\n\t\t    \t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\">\r\n\t\t    \t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:divisionReg%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"divisionType\" value=\"2\">\r\n\t\t\t\t\t\t\t<input type=\"submit\" value=\"部署登録\" class=\"uk-button uk-button-primary\">\r\n\t\t    \t\t\t<\/form>\r\n                        <p class=\"uk-text-danger uk-text-bold\">※大倉庫の登録は1つまでです<\/p>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n                        \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search80:table%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39905",
   "name": "EndInventorySlip",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n$session = $SPIRAL->getSession();\r\n$cardUrl = $session->get(\"cardUrl\");\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 棚卸伝票<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/rel:mpgt:page_263631%&table_cache=true\"><span>棚卸履歴一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $cardUrl ?>\"><span>棚卸結果報告<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>%val:usr:divisionName% 棚卸結果報告<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-left uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">%val:usr:divisionName% 棚卸結果報告<\/p>\r\n\t\t    \t<hr>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">棚卸登録日時<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:registrationTime%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">部署名<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:divisionName%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">品目数<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:itemsNumber%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t\t    <div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t    　　%sf:usr:search17:mstfilter:table%\r\n\t\t        <\/div>\r\n\t\t    \t\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39906",
   "name": "GoodsBillingContentEntry",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\nif($userInfo->getUserPermission() == '1') {\r\n\t$divisionData = $getDivision->select();\r\n} else {\r\n\t$divisionData = $getDivision->select($userInfo->getDivisionId());\r\n}\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 物品請求/個別発注<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <style>\r\n\t\t.id{\r\n\t\t\tmin-width: 24px;\r\n\t\t\tmax-width: 24px;\r\n\t\t}\r\n\t\t\r\n\t\t.shouhin-data .itemName{\r\n\t\t\tfont-size: 14px;\r\n\t\t}\r\n\t\t.shouhin-data .makerName{\r\n\t\t\tfont-size: 12px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .tana{\r\n\t\t\tfont-size: 8px;\r\n\t\t}\r\n\t\t.shouhin-data .itemCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .constant{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .quantity{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .price{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .JANCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .officialFlag{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.itemCount{\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\t\t.itemCount->after {\r\n\t\t   content: attr(data-format); /* ここが重要!! */\r\n\t\t   width: 10%;\r\n\t\t   height: 20px;\r\n\t\t   position: absolute;\r\n\t\t   bottom: 4px;\r\n\t\t}\r\n\t\t.itemCountInput{\r\n\t\t\twidth: 90%;\r\n\t\t}\r\n\t\t.uk-table th, .uk-table td{\r\n\t\t\tword-break: break-word;\r\n\t\t\tpadding: 12px 8px;\r\n\t\t\tvertical-align: middle;\r\n\t\t}\r\n\t\t.uk-table tfoot tr{\r\n\t\t\tborder-bottom: #e5e5e5 1px solid;\r\n\t\t\tborder-top: #e5e5e5 1px solid;\r\n\t\t}\r\n    <\/style>\r\n    <script>\r\n\t\tlet canAjax = true;\r\n    \r\n    \t// 参照ボタンクリック\r\n\t\tfunction sanshouClick(){\r\n\t\t\t// 参照マスタを別ウィンドウで開く\r\n\t\t\twindow.open('%url/rel:mpgt:page_262313%', '_blank','scrollbars=yes,width=1220,height=600');\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\tlet listObject = {};\r\n\t\tlet dataKey = ['id','maker','shouhinName','code','kikaku','irisu','count','kakaku','jan','oroshi'];\r\n\t\t\r\n\t\tfunction addTr(object){\r\n\t\t\tif(listObject[object.recordId]){\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\tlistObject[object.recordId] = object;\r\n\t\t\t\tlistObject[object.recordId].row = Object.keys(listObject).length;\r\n\t\t\t}\r\n\t\t\tlistObject[object.recordId].countNum = 0;\r\n\t\t\tlet trElm = document.createElement(\"tr\"); \r\n\t\t\tlet tdElm = '';\r\n\t\t\tfor(let i = 0 ; i < dataKey.length; i++){\r\n\t\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\t\thtml = '';\r\n\t\t\t\t\r\n\t\t\t\tif(dataKey[i] === 'id'){\r\n\t\t\t\t\thtml = document.createTextNode(listObject[object.recordId].row);\r\n\t\t\t\t} else if(dataKey[i] === 'count'){\r\n\t\t\t\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t\t\t\t    html = document.createElement(\"div\");\r\n\t\t\t\t    input = document.createElement(\"input\");\r\n\t\t\t\t    input.type = 'number';\r\n\t\t\t\t\tinput.step=\"1\"\r\n\t\t\t\t    input.className = 'uk-input';\r\n\t\t\t\t    input.id = 'hp_' + object.recordId;\r\n\t\t\t\t    input.style = 'width:96px';\r\n\t\t\t\t    input.min = 0;\r\n\t\t\t\t    input.value = listObject[object.recordId].countNum;\r\n\t\t\t\t    \r\n\t\t\t\t    input.onchange  = function () {\r\n\t\t\t\t\t\tchangeForInputNumber(this);\r\n\t\t\t\t    \tonchangeCountNum(object.recordId,this.value);\r\n\t\t\t\t    };\r\n\t\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t\t    span = document.createElement(\"span\");\r\n\t\t\t\t    span.innerText = listObject[object.recordId].unit;\r\n\t\t\t\t    span.className = 'uk-text-bottom';\r\n\t\t\t\t\thtml.appendChild(input);\r\n\t\t\t\t\thtml.appendChild(span);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext = '';\r\n\t\t\t\t\tif(dataKey[i] === 'kakaku'){\r\n\t\t\t\t\t\ttext += '￥';\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttext += listObject[object.recordId][dataKey[i]];\r\n\t\t\t\t\tif(dataKey[i] === 'teisu' || dataKey[i] === 'irisu') {\r\n\t\t\t\t\t\ttext += listObject[object.recordId].unit;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml = document.createTextNode(text);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttdElm.appendChild(html);\r\n\t\t\t\ttrElm.appendChild(tdElm);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\".shouhin-table table tbody\").append(trElm);\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction onchangeCountNum(id,value){\r\n\t\t\tlistObject[id].countNum = value;\r\n\t\t\t$('#hp_'+id).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"96px\"});\r\n\t\t\t$('#hp_'+id).val(value);\r\n\t\t\t$(window).scrollTop($('#hp_'+id+':first').offset().top - 100);\r\n\t\t}\r\n\t\t\r\n\t\tfunction goodsBillingValidationCheck(){\r\n\t\t\tif($('select[name=\"busyo\"]').val()){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('部署を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Object.keys(listObject).length === 0){\r\n\t\t\t\tUIkit.modal.alert('商品を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet checkflg = false;\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t  if(listObject[key].countNum !== 0){\r\n\t\t\t  \tcheckflg = true;\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(checkflg){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('数量を入力してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction unorderedSlipValidationCheck(){\r\n\t\t\tif($('select[name=\"busyo\"]').val()){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('部署を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Object.keys(listObject).length === 0){\r\n\t\t\t\tUIkit.modal.alert('商品を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet checkflg = false;\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t  if(Math.floor(listObject[key].countNum / listObject[key].irisu) > 0){\r\n\t\t\t  \tcheckflg = true;\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(checkflg){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('入数を満たす数量を入力してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction sendUnorderedSlip(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(! unorderedSlipValidationCheck()){\r\n\t\t\t\tloading_remove();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tloading();\r\n\t\t\t\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:regUnordered%',\r\n                type:'POST',\r\n                data:{\r\n                \tordered : JSON.stringify( objectValueToURIencode(listObject) ),\r\n                \tdivisionId : $('select[name=\"busyo\"]').val()\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"未発注伝票の作成に失敗しました\");\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n            \t\treturn false;\r\n                }\r\n                \r\n                UIkit.modal.alert(\"未発注伝票を作成しました\").then(function(){\r\n\t\t\t\t\t$('.goodsBillingButton').prop('disabled', false);\r\n\t\t\t\t\tdataReset();\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n                \r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"未発注伝票の作成に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n\t\t\t\t\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\tfunction sendGoodsBilling(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n            loading();\r\n\t\t\tif(! goodsBillingValidationCheck()){\r\n\t\t\t\tloading_remove();\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:regGoodsBilling%',\r\n                type:'POST',\r\n                data:{\r\n                \tbilling : JSON.stringify( objectValueToURIencode(listObject) ),\r\n                \tdivisionId : $('select[name=\"busyo\"]').val()\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"物品請求に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert('物品請求が完了しました').then(function () {\r\n\t\t\t\t\tUIkit.modal.confirm(\"物品請求内容で未発注伝票を作成しますか？\").then(function () {\r\n\t\t\t\t\t\t$('.goodsBillingButton').prop('disabled', true);\r\n\t\t\t\t\t\tsendUnorderedSlip();\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\tdataReset();\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n\t\t\t\tconsole.log(data);\r\n            \tUIkit.modal.alert(\"物品請求に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction barcodeSearch(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n            loading();\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:labelBarcodeSAPI%',\r\n                type:'POST',\r\n                data:{\r\n                \tbarcode : $('input[name=\"barcode\"]').val(),\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n            \tlet value = 0;\r\n                if(data.code != 0 || data.data.length == 0){\r\n            \t\tUIkit.modal.alert(\"商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                data = data.data;\r\n                addTr(data);\r\n                value = parseInt(listObject[data.recordId].countNum) + parseInt(data.count);\r\n                onchangeCountNum(data.recordId,value);\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n            \t$('input[name=\"barcode\"]').val('');\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction dataReset(){\r\n            $('table.uk-table tbody tr').remove();\r\n            listObject = {};\r\n            loading_remove();\r\n\t\t}\r\n\t\t\r\n    <\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand uk-margin-top\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>物品請求・個別発注 内容入力<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">物品請求・個別発注 内容入力<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-width-1-3@m\">\r\n\t\t    \t\t<div class=\"uk-margin\">\r\n\t\t\t            <select class=\"uk-select\" name=\"busyo\">\r\n\t\t\t                <option value=\"\">----- 部署選択 -----<\/option>\r\n\t\t\t                <?php\r\n\t\t\t                if($userInfo->getUserPermission() == '1') {\r\n\t\t\t\t                echo '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t                echo '<option value=\"\" disabled>--------------------<\/option>';\r\n\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t                \tif($divisiton[5] == '1'){\r\n\t\t\t\t                \t\tcontinue;\r\n\t\t\t\t                \t}\r\n\t\t\t\t                echo '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t                }\r\n\t\t\t                } else if($userInfo->getDivisionId() == $divisionData['store'][0][1]) {\r\n\t\t\t\t                echo '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t                } else {\r\n\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t                \tif($divisiton[5] == '1'){\r\n\t\t\t\t                \t\tcontinue;\r\n\t\t\t\t                \t}\r\n\t\t\t\t                echo '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t                }\r\n\t\t\t                }\r\n\t\t\t                ?>\r\n\t\t\t            <\/select>\r\n\t\t\t        <\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin-bottom\">\r\n\t\t    \t\t<div>\r\n\t\t    \t\t\t<div uk-margin>\r\n\t\t    \t\t\t\t<button class=\"uk-button uk-button-default\" onclick=\"sanshouClick()\">商品マスタを開く<\/button>\r\n\t\t    \t\t\t\t<button class=\"uk-button uk-button-default\" type=\"submit\" onclick=\"window.print();return false;\">印刷プレビュー<\/button>\r\n\t\t    \t\t\t\t<button class=\"uk-button uk-button-primary goodsBillingButton\" onclick=\"sendGoodsBilling()\">物品請求<\/button>\r\n\t\t    \t\t\t\t<button class=\"uk-button uk-button-primary unorderedSlipButton\" onclick=\"sendUnorderedSlip()\">未発注伝票作成<\/button>\r\n\t\t    \t\t\t<\/div>\r\n\t\t    \t\t<\/div>\r\n\t\t    \t\t<?php /*\r\n\t\t    \t\t<div class=\"uk-inline uk-width-1-2@m\" uk-sticky=\"sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\"> \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-default uk-float-right uk-width-1-5 uk-padding-remove\">検索<\/button>\r\n\t\t    \t\t<\/div>*/ ?>\r\n\t\t    \t<\/div>\r\n\t\t\t    <div uk-sticky=\"sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky\" class=\"uk-padding-top uk-background-muted uk-padding-small\">\r\n\t\t    \t\t<form action='#' method=\"post\" onsubmit=\"barcodeSearch(); return false\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\" name=\"barcode\"> \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-primary uk-float-right uk-width-1-5 uk-padding-remove\" type=\"submit\">検索<\/button>\r\n\t\t\t\t\t<\/form>\t\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t    \t<div class=\"shouhin-table uk-width-expand uk-overflow-auto\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-striped uk-table-striped uk-table-condensed uk-text-nowrap\">\r\n\t\t    \t\t\t<thead>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<th>id<\/th>\r\n\t\t    \t\t\t\t\t<th>メーカー<\/th>\r\n\t\t    \t\t\t\t\t<th>商品名<\/th>\r\n\t\t    \t\t\t\t\t<th>製品コード<\/th>\r\n\t\t    \t\t\t\t\t<th>規格<\/th>\r\n\t\t    \t\t\t\t\t<th>入数<\/th>\r\n\t\t    \t\t\t\t\t<th>数量<\/th>\r\n\t\t    \t\t\t\t\t<th>価格<\/th>\r\n\t\t    \t\t\t\t\t<th>JANコード<\/th>\r\n\t\t    \t\t\t\t\t<th>卸業者<\/th>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/thead>\r\n\t\t    \t\t\t<tbody>\r\n\t\t    \t\t\t<\/tbody>\r\n\t\t    \t\t\t<tfoot>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/tfoot>\r\n\t\t    \t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39907",
   "name": "GoodsBillingDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\ninclude_once 'NewJoyPla/api/UpdateUnordered.php';\r\ninclude_once 'NewJoyPla/api/GetCardInfo.php';\r\ninclude_once 'NewJoyPla/api/GetItemBilling.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select('NJ_BillingHDB',$SPIRAL->getCardId(),'billingNumber','billingAuthKey',\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][2] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$getItemBilling = new App\\Api\\GetItemBilling($spiralDataBase,$userInfo);\r\n$billingData = $getItemBilling->getItemBilling($card['data'][0][0]);\r\n\r\n$billingData = $spiralDataBase->arrayToNameArray($billingData['data'],array('registrationTime','updateTime','inHospitalItemId','billingNumber','price','billingQuantity','billingAmount','hospitalId','divisionId','itemId','itemName','itemCode','itemStandard','itemJANCode','quantityUnit','makerName','itemUnit','quantity'));\r\n\r\nforeach($billingData as $record){\r\n\t$ItemsToJs[$record['inHospitalItemId']] = array(\r\n\t\t'billingQuantity'=> $record['billingQuantity']\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$billingAuthKey = $crypt->encrypt($card['data'][0][1], 'JoyPla');\r\n\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266881%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 物品請求書<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>物品請求一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>物品請求書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"物品請求取消\" onclick=\"billingDelete();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">物　品　請　求　書<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider uk-text-nowrap\">\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">物品請求日時<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:registrationTime%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">部署名<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:divisionName%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">品目数<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:itemsNumber%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price('%val:usr:totalAmount%')<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>請求数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>請求金額<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t    \t\t\t\t\t//'orderNumber','makerName','itemName','itemCode','itemStandard','price','quantity','orderQuantity','orderPrice','itemJANCode'\r\n\t\t\t\t    \t\t\t\t\tforeach($billingData as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo '<tr>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$num.'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['makerName'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['itemName'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['itemCode'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['itemStandard'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['quantity'].$record['quantityUnit'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>￥<script>price(fixed(\"'.$record['price'].'\"))<\/script> / '.$record['itemUnit'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>'.$record['billingQuantity'].$record['quantityUnit'].'<\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<td>￥<script>price(fixed(\"'.$record['billingAmount'].'\"))<\/script><\/td>';\r\n\t\t\t\t    \t\t\t\t\t\techo '<\/tr>';\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tlet canAjax = true;\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\tfunction billingDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm('物品請求情報を取消します。<br>よろしいですか<br>注意:在庫数を戻します。').then(function () {\r\n\t\t\t\t\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:'%url/card:page_267234%',\r\n\t                type:'POST',\r\n\t                data:{\r\n\t                \tdivisionId:\"%val:usr:divisionId%\",\r\n\t                \tbillingData : JSON.stringify( itemsToJs ),\r\n\t                \tbillingAuthKey: \"<?php echo $billingAuthKey ?>\",\r\n\t                \tbillingNumber: \"%val:usr:billingNumber%\",\r\n\t                },\r\n\t                dataType: 'json'\r\n\t            })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t                if(! data.result){\r\n\t            \t\tUIkit.modal.alert(\"物品請求取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t            \t\treturn false;\r\n\t                }\r\n\t                UIkit.modal.alert(\"物品請求取消が完了しました\").then(function () {\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t\t});\r\n\t            })\r\n\t            // Ajaxリクエストが失敗した時発動\r\n\t            .fail( (data) => {\r\n\t        \t\tUIkit.modal.alert(\"物品請求取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t            \tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止しました\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39908",
   "name": "GoodsBillingList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 物品請求一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>物品請求一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">物品請求一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:goodsBillingList:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39909",
   "name": "GoodsBillingMR",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GoodsBillingMonthlyReport.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$goodsBillingMonthlyReport = new App\\Api\\GoodsBillingMonthlyReport($spiralDataBase,$userInfo);\r\n\r\n$startMonth = date('Y-m-01');\r\n$endMonth = '';\r\n$divisionId = '';\r\n$page = 1;\r\n$limit = 100;\r\n$itemName = '';\r\n$itemCode = '';\r\n$itemStandard = '';\r\n\r\nif(isset($_POST['startMonth'])){\r\n\t$startMonth = App\\Lib\\html($_POST['startMonth']);\r\n}\r\n\r\nif(isset($_POST['endMonth'])){\r\n\t$endMonth = App\\Lib\\html($_POST['endMonth']);\r\n}\r\n\r\nif($userInfo->getUserPermission() == '1'){\r\n\tif(isset($_POST['divisionId'])){\r\n\t\t$divisionId = App\\Lib\\html($_POST['divisionId']);\r\n\t}\r\n} else {\r\n\t$divisionId = $userInfo->getDivisionId();\r\n}\r\n\r\nif(isset($_POST['page'])){\r\n\t$page = App\\Lib\\html($_POST['page']);\r\n}\r\n\r\nif(isset($_POST['limit'])){\r\n\t$limit = App\\Lib\\html($_POST['limit']);\r\n}\r\n\r\nif(isset($_POST['itemName'])){\r\n\t$itemName = App\\Lib\\html($_POST['itemName']);\r\n}\r\nif(isset($_POST['itemCode'])){\r\n\t$itemCode = App\\Lib\\html($_POST['itemCode']);\r\n}\r\nif(isset($_POST['itemStandard'])){\r\n\t$itemStandard = App\\Lib\\html($_POST['itemStandard']);\r\n}\r\n\r\n\r\n$result = $goodsBillingMonthlyReport->dataSelect($startMonth,$endMonth,$divisionId,$itemName,$itemCode,$itemStandard,$page,$limit);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 月次レポート【物品請求】<\/title>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>月次レポート【物品請求】<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"listDl();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">月次レポート【物品請求】<\/h2>\r\n\t\t    \t<hr>\r\n\t\t\t\t<div class=\"uk-width-1-1 uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-stacked\" name=\"myform\" action=\"%url/rel:mpgt:goodsBillingMR%\" method=\"post\" onsubmit=\"return submitCheck()\">\r\n\t\t\t\t\t\t<div class=\"uk-width-3-4@m uk-margin-auto\">\r\n\t\t\t\t\t\t\t<h3>検索<\/h3>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      日付\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-2@m\" uk-grid>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"startMonth\" value=\"<?php echo $startMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">から<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"endMonth\" value=\"<?php echo $endMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">まで<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"divisionId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tif($divisionData['store']){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $divisionData['store'][0][1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$divisionData['store'][0][1].\"\\\" \". $selected .\">\".$divisionData['store'][0][3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$record[1].\"\\\" \".$selected.\" >\".$record[3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom; \r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\tif($divisionData['store'][0][1] == $divisionId){\r\n\t\t\t\t\t\t\t\t\t\t\techo $divisionData['store'][0][3];\r\n\t\t\t\t\t\t\t\t\t\t} else { \r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t    \t\t\t\tif($record[1] != $divisionId){ continue; } \r\n\t\t\t\t\t\t\t    \t\t\t\techo $record[3] ;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t} ?>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      商品名\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemName\" value=\"<?php echo $itemName ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      製品コード\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemCode\" value=\"<?php echo $itemCode ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      規格\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemStandard\" value=\"<?php echo $itemStandard ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-text-center\">\r\n\t\t\t\t\t\t\t\t<input class=\"uk-margin-top uk-button uk-button-default\" type=\"submit\" value=\"検索\">\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-width-1-2@m uk-width-1-4@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(fixed('<?php echo $result['totalAmount'] ?>'))<\/script> -<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<\/tbody>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\">\r\n\t\t\t\t\t\t\t\t<span class=\"smp-offset-start\"><?php echo($limit * ($page - 1) )+ 1 ?><\/span> - <span class=\"smp-offset-end\"><?php echo($limit * $page > $result['count'])? $result['count'] : $limit * $page ?><\/span>件 / <span class=\"smp-count\"><?php echo $result['count'] ?><\/span>件\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\" uk-grid>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-2-3\">\r\n\t\t\t\t\t\t\t\t\t<select name=\"limit\" class=\" uk-select\">\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"10\" <?php echo($limit == '10')? 'selected' : '' ?>>10件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"50\" <?php echo($limit == '50')? 'selected' : '' ?>>50件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"100\" <?php echo($limit == '100')? 'selected' : '' ?>>100件<\/option><\/select><\/div>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-1-3\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"smp-table-submit-button\" class=\"uk-button uk-button-default\" value=\"表示\">\r\n\t\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\">\r\n\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>No<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>最小単位の価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>請求数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>合計金額<\/th>\r\n\t\t\t\t\t\t\t\t\t<\/tr>\r\n\t\t\t\t\t\t\t\t<\/thead>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\tif($result['count'] > 0){\r\n\t\t\t\t\t\t\t\t\t\tforeach($result['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['id'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['makerName'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemName'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemCode'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemStandard'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['minPrice'] .\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['billingQuantity'] .\" \".$record['quantityUnit'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['totalAmount'] .\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} ?>\r\n\t\t\t\t\t\t\t\t<\/tbody>\r\n\t\t\t\t\t\t\t<\/table>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<input name=\"page\" value=\"1\" type=\"hidden\">\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n     <script>\r\n\tfunction submitCheck(){\r\n\t\tif($('input[name=\"startMonth\"]').val() == \"\"){\r\n\t\t\tUIkit.modal.alert('日付検索の開始日は必須です');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tfunction pageSubmit(page){\r\n\t\t$('input[name=\"page\"]').val(page);\r\n\t\tdocument.myform.submit();\r\n\t}\r\n     \r\n\tfunction exportCSV(records) {\r\n\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\r\n\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\tlet link = document.createElement('a');\r\n\t\tlink.download = 'goodsBillingMonthlyReport_<?php echo date('Ymd') ?>.tsv';\r\n\t\tlink.href = url;\r\n\t\tdocument.body.appendChild(link);\r\n\t\tlink.click();\r\n\t\tdocument.body.removeChild(link);\r\n\t};\r\n\t\r\n\tfunction listDl(){\r\n\t\tlet records = <?php echo json_encode($result['data'])?>;\r\n\t\tlet result = [];\r\n\t\tfor(let i = 0 ; i < records.length ; i++){\r\n\t\t\tresult[i] = [];\r\n\t\t\tObject.keys(records[i]).forEach(function (key) {\r\n\t\t\t\tresult[i].push(records[i][key]);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tresult.unshift(['id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','minPrice','billingQuantity','totalAmount','quantityUnit']);\r\n\t\r\n\t\texportCSV(result);\r\n\t}\r\n     <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39910",
   "name": "HPTop",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetTenantData.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select();\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla TOP<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <style>\r\n    \t.nj_card{\r\n    \t\tbackground: #fff;\r\n\t\t    color: #666;\r\n\t\t    box-shadow: 0 5px 15px rgba(0,0,0,.08);\r\n    \t\tposition: relative;\r\n\t\t\theight: 100px;\r\n\t\t\tbox-sizing: border-box;\r\n    \t}\r\n\t\t.nj_card a{\r\n\t\t\tposition: absolute;\r\n\t\t    top: 0;\r\n\t\t    bottom: 0;\r\n\t\t    right: 0;\r\n\t\t    left: 0;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-body .icon {\r\n\t\t    font-size: 45px;\r\n\t\t    position: absolute;\r\n\t\t    top: -8px;\r\n\t\t    right: 0px;\r\n\t\t    color: #fff;\r\n\t\t    display: block;\r\n\t\t    height: 60px;\r\n\t\t    width: 60px;\r\n\t\t    background-repeat: no-repeat;\r\n\t\t    background-position: right bottom;\r\n\t\t}\r\n\r\n\t\t.nj_card .menu-body{\r\n    \t\tcolor: #ffffff;\r\n    \t\ttext-align: left;\r\n\t\t\tposition: absolute;\r\n\t\t\tleft: 12px;\r\n\t\t\tright: 12px;\r\n\t\t\ttop: 16px;\r\n\t\t\tbottom: 16px;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t}\r\n    \t\r\n\t\t.nj_card .menu-body p{\r\n\t\t\tmargin: 0px;\r\n\t\t    line-height: 1;\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 10px;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.nj_card .menu-body .title{\r\n\t\t\tfont-size: 20px;\r\n\t\t\tfont-weight: 600;\r\n\t\t\tcolor : #fff;\r\n\t\t\tfont-family:'メイリオ', 'Meiryo','ＭＳ ゴシック','Hiragino Kaku Gothic ProN','ヒラギノ角ゴ ProN W3',sans-serif;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-body .text{\r\n\t\t\tfont-size: 13px;\r\n\t\t\tcolor : #fff;\r\n\t\t\tfont-family:'メイリオ', 'Meiryo','ＭＳ ゴシック','Hiragino Kaku Gothic ProN','ヒラギノ角ゴ ProN W3',sans-serif;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-foot{\r\n\t\t\tbottom: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tposition: absolute;\r\n\t\t\tpadding: 3px;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-foot span{\r\n\t\t\tfont-size: 13px;\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\t\t\r\n\t\t.category-title{\r\n\t\t\tpadding: 8px;\r\n\t\t\tfont-weight: 600;\r\n\t\t}\r\n\t\t\r\n\t\t.content-1{\r\n    \t\tbackground: #87c7d7;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-1 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/1.png\");\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-1 .menu-foot{\r\n\t\t\tbackground: #79b3c1;\r\n\t\t\tcolor: #bcd9e0;\r\n\t\t}\r\n\t\t\r\n\t\t.content-1-1{\r\n    \t\tbackground: #5daac1;\r\n    \t}\r\n    \t\r\n\t\t.content-1-1 .menu-foot{\r\n\t\t\tbackground: #5499ad;\r\n\t\t\tcolor: #aaccd6;\r\n\t\t}\r\n    \t/*\r\n\t\t.content-1-1{\r\n    \t\tbackground: #87c7d7;\r\n    \t}\r\n    \t\r\n\t\t.content-1-1 .menu-foot{\r\n\t\t\tbackground: #79b3c1;\r\n\t\t\tcolor: #bcd9e0;\r\n\t\t}\r\n    \t*/\r\n\t\t.content-1-2{\r\n    \t\tbackground: #5daac1;\r\n    \t}\r\n    \t.content-1-2 .menu-foot{\r\n    \t\tbackground: #5499ad;\r\n    \t\tcolor: #aaccd6;\r\n    \t}\r\n    \t.content-1-2-sp{\r\n    \t\tbackground: #d7392c;\r\n    \t}\r\n    \t.content-1-2-sp .menu-foot{\r\n    \t\tbackground: #ad2525;\r\n    \t\tcolor: #ffffff;\r\n    \t}\r\n\t\t\r\n\t\t.content-2{\r\n    \t\tbackground: #52adb3;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-2 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/2.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-2 .menu-foot{\r\n\t\t\tbackground: #4a9ba1;\r\n\t\t\tcolor: #9bc8cb;\r\n\t\t}\r\n\t\t\r\n\t\t.content-2-1{\r\n    \t\tbackground: #52adb3;\r\n    \t}\r\n    \t\r\n\t\t.content-2-1 .menu-foot{\r\n\t\t\tbackground: #4a9ba1;\r\n\t\t\tcolor: #9bc8cb;\r\n\t\t}\r\n\t\t\r\n\t\t.content-3{\r\n\t\t\tbackground: #ea87af;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-3 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/3.png\");\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-3 .menu-foot{\r\n\t\t\tbackground: #d2799d;\r\n\t\t\tcolor: #e9bcce;\r\n\t\t}\r\n\t\t\r\n\t\t.content-3-1{\r\n    \t\tbackground: #ea87af;\r\n    \t}\r\n    \t\r\n\t\t.content-3-1 .menu-foot{\r\n\t\t\tbackground: #d2799d;\r\n\t\t\tcolor: #e9bcce;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-4{\r\n\t\t\tbackground: #d9c43d;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-4 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/4.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-4 .menu-foot{\r\n\t\t\tbackground: #c3b037;\r\n\t\t\tcolor: #e1d89b;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-5{\r\n    \t\tbackground: #f3a43c;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-5 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/5.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-5 .menu-foot{\r\n\t\t\tbackground: #da9336;\r\n\t\t\tcolor: #edc99b;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-6{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-6 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/6.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-6 .menu-foot{\r\n\t\t\tbackground: #778d38;\r\n\t\t\tcolor: #bbc69c;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-6-1{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n    \t\r\n\t\t.content-6-1 .menu-foot{\r\n\t\t\tbackground: #778d38;\r\n\t\t\tcolor: #bbc69c;\r\n\t\t}\r\n    \t\r\n\t\t.content-6-2{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n    \t.content-6-2 .menu-foot{\r\n    \t\tbackground: #778d38;\r\n    \t\tcolor: #bbc69c;\r\n    \t}\r\n\t\t\r\n\t\t.content-7{\r\n    \t\tbackground: #b6a1cb;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-7 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/7.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-7 .menu-foot{\r\n\t\t\tbackground: #a391b6;\r\n\t\t\tcolor: #d1c8db;\r\n\t\t}\r\n\t\t\r\n\t\t.content-7-1{\r\n    \t\tbackground: #b6a1cb;\r\n    \t}\r\n    \t\r\n\t\t.content-7-1 .menu-foot{\r\n\t\t\tbackground: #a391b6;\r\n\t\t\tcolor: #d1c8db;\r\n\t\t}\r\n\t\t\r\n\t\t.content-8{\r\n    \t\tbackground: #874989;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-8 .menu-body .icon{\r\n\t\t\tbackground-image: url(\"https://i02.smp.ne.jp/u/joypla/images/menu_icon/8.png\");\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-8 .menu-foot{\r\n\t\t\tbackground: #79427b;\r\n\t\t\tcolor: #bca1bd;\r\n\t\t}\r\n\t\t\r\n\t\t.content-8-1{\r\n    \t\tbackground: #874989;\r\n    \t}\r\n    \t\r\n\t\t.content-8-1 .menu-foot{\r\n\t\t\tbackground: #79427b;\r\n\t\t\tcolor: #bca1bd;\r\n\t\t}\r\n\t\t\r\n\t\ta.top-to-icon {\r\n\t\t\tzoom : 1.4;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.topic .limiter{\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t.topic .uk-pagination{\r\n\t\t\tdisplay: none !important;\r\n\t\t\t\r\n\t\t}\r\n\t\t.topic .title{\r\n\t\t\tpadding: 8px;\r\n\t\t\tbackground:#999999;\r\n\t\t\tcolor:white;\r\n\t\t\tmargin: 0px 0 0px 0;\r\n\t\t}\r\n\t\t.topic{\r\n\t\t\tborder: solid 1px #999999;\r\n\t\t\theight: 400px;\r\n\t\t}\r\n    <\/style>\r\n    <script>\r\n\tlet canAjax = true;\r\n    $(document).ready(function() {\r\n\t\t pageShow('<?php echo $_POST[\"page\"] ?>');\r\n    });\r\n    \tfunction paging(id){\r\n    \t\tlet url = location.href ;\r\n    \t\tlet param = '';\r\n    \t\tif(id){\r\n    \t\t\tparam = '&page='+id ;\r\n    \t\t}\r\n    \t\twindow.location.href = \"/area/servlet/area.MyPageBundle?MyPageID=<?php echo $_POST[\"MyPageID\"] ?>\"+param;\r\n    \t}\r\n    \t\r\n    \tfunction pageShow(page){\r\n    \t\tif(page == null || page == ''){\r\n    \t\t\tpage = 'page_top';\r\n    \t\t}\r\n\t\t\t$(\"[id^='page']\").hide();\r\n\t\t    $('#'+page).show();\r\n    \t}\r\n    \t\r\n    \t\r\n\t\tfunction search(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet searchValue =  $('input[name=\"searchValue\"]').val();\r\n\t\t\tif(searchValue == ''){\r\n\t\t\t\tUIkit.modal.alert('検索したいバーコードを読み取りまたは、入力してください');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n            loading();\r\n            \r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:barcodeSearchAPI%',\r\n                type:'POST',\r\n                data:{\r\n                \tsearchValue :searchValue\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(data.code != 0){\r\n            \t\tUIkit.modal.alert(\"伝票が見つかりませんでした\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"伝票が見つかりました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\tlocation.href=data.urls[0];\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n            \tUIkit.modal.alert(\"伝票が見つかりませんでした\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n    <\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding uk-padding-remove-horizontal\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-large\t\">\r\n\t    \t\t<?php\r\n\t    \t\tif($hospitalData['data'][0]['function1'] == '1'):\r\n\t    \t\t?>\r\n\t\t    \t<div class=\"uk-margin\">\r\n\t\t    \t\t<form action=\"#\" onsubmit=\"search(); return false;\" method=\"post\">\r\n\t\t\t\t    \t<div class=\"uk-padding-top uk-background-muted uk-padding-small uk-width-1-2@m\" >\r\n\t\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\" name=\"searchValue\"> \r\n\t\t\t    \t\t\t<button class=\"uk-button uk-button-primary uk-float-right uk-width-1-5 uk-padding-remove\" type=\"submit\">検索<\/button>\r\n\t\t\t    \t\t<\/div>\r\n\t\t    \t\t<\/form> \r\n\t    \t\t<\/div>\r\n\t    \t\t<?php\r\n\t    \t\tendif;\r\n\t    \t\t?>\r\n\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function1'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-1\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">注文・入庫<\/span><br>\r\n\t\t                                <span class=\"text\">Orders Receipt<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page1')\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function2'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-2\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">棚卸<\/span><br>\r\n\t\t                                <span class=\"text\">Inventory<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page2')\" class=\"slide2 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function3'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-3\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">実績<\/span><br>\r\n\t\t                                <span class=\"text\">Achievement<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page3')\" class=\"slide3 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function4'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-4\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">オプションメニュー<\/span><br>\r\n\t\t                                <span class=\"text\">Option<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"%url/rel:mpgt:option%\" class=\"slide4 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function5'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-5\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">貸出<\/span><br>\r\n\t\t                                <span class=\"text\">Borrowing<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>Coming Soon<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"#\" class=\"slide5\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function6'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-6\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">払出・在庫管理<\/span><br>\r\n\t\t                                <span class=\"text\">Payout Stock<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a  href=\"javascript:paging('page6')\" class=\"slide6 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function7'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-7\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">商品・見積<\/span><br>\r\n\t\t                                <span class=\"text\">Product Quotation<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page7')\" class=\"slide7 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tif($hospitalData['data'][0]['function8'] == '1'):\r\n\t\t    \t\t?>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-8\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">ユーザー管理<\/span><br>\r\n\t\t                                <span class=\"text\">User Management<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page8')\" class=\"slide8 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t    \t\t<?php\r\n\t\t    \t\tendif;\r\n\t\t    \t\t?>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div class=\"uk-text-left\" uk-grid>\r\n\t\t\t\t\t<div class=\"uk-width-1-2@m uk-text-left\">\r\n\t\t\t\t\t\t<div class=\"topic\">\r\n\t\t\t\t    \t\t<div class=\"title\">\t\r\n\t\t\t\t    \t\t\t<div uk-grid>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 \">\r\n\t\t\t\t\t    \t\t\t\t<span>システム通知<\/span>\r\n\t\t\t\t\t    \t\t\t<\/p>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 uk-text-right\">\r\n\t\t\t\t\t    \t\t\t\t<a href=\"%url/rel:mpgt:page_266378%\" class=\"uk-link\" style=\"color:#ffffff\">More Info<\/a>\r\n\t\t\t\t\t    \t\t\t<\/p>\t\r\n\t\t\t\t    \t\t\t<\/div>\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t\t<div class=\"uk-padding-small\">\r\n\t\t\t\t    \t\t\t\t%sf:usr:search91:table%\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div class=\"uk-width-1-2@m uk-text-left\">\r\n\t\t\t\t\t\t<div class=\"topic\">\r\n\t\t\t\t    \t\t<div class=\"title\">\r\n\t\t\t\t    \t\t\t<div uk-grid>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 \">\r\n\t\t\t\t\t    \t\t\t\t<span>新着トピック<\/span>\r\n\t\t\t\t\t    \t\t\t<\/p>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 uk-text-right\">\r\n\t\t\t\t\t    \t\t\t\t<a href=\"%url/rel:mpgt:page_266278%\" class=\"uk-link\" style=\"color:#ffffff\">More Info<\/a>\r\n\t\t\t\t\t    \t\t\t<\/p>\t\r\n\t\t\t\t    \t\t\t<\/div>\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t\t<div class=\"uk-padding-small\">\r\n\t\t\t\t    \t\t\t\t%sf:usr:search88:table%\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\r\n\t\t<?php\r\n\t\tif($hospitalData['data'][0]['function1'] == '1'):\r\n\t\t?>\t\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page1\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">注文・入庫<\/span><br>\r\n\t                            <span class=\"sub-title\">Orders Receipt<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-1-1 category-title\">注文<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">物品請求 / 個別発注<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Billing / Orders<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_262302%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">物品請求一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Billing List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:goodsBillingList%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266881%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">未発注書一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Unordered List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:unorderedList%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266849%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">発注書一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Ordered List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:orderedList%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266883%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">発注調整<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Order Adjustment<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_264502%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266885%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-1-2 category-title\">入庫<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-2\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">入荷照合<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Arrival Check<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:orderedList%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266883%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-2\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">商品別照合一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Check By Items<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_263495%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif ?>\r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-2\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">検収書一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Acceptance List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266891%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266908%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-1-2\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">返品一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Return List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_265603%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266910%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t    \r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t<?php\r\n\t\tendif;\r\n\t\t?>\r\n\r\n\t\t<?php\r\n\t\tif($hospitalData['data'][0]['function2'] == '1'):\r\n\t\t?>\t\t\t\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page2\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">棚卸<\/span><br>\r\n\t                            <span class=\"sub-title\">Inventory<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-1@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-2-1 category-title\">棚卸<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-2-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">棚卸<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Inventory Entry<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_263613%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-2-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">棚卸履歴一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Inventory History List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_263631%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page6\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">払出・在庫管理<\/span><br>\r\n\t                            <span class=\"sub-title\">Payout Stock<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-6-1 category-title\">払出（倉庫移動）<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-6-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">払出<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Payout<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:payoutContent%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-6-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">払出履歴一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Payout History List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_263579%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                            <?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_267442%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-6-1 category-title\">在庫<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-6-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">在庫管理表<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Stock Management List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_263588%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                            <?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_267320%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-6-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">ロット管理<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Lot List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_264625%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266925%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t\r\n\t\t<?php\r\n\t\tendif;\r\n\t\t?>\r\n\r\n\t\t<?php\r\n\t\tif($hospitalData['data'][0]['function3'] == '1'):\r\n\t\t?>\t\t\t\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page3\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">実績<\/span><br>\r\n\t                            <span class=\"sub-title\">Achievement<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-1@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-3-1 category-title\">実績<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-3-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">月次レポート【物品請求】<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Monthly Paper Goods Billing<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:goodsBillingMR%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-3-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">月次レポート【注文】<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Monthly Paper Order<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:orderMR%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-3-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">月次レポート【入荷照合】<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Monthly Paper Receiving<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:receivingMR%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-3-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">月次レポート【払出】<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Monthly Paper Payout<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:payoutMR%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-3-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">発注履歴詳細一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Order History Detail List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"%url/rel:mpgt:page_264885%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php else : ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"%url/rel:mpgt:page_162388%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t                            \r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t<?php\r\n\t\tendif;\r\n\t\t?>\r\n\r\n\t\t<?php\r\n\t\tif($hospitalData['data'][0]['function7'] == '1'):\r\n\t\t?>\t\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page7\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">商品・見積<\/span><br>\r\n\t                            <span class=\"sub-title\">Product Quotation<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"uk-child-width-1-2@m uk-text-left@m uk-margin-small-top\" style=\"color: #ffffff\" uk-grid>\r\n\t\t\t\t\t\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-7-1 category-title\">見積<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t\t<?php if($tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">見積依頼<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Quote Request<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"#\" onclick=\"javascript:document.quoteRequest.submit();\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"quoteRequest\" target=\"_blank\">\r\n\t\t\t\t\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"tenantId\" value=\"%val:usr:tenantId%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:quoteRequest%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"requestUName\" value=\"%val:usr:name%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"mail\" value=\"%val:usr:mailAddress%\">\r\n\t\t\t\t\t\t\t\t\t\t<\/form>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif; ?>\r\n\t\t\t\t\t\t\t<?php if($tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">見積依頼一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Quote Request List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266497%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif; ?>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-7-1 category-title\">商品<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">商品一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Items List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_264415%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">院内商品一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">In Hospital Items List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_264251%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1' && $tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">商品登録<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Item Regist<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"#\" onclick=\"javascript:document.itemsReg.submit();\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"itemsReg\" target=\"_blank\">\r\n\t\t\t\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"tenantId\" value=\"%val:usr:tenantId%\">\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:tenantId%\">\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:itemReg%\">\r\n\t\t\t\t\t\t\t\t\t<\/form>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif; ?>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1' && $tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">一括商品登録<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Bulk Insert Item<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:BulkInsertItems%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif; ?>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">一括院内商品登録<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Bulk Insert In Hospital Item<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:BulkInHPInsert%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <?php endif; ?>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t\r\n\t\t<?php\r\n\t\tendif;\r\n\t\t?>\r\n\r\n\t\t<?php\r\n\t\tif($hospitalData['data'][0]['function8'] == '1'):\r\n\t\t?>\t\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page8\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">ユーザー管理<\/span><br>\r\n\t                            <span class=\"sub-title\">User Management<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-1@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-8-1 category-title\">ユーザー管理<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">ユーザー情報変更<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">User Info Change<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"#\" onclick=\"document.userInfoChange.submit();\" class=\"slide1\"><\/a>\r\n\t\t\t                            \r\n\t\t\t\t\t\t\t\t\t\t<form method=\"post\" action=\"/regist/is\" name=\"userInfoChange\" target=\"_blank\">\r\n\t\t\t\t\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"divisionId\" value=\"%val:usr:divisionId%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"userPermission\" value=\"%val:usr:userPermission:id%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"loginId\" value=\"%val:usr:loginId%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"name\" value=\"%val:usr:name%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"nameKana\" value=\"%val:usr:nameKana%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"mailAddress\" value=\"%val:usr:mailAddress%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"remarks\" value=\"%val:usr:remarks%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:hpUserChange%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:hpUserCForD%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"%val:sys:id%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"authKey\" value=\"%val:usr:authKey%\" >\r\n\t\t\t\t\t\t\t\t\t\t<\/form>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">ユーザー一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">User List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:userManagement%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">部署一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Division List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_265018%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">卸業者一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Distributor List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_265118%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">契約情報確認<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Contract Confirmationn<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:ContractConfirm%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t<?php\r\n\t\tendif;\r\n\t\t?>\r\n\t\t\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39911",
   "name": "InHospitalItemsListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 院内商品マスタ<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>院内商品マスタ<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1 uk-margin-remove-left\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m uk-padding-remove\">\r\n\t\t    \t\t\t<h2>院内商品マスタ<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div class=\"uk-width-1-4@m uk-padding-remove no_print\">\r\n\t\t\t\t    \t<ul uk-accordion class=\"uk-background-muted uk-padding-small\">\r\n\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t        <a class=\"uk-accordion-title\" href=\"#\">表示項目選択<\/a>\r\n\t\t\t\t\t\t        <div class=\"uk-accordion-content\" hidden>\r\n\t\t\t\t\t\t    \t\t<a class=\"uk-button uk-button-secondary uk-button-small uk-width-1-1\" href=\"#\" onclick=\"table_field_selector()\">反映<\/a>\r\n\t\t\t\t\t\t        \t<ul class=\"uk-list uk-list-striped\">\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_01\" type=\"checkbox\"> 使用状況<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_02\" type=\"checkbox\"> 登録日時<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_03\" type=\"checkbox\"> 更新日時<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_04\" type=\"checkbox\"> 商品ID<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_05\" type=\"checkbox\"> メーカー名<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_06\" type=\"checkbox\"> 商品名<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_07\" type=\"checkbox\"> 製品コード<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_08\" type=\"checkbox\"> 規格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_09\" type=\"checkbox\"> カタログNO<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_10\" type=\"checkbox\"> シリアルNO<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_11\" type=\"checkbox\"> 入数<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_12\" type=\"checkbox\"> 最小単位の価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_13\" type=\"checkbox\"> 価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_14\" type=\"checkbox\"> 旧価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_15\" type=\"checkbox\"> JANコード<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_16\" type=\"checkbox\"> 院内倉庫在庫数<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_17\" type=\"checkbox\"> 償還価格フラグ<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_18\" type=\"checkbox\"> 償還価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_19\" type=\"checkbox\"> 旧償還価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_20\" type=\"checkbox\"> 卸業者<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_21\" type=\"checkbox\"> 特記事項<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/li>\r\n\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin-top\">\r\n\t\t\t\t%sf:usr:searchOroshiItem%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t$(function(){\r\n\t\tlet storage = JSON.parse(localStorage.getItem(\"joypla_inHpItemsList\"));\r\n\t\tlet dispObj = {};\r\n\t\tif(!storage){\r\n\t\t\tfor(let i = 1 ; i <= 22 ; i++){\r\n\t\t\t\tdispObj[i] = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdispObj = storage;\r\n\t\t}\r\n\t\tdispSet(dispObj);\r\n\t});\r\n\tfunction table_field_selector(){\r\n\t\tlet count = $(\"input[class^='uk-checkbox chk_']\").length;\r\n\t\tlet disp = {};\r\n\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\tdisp[i] = false;\r\n\t\t\tif($(\"input.chk_\"+( \"00\" + i ).slice( -2 )).is(\":checked\")){\r\n\t\t\t\tdisp[i] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlocalStorage.setItem(\"joypla_inHpItemsList\", JSON.stringify(disp));\r\n\t\tlocation.reload();\r\n\t}\r\n\t\r\n\tfunction dispSet(settingObj){\r\n\t\tObject.keys(settingObj).forEach(function (key) {\r\n\t\t  $(\".chk_\"+( \"00\" + key ).slice( -2 )).prop(\"checked\", settingObj[key]);\r\n\t\t  if(settingObj[key]){\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).show();\r\n\t\t  } else {\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).hide();\r\n\t\t  }\r\n\t\t});\r\n\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39912",
   "name": "InHospitalItemsListForReference",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 院内商品情報一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n\r\n\t<script>\r\n\tfunction hanei(elm){\r\n\t\tlet shouhinTr = $(elm.parentNode.parentNode);\r\n\t\tshouhinObject = JSON.parse($('.json',shouhinTr).text().replace(/\\r?\\n/g, '').trim());\r\n\t\twindow.opener.addTr(shouhinObject);\r\n\t}\r\n\t<\/script>    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>院内商品情報一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">院内商品情報一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:innnaizyouhou%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39913",
   "name": "InHospitalProductsDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 院内商品情報<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n    <script>\r\n    $(function(){\r\n    \tlet notUsedFlag = \"%val:usr:notUsedFlag:id%\";\r\n\t\tif(notUsedFlag == \"0\"){\r\n\t\t\tlabel = \"uk-label-success\";\r\n\t\t} else {\r\n\t\t\tlabel = \"uk-label-danger\";\r\n\t\t}\r\n\t\t\r\n\t\t$(\"#notUsedFlag\").addClass(label);\r\n    });\r\n    \r\n\t<\/script>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\">院内商品マスタ<\/a><\/li><li><span>院内商品情報<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == \"1\"): ?>\r\n\t                    <input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"院内商品情報変更\" onclick=\"document.itemsChange.submit()\">\r\n\t\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"itemsChange\" target=\"_blank\" class=\"uk-hidden\">\r\n\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:inHpItemsChange%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"makerName\" value=\"%val:usr:makerName%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemName\" value=\"%val:usr:itemName%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemCode\" value=\"%val:usr:itemCode%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemStandard\" value=\"%val:usr:itemStandard%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemJANCode\" value=\"%val:usr:itemJANCode%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"price\" value=\"%val:usr:price%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"inHospitalItemId\" value=\"%val:usr:inHospitalItemId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"authKey\" value=\"%val:usr:authKey%\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"notUsedFlag\" value=\"%val:usr:notUsedFlag%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"catalogNo\" value=\"%val:usr:catalogNo%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"serialNo\" value=\"%val:usr:serialNo%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"constant\" value=\"%val:usr:constant%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"quantity\" value=\"%val:usr:quantity%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"quantityUnit\" value=\"%val:usr:quantityUnit%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemUnit\" value=\"%val:usr:itemUnit%\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"minPrice\" value=\"%val:usr:minPrice%\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"price\" value=\"%val:usr:price%\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"oldPrice\" value=\"%val:usr:oldPrice%\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"medicineCategory\" value=\"%val:usr:medicineCategory%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"homeCategory\" value=\"%val:usr:homeCategory%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"HPstock\" value=\"%val:usr:HPstock%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"notice\" value=\"%val:usr:notice%\">\r\n\t\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:inHpItemsChange%\">\r\n\t\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t<a class=\"print_hidden uk-button uk-button-primary\" href=\"#modal-label\" uk-toggle>ラベル発行<\/a>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>院内商品情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-4-5@m uk-margin-auto uk-margin-remove-top\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t    <tr><td colspan=\"6\">商品基本情報<\/td><\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>商品ID<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemId%<\/td>\r\n\t\t\t\t\t            <th>JANコード<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemJANCode%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>メーカー名<\/th>\r\n\t\t\t\t\t            <td>%val:usr:makerName%<\/td>\r\n\t\t\t\t\t            <th>商品名<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>製品コード<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemCode%<\/td>\r\n\t\t\t\t\t            <th>規格<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemStandard%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>償還価格フラグ<\/th>\r\n\t\t\t\t\t            <td>%val:usr:officialFlag:v%<\/td>\r\n\t\t\t\t\t            <th>償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialprice%\"))<\/script>円<\/td>\r\n\t\t\t\t\t            <th>旧償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialpriceOld%\"))<\/script>円<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>最小入数単位の価格<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\"><script>price(fixed(\"%val:usr:minPrice%\"))<\/script>円 / 1 %val:usr:quantityUnit%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t    \t<tr><td colspan=\"6\">院内商品情報<\/td><\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>不使用フラグ<\/th>\r\n\t\t\t\t\t            <td><span class=\"uk-label\" id=\"notUsedFlag\">%val:usr:notUsedFlag:v%<\/span><\/td>\r\n\t\t\t\t\t            <th>卸業者<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:distributorName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>カタログNo<\/th>\r\n\t\t\t\t\t            <td>%val:usr:catalogNo%<\/td>\r\n\t\t\t\t\t            <th>シリアルNo<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:serialNo%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>個数単位<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>入数<\/th>\r\n\t\t\t\t\t            <td>%val:usr:quantity% %val:usr:quantityUnit% / 1 %val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t            <th>価格<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><script>price(fixed(\"%val:usr:price%\"))<\/script>円 / 1 %val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t            <!--\r\n\t\t\t\t\t            <th>旧価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:oldPrice%\"))<\/script>円<\/td>\r\n\t\t\t\t\t            -->\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>保険請求分類（医科）<\/th>\r\n\t\t\t\t\t            <td>%val:usr:medicineCategory%<\/td>\r\n\t\t\t\t\t            <th>保険請求分類（在宅）<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:homeCategory%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th class=\"uk-text-top\">特記事項<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:notice:br%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<div id=\"modal-label\" uk-modal>\r\n\t    <div class=\"uk-modal-dialog\">\r\n\t        <button class=\"uk-modal-close-default\" type=\"button\" uk-close><\/button>\r\n\t        <div class=\"uk-modal-header\">\r\n\t            <h2 class=\"uk-modal-title\">ラベル発行<\/h2>\r\n\t        <\/div>\r\n\t\t\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"uk-form-horizontal\">\r\n\t\t        <div class=\"uk-modal-body\">\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" >入数指定<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" value=\"%val:usr:quantity%\" step=\"1\" min=\"0\" name=\"quantity\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" >印刷枚数<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" step=\"1\" value=\"1\" min=\"0\" name=\"printCount\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">JANコード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemJANCode%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">メーカー名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:makerName%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">商品名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemName%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">製品コード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemCode%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">規格<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemStandard%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t        <\/div>\r\n\t\t        <div class=\"uk-modal-footer uk-text-right\">\r\n\t\t            <button class=\"uk-button uk-button-default uk-modal-close\" type=\"button\">閉じる<\/button>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"ラベル発行\" onclick='return createLabel(\"%val:usr:inHospitalItemId%\")'>\r\n\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t\t\t\t<input type=\"hidden\" value=\"%val:usr:distributorName%\" name=\"distributorName\">\r\n\t\t        <\/div>\r\n\t        <\/form>\r\n\t    <\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tlet itemsToJs = {\r\n\t\t\t\"%val:usr:inHospitalItemId%\":{\r\n\t\t\t\t\"receivingCount\":\"0\",\r\n\t\t\t\t\"quantity\":\"%val:usr:quantity%\",\r\n\t\t\t\t\"makerName\":\"%val:usr:makerName%\",\r\n\t\t\t\t\"itemName\":\"%val:usr:itemName%\",\r\n\t\t\t\t\"itemCode\":\"%val:usr:itemCode%\",\r\n\t\t\t\t\"itemStandard\":\"%val:usr:itemStandard%\",\r\n\t\t\t\t\"quantityUnit\":\"%val:usr:quantityUnit%\",\r\n\t\t\t\t\"itemUnit\":\"%val:usr:itemUnit%\",\r\n\t\t\t\t\"itemJANCode\":\"%val:usr:itemJANCode%\",\r\n\t\t\t\t\"totalReturnCount\":\"0\",\r\n\t\t\t\t\"labelId\":\"%val:usr:labelId%\",\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tfunction createLabel(inHospitalItemId){\r\n\t\t\tif(!setVal()){\r\n\t\t\t\tUIkit.modal.alert('入力値に不正があります。<br>ご確認ください');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\titemsToJs[inHospitalItemId].receivingCount = $('input[name=\"printCount\"]').val();\r\n\t\t\titemsToJs[inHospitalItemId].quantity = $('input[name=\"quantity\"]').val();\r\n\t\t\t\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( objectValueToURIencode(itemsToJs) ));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction setVal(){\r\n\t\t\t$('input[name=\"printCount\"]').removeClass('uk-form-danger');\r\n\t\t\t$('input[name=\"quantity\"]').removeClass('uk-form-danger');\r\n\t\t\t\r\n\t\t\tlet flg = true;\r\n\t\t\tif($('input[name=\"printCount\"]').val() == '' || $('input[name=\"printCount\"]').val() < 1 ){\r\n\t\t\t\t$('input[name=\"printCount\"]').addClass('uk-form-danger');\r\n\t\t\t\tflg = false;\r\n\t\t\t}\r\n\t\t\tif($('input[name=\"quantity\"]').val() == '' || $('input[name=\"quantity\"]').val() < 1 ){\r\n\t\t\t\t$('input[name=\"quantity\"]').addClass('uk-form-danger');\r\n\t\t\t\tflg = false;\r\n\t\t\t}\r\n\t\t\treturn flg;\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39914",
   "name": "InHospitalProductsDetailForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 院内商品情報<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n    <script>\r\n    $(function(){\r\n\t\tif(\"%val:usr:notUsedFlag:id%\" == \"0\"){\r\n\t\t\tlabel = \"uk-label-success\";\r\n\t\t} else {\r\n\t\t\tlabel = \"uk-label-danger\";\r\n\t\t}\r\n\t\t\r\n\t\t$(\"#notUsedFlag\").addClass(label);\r\n    });\r\n\t<\/script>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\">院内商品マスタ<\/a><\/li><li><span>院内商品情報<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n                    <a class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" href=\"#modal-label\" uk-toggle>ラベル発行<\/a>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>院内商品情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-4-5@m uk-margin-auto uk-margin-remove-top\" uk-grid>\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider\">\r\n\t\t\t\t\t    <tr><td colspan=\"6\">商品基本情報<\/td><\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>商品ID<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemId%<\/td>\r\n\t\t\t\t\t            <th>JANコード<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemJANCode%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>メーカー名<\/th>\r\n\t\t\t\t\t            <td>%val:usr:makerName%<\/td>\r\n\t\t\t\t\t            <th>商品名<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>製品コード<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemCode%<\/td>\r\n\t\t\t\t\t            <th>規格<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemStandard%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>償還価格フラグ<\/th>\r\n\t\t\t\t\t            <td>%val:usr:officialFlag:v%<\/td>\r\n\t\t\t\t\t            <th>償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialprice%\"))<\/script>円<\/td>\r\n\t\t\t\t\t            <th>旧償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialpriceOld%\"))<\/script>円<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>最小入数単位の価格<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\"><script>price(fixed(\"%val:usr:minPrice%\"))<\/script>円 / 1 %val:usr:quantityUnit%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t    \t<tr><td colspan=\"6\">院内商品情報<\/td><\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>不使用フラグ<\/th>\r\n\t\t\t\t\t            <td><span class=\"uk-label\" id=\"notUsedFlag\">%val:usr:notUsedFlag:v%<\/span><\/td>\r\n\t\t\t\t\t            <th>卸業者<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:distributorName%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>カタログNo<\/th>\r\n\t\t\t\t\t            <td>%val:usr:catalogNo%<\/td>\r\n\t\t\t\t\t            <th>シリアルNo<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:serialNo%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>個数単位<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>入数<\/th>\r\n\t\t\t\t\t            <td>%val:usr:quantity% %val:usr:quantityUnit% / 1 %val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t            <th>価格<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\"><script>price(fixed(\"%val:usr:price%\"))<\/script>円 / 1 %val:usr:itemUnit%<\/td>\r\n\t\t\t\t\t            <!--\r\n\t\t\t\t\t            <th>旧価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:oldPrice%\"))<\/script>円<\/td>\r\n\t\t\t\t\t            -->\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>保険請求分類（医科）<\/th>\r\n\t\t\t\t\t            <td>%val:usr:medicineCategory%<\/td>\r\n\t\t\t\t\t            <th>保険請求分類（在宅）<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:homeCategory%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th class=\"uk-text-top\">特記事項<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\">%val:usr:notice:br%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<div id=\"modal-label\" uk-modal>\r\n\t    <div class=\"uk-modal-dialog\">\r\n\t        <button class=\"uk-modal-close-default\" type=\"button\" uk-close><\/button>\r\n\t        <div class=\"uk-modal-header\">\r\n\t            <h2 class=\"uk-modal-title\">ラベル発行<\/h2>\r\n\t        <\/div>\r\n\t\t\t<form action=\"%url/rel:@mpgt:createLabelForD%\" target=\"_blank\" method=\"post\" class=\"uk-form-horizontal\">\r\n\t\t        <div class=\"uk-modal-body\">\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" >入数指定<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" step=\"1\" value=\"%val:usr:quantity%\" min=\"0\" name=\"quantity\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\" >印刷枚数<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" step=\"1\" value=\"1\" min=\"0\" name=\"printCount\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">JANコード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemJANCode%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">メーカー名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:makerName%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">商品名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemName%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">製品コード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemCode%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">規格<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span>%val:usr:itemStandard%<\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t        <\/div>\r\n\t\t        <div class=\"uk-modal-footer uk-text-right\">\r\n\t\t            <button class=\"uk-button uk-button-default uk-modal-close\" type=\"button\">閉じる<\/button>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"ラベル発行\" onclick='return createLabel(\"%val:usr:inHospitalItemId%\")'>\r\n\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t\t\t\t<input type=\"hidden\" value=\"%val:usr:distributorName%\" name=\"distributorName\">\r\n\t\t        <\/div>\r\n\t        <\/form>\r\n\t    <\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tlet itemsToJs = {\r\n\t\t\t\"%val:usr:inHospitalItemId%\":{\r\n\t\t\t\t\"receivingCount\":\"0\",\r\n\t\t\t\t\"quantity\":\"%val:usr:quantity%\",\r\n\t\t\t\t\"makerName\":\"%val:usr:makerName%\",\r\n\t\t\t\t\"itemName\":\"%val:usr:itemName%\",\r\n\t\t\t\t\"itemCode\":\"%val:usr:itemCode%\",\r\n\t\t\t\t\"itemStandard\":\"%val:usr:itemStandard%\",\r\n\t\t\t\t\"quantityUnit\":\"%val:usr:quantityUnit%\",\r\n\t\t\t\t\"itemUnit\":\"%val:usr:itemUnit%\",\r\n\t\t\t\t\"itemJANCode\":\"%val:usr:itemJANCode%\",\r\n\t\t\t\t\"totalReturnCount\":\"0\",\r\n\t\t\t\t\"labelId\":\"%val:usr:labelId%\",\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tfunction createLabel(inHospitalItemId){\r\n\t\t\tif(!setVal()){\r\n\t\t\t\tUIkit.modal.alert('入力値に不正があります。<br>ご確認ください');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\titemsToJs[inHospitalItemId].receivingCount = $('input[name=\"printCount\"]').val();\r\n\t\t\titemsToJs[inHospitalItemId].quantity = $('input[name=\"quantity\"]').val();\r\n\t\t\t\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( objectValueToURIencode(itemsToJs) ));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction setVal(){\r\n\t\t\t$('input[name=\"printCount\"]').removeClass('uk-form-danger');\r\n\t\t\t$('input[name=\"quantity\"]').removeClass('uk-form-danger');\r\n\t\t\t\r\n\t\t\tlet flg = true;\r\n\t\t\tif($('input[name=\"printCount\"]').val() == '' || $('input[name=\"printCount\"]').val() < 1 ){\r\n\t\t\t\t$('input[name=\"printCount\"]').addClass('uk-form-danger');\r\n\t\t\t\tflg = false;\r\n\t\t\t}\r\n\t\t\tif($('input[name=\"quantity\"]').val() == '' || $('input[name=\"quantity\"]').val() < 1 ){\r\n\t\t\t\t$('input[name=\"quantity\"]').addClass('uk-form-danger');\r\n\t\t\t\tflg = false;\r\n\t\t\t}\r\n\t\t\treturn flg;\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39915",
   "name": "InHospitalProductsMaster",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 院内商品マスタ<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>院内商品マスタ<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1 uk-margin-remove-left\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m uk-padding-remove\">\r\n\t\t    \t\t\t<h2>院内商品マスタ<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div class=\"uk-width-1-4@m uk-padding-remove no_print\">\r\n\t\t\t\t    \t<ul uk-accordion class=\"uk-background-muted uk-padding-small\">\r\n\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t        <a class=\"uk-accordion-title\" href=\"#\">表示項目選択<\/a>\r\n\t\t\t\t\t\t        <div class=\"uk-accordion-content\" hidden>\r\n\t\t\t\t\t\t    \t\t<a class=\"uk-button uk-button-secondary uk-button-small uk-width-1-1\" href=\"#\" onclick=\"table_field_selector()\">反映<\/a>\r\n\t\t\t\t\t\t        \t<ul class=\"uk-list uk-list-striped\">\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_01\" type=\"checkbox\"> 使用状況<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_02\" type=\"checkbox\"> 登録日時<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_03\" type=\"checkbox\"> 更新日時<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_04\" type=\"checkbox\"> 商品ID<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_05\" type=\"checkbox\"> メーカー名<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_06\" type=\"checkbox\"> 商品名<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_07\" type=\"checkbox\"> 製品コード<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_08\" type=\"checkbox\"> 規格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_09\" type=\"checkbox\"> カタログNO<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_10\" type=\"checkbox\"> シリアルNO<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_11\" type=\"checkbox\"> 入数<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_12\" type=\"checkbox\"> 最小単位の価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_13\" type=\"checkbox\"> 価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_14\" type=\"checkbox\"> 旧価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_15\" type=\"checkbox\"> JANコード<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_16\" type=\"checkbox\"> 院内倉庫在庫数<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_17\" type=\"checkbox\"> 償還価格フラグ<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_18\" type=\"checkbox\"> 償還価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_19\" type=\"checkbox\"> 旧償還価格<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_20\" type=\"checkbox\"> 卸業者<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_21\" type=\"checkbox\"> 特記事項<\/label>\r\n\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/li>\r\n\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin-top\">\r\n\t\t\t\t%sf:usr:search63%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t$(function(){\r\n\t\tlet storage = JSON.parse(localStorage.getItem(\"joypla_inHpItemsList\"));\r\n\t\tlet dispObj = {};\r\n\t\tif(!storage){\r\n\t\t\tfor(let i = 1 ; i <= 22 ; i++){\r\n\t\t\t\tdispObj[i] = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdispObj = storage;\r\n\t\t}\r\n\t\tdispSet(dispObj);\r\n\t});\r\n\tfunction table_field_selector(){\r\n\t\tlet count = $(\"input[class^='uk-checkbox chk_']\").length;\r\n\t\tlet disp = {};\r\n\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\tdisp[i] = false;\r\n\t\t\tif($(\"input.chk_\"+( \"00\" + i ).slice( -2 )).is(\":checked\")){\r\n\t\t\t\tdisp[i] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlocalStorage.setItem(\"joypla_inHpItemsList\", JSON.stringify(disp));\r\n\t\tlocation.reload();\r\n\t}\r\n\t\r\n\tfunction dispSet(settingObj){\r\n\t\tObject.keys(settingObj).forEach(function (key) {\r\n\t\t  $(\".chk_\"+( \"00\" + key ).slice( -2 )).prop(\"checked\", settingObj[key]);\r\n\t\t  if(settingObj[key]){\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).show();\r\n\t\t  } else {\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).hide();\r\n\t\t  }\r\n\t\t});\r\n\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39916",
   "name": "InventoryContentEntry",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 棚卸内容入力<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <style>\r\n\t\t\r\n\t\t.page_title{\r\n\t\t}\r\n\t\t\r\n\t\t.shouhin-data{\r\n\t\t}\r\n\t\t\r\n\t\t.id{\r\n\t\t\tmin-width: 24px;\r\n\t\t\tmax-width: 24px;\r\n\t\t}\r\n\t\t\r\n\t\t.shouhin-data .itemName{\r\n\t\t\tfont-size: 14px;\r\n\t\t}\r\n\t\t.shouhin-data .makerName{\r\n\t\t\tfont-size: 12px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .tana{\r\n\t\t\tfont-size: 8px;\r\n\t\t}\r\n\t\t.shouhin-data .itemCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .constant{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .quantity{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .price{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .JANCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .officialFlag{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.itemCount{\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\t\t.itemCount->after {\r\n\t\t   content: attr(data-format); /* ここが重要!! */\r\n\t\t   width: 10%;\r\n\t\t   height: 20px;\r\n\t\t   position: absolute;\r\n\t\t   bottom: 4px;\r\n\t\t}\r\n\t\t.itemCountInput{\r\n\t\t\twidth: 90%;\r\n\t\t}\r\n\t\t.uk-table th, .uk-table td{\r\n\t\t\tword-break: break-word;\r\n\t\t\tpadding: 12px 8px;\r\n\t\t\tvertical-align: middle;\r\n\t\t}\r\n\t\t.uk-table tfoot tr{\r\n\t\t\tborder-bottom: #e5e5e5 1px solid;\r\n\t\t\tborder-top: #e5e5e5 1px solid;\r\n\t\t}\r\n    <\/style>\r\n    <script>\r\n\t\tlet canAjax = true;\r\n    \t// 参照ボタンクリック\r\n\t\tfunction sanshouClick(){\r\n\t\t\t// 参照マスタを別ウィンドウで開く\r\n\t\t\twindow.open('%url/rel:mpgt:page_262313%', '_blank','scrollbars=yes,width=1220,height=600');\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\tlet listObject = {};\r\n\t\tlet dataKey = ['id','maker','shouhinName','code','kikaku','irisu','count','kakaku','jan','oroshi'];\r\n\t\t\r\n\t\tfunction addTr(object){\r\n\t\t\tif(listObject[object.recordId]){\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\tlistObject[object.recordId] = object;\r\n\t\t\t\tlistObject[object.recordId].row = Object.keys(listObject).length;\r\n\t\t\t}\r\n\t\t\tlistObject[object.recordId].countNum = 0;\r\n\t\t\tlet trElm = document.createElement(\"tr\"); \r\n\t\t\tlet tdElm = '';\r\n\t\t\tfor(let i = 0 ; i < dataKey.length; i++){\r\n\t\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\t\thtml = '';\r\n\t\t\t\tif(dataKey[i] === 'id'){\r\n\t\t\t\t\thtml = document.createTextNode(listObject[object.recordId].row);\r\n\t\t\t\t} else if(dataKey[i] === 'count'){\r\n\t\t\t\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t\t\t\t    html = document.createElement(\"div\");\r\n\t\t\t\t    input = document.createElement(\"input\");\r\n\t\t\t\t    input.type = 'number';\r\n\t\t\t\t\tinput.step=\"1\";\r\n\t\t\t\t    input.className = 'uk-input';\r\n\t\t\t\t    input.style = 'width:96px';\r\n\t\t\t\t    input.id = 'hp_' + object.recordId;\r\n\t\t\t\t    input.min = 0;\r\n\t\t\t\t    input.value = listObject[object.recordId].countNum;\r\n\t\t\t\t    \r\n\t\t\t\t    input.onchange  = function () {  \r\n\t\t\t\t\t\tchangeForInputNumber(this);\r\n\t\t\t\t    \tonchangeCountNum(object.recordId,this.value);\r\n\t\t\t\t    };\r\n\t\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t\t    span = document.createElement(\"span\");\r\n\t\t\t\t    span.innerText = listObject[object.recordId].unit;\r\n\t\t\t\t    span.className = 'uk-text-bottom';\r\n\t\t\t\t\thtml.appendChild(input);\r\n\t\t\t\t\thtml.appendChild(span);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext = \"\";\r\n\t\t\t\t\tif(dataKey[i] === 'kakaku') {\r\n\t\t\t\t\t\ttext += \"￥\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttext += listObject[object.recordId][dataKey[i]];\r\n\t\t\t\t\tif(dataKey[i] === 'teisu' || dataKey[i] === 'irisu') {\r\n\t\t\t\t\t\ttext += listObject[object.recordId].unit;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml = document.createTextNode(text);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttdElm.appendChild(html);\r\n\t\t\t\ttrElm.appendChild(tdElm);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\".shouhin-table table tbody\").append(trElm);\r\n\t\t}\r\n\t\t\r\n\t\tfunction onchangeCountNum(id,value){\r\n\t\t\tlistObject[id].countNum = value;\r\n\t\t\t$('#hp_'+id).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"96px\"});\r\n\t\t\t$('#hp_'+id).val(value);\r\n\t\t\t$(window).scrollTop($('#hp_'+id+':first').offset().top - 100);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction barcodeSearch(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n            loading();\r\n          \r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:labelBarcodeSAPI%',\r\n                type:'POST',\r\n                data:{\r\n                \tbarcode : $('input[name=\"barcode\"]').val(),\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n            \tlet value = 0;\r\n                if(data.code != 0 || data.data.length == 0){\r\n            \t\tUIkit.modal.alert(\"商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                data = data.data;\r\n                addTr(data);\r\n                value = parseInt(listObject[data.recordId].countNum) + parseInt(data.count);\r\n                onchangeCountNum(data.recordId,value);\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n            \t$('input[name=\"barcode\"]').val('');\r\n\t\t\t\tloading_remove();\r\n\t\t\t\t\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\tfunction inventoryCheck(){\r\n\t\t\tif($('select[name=\"busyo\"]').val()){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('部署を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Object.keys(listObject).length === 0){\r\n\t\t\t\tUIkit.modal.alert('商品を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet checkflg = false;\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t  if(listObject[key].countNum !== 0){\r\n\t\t\t  \tcheckflg = true;\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(checkflg){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('数量を入力してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction sendInventory(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n            loading();\r\n\t\t\tif(! inventoryCheck()){\r\n\t\t\t\tloading_remove();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:regInventory%',\r\n                type:'POST',\r\n                data:{\r\n                \tinventory : JSON.stringify( objectValueToURIencode(listObject) ),\r\n                \tdivisionId : $('select[name=\"busyo\"]').val()\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"棚卸登録に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"棚卸登録が完了しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\tdataReset();\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"棚卸登録に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n\t\t\t\t\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction dataReset(){\r\n            $('table.uk-table tbody tr').remove();\r\n            listObject = {};\r\n            loading_remove();\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n    <\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>棚卸内容入力<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">棚卸内容入力<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-width-1-3@m\">\r\n\t\t    \t\t<div class=\"uk-margin\">\r\n\t\t\t            <select class=\"uk-select\" name=\"busyo\">\r\n\t\t\t\t                <option value=\"\">----- 部署選択 -----<\/option>\r\n\t\t\t\t                <?php if($userInfo->getUserPermission() == '1'){ \r\n\t\t\t\t\t                echo '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t\t                echo '<option value=\"\" disabled>---------------------<\/option>';\r\n\t\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t                \t\tif($divisiton[5] == '1'){ continue; }\r\n\t\t\t\t\t                \techo '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t\t                }\r\n\t\t\t\t                } else {\r\n\t\t\t\t                \tif($divisionData['store'][0][1] == $userInfo->getDivisionId()){\r\n\t\t\t\t                \t\techo '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t                \t} else {\r\n\t\t\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t                \t\t\tif($divisiton[1] != $userInfo->getDivisionId()){ continue; }\r\n\t\t\t\t\t\t\t\t            echo '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t\t\t                }\r\n\t\t\t\t                \t}\r\n\t\t\t\t                }?>\r\n\t\t\t            <\/select>\r\n\t\t\t        <\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin-bottom\" >\r\n\t\t    \t\t<div class=\"\" uk-margin>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-default \" onclick=\"sanshouClick()\">商品マスタを開く<\/button>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-default\" type=\"submit\" onclick=\"window.print();return false;\">印刷プレビュー<\/button>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-primary\" onclick=\"sendInventory()\">棚卸入力<\/button>\r\n\t\t    \t\t<\/div>\r\n\t\t    \t\t<?php /*\r\n\t\t    \t\t<div class=\"uk-inline uk-width-1-2@m\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\"> \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-default uk-float-right uk-width-1-5 uk-padding-remove\">検索<\/button>\r\n\t\t    \t\t<\/div>\r\n\t\t    \t\t*/?>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t\t    <div uk-sticky=\"sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky\" class=\"uk-padding-top uk-background-muted uk-padding-small\">\r\n\t\t    \t\t<form action='#' method=\"post\" onsubmit=\"barcodeSearch(); return false\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\" name=\"barcode\"> \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-primary uk-float-right uk-width-1-5 uk-padding-remove\" type=\"submit\">検索<\/button>\r\n\t\t\t\t\t<\/form>\t\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t    \t<div class=\"shouhin-table uk-width-expand uk-overflow-auto\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-striped uk-text-nowrap\">\r\n\t\t    \t\t\t<thead>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<th>id<\/th>\r\n\t\t    \t\t\t\t\t<th>メーカー<\/th>\r\n\t\t    \t\t\t\t\t<th>商品名<\/th>\r\n\t\t    \t\t\t\t\t<th>製品コード<\/th>\r\n\t\t    \t\t\t\t\t<th>規格<\/th>\r\n\t\t    \t\t\t\t\t<th>入数<\/th>\r\n\t\t    \t\t\t\t\t<th>棚卸数量<\/th>\r\n\t\t    \t\t\t\t\t<th>価格<\/th>\r\n\t\t    \t\t\t\t\t<th>JANコード<\/th>\r\n\t\t    \t\t\t\t\t<th>卸業者<\/th>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/thead>\r\n\t\t    \t\t\t<tbody>\r\n\t\t    \t\t\t<\/tbody>\r\n\t\t    \t\t\t<tfoot>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/tfoot>\r\n\t\t    \t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39917",
   "name": "InventoryControlTable",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 在庫管理表<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\t\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print uk-margin-top\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>在庫管理表<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin\">在庫管理表<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search12:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t\r\n\t<div id=\"modal-label\" uk-modal>\r\n\t    <div class=\"uk-modal-dialog\">\r\n\t        <button class=\"uk-modal-close-default\" type=\"button\" uk-close><\/button>\r\n\t        <div class=\"uk-modal-header\">\r\n\t            <h2 class=\"uk-modal-title\">払出ラベル発行<\/h2>\r\n\t        <\/div>\r\n\t\t\t<form action=\"%url/rel:mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"uk-form-horizontal\" name=\"createLabelForm\">\r\n\t\t        <div class=\"uk-modal-body\">\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">卸業者名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-distributorName\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\">払出元部署<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls sourceDivision\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">部署名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-divisionName\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">部署棚名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-divisionRackNumber\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">部署別定数<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-constantByDiv\"><\/span><span class=\"modal-quantityUnit\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\">入数指定<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" step=\"1\" value=\"\" min=\"0\" name=\"quantity\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t            <div class=\"uk-margin\">\r\n\t\t\t\t        <label class=\"uk-form-label\">個数（印刷枚数）<\/label>\r\n\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t\t            <input class=\"uk-input\" type=\"number\" step=\"1\" value=\"\" min=\"0\" name=\"printCount\">\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">JANコード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-itemJANCode\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">メーカー名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-makerName\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t\t<hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">カタログNo<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-catalogNo\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">商品名<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-itemName\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">製品コード<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-itemCode\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <hr>\r\n\t\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t\t        <div class=\"uk-form-label\">規格<\/div>\r\n\t\t\t\t        <div class=\"uk-form-controls uk-form-controls-text\">\r\n\t\t\t\t        \t<span class=\"modal-itemStandard\"><\/span>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t        <\/div>\r\n\t\t        <div class=\"uk-modal-footer uk-text-right\">\r\n\t\t            <button class=\"uk-button uk-button-default uk-modal-close\" type=\"button\">閉じる<\/button>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"ラベル発行\" onclick=\"return createLabel()\">\r\n\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t\t\t\t<input type=\"hidden\" value=\"\" name=\"inHospitalItemId\">\r\n\t\t\t\t\t<input type=\"hidden\" value=\"payout\" name=\"pattern\">\r\n\t\t        <\/div>\r\n\t        <\/form>\r\n\t    <\/div>\r\n   <script>\r\n\tconst divisitonData = <?php echo json_encode($divisionData); ?>;\r\n\t$(function(){\r\n\t\t$('p.stock_barcode').each(function(i, o){\r\n\t\t\tlet num = $(o).text();\r\n\t\t\t$(o).html(\"<svg id='barcode_\"+i+\"'><\/svg>\");\r\n\t\t\tgenerateBarcode(\"barcode_\"+i,num);\r\n\t\t});\r\n\t\tmakeDivitionSelect();\r\n\t\tmakeCreateLabelDivitionSelect();\r\n\t})\r\n\t\r\n\tfunction makeCreateLabelDivitionSelect(){\r\n\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t    html = document.createElement(\"div\");\r\n\t    select = document.createElement(\"select\");\r\n\t    select.className = 'uk-select';\r\n\t    select.name = 'sourceDivision';\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = '';\r\n\t    option.text = ' ----- 部署を選択してください -----';\r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = divisitonData['store'][0][1];\r\n\t    option.text = divisitonData['store'][0][3];\r\n\t    \r\n\t    \r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t\tObject.keys(divisitonData['division']).forEach(function (key) {\r\n\t\t    \r\n\t\t    option = document.createElement(\"option\");\r\n\t\t    option.value = divisitonData['division'][key][1];\r\n\t\t    option.text = divisitonData['division'][key][3];\r\n\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t    \r\n\t\t\tselect.appendChild(option);\r\n\t\t});\r\n\t\r\n\t\thtml.appendChild(select);\r\n\t\t\r\n\t\t$('div.sourceDivision').append(html);\r\n\t}\r\n\r\n\tfunction makeDivitionSelect(){\r\n   \t\tlet selectval = $('#divisionName').val();\r\n\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t    html = document.createElement(\"div\");\r\n\t    select = document.createElement(\"select\");\r\n\t    select.className = 'uk-select';\r\n\t    select.onchange  = function () {  \r\n\t    \tonchangeSelect(this.value);\r\n\t    };\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = '';\r\n\t    option.text = ' ----- 部署を選択してください -----';\r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = divisitonData['store'][0][3];\r\n\t    option.text = divisitonData['store'][0][3];\r\n\t    \r\n\t    if(divisitonData['store'][0][3] == selectval){\r\n\t    \toption.selected = 'selected';\r\n\t    }\r\n\t    \r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t\tObject.keys(divisitonData['division']).forEach(function (key) {\r\n\t\t    \r\n\t\t    option = document.createElement(\"option\");\r\n\t\t    option.value = divisitonData['division'][key][3];\r\n\t\t    option.text = divisitonData['division'][key][3];\r\n\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t    \r\n\t\t    if(divisitonData['division'][key][3] == selectval){\r\n\t\t    \toption.selected = 'selected';\r\n\t\t    }\r\n\t\t\tselect.appendChild(option);\r\n\t\t});\r\n\t\r\n\t\thtml.appendChild(select);\r\n\t\t\r\n\t\t$('#divisionNameDiv').append(html);\r\n\t}\r\n   \r\n\tfunction onchangeSelect(val){\r\n\t\t$('#divisionName').val(val);\r\n\t}\r\n\r\n\tlet itemsToJs = {};\r\n\r\n\tfunction createModalOpen(elm,inHospitalItemId){\r\n\t\tlet Tr = $(elm.parentNode.parentNode);\r\n\t\tlet objectForLabel = JSON.parse($('.json',Tr).text().replace(/\\r?\\n/g, '').trim());\r\n\t\titemsToJs = objectForLabel;\r\n\t\t\r\n\t\t$('input[name=\"printCount\"]').removeClass('uk-form-danger');\r\n\t\t$('input[name=\"quantity\"]').removeClass('uk-form-danger');\r\n\r\n\t\t$('input[name=\"inHospitalItemId\"]').val(inHospitalItemId);\r\n\r\n\t\t$('span.modal-distributorName').text(itemsToJs[inHospitalItemId].distributorName);\r\n\t\t$('span.modal-divisionName').text(itemsToJs[inHospitalItemId].divisionName);\r\n\t\t$('span.modal-divisionRackNumber').text(itemsToJs[inHospitalItemId].rackName);\r\n\r\n\t\t$('input[name=\"quantity\"]').val(itemsToJs[inHospitalItemId].quantity);\r\n\t\t$('input[name=\"printCount\"]').val(1);\r\n\t\t\r\n\t\t$('span.modal-constantByDiv').text(itemsToJs[inHospitalItemId].constantByDiv);\r\n\t\t$('span.modal-quantityUnit').text(itemsToJs[inHospitalItemId].unit);\r\n\t\t\r\n\t\t$('span.modal-itemJANCode').text(itemsToJs[inHospitalItemId].jan);\r\n\t\t$('span.modal-makerName').text(itemsToJs[inHospitalItemId].maker);\r\n\t\t$('span.modal-itemName').text(itemsToJs[inHospitalItemId].itemName);\r\n\t\t$('span.modal-itemCode').text(itemsToJs[inHospitalItemId].code);\r\n\t\t$('span.modal-itemStandard').text(itemsToJs[inHospitalItemId].itemStandard);\r\n\t\t$('span.modal-catalogNo').text(itemsToJs[inHospitalItemId].catalogNo);\r\n\t\t\r\n\t\tUIkit.modal($('#modal-label')).show();\r\n\t}\r\n\r\n\tfunction createLabel(){\r\n\t\tif(!setVal()){\r\n\t\t\tUIkit.modal.alert('入力値に不正があります。<br>ご確認ください').then(function () {\r\n\t\t\t\tUIkit.modal($('#modal-label')).show();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet inHospitalItemId = $('input[name=\"inHospitalItemId\"]').val();\r\n\t\titemsToJs[inHospitalItemId].printCount = $('input[name=\"printCount\"]').val();\r\n\t\titemsToJs[inHospitalItemId].quantity = $('input[name=\"quantity\"]').val();\r\n\t\t\r\n\t\t$(\"#itemsData\").val(JSON.stringify( objectValueToURIencode(itemsToJs) ));\r\n\r\n\t\tsourceDivision = $('select[name=\"sourceDivision\"]').val();\r\n\t\tflag = true;\r\n\t\tif(sourceDivision == ''){\r\n\t\t\tUIkit.modal.confirm(\"払出元部署が選択されていません。<br>元部署印字なしで出力しますか\").then(function () {\r\n\t\t\t\tdocument.createLabelForm.submit();\r\n\t\t\t\tflag = true;\r\n\t\t\t},function(){\r\n\t\t\t\tUIkit.modal($('#modal-label')).show();\r\n\t\t\t\tflag = false;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdocument.createLabelForm.submit();\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n\t\r\n\tfunction setVal(){\r\n\t\t$('input[name=\"printCount\"]').removeClass('uk-form-danger');\r\n\t\t$('input[name=\"quantity\"]').removeClass('uk-form-danger');\r\n\t\t\r\n\t\tlet flg = true;\r\n\t\tif($('input[name=\"printCount\"]').val() == '' || $('input[name=\"printCount\"]').val() < 1 ){\r\n\t\t\t$('input[name=\"printCount\"]').addClass('uk-form-danger');\r\n\t\t\tflg = false;\r\n\t\t}\r\n\t\tif($('input[name=\"quantity\"]').val() == '' || $('input[name=\"quantity\"]').val() < 1 ){\r\n\t\t\t$('input[name=\"quantity\"]').addClass('uk-form-danger');\r\n\t\t\tflg = false;\r\n\t\t}\r\n\t\treturn flg;\r\n\t}\r\n   <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39918",
   "name": "InventoryHistoryList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 棚卸履歴一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>棚卸履歴一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">棚卸履歴一覧<\/h2>\r\n\t\t    \t<hr>\r\n\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t    \t<h3>実施中の棚卸<\/h3>\r\n\t\t\t    \t<hr>\r\n                    <div>\r\n\t\t\t    \t\t%sf:usr:inInventory:table%\r\n\t\t\t    \t<\/div>\r\n\t\t\t\r\n\t\t\t\r\n                    <h3>棚卸終了履歴<\/h3>\r\n\t\t\t    \t<hr>\r\n                    <div>\r\n\t\t\t    \t\t%sf:usr:inventoryComp:table%\r\n\t\t\t    \t<\/div>\r\n                <\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39919",
   "name": "InventoryInformationByDivision",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemPayout.php\";\r\ninclude_once \"NewJoyPla/api/RegInventoryEndHistory.php\";\r\n\r\n$session   = $SPIRAL->getSession();\r\n$session->put(\"cardUrl\", $_SERVER[\"REQUEST_URI\"]);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n\r\n$card = $cardInfo->select(\"NJ_InventoryEDB\",$SPIRAL->getCardId(),\"inventoryEndId\",\"invEndAuthKey\",\"inventoryStatus\");\r\n/*\r\n$getItemPayout = new App\\Api\\GetItemPayout($spiralDataBase,$userInfo);\r\n$payoutData = $getItemPayout->getItemPayout($card[\"data\"][0][0]);\r\n\r\n$payoutData = $spiralDataBase->arrayToNameArray($payoutData[\"data\"],array(\"registrationTime\",\"payoutHistoryId\",\"price\",\"itemId\",\"itemName\",\"itemCode\",\"itemStandard\",\"itemJANCode\",\"quantityUnit\",\"payoutQuantity\",\"payoutAmount\",\"deadlineMinimum\",\"deadlineMax\",\"itemUnit\",\"quantity\",\"makerName\"));\r\n\r\nforeach($payoutData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"payoutQuantity\"=> $record[\"payoutQuantity\"]\r\n\t\t);\r\n}\r\n*/\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][1], \"JoyPla\");\r\n$class = \"uk-label-warning\" ;\r\n$disabled = \"\";\r\nif($card[\"data\"][0][2] == 2){\r\n\t$class = \"uk-label-success\";\r\n\t$disabled = \"disabled\";\r\n\t$linkDisp = \"uk-hidden\";\r\n} else {\r\n\r\n\t$regInventoryEndHistory = new App\\Api\\RegInventoryEndHistory($spiralDataBase,$userInfo);\r\n\t$result = $regInventoryEndHistory->updateHistory($card[\"data\"][0][0]);\r\n\t\r\n\tif(!$result){\r\n\t\techo json_encode(array(\"result\"=>$result));\r\n\t\texit;\r\n\t}\r\n\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 棚卸伝票<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\"><span>棚卸履歴一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>棚卸結果報告<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<?php if($card[\"data\"][0][2] != 2 && $userInfo->getUserPermission() == \"1\"): ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"棚卸情報削除\" onclick=\"inventoryDelete();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"棚卸終了\" onclick=\"inventoryFinish();return false;\">\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div class=\"no_print\">\r\n\t\t\t\t\t<span class=\"uk-label uk-padding-small <?php echo $class ?> uk-padding-remove-vertical uk-text-large\">%val:usr:inventoryStatus%<\/span>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-left uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">棚卸結果報告<\/p>\r\n\t\t    \t<hr>\r\n\t\t    \t<\/div>\r\n\t\t\t    <div class=\"uk-margin <?php echo $linkDisp ?> uk-hidden\">\r\n\t\t\t    \t<a href=\"#\">計算上在庫が存在する商品を確認する<\/a>\r\n\t\t        <\/div>\r\n\t\t    \t\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">棚卸終了日時<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:inventoryTime%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">品目数<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:itemsNumber%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n%sf:usr:search13:mstfilter:table%\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\tlet canAjax = true;\r\n\t<?php \r\n\tif($card[\"data\"][0][2] == 2){\r\n\t\techo \"$('th.no_fix,td.no_fix').remove();\";\r\n\t} else {\r\n\t\techo \"$('th.fix,td.fix').remove();\";\r\n\t}\r\n\t?>\r\n\t\t//let itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\tfunction inventoryDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"伝票を取消します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\t\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:\"%url/card:page_267247%\",\r\n\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tinventoryEndId : \"%val:usr:inventoryEndId%\",\r\n\t\t\t\t\t\tauthKey : \"<?php echo $authKeyCrypt ?>\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"取消しました\").then(function(){\r\n\t\t\t\t\t\tlocation.href =\"%url/table:back%&table_cache=true\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\tUIkit.modal.alert(\"取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction inventoryFinish(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tloading();\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:\"%url/card:page_267244%\",\r\n                type:\"POST\",\r\n                data:{\r\n                \tinventoryEndHistoryId : \"%val:usr:inventoryEndId%\",\r\n                \tinventoryEAuthkey : \"<?php echo $authKeyCrypt ?>\",\r\n                },\r\n                dataType: \"json\"\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"棚卸終了に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"棚卸を終了しました\").then(function(){\r\n\t\t\t\t\tlocation.href =\"%url/table:back%&table_cache=true\";\r\n\t\t\t\t});\r\n\t\t\t\t\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n            \t\r\n        \t\tUIkit.modal.alert(\"棚卸終了に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n        \t\treturn false;\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n            \tloading_remove();\r\n            });\r\n\t\t}\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39920",
   "name": "InventorySlipDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/RegInventoryHistory.php\";\r\ninclude_once \"NewJoyPla/api/RegInventoryEndHistory.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n\r\n\r\n$session = $SPIRAL->getSession();\r\n$cardUrl = $session->get(\"cardUrl\");\r\n\r\n$card = $cardInfo->select(\"inventoryByDiv\",$SPIRAL->getCardId(),\"inventoryHId\",\"inventoryEndId\",\"invHAuthKey\",\"divisionId\");\r\n\r\n$InventoryHistoryId = $card[\"data\"][0][0];\r\n$inventoryEndHistoryId = $card[\"data\"][0][1];\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][2], \"JoyPla\");\r\n\r\n$regInventoryHistory = new App\\Api\\RegInventoryHistory($spiralDataBase,$userInfo);\r\n\r\n$result = $regInventoryHistory->updateHistory($InventoryHistoryId);\r\n\r\nif(!$result){\r\n\techo json_encode(array(\"result\"=>$result));\r\n\texit;\r\n}\r\n\r\n$regInventoryEndHistory = new App\\Api\\RegInventoryEndHistory($spiralDataBase,$userInfo);\r\n$result = $regInventoryEndHistory->updateHistory($inventoryEndHistoryId);\r\n\r\n\r\nif(!$result){\r\n\techo json_encode(array(\"result\"=>$result));\r\n\texit;\r\n}\r\n\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 棚卸伝票<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n        <script>\r\n\t\tlet canAjax = true;\r\n\t\t<?php if($userInfo->getUserPermission() == \"1\" || $userInfo->getDivisionId() == $card[\"data\"][0][3]): ?>\r\n\t\tfunction deleteInvForDiv(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"伝票を取消します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:\"%url/card:page_267254%\",\r\n\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\tinventoryHId : \"%val:usr:inventoryHId%\",\r\n\t\t\t\t\t\tauthKey : \"<?php echo $authKeyCrypt ?>\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"取消しました\").then(function(){\r\n\t\t\t\t\t\tlocation.href =\"<?php echo $cardUrl ?>\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tUIkit.modal.alert(\"取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t<?php endif ?>\r\n\t\t\r\n\t\t<\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/rel:mpgt:page_263631%&table_cache=true\"><span>棚卸履歴一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $cardUrl ?>\"><span>棚卸結果報告<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>%val:usr:divisionName% 棚卸結果報告<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t\r\n\t\t\t    \t<?php if($userInfo->getUserPermission() == \"1\" || $userInfo->getDivisionId() == $card[\"data\"][0][3]): ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"%val:usr:divisionName% 棚卸取消\" onclick=\"deleteInvForDiv();return false;\">\r\n\t\t\t    \t<?php endif ?>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-left uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">%val:usr:divisionName% 棚卸結果報告<\/p>\r\n\t\t    \t<hr>\r\n\t\t    \t<\/div>\r\n\t\t        \r\n\t\t\t    <div class=\"uk-margin\">\r\n\t\t\t    \t<!-- <a href=\"#\">計算上在庫が存在する商品を確認する<\/a> -->\r\n\t\t        <\/div>\r\n\t\t    \t\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">棚卸登録日時<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:registrationTime%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">部署名<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:divisionName%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">品目数<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:itemsNumber%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t\t    <div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t\t    <?php if($userInfo->getUserPermission() == \"1\" || $userInfo->getDivisionId() == $card[\"data\"][0][3]): ?>\r\n\t\t\t    　　%sf:usr:search15:mstfilter:table%\r\n        \t\t<?php else: ?>\r\n                    %sf:usr:search17:mstfilter:table%\r\n\t        \t<?php endif ?>\r\n\t\t        <\/div>\r\n\t\t    \t\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39921",
   "name": "LotManagement",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla ロット管理<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>ロット管理<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">ロット管理<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search76:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t$(function(){\r\n\t\t\tlet nowDate = new Date(<?php echo date(\"Y\") ?>,  <?php echo date(\"m\") ?> - 1, <?php echo date(\"d\") ?>, \"00\", \"00\", \"00\");\r\n\t\t\tlet checkDate = new Date(<?php echo date(\"Y\",strtotime(\"+2 week\")) ?>,  <?php echo date(\"m\",strtotime(\"+2 week\")) ?> - 1, <?php echo date(\"d\",strtotime(\"+2 week\")) ?>, \"00\", \"00\", \"00\");\r\n\t\t\t\r\n\t\t\tfor(let i = 0; i < $(\"#tablearea .lotDate\").length ; i++){\r\n\t\t\t\tstr = $(\"#tablearea .lotDate\")[i].innerText;\r\n\t\t\t\tif(str == \"\"){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tresult = str.split(\"年\");\r\n\t\t\t\tresult2 = result[1].split(\"月\");\r\n\t\t\t\tresult3 = result2[1].split(\"日\");\r\n\t\t\t\t\r\n\t\t\t\tY = result[0];\r\n\t\t\t\tm = result2[0];\r\n\t\t\t\td =result3[0];\r\n\t\t\t\t\r\n\t\t\t\tlotDate = new Date(Y,  parseInt(m) - 1, d, \"00\", \"00\", \"00\");\r\n\t\t\t\tif(nowDate.getTime() <= lotDate.getTime() && checkDate.getTime() >= lotDate.getTime()){\r\n\t\t\t\t\t$(\"#tablearea .lotDate\")[i].classList.add( \"uk-text-warning\" );\r\n\t\t\t\t\t$(\"#tablearea .lotDate\")[i].classList.add( \"uk-text-bold\" );\r\n\t\t\t\t}\r\n\t\t\t\tif(nowDate.getTime() > lotDate.getTime()){\r\n\t\t\t\t\t$(\"#tablearea .lotDate\")[i].classList.add( \"uk-text-danger\" );\r\n\t\t\t\t\t$(\"#tablearea .lotDate\")[i].classList.add( \"uk-text-bold\" );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39922",
   "name": "Option",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<!DOCTYPE html>\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once 'NewJoyPla/api/GetTenantData.php';\r\n\r\n\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select();\r\n\r\n?>\r\n<html>\r\n  <head>\r\n    <title>JoyPla オプション情報<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>オプション情報<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t    \t<div class='uk-width-1-1' uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>オプション情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t    \t\t<p class=\"uk-text-warning\">オプションの変更はお問合せよりご連絡ください。<\/p>\r\n\t\t    \t<div class='uk-width-4-5@m uk-margin-auto uk-margin-remove-top' >\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>テナント種別<\/th>\r\n\t\t\t\t\t            <td><?php echo ($tenantData['data'][0]['tenantKind'] == '1')? \"シングルテナント\" : \"マルチテナント\" ;?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>入庫先設定<\/th>\r\n\t\t\t\t\t            <td><?php echo ($hospitalData['data'][0]['receivingTarget'] == '1')? \"大倉庫\" : \"発注部署\" ;?><\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>登録可能ユーザー数<\/th>\r\n\t\t\t\t\t            <td><?php echo $hospitalData['data'][0]['registerableNum'] ?> 人まで<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39923",
   "name": "OrderAdjustment",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/api/GetUnordered.php';\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n\r\n$getUnordered = new App\\Api\\GetUnordered($spiralDataBase,$userInfo);\r\n\r\n$getUnorderedData = $getUnordered->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注調整<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<?php\r\n\t\t    \tif($getUnorderedData['count'] > 0):\r\n\t\t    \t?>\t\r\n\t\t    \t<script>\r\n\t\t    \t\t$(function(){\r\n\t\t    \t\t\tUIkit.modal.alert('未発注伝票があります。<br>未発注伝票一覧へ移動します。').then(function(){\r\n\t\t\t\t\t\t\tlocation.href=\"%url/rel:mpgt:unorderedList%\";\r\n\t\t\t\t\t\t});\r\n\t\t    \t\t});\r\n\t\t    \t<\/script>\r\n\t\t    \t\r\n\t\t    \t<?php\t\r\n\t\t    \telse:\r\n\t\t    \t?>\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print uk-margin-top\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注調整<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"表示内容で未発注伝票を作成\" onclick=\"sendUnorderedSlip();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title\">発注調整<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search75%\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t    \t<?php\t\r\n\t\t    \tendif\r\n\t\t    \t?>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n   <script>\r\n   let canAjax = true;\r\n   const divisitonData = <?php echo json_encode($divisionData); ?>;\r\n   let listObject = {};\r\n   $(function(){\r\n\t  getItemsList();\r\n      makeDivitionSelect();\r\n   })\r\n\r\n\r\n   function makeDivitionSelect(){\r\n   \t\tlet selectval = $('#divisionName').val();\r\n\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t    html = document.createElement(\"div\");\r\n\t    select = document.createElement(\"select\");\r\n\t    select.className = 'uk-select';\r\n\t    select.onchange  = function () {  \r\n\t    \tonchangeSelect(this.value);\r\n\t    };\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = '';\r\n\t    option.text = '----- 部署を選択してください -----';\r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = divisitonData['store'][0][3];\r\n\t    option.text = divisitonData['store'][0][3] + \"(大倉庫)\";\r\n\t    \r\n\t    if(divisitonData['store'][0][3] == selectval){\r\n\t    \toption.selected = 'selected';\r\n\t    }\r\n\t    \r\n\t    //input.step = listObject[object.recordId].irisu;\r\n\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\tselect.appendChild(option);\r\n\t\t\r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = \"\";\r\n\t    option.text = \"---------------------------------------\";\r\n\t    option.disabled = \"disabled\";\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t\tObject.keys(divisitonData['division']).forEach(function (key) {\r\n\t\t    if(divisitonData['division'][key][5] != '1'){\r\n\t\t\t    option = document.createElement(\"option\");\r\n\t\t\t    option.value = divisitonData['division'][key][3];\r\n\t\t\t    option.text = divisitonData['division'][key][3];\r\n\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t    \r\n\t\t\t    if(divisitonData['division'][key][3] == selectval){\r\n\t\t\t    \toption.selected = 'selected';\r\n\t\t\t    }\r\n\t\t\t\tselect.appendChild(option);\r\n\t\t    }\r\n\t\t});\r\n\t\r\n\t\thtml.appendChild(select);\r\n\t\t\r\n\t\t$('#divisionNameDiv').append(html);\r\n   }\r\n   \r\n   function onchangeSelect(val){\r\n   \t$('#divisionName').val(val);\r\n   }\r\n   \r\n   function active(elm,id,totalZaiko,quantity,busyoId,inHospitalItemId){\r\n   \telm.style.backgroundColor = 'rgb(255, 204, 153)';\r\n   \torderQuantity = quantity * elm.value;\r\n   \t$('#orderQuantityPerCarton_'+id).text(orderQuantity);\r\n   \t$('#adjustmentStock_'+id).text(totalZaiko + orderQuantity);\r\n   \tlistObject[busyoId][inHospitalItemId]['countNum'] = orderQuantity;\r\n   }\r\n   \r\n   \r\n    function getItemsList(){\r\n\t\t$('#tablearea td.json').each(function() {\r\n\t\t\tjson = JSON.parse($(this).text().replace(/\\r?\\n/g, '').trim());\r\n\t\t\tif(! listObject[json.divisionId]){\r\n\t\t\t\tlistObject[json.divisionId] = {};\r\n\t\t\t}\r\n\t\t\tlistObject[json.divisionId][json.inHospitalItemId] = json;\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction validateChack(){\r\n\t\tlet flag = false;\r\n\t\tObject.keys(listObject).forEach(function(divkey) {\r\n \r\n\t\t\tObject.keys(listObject[divkey]).forEach(function(key) {\r\n\t \r\n\t\t\t    if(listObject[divkey][key].countNum > 0){\r\n\t\t\t    \tflag = true;\r\n\t\t\t    }\r\n\t\t\t})\r\n\t\t \r\n\t\t})\r\n\t\tif(!flag){\r\n\t\t\tUIkit.modal.alert(\"発注する商品がありません\");\r\n\t\t}\r\n\t\t\r\n\t\treturn flag;\r\n\t}\r\n\r\n\tfunction sendUnorderedSlip(){\r\n\t\tif(!canAjax) { \r\n\t\t\tconsole.log('通信中');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!validateChack()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tloading();\r\n\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t$.ajax({\r\n\t\t\tasync: false,\r\n            url:'%url/rel:mpgt:regUnordereByDiv%',\r\n            type:'POST',\r\n            data:{\r\n            \tordered : JSON.stringify( objectValueToURIencode(listObject) ),\r\n            \tdivisionId : $('select[name=\"busyo\"]').val()\r\n            },\r\n            dataType: 'json'\r\n        })\r\n        // Ajaxリクエストが成功した時発動\r\n        .done( (data) => {\r\n            \r\n            if(! data.result){\r\n        \t\tUIkit.modal.alert(\"未発注伝票の作成に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n        \t\treturn false;\r\n            }\r\n            \r\n            UIkit.modal.alert(\"未発注伝票を作成しました\").then(function(){\r\n\t\t\t\tUIkit.modal.alert(\"未発注伝票一覧へ移動します\").then(function(){\r\n\t\t\t\t\tlocation.href=\"%url/rel:mpgt:unorderedList%\";\r\n\t\t\t\t});\r\n\t\t\t});\r\n        })\r\n        // Ajaxリクエストが失敗した時発動\r\n        .fail( (data) => {\r\n        \tUIkit.modal.alert(\"未発注伝票の作成に失敗しました\").then(function(){\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t});\r\n        })\r\n        // Ajaxリクエストが成功・失敗どちらでも発動\r\n        .always( (data) => {\r\n\t\t\tloading_remove();\r\n        });\r\n\t}\r\n\t\r\n   <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39924",
   "name": "OrderContentForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateRequestStatus.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"NJ_QRequestDB\",$SPIRAL->getCardId(),\"requestId\",\"requestStatus\");\r\n\r\nif($card[\"data\"][0][1] == \"1\"){\r\n\t$updateRequestStatus = new App\\Api\\UpdateRequestStatus($spiralDataBase);\r\n\t$updateRequestStatus->open($card[\"data\"][0][0]);\r\n}\r\n\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 見積依頼詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%\">見積依頼一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>見積依頼詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-2-3@m\">\r\n\t\t    \t\t<article class=\"uk-article\">\r\n\r\n\t\t\t\t\t    <h1 class=\"uk-article-title\">%val:usr:requestTitle%<\/h1>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    <p class=\"uk-article-meta\">\r\n\t\t\t\t\t        ステータス: %val:usr:requestStatus% <br>\r\n                            依頼者 %val:usr:hospitalName% %val:usr:requestUName% <br>\r\n\t\t\t\t\t    \t卸業者：%val:usr:distributorName%\r\n\t\t\t\t\t    <\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"\">\r\n\t\t\t\t\t    \t見積期限：%val:usr:quotePeriod% <br> <br>\r\n\t\t\t\t\t    \t%val:usr:requestDetail:br%\r\n\t\t\t\t\t    \t<\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"uk-grid-small uk-child-width-auto\" uk-grid>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-2\">\r\n\t\t\t\t\t    \t\t%val:usr:registrationTime%\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t        \r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t<\/article>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<p>見積商品一覧<\/p>\r\n\t\t\t\t\t<div>%sf:usr:search93:mstfilter:table%<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<form name=\"reqItemsReg\" action=\"/regist/is\" target=\"_blank\" method=\"POST\">\r\n\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:reqItemsReg%\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"requestId\" value=\"%val:usr:requestId%\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"tenantId\" value=\"%val:usr:tenantId%\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\">\r\n\t\t\t\t<\/form>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39925",
   "name": "OrderHistoryDetailList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/api/GetDistributor.php\";\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$getDistributor = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n\r\n$distributorData = $getDistributor->getDistributor();\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注履歴詳細一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注履歴詳細一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\">\r\n\t\t\t\t  <input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t  <?php //<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"$('#exportButton').click()\">\r\n\t\t\t\t  ?>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">発注履歴詳細一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search77:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n   const distributorData = <?php echo json_encode($distributorData[\"data\"]); ?>;\r\n   $(function(){\r\n      makeDistributorSelect();\r\n   })\r\n\r\n   function makeDistributorSelect(){\r\n   \t\tlet selectval = $(\"#distributorId\").val();\r\n\t\t//html = \"<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">\";\r\n\t    html = document.createElement(\"div\");\r\n\t    select = document.createElement(\"select\");\r\n\t    select.className = \"uk-select\";\r\n\t    select.onchange  = function () {  \r\n\t    \tonchangeSelect(this.value);\r\n\t    };\r\n\t    \r\n\t    option = document.createElement(\"option\");\r\n\t    option.value = \"\";\r\n\t    option.text = \" --- 卸業者を選択してください ---\";\r\n\t\tselect.appendChild(option);\r\n\t    \r\n\t\tObject.keys(distributorData).forEach(function (key) {\r\n\t\t    \r\n\t\t    option = document.createElement(\"option\");\r\n\t\t    option.value = distributorData[key][1];\r\n\t\t    option.text = distributorData[key][0];\r\n\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t    \r\n\t\t    if(distributorData[key][1] == selectval){\r\n\t\t    \toption.selected = \"selected\";\r\n\t\t    }\r\n\t\t\tselect.appendChild(option);\r\n\t\t});\r\n\t\r\n\t\thtml.appendChild(select);\r\n\t\t\r\n\t\t$(\"#distributorIdDiv\").append(html);\r\n   }\r\n   \r\n   function onchangeSelect(val){\r\n   \t$(\"#distributorId\").val(val);\r\n   }\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39926",
   "name": "OrderHistoryDetailListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注履歴詳細一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注履歴詳細一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\">\r\n\t\t\t\t  <input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t  <?php //<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"$('#exportButton').click()\">\r\n\t\t\t\t  ?>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">発注履歴詳細一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t\t\t%sf:usr:search85%\r\n\t\t    \t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39927",
   "name": "OrderMR",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/OrderMonthlyReport.php';\r\ninclude_once 'NewJoyPla/api/GetDistributor.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$orderMonthlyReport = new App\\Api\\OrderMonthlyReport($spiralDataBase,$userInfo);\r\n\r\n\r\n$startMonth = date('Y-m-01');\r\n$endMonth = '';\r\n$distributorId = '';\r\n$divisionId = '';\r\n$page = 1;\r\n$limit = 100;\r\n$itemName = '';\r\n$itemCode = '';\r\n$itemStandard = '';\r\n\r\nif(isset($_POST['startMonth'])){\r\n\t$startMonth = App\\Lib\\html($_POST['startMonth']);\r\n}\r\n\r\nif(isset($_POST['endMonth'])){\r\n\t$endMonth = App\\Lib\\html($_POST['endMonth']);\r\n}\r\n\r\nif(isset($_POST['distributorId'])){\r\n\t$distributorId = App\\Lib\\html($_POST['distributorId']);\r\n}\r\n\r\nif($userInfo->getUserPermission() == '1'){\r\n\tif(isset($_POST['divisionId'])){\r\n\t\t$divisionId = App\\Lib\\html($_POST['divisionId']);\r\n\t}\r\n} else {\r\n\t$divisionId = $userInfo->getDivisionId();\r\n}\r\n\r\nif(isset($_POST['page'])){\r\n\t$page = App\\Lib\\html($_POST['page']);\r\n}\r\n\r\nif(isset($limit)){\r\n\t$limit = App\\Lib\\html($limit);\r\n}\r\n\r\nif(isset($_POST['itemName'])){\r\n\t$itemName = App\\Lib\\html($_POST['itemName']);\r\n}\r\nif(isset($_POST['itemCode'])){\r\n\t$itemCode = App\\Lib\\html($_POST['itemCode']);\r\n}\r\nif(isset($_POST['itemStandard'])){\r\n\t$itemStandard = App\\Lib\\html($_POST['itemStandard']);\r\n}\r\n\r\n$getDistributor = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n\r\n$distributorData = $getDistributor->getDistributor();\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n$result = $orderMonthlyReport->dataSelect($startMonth,$endMonth,$distributorId,$divisionId,$itemName,$itemCode,$itemStandard,$page,$limit);\r\n\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 月次レポート【注文】<\/title>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>月次レポート【注文】<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"listDl();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">月次レポート【注文】<\/h2>\r\n\t\t    \t<hr>\r\n\t\t\t\t<div class=\"uk-width-1-1 uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-stacked\" name=\"myform\" action=\"%url/rel:mpgt:orderMR%\" method=\"post\" onsubmit=\"return submitCheck()\">\r\n\t\t\t\t\t\t<div class=\"uk-width-3-4@m uk-margin-auto\">\r\n\t\t\t\t\t\t\t<h3>検索<\/h3>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      日付\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-2@m\" uk-grid>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"startMonth\" value=\"<?php echo $startMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">から<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"endMonth\" value=\"<?php echo $endMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">まで<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      卸業者\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"distributorId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($distributorData['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($distributorId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t\t\t$stringDom .= \"<option value=\\\"\". $record[1] .\"\\\" \".$selected.\">\".$record[0].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom;\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"divisionId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tif($divisionData['store']){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $divisionData['store'][0][1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$divisionData['store'][0][1].\"\\\" \". $selected .\">\".$divisionData['store'][0][3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$record[1].\"\\\" \".$selected.\" >\".$record[3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom; \r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\tif($divisionData['store'][0][1] == $divisionId){\r\n\t\t\t\t\t\t\t\t\t\t\techo $divisionData['store'][0][3];\r\n\t\t\t\t\t\t\t\t\t\t} else { \r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t    \t\t\t\tif($record[1] != $divisionId){ continue; } \r\n\t\t\t\t\t\t\t    \t\t\t\techo $record[3] ;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t} ?>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      商品名\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemName\" value=\"<?php echo $itemName?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      製品コード\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemCode\" value=\"<?php echo $itemCode ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      規格\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemStandard\" value=\"<?php echo $itemStandard ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-text-center\">\r\n\t\t\t\t\t\t\t\t<input class=\"uk-margin-top uk-button uk-button-default\" type=\"submit\" value=\"検索\">\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-width-1-2@m uk-width-1-4@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(fixed('<?php echo $result['totalAmount'] ?>'))<\/script> -<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<\/tbody>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\">\r\n\t\t\t\t\t\t\t\t<span class=\"smp-offset-start\"><?php echo ($limit * ($page- 1) + 1 )?><\/span> - <span class=\"smp-offset-end\"><?php echo ($limit * $page> $result['count'])? $result['count'] : $limit * $page?><\/span>件 / <span class=\"smp-count\"><?php echo  $result['count'] ?><\/span>件\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\" uk-grid>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-2-3\">\r\n\t\t\t\t\t\t\t\t\t<select name=\"limit\" class=\" uk-select\">\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"10\" <?php echo ($limit == '10')? 'selected' : '' ?>>10件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"50\" <?php echo ($limit == '50')? 'selected' : '' ?>>50件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"100\" <?php echo ($limit == '100')? 'selected' : '' ?>>100件<\/option><\/select><\/div>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-1-3\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"smp-table-submit-button\" class=\"uk-button uk-button-default\" value=\"表示\">\r\n\t\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-text-nowrap\">\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\">\r\n\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>No<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>卸業者<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>注文数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>合計金額<\/th>\r\n\t\t\t\t\t\t\t\t\t<\/tr>\r\n\t\t\t\t\t\t\t\t<\/thead>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\tif($result['count'] > 0){\r\n\t\t\t\t\t\t\t\t\t\tforeach($result['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['id'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['distributorName'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['makerName'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemName'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemCode'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemStandard'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['price'].\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['orderQuantity'].\" \".$record['itemUnit'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['totalAmount'].\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t<\/tbody>\r\n\t\t\t\t\t\t\t<\/table>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<input name=\"page\" value=\"1\" type=\"hidden\">\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n     <script>\r\n     function submitCheck(){\r\n     \tif($('input[name=\"startMonth\"]').val() == \"\"){\r\n     \t\tUIkit.modal.alert('日付検索の開始日は必須です');\r\n     \t\treturn false;\r\n     \t}\r\n     \treturn true;\r\n     }\r\n     \r\n     function pageSubmit(page){\r\n     \t$('input[name=\"page\"]').val(page);\r\n     \tdocument.myform.submit();\r\n     }\r\n     \r\n\tfunction exportCSV(records) {\r\n\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\r\n\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\tlet link = document.createElement('a');\r\n\t\tlink.download = 'orderMonthlyReport_<?php echo date('Ymd') ?>.tsv';\r\n\t\tlink.href = url;\r\n\t\tdocument.body.appendChild(link);\r\n\t\tlink.click();\r\n\t\tdocument.body.removeChild(link);\r\n\t};\r\n\t\r\n\tfunction listDl(){\r\n\t\tlet records = <?php echo json_encode($result['data']) ?>;\r\n\t\tlet result = [];\r\n\t\tfor(let i = 0 ; i < records.length ; i++){\r\n\t\t\tresult[i] = [];\r\n\t\t\tObject.keys(records[i]).forEach(function (key) {\r\n\t\t\t\tresult[i].push(records[i][key]);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tresult.unshift(['id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','price','orderQuantity','totalAmount','itemUnit','distributorName']);\r\n\t\r\n\t\texportCSV(result);\r\n\t}\r\n     <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39928",
   "name": "OrderSlipDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetOrderItems.php\";\r\ninclude_once \"NewJoyPla/api/GetReceivingItems.php\";\r\ninclude_once \"NewJoyPla/api/UpdateOrder.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"orderStatus\",\"orderAuthKey\",\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][3] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n$getOrderItems = new App\\Api\\GetOrderItems($spiralDataBase);\r\n$orderItems = $getOrderItems->select($card[\"data\"][0][0],\"orderNumber\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\",\"quantityUnit\",\"itemUnit\",\"orderCNumber\",\"inHospitalItemId\",\"dueDate\",\"labelId\",\"receivingNum\");\r\n$orderItems = $spiralDataBase->arrayToNameArray($orderItems[\"data\"],array(\"orderNumber\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\",\"quantityUnit\",\"itemUnit\",\"orderCNumber\",\"inHospitalItemId\",\"dueDate\",\"labelId\",\"receivingNum\"));\r\n\r\n//,\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\"\r\n\r\n$ItemsToJs = array();\r\n$Items = array();\r\n\r\nforeach($orderItems as $record){\r\n\t$Items[] = $record[\"orderCNumber\"];\r\n}\r\n\r\n$getReceivingItems = new App\\Api\\GetReceivingItems($spiralDataBase,$userInfo);\r\n$receivingData = $getReceivingItems->select($Items);\r\n$receivingData = $spiralDataBase->arrayToNameArray($receivingData[\"data\"],array(\"registrationTime\",\"orderCNumber\",\"receivingCount\",\"receivingHId\"));\r\n\r\n\r\nforeach($orderItems as $key => $record){\r\n\t$orderItems[$key][\"receivingNowCount\"] = $record['receivingNum'];\r\n\t$orderItems[$key][\"receivingFlag\"] = false;\r\n\t$orderItems[$key][\"remainingCount\"] = 0;\r\n\t/*\r\n\tforeach($receivingData as $receivingRecord){\r\n\t\tif($record[\"orderCNumber\"] == $receivingRecord[\"orderCNumber\"]){\r\n\t\t\t//$orderItems[$key][\"receivingNowCount\"] += (int)$receivingRecord[\"receivingCount\"];\r\n\t\t}\r\n\t}\r\n\t*/\r\n}\r\n\r\n$num = 1;\r\nforeach($orderItems as $key => $record){\r\n\t$orderItems[$key][\"remainingCount\"] = $record[\"orderQuantity\"] - $record[\"receivingNowCount\"];\r\n\tif($record[\"orderQuantity\"] <= $record[\"receivingNowCount\"]){\r\n\t\t$orderItems[$key][\"receivingFlag\"] = true;\r\n\t}\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"num\" => $num,\r\n\t\t\"orderCNumber\"=> $record[\"orderCNumber\"],\r\n\t\t\"orderQuantity\"=> $record[\"orderQuantity\"],\r\n\t\t\"countNum\"=> $record[\"orderQuantity\"],\r\n\t\t//\"changeReceiving\"=> \"0\",\r\n\t\t\"receivingFlag\"=> $orderItems[$key][\"receivingFlag\"],\r\n\t\t\"receivingNowCount\"=> $orderItems[$key][\"receivingNowCount\"],//入庫完了数\r\n\t\t//\"receivingBeforeCount\"=> $orderItems[$key][\"receivingNowCount\"],//前回までの入庫数\r\n\t\t\"receivingCount\" => 0,//今回入庫\r\n\t\t\"quantity\"=>$orderItems[$key][\"quantity\"],\r\n\t\t\"makerName\"=>$orderItems[$key][\"makerName\"],\r\n\t\t\"itemName\"=>$orderItems[$key][\"itemName\"],\r\n\t\t\"itemStandard\"=>$orderItems[$key][\"itemStandard\"],\r\n\t\t\"itemCode\"=>$orderItems[$key][\"itemCode\"],\r\n\t\t\"quantityUnit\"=>$orderItems[$key][\"quantityUnit\"],\r\n\t\t\"itemJANCode\"=>$orderItems[$key][\"itemJANCode\"],\r\n\t\t\"receivingFlag\"=>$orderItems[$key][\"receivingFlag\"],\r\n\t\t\"lotNum\" => $orderItems[$key][\"receivingNowCount\"],\r\n\t\t\"price\" => $orderItems[$key][\"price\"],\r\n\t\t\"labelId\" => $orderItems[$key][\"labelId\"],\r\n\t\t);\r\n\t$num++;\r\n}\r\n\r\n\r\n$updateOrder = new App\\Api\\UpdateOrder($spiralDataBase);\r\n$result = $updateOrder->update($card[\"data\"][0][0],$card[\"data\"][0][2],$orderItems);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][2], \"JoyPla\");\r\n\r\n//var_dump($ItemsToJs);\r\n//var_dump($receivingData);\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$divisionIdCrypt = $crypt->encrypt($card[\"data\"][0][3], \"JoyPla\");\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266883%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注書<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n        <script>\r\n\t\tlet canAjax = true;\r\n\t\tfunction back(){\r\n\t\t\tif(\"<?php echo $result[\"pattern\"] ?>\" == \"delete\"){\r\n\t\t\t\tUIkit.modal.alert(\"発注商品が0件となりました。<br>発注書一覧へ戻ります。\").then(function(){\r\n\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(\"<?php echo $card[\"data\"][0][1] ?>\" == \"1\"){\r\n\t\t\t\tUIkit.modal.alert(\"未発注書です。<br>発注書一覧へ戻ります。\").then(function(){\r\n\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tback();\r\n\t\t\r\n\t\t<\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>発注書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>発注書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<form action=\"#\" method=\"post\">\r\n\t\t\t\t\t<div class=\"uk-child-width-1-2@m no_print uk-margin\" uk-grid>\r\n\t\t\t\t\t\t<div class=\"uk-text-left\">\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"発注書取消\" onclick=\"orderedDelete();return false;\">\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"納品照合\" onclick=\"deliveryCheck();return false;\">\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div class=\"uk-text-right\">\r\n\t\t\t\t\t\t\t<button type=\"button\" class=\"uk-button uk-button-primary\"  uk-toggle=\"target: #modal-gs1128\">GS1-128で照合<\/button>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">発　　注　　書<\/p>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div uk-grid>\r\n\t\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t    \t\t\t\t\t<td>発注日時<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td>%val:usr:orderTime%<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td>%val:usr:orderNumber%<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/table>\r\n\t\t\t    \t\t\t\t<div id=\"order_barcode\" class=\"uk-text-center\">\r\n\t\t    \t\t\t\t\t\t<span id=\"hacchu_num\">%val:usr:orderNumber%<\/span>\r\n\t\t    \t\t\t\t\t<\/div>\r\n\t\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<\/div>\r\n\t\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t    \t\r\n\t\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:60px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>今回入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>納期<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>金額<\/th>\r\n\t\t    \t\t\t\t\t\t\t\t<th>入庫情報記入<\/th>\r\n\t\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\tforeach($orderItems as $record){\r\n\t\t\t\t\t    \t\t\t\t\t\t$barcodeId = \"01\".$record[\"inHospitalItemId\"].\"X\".$record[\"quantity\"];\r\n\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<tr id='tr_\".$num.\"'>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>￥\".$record[\"price\"].\"<span class='uk-text-small'><\/span> / <span class='uk-text-small'>1\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].\"<span class='uk-text-small'>\".$record[\"quantityUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].\"<span class='uk-text-small'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingNowCount\"].\"<span class='uk-text-remove'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\tif($record[\"receivingFlag\"]){\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td>入庫完了<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t} else {\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td><input type='number' class='uk-input receiving_\".$record[\"inHospitalItemId\"].\"' style='width:82px' min='0' max='\".$record[\"remainingCount\"].\"' value='0' onchange='active(this,\\\"\".$record[\"inHospitalItemId\"].\"\\\")'><span class='uk-text-small uk-text-middle'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"dueDate\"].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>￥<script>price('\".$record[\"orderPrice\"].\"')<\/script><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t//echo \"<td id=\"barcode_\".$num.\"\" class=\"uk-text-center\">\".$barcodeId.\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\tif($record[\"receivingFlag\"]){\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td class='uk-text-center'>入庫済み<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t} else {\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td class='uk-text-center'><button type='button' class='uk-button uk-button-default uk-button-small' onclick='addLotInput(\".$num.\",\\\"\".$record[\"inHospitalItemId\"].\"\\\",null,null)'>入庫情報記入<\/button><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t\t    \t\t\t\r\n\t\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t\t    \t<\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-3-4 uk-margin\">\r\n\t\t\t    \t\t<table class=\"uk-table uk-table-middle uk-table-divider\">\r\n\t\t\t    \t\t\t<thead>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td colspan=\"2\">備考<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/thead>\r\n\t\t\t    \t\t\t<tbody>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-width-1-5\">\r\n\t\t\t    \t\t\t\t\t    %val:usr:divisionName%\t\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-width-4-5\">\r\n\t\t\t    \t\t\t\t\t\t%val:usr:ordercomment:br%\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t    \t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t   \t<\/form>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"print_hidden uk-inline\" id=\"createLabelForm\">\r\n\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t<input type=\"hidden\" value=\"%val:usr:distributorName%\" name=\"distributorName\">\r\n\t<\/form>\r\n\t\r\n\t<!-- This is a button toggling the modal with the default close button -->\r\n\t\t<!-- This is the modal with the default close button -->\r\n\t\t<div id=\"modal-gs1128\" uk-modal>\r\n\t\t    <div class=\"uk-modal-dialog uk-modal-body\">\r\n\t\t    \t<form onsubmit=\"gs1_128($('#GS1-128').val());return false;\" action=\"#\">\r\n\t\t\t        <button class=\"uk-modal-close\" type=\"button\" uk-close><\/button>\r\n\t\t\t        <h2 class=\"uk-modal-title\">GS1-128 読取<\/h2>\r\n\t\t\t        <input type=\"text\" class=\"uk-input\" placeholder=\"GS1-128\" id=\"GS1-128\" autofocus=\"true\">\r\n\t\t\t        <div class=\"uk-margin-top select_items\" style=\"display:none\">\r\n\t\t\t\t        <p>商品特定<\/p>\r\n\t\t\t\t        <select name=\"not_items_info\" class=\"uk-select\">\r\n\t\t\t\t        \t<option value=\"\"> --- 選択してください --- <\/option>\r\n\t\t\t\t\t\t\t<?php\r\n\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t        \tforeach($ItemsToJs as $key => $val){\r\n\t\t\t\t        \t\t$stringDom .= \"<option value='\".$key.\"'>\".$val[\"itemName\"].\"<\/option>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\techo $stringDom;\r\n\t\t\t\t        \t?>\r\n\t\t\t\t        <\/select>\r\n\t\t\t        <\/div>\r\n\t\t\t\t\t<p class=\"uk-text-right\">\r\n\t\t\t            <button class=\"uk-button uk-button-primary\" type=\"button\" onclick=\"gs1_128($('#GS1-128').val());\">反映<\/button>\r\n\t\t\t        <\/p>\r\n\t\t        <\/form>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\r\n    <script>\r\n    \tlet upToData = <?php echo json_encode($ItemsToJs); ?>;\r\n    \t\r\n\t\t\r\n\t\tlet gs1128_object = {};\r\n\t\t$(function(){\r\n\t\t/*\r\n\t\t let count = $(\"#tbl-Items tbody\").children().length;\r\n\t\t let num ;\r\n\t\t for(let i = 1 ; i <= count ; i++){\r\n\t\t \tnum = $(\"#barcode_\" + i).text();\r\n\t\t\t$(\"#barcode_\" + i).html(\"<svg id=\"barcode_area_\"+i+\"\"><\/svg>\");\r\n\t\t\tgenerateBarcode(\"barcode_area_\" + i,num);\r\n\t\t \t//$(\"td#barcode_\" + i +\" div\").barcode(num, \"ean13\",{barWidth: 2 ,barHeight: 40 , output: \"css\"});\r\n\t\t }\r\n\t\t */\r\n\t\t let order_num = $(\"#hacchu_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#order_barcode\").html(\"<svg id='barcode_hacchu'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_hacchu\",order_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t\t\r\n\t\tfunction deliveryCheck(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//$_POST[\"orderHistoryId\"],$_POST[\"divisionId\"],$_POST[\"receiving\"]\r\n\t\t\t\r\n\t\t\tlet flg = true;\r\n\t\t\t\r\n\t\t\tUIkit.modal.confirm(\"入力された値で納品照合を行います。<br>よろしいですか\").then(function () {\r\n\t\t\t\tlet receivingData = {};\r\n\t\t\t\tObject.keys(upToData).forEach(function (key) {\r\n\t\t\t\t\t//if(upToData[key].changeReceiving != \"0\"){\r\n\t\t\t\t\tif(upToData[key].receivingCount != \"0\"){\r\n\t\t\t\t\t\treceivingData[key] = upToData[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(Object.keys(receivingData).length == 0){\r\n\t\t\t\t\tUIkit.modal.alert(\"納品対象がありません。<br>入庫数を入力して下さい\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:\"%url/card:page_267241%\",\r\n\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\torderHistoryId : \"%val:usr:orderNumber%\",\r\n\t\t\t\t\t\tdivisionId : \"%val:usr:divisionId%\",\r\n\t\t\t\t\t\tdistributorId : \"%val:usr:distributorId%\",\r\n\t\t\t\t\t\treceiving : JSON.stringify(receivingData),\r\n\t\t\t\t\t\tlotData : JSON.stringify(makeLotObj()),\r\n\t\t\t\t\t\tdivisionId : \"<?php echo $divisionIdCrypt ?>\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"納品照合に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"納品照合が完了しました\").then(function () {\r\n\t\t\t\t\t\tUIkit.modal.confirm(\"ラベル発行を行いますか\").then(function () {\r\n\t\t\t\t\t\t\tcreateLabel();\r\n\t\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\tUIkit.modal.alert(\"納品照合に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction addLotInput(num,inHospitalItemId,lotval,lotDate){\r\n\t\t\tif(parseInt(upToData[inHospitalItemId][\"orderQuantity\"]) <= parseInt(upToData[inHospitalItemId].lotNum)){\r\n\t\t\t\tUIkit.modal.alert(\"発注数より多くはできません。ご確認ください\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tif($(\"input.receiving_\"+inHospitalItemId)[0].max < (parseInt($(\"input.receiving_\"+inHospitalItemId).val()) + 1)){\r\n\t\t\t\tUIkit.modal.alert(\"発注数より多くはできません。ご確認ください\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tupToData[inHospitalItemId].lotNum = parseInt(upToData[inHospitalItemId].lotNum) + 1;\r\n\t\t\t\r\n\t\t\tlet trElm = document.createElement(\"tr\"); \r\n\t\t\tlet tdElm = document.createElement(\"td\");\r\n\t\t\ttdElm.colSpan = \"4\";\r\n\t\t\ttrElm.appendChild(tdElm); \r\n\t\t\t\r\n\t\t\t\r\n\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\ttdElm.className = \"uk-text-small uk-text-break\";\r\n\t\t\ttdElm.style = \"white-space: break-spaces\";\r\n\t\t\thtml = document.createTextNode(\"ロット番号:※ 分からない場合は無記入\");\r\n\t\t\ttdElm.appendChild(html);\r\n\t\t\ttdElm.colSpan = \"4\";\r\n\t\t\ttdElm.className = \"uk-text-small\";\r\n\t\t\tinput = document.createElement(\"input\");\r\n\t\t\tinput.className = \"uk-input lot_\" +inHospitalItemId;\r\n\t\t\tinput.type = \"text\";\r\n\t\t\tinput.value = lotval;\r\n\t\t\tif(lotval){\r\n    \t\t\tinput.style.backgroundColor = \"rgb(255, 204, 153)\";\r\n\t\t\t}\r\n\t\t\tinput.onchange  = function () {  \r\n\t\t\t    \t$(this).css(\"background-color\",\"rgb(255, 204, 153)\");\r\n\t\t\t    };\r\n\t\t\ttdElm.appendChild(input); \r\n\t\t\ttrElm.appendChild(tdElm); \r\n\t\t\t\r\n\t\t\t\r\n\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\ttdElm.className = \"uk-text-small uk-text-break\";\r\n\t\t\ttdElm.style = \"white-space: break-spaces\";\r\n\t\t\thtml = document.createTextNode(\"使用期限: ※ 分からない場合は無記入\");\r\n\t\t\ttdElm.appendChild(html);\r\n\t\t\ttdElm.colSpan = \"4\";\r\n\t\t\tinput = document.createElement(\"input\");\r\n\t\t\tinput.className = \"uk-input lotDate_\" +inHospitalItemId;\r\n\t\t\tinput.type = \"date\";\r\n\t\t\tinput.value = lotDate;\r\n\t\t\tif(lotDate){\r\n    \t\t\tinput.style.backgroundColor = \"rgb(255, 204, 153)\";\r\n\t\t\t}\r\n\t\t\tinput.onchange  = function () {  \r\n\t\t\t    \t$(this).css(\"background-color\",\"rgb(255, 204, 153)\");\r\n\t\t\t    };\r\n\t\t\t\r\n\t\t\ttdElm.appendChild(input); \r\n\t\t\ttrElm.appendChild(tdElm); \r\n\t\t\t\r\n\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\ttdElm.className = \"uk-text-center\";\r\n\t\t\tinput = document.createElement(\"input\");\r\n\t\t\tinput.className = \"uk-button uk-button-danger uk-button-small\";\r\n\t\t\tinput.type = \"button\";\r\n\t\t\tinput.value = \"削除\";\r\n\t\t\t\r\n\t\t\tinput.onclick  = function () {  \r\n\t\t\t    \t$(this).parent().parent().remove();\r\n\t\t\t\t\tval = $(\"input.receiving_\"+inHospitalItemId).val();\r\n\t\t\t\t\tmin = $(\"input.receiving_\"+inHospitalItemId)[0].min;\r\n\t\t\t\t\t$(\"input.receiving_\"+inHospitalItemId)[0].min = parseInt(min) - 1;\r\n\t\t\t\t\t$(\"input.receiving_\"+inHospitalItemId).val(parseInt(val) - 1);\r\n\t\t\t\t\tupToData[inHospitalItemId].lotNum = parseInt(upToData[inHospitalItemId].lotNum) - 1;\r\n\t\t\t\t\tactive($(\"input.receiving_\"+inHospitalItemId),inHospitalItemId);\r\n\t\t\t    };\r\n\t\t\t\r\n\t\t\ttdElm.appendChild(input); \r\n\t\t\ttrElm.appendChild(tdElm); \r\n\t\t\t\r\n\t\t\t$(\"#tr_\"+num).after(trElm);\r\n\t\t\tmin = $(\"input.receiving_\"+inHospitalItemId)[0].min;\r\n\t\t\t$(\"input.receiving_\"+inHospitalItemId)[0].min = parseInt(min) + 1;\r\n\t\t\tval = $(\"input.receiving_\"+inHospitalItemId).val();\r\n\t\t\t$(\"input.receiving_\"+inHospitalItemId).val(parseInt(val) + 1);\r\n\t\t\t$(\"input.receiving_\"+inHospitalItemId).css(\"background-color\",\"rgb(255, 204, 153)\");\r\n\t\t\tactive($(\"input.receiving_\"+inHospitalItemId)[0],inHospitalItemId);\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction orderedDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif( \"%val:usr:orderStatus:id%\" == \"5\" || \"%val:usr:orderStatus:id%\" == \"6\" ){\r\n\t\t\t\tUIkit.modal.alert(\"すでに入庫済みの情報があります。削除はできません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUIkit.modal.confirm(\"発注書を削除します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:\"%url/card:page_267242%\",\r\n\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\torderNum : \"%val:usr:orderNumber%\",\r\n\t\t\t\t\t\torderData : JSON.stringify( upToData ),\r\n\t\t\t\t\t\torderAuthKey: \"<?php echo $authKeyCrypt ?>\" ,\r\n\t\t\t\t\t\tcountFlg : true,\r\n\t\t\t\t\t\tdivisionId : \"<?php echo $divisionIdCrypt ?>\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"発注書取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"発注書取消が完了しました\").then(function(){\r\n\t\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tUIkit.modal.alert(\"伝票削除に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n    \t\r\n\t\tfunction active(elm,inHospitalItemId){\r\n\t\t\tif(elm.style){\r\n    \t\t\telm.style.backgroundColor = \"rgb(255, 204, 153)\";\r\n\t\t\t}\r\n    \t\t//upToData[inHospitalItemId].changeReceiving = elm.value;\r\n    \t\t//upToData[inHospitalItemId].receivingNowCount = elm.value;\r\n    \t\tupToData[inHospitalItemId].receivingCount = elm.value;\r\n    \r\n    \t}\r\n    \tfunction createLabel(){\r\n    \t\t$(\"#itemsData\").val(JSON.stringify( upToData ));\r\n    \t\t$(\"#createLabelForm\").submit();\r\n\t\t\tlocation.reload();\r\n    \t}\r\n    \t\r\n\r\n    \tfunction gs1_128(gs1128){\r\n    \t\tgs1128_object = {};\r\n\t\t\tif(gs1128.indexOf(\"]C1\") !== 0){\r\n\t\t\t\t//UIkit.modal.alert(\"GS1-128ではありません\");\r\n\t\t\t\t//return ;\r\n\t\t\t\treturn gs1_128(\"]C1\"+gs1128);\r\n\t\t\t} else {\r\n\t\t\t\tgs1128 = gs1128.slice( 3 );\r\n\t\t\t\tlet obj = check_gs1128(gs1128);\r\n\t\t\t\tlet chkflg = false;\r\n\t\t\t\tlet objkey = $(\".select_items select\").val();\r\n\t\t\t\t\r\n\t\t\t\tif( objkey == \"\" && ! obj.hasOwnProperty(\"01\")){\r\n\t\t\t\t\tUIkit.modal.alert(\"商品情報が含まれておりませんでした<br>選択肢からお選びいただき再度、反映をクリックしてください。\").then(function(){\r\n\t\t\t\t\t\t$(\".select_items\").show();\r\n\t\t\t\t\t\tUIkit.modal($('#modal-gs1128')).show();\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(objkey == \"\" ){\r\n\t\t\t\t\tsearchJan = addCheckDigit(obj[\"01\"]);\r\n\t\t\t\t\tObject.keys(upToData).forEach(function (key) {\r\n\t\t\t\t\t  if(searchJan == upToData[key][\"itemJANCode\"]){\r\n\t\t\t\t\t\t  chkflg = true;\r\n\t\t\t\t\t\t  objkey = key;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchkflg = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(!chkflg){\r\n\t\t\t\t\tUIkit.modal.alert(\"対象の発注商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\t\tUIkit.modal($('#modal-gs1128')).show();\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\taddLotInput(upToData[objkey][\"num\"],objkey,obj[\"10\"],changeDate(obj[\"17\"]));\r\n\t\t\t\t$(\".select_items\").hide();\r\n\t\t\t\t$(\".select_items select\").val(\"\");\r\n\t\t\t\t$(\"#GS1-128\").val(\"\");\r\n\t\t\t\tdocument.getElementById(\"GS1-128\").focus()\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction changeDate(text){\r\n\t\t\tif(text == null){\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t\tif(text.length == \"6\"){\r\n\t\t\t\ttext = 20 + text;\r\n\t\t\t}\r\n\t\t\tdate = text.slice(6, 8);\r\n\t\t\tif(parseInt(text.slice(6, 8)) == 0){\r\n\t\t\t\tdate = '01';\r\n\t\t\t}\r\n\t\t\treturn text.slice(0, 4) + \"-\" + text.slice(4, 6) + \"-\" + date;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\t\t\r\n\t\tfunction makeLotObj(){\r\n\t\t\tlotObj = {};\r\n\t\t\tObject.keys(upToData).forEach(function (inHPItemKey) {\r\n\t\t\t\tlotObj[inHPItemKey] = {};\r\n\t\t\t\t$(\".lot_\"+inHPItemKey).each(function(index,elm){\r\n\t\t\t\t\tlotObj[inHPItemKey][index] = {};\r\n\t\t\t\t\tlotObj[inHPItemKey][index][\"lotNumber\"]= elm.value;\r\n\t\t\t\t\tlotObj[inHPItemKey][index][\"inHospitalItemId\"] = inHPItemKey;\r\n\t\t\t\t});\r\n\t\t\t\t$(\".lotDate_\"+inHPItemKey).each(function(index,elm){\r\n\t\t\t\t\tlotObj[inHPItemKey][index][\"lotDate\"] = elm.value;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\treturn lotObj;\r\n\t\t}\r\n    <\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39929",
   "name": "OrderSlipForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetCardInfo.php';\r\ninclude_once 'NewJoyPla/api/GetOrderItems.php';\r\ninclude_once 'NewJoyPla/api/GetReceivingItems.php';\r\ninclude_once 'NewJoyPla/api/UpdateOrder.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select('orderdataDB',$SPIRAL->getCardId(),'orderNumber','orderStatus','orderAuthKey');\r\n\r\n$getOrderItems = new App\\Api\\GetOrderItems($spiralDataBase);\r\n$orderItems = $getOrderItems->select($card[\"data\"][0][0],'orderNumber','makerName','itemName','itemCode','itemStandard','price','quantity','orderQuantity','orderPrice','itemJANCode','quantityUnit','itemUnit','orderCNumber','inHospitalItemId','dueDate');\r\n$orderItems = $spiralDataBase->arrayToNameArray($orderItems[\"data\"],array('orderNumber','makerName','itemName','itemCode','itemStandard','price','quantity','orderQuantity','orderPrice','itemJANCode','quantityUnit','itemUnit','orderCNumber','inHospitalItemId','dueDate'));\r\n\r\n//,'makerName','itemName','itemCode','itemStandard','price','quantity','orderQuantity','orderPrice','itemJANCode'\r\n\r\n$ItemsToJs = array();\r\n$Items = array();\r\n\r\nforeach($orderItems as $record){\r\n\t$Items[] = $record['orderCNumber'];\r\n}\r\n\r\n$getReceivingItems = new App\\Api\\GetReceivingItems($spiralDataBase,$userInfo);\r\n$receivingData = $getReceivingItems->select($Items);\r\n$receivingData = $spiralDataBase->arrayToNameArray($receivingData[\"data\"],array('registrationTime','orderCNumber','receivingCount','receivingHId'));\r\n\r\n\r\nforeach($orderItems as $key => $record){\r\n\t$orderItems[$key]['receivingNowCount'] = 0;\r\n\t$orderItems[$key]['receivingFlag'] = false;\r\n\t$orderItems[$key]['remainingCount'] = 0;\r\n\tforeach($receivingData as $receivingRecord){\r\n\t\tif($record['orderCNumber'] == $receivingRecord['orderCNumber']){\r\n\t\t\t$orderItems[$key]['receivingNowCount'] += (int)$receivingRecord['receivingCount'];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$num = 1;\r\nforeach($orderItems as $key => $record){\r\n\t$orderItems[$key]['remainingCount'] = $record['orderQuantity'] - $record['receivingNowCount'];\r\n\tif($record['orderQuantity'] <= $record['receivingNowCount']){\r\n\t\t$orderItems[$key]['receivingFlag'] = true;\r\n\t}\r\n\t$ItemsToJs[$record['inHospitalItemId']] = array(\r\n\t\t'num' => $num,\r\n\t\t'orderCNumber'=> $record['orderCNumber'],\r\n\t\t'orderQuantity'=> $record['orderQuantity'],\r\n        'countNum'=> $record['orderQuantity'],\r\n    \t//'changeReceiving'=> '0',\r\n        'receivingFlag'=> $orderItems[$key]['receivingFlag'],\r\n        'receivingNowCount'=> $orderItems[$key]['receivingNowCount'],\r\n        //'receivingBeforeCount'=> $orderItems[$key]['receivingNowCount'],\r\n        'receivingCount' => 0,\r\n        'quantity'=>$orderItems[$key]['quantity'],\r\n        'makerName'=>$orderItems[$key]['makerName'],\r\n        'itemName'=>$orderItems[$key]['itemName'],\r\n        'itemStandard'=>$orderItems[$key]['itemStandard'],\r\n        'itemCode'=>$orderItems[$key]['itemCode'],\r\n        'quantityUnit'=>$orderItems[$key]['quantityUnit'],\r\n        'itemJANCode'=>$orderItems[$key]['itemJANCode'],\r\n        'receivingFlag'=>$orderItems[$key]['receivingFlag'],\r\n        'lotNum' => $orderItems[$key]['receivingNowCount'],\r\n        'price' => $orderItems[$key]['price'],\r\n        'dueDate' => $orderItems[$key]['dueDate']\r\n\t\t);\r\n\t$num++;\r\n}\r\n\r\n\r\n$updateOrder = new App\\Api\\UpdateOrder($spiralDataBase);\r\n$result = $updateOrder->update($card[\"data\"][0][0],$card['data'][0][2],$orderItems);\r\n\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card['data'][0][2], 'JoyPla');\r\n\r\n//var_dump($ItemsToJs);\r\n//var_dump($receivingData);\r\n$orderFixingButton = \"\";\r\nif($card[\"data\"][0][1] > 4){\r\n\t$orderFixingButton = \"disabled\";\r\n}\r\n\r\n$orderFixingDel = \"\";\r\nif(!($card[\"data\"][0][1] == 3 || $card[\"data\"][0][1] == 4)){\r\n\t$orderFixingDel = \"disabled\";\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注書<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n\r\n        <script>\r\n\t\tlet canAjax = true;\r\n\t\tfunction back(){\r\n\t\t\tif('<?php echo $result[\"pattern\"] ?>' == \"delete\"){\r\n\t\t\t\tUIkit.modal.alert(\"発注商品が0件となりました。<br>発注書一覧へ戻ります。\").then(function(){\r\n\t\t\t\t\tlocation.href =\"%url/table:back%&table_cache=true\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif('<?php echo $card[\"data\"][0][1] ?>' == \"1\"){\r\n\t\t\t\tUIkit.modal.alert(\"未発注書です。<br>発注書一覧へ戻ります。\").then(function(){\r\n\t\t\t\t\tlocation.href =\"%url/table:back%&table_cache=true\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tback();\r\n\t\t\r\n\t\t<\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\"><span>発注書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>発注書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<form action=\"#\" method=\"post\">\r\n\t\t\t\t\t<div class=\"uk-child-width-1-2@m no_print uk-margin\" uk-grid>\r\n\t\t\t\t\t\t<div class=\"uk-text-left\">\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"受注取消\" onclick=\"orderFixingDel();return false;\" <?php echo $orderFixingDel ?>>\r\n\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"受注確定\" onclick=\"orderFixing();return false;\" <?php echo $orderFixingButton ?>>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">発　　注　　書<\/p>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div uk-grid>\r\n\t\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price('%val:usr:totalAmount%')<\/script> - <\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t    \t\t\t\t\t<td>発注日時<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td>%val:usr:orderTime%<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td>%val:usr:orderNumber%<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/table>\r\n\t\t\t    \t\t\t\t<div id=\"order_barcode\" class=\"uk-text-center\">\r\n\t\t    \t\t\t\t\t\t<span id=\"hacchu_num\">%val:usr:orderNumber%<\/span>\r\n\t\t    \t\t\t\t\t<\/div>\r\n\t\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<\/div>\r\n\t\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t    \t\r\n\t\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:60px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>金額<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>納期<\/th>\r\n\t\t\t\t\t\t\t\t\t\t\t<th>ステータス<\/th>\r\n\t\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\tforeach($orderItems as $record){\r\n\t\t\t\t\t    \t\t\t\t\t\t$barcodeId = \"01\".$record['inHospitalItemId'].\"X\".$record['quantity'];\r\n\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<tr id='tr_\".$num.\"'>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>$num<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['makerName'].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['itemName'].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['itemCode'].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['itemStandard'].\"<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>￥\".$record['price'].\"<span class='uk-text-small'><\/span> / <span class='uk-text-small'>1\".$record['itemUnit'].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['quantity'].\"<span class='uk-text-small'>\".$record['quantityUnit'].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['orderQuantity'].\"<span class='uk-text-small'>\".$record['itemUnit'].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record['receivingNowCount'].\"<span class='uk-text-remove'>\".$record['itemUnit'].\"<\/span><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>￥<script>price('\".$record['orderPrice'].\"')<\/script><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td><input type='date' class='uk-input' style='width: 165px' value='\".\\App\\Lib\\changeDateFormat('Y年m月d日' , $record['dueDate'] , 'Y-m-d').\"' min='\".date(\"Y-m-d\").\"' onchange='dueDateChange(\\\"\".$record['inHospitalItemId'].\"\\\",this)'><\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\tif($record['receivingFlag']){\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<td>入庫済み<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t} else if( $record['receivingNowCount'] > 0) {\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td>一部入庫(\".$record['receivingNowCount'].\"/\".$record['orderQuantity'].\")<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t} else {\r\n\t\t\t\t\t    \t\t\t\t\t\t\techo \"<td>未入庫<\/td>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t\t    \t\t\t\r\n\t\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t\t    \t<\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-3-4 uk-margin\">\r\n\t\t\t    \t\t<table class='uk-table uk-table-middle uk-table-divider'>\r\n\t\t\t    \t\t\t<thead>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td colspan=\"2\">備考<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/thead>\r\n\t\t\t    \t\t\t<tbody>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-width-1-5\">\r\n\t\t\t    \t\t\t\t\t    %val:usr:divisionName%\t\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t\t<td class=\"uk-width-4-5\">\r\n\t\t\t    \t\t\t\t\t\t%val:usr:ordercomment:br%\r\n\t\t\t    \t\t\t\t\t<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t    \t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t   \t<\/form>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"print_hidden uk-inline\" id=\"createLabelForm\">\r\n\t\t<input type=\"hidden\" value='' name=\"itemsData\" id=\"itemsData\">\r\n\t\t<input type=\"hidden\" value='%val:usr:distributorName%' name=\"distributorName\">\r\n\t<\/form>\r\n\t\r\n    <script>\r\n    \tlet upToData = <?php echo json_encode($ItemsToJs); ?>;\r\n    \tlet status = \"%val:usr:orderStatus:id%\";\r\n    \t$(function(){\r\n    \t\t\r\n\t\t\t/*\r\n\t\t\t let count = $('#tbl-Items tbody').children().length;\r\n\t\t\t let num ;\r\n\t\t\t for(let i = 1 ; i <= count ; i++){\r\n\t\t\t \tnum = $('#barcode_' + i).text();\r\n\t\t\t\t$('#barcode_' + i).html('<svg id=\"barcode_area_'+i+'\"><\/svg>');\r\n\t\t\t\tgenerateBarcode('barcode_area_' + i,num);\r\n\t\t\t \t//$('td#barcode_' + i +' div').barcode(num, \"ean13\",{barWidth: 2 ,barHeight: 40 , output: 'css'});\r\n\t\t\t }\r\n\t\t\t */\r\n\t\t\t let order_num = $('#hacchu_num').text();\r\n\t\t\t //$('#hacchu_num').remove();\r\n\t\t\t $('#order_barcode').html('<svg id=\"barcode_hacchu\"><\/svg>');\r\n\t\t\t generateBarcode('barcode_hacchu',order_num);\r\n\t\t\t //$('td#order_barcode div').barcode({code:order_num, crc:false }, 'int25',{barWidth: 3 ,barHeight: 40 , output: 'css'});\r\n\t\t\t\r\n    \t});\r\n\t\tlet gs1128_object = {};\r\n\t\tfunction dueDateChange(inHPitemid,elm){\r\n\t\t\tupToData[inHPitemid].dueDate = elm.value;\r\n\t\t\telm.style=\"width: 165px;background-color: rgb(255, 204, 153)\";\r\n\t\t}\r\n\t\t\r\n\t\tfunction orderFixing(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//$_POST['orderHistoryId'],$_POST['divisionId'],$_POST['receiving']\r\n\t\t\tif(status > 3){\r\n\t\t\t\tUIkit.modal.alert(\"すでに受注済みです\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tUIkit.modal.confirm(\"受注を確定します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:'%url/card:page_267209%',\r\n\t\t\t\t\ttype:'POST',\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\torderItems : JSON.stringify(upToData),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: 'json'\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"受注確定に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"受注確定しました\").then(function () {\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tUIkit.modal.alert(\"受注確定に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction orderFixingDel(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//$_POST['orderHistoryId'],$_POST['divisionId'],$_POST['receiving']\r\n\t\t\tUIkit.modal.confirm(\"受注を取消します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:'%url/card:page_162119%',\r\n\t\t\t\t\ttype:'POST',\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\torderHistoryId : \"%val:usr:orderNumber%\",\r\n\t\t\t\t\t\torderAuthKey : \"<?php echo $authKeyCrypt ?>\",\r\n\t\t\t\t\t\torderItems : JSON.stringify(upToData),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: 'json'\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"受注取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"受注取消しました\").then(function(){\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\tUIkit.modal.alert(\"受注取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n    <\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39930",
   "name": "OroshiTop",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<?php\r\n\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetTenantData.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select($hospitalData['data'][0]['tenantId']);\r\n\r\n?>\r\n<html>\r\n  <head>\r\n    <title>JoyPla TOP<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <style>\r\n    \t.nj_card{\r\n    \t\tbackground: #fff;\r\n\t\t    color: #666;\r\n\t\t    box-shadow: 0 5px 15px rgba(0,0,0,.08);\r\n    \t\tposition: relative;\r\n\t\t\theight: 100px;\r\n\t\t\tbox-sizing: border-box;\r\n    \t}\r\n\t\t.nj_card a{\r\n\t\t\tposition: absolute;\r\n\t\t    top: 0;\r\n\t\t    bottom: 0;\r\n\t\t    right: 0;\r\n\t\t    left: 0;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-body .icon {\r\n\t\t    font-size: 45px;\r\n\t\t    position: absolute;\r\n\t\t    top: -8px;\r\n\t\t    right: 0px;\r\n\t\t    color: #fff;\r\n\t\t    display: block;\r\n\t\t    height: 60px;\r\n\t\t    width: 60px;\r\n\t\t    background-repeat: no-repeat;\r\n\t\t    background-position: right bottom;\r\n\t\t}\r\n\r\n\t\t.nj_card .menu-body{\r\n    \t\tcolor: #ffffff;\r\n    \t\ttext-align: left;\r\n\t\t\tposition: absolute;\r\n\t\t\tleft: 12px;\r\n\t\t\tright: 12px;\r\n\t\t\ttop: 16px;\r\n\t\t\tbottom: 16px;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t}\r\n    \t\r\n\t\t.nj_card .menu-body p{\r\n\t\t\tmargin: 0px;\r\n\t\t    line-height: 1;\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 10px;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.nj_card .menu-body .title{\r\n\t\t\tfont-size: 20px;\r\n\t\t\tfont-weight: 600;\r\n\t\t\tcolor : #fff;\r\n\t\t\tfont-family:'メイリオ', 'Meiryo','ＭＳ ゴシック','Hiragino Kaku Gothic ProN','ヒラギノ角ゴ ProN W3',sans-serif;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-body .text{\r\n\t\t\tfont-size: 13px;\r\n\t\t\tcolor : #fff;\r\n\t\t\tfont-family:'メイリオ', 'Meiryo','ＭＳ ゴシック','Hiragino Kaku Gothic ProN','ヒラギノ角ゴ ProN W3',sans-serif;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-foot{\r\n\t\t\tbottom: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tposition: absolute;\r\n\t\t\tpadding: 3px;\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card .menu-foot span{\r\n\t\t\tfont-size: 13px;\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\t\t\r\n\t\t.category-title{\r\n\t\t\tpadding: 8px;\r\n\t\t\tfont-weight: 600;\r\n\t\t}\r\n\t\t\r\n\t\t.content-1{\r\n    \t\tbackground: #87c7d7;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-1 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/1.png);\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-1 .menu-foot{\r\n\t\t\tbackground: #79b3c1;\r\n\t\t\tcolor: #bcd9e0;\r\n\t\t}\r\n\t\t\r\n\t\t.content-1-1{\r\n    \t\tbackground: #5daac1;\r\n    \t}\r\n    \t\r\n\t\t.content-1-1 .menu-foot{\r\n\t\t\tbackground: #5499ad;\r\n\t\t\tcolor: #aaccd6;\r\n\t\t}\r\n    \t/*\r\n\t\t.content-1-1{\r\n    \t\tbackground: #87c7d7;\r\n    \t}\r\n    \t\r\n\t\t.content-1-1 .menu-foot{\r\n\t\t\tbackground: #79b3c1;\r\n\t\t\tcolor: #bcd9e0;\r\n\t\t}\r\n    \t*/\r\n\t\t.content-1-2{\r\n    \t\tbackground: #5daac1;\r\n    \t}\r\n    \t.content-1-2 .menu-foot{\r\n    \t\tbackground: #5499ad;\r\n    \t\tcolor: #aaccd6;\r\n    \t}\r\n    \t.content-1-2-sp{\r\n    \t\tbackground: #d7392c;\r\n    \t}\r\n    \t.content-1-2-sp .menu-foot{\r\n    \t\tbackground: #ad2525;\r\n    \t\tcolor: #ffffff;\r\n    \t}\r\n\t\t\r\n\t\t.content-2{\r\n    \t\tbackground: #52adb3;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-2 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/2.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-2 .menu-foot{\r\n\t\t\tbackground: #4a9ba1;\r\n\t\t\tcolor: #9bc8cb;\r\n\t\t}\r\n\t\t\r\n\t\t.content-2-1{\r\n    \t\tbackground: #52adb3;\r\n    \t}\r\n    \t\r\n\t\t.content-2-1 .menu-foot{\r\n\t\t\tbackground: #4a9ba1;\r\n\t\t\tcolor: #9bc8cb;\r\n\t\t}\r\n\t\t\r\n\t\t.content-3{\r\n\t\t\tbackground: #ea87af;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-3 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/3.png);\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-3 .menu-foot{\r\n\t\t\tbackground: #d2799d;\r\n\t\t\tcolor: #e9bcce;\r\n\t\t}\r\n\t\t\r\n\t\t.content-3-1{\r\n    \t\tbackground: #ea87af;\r\n    \t}\r\n    \t\r\n\t\t.content-3-1 .menu-foot{\r\n\t\t\tbackground: #d2799d;\r\n\t\t\tcolor: #e9bcce;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-4{\r\n\t\t\tbackground: #d9c43d;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-4 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/4.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-4 .menu-foot{\r\n\t\t\tbackground: #c3b037;\r\n\t\t\tcolor: #e1d89b;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-5{\r\n    \t\tbackground: #f3a43c;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-5 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/5.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-5 .menu-foot{\r\n\t\t\tbackground: #da9336;\r\n\t\t\tcolor: #edc99b;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-6{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-6 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/6.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-6 .menu-foot{\r\n\t\t\tbackground: #778d38;\r\n\t\t\tcolor: #bbc69c;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t.content-6-1{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n    \t\r\n\t\t.content-6-1 .menu-foot{\r\n\t\t\tbackground: #778d38;\r\n\t\t\tcolor: #bbc69c;\r\n\t\t}\r\n    \t\r\n\t\t.content-6-2{\r\n    \t\tbackground: #849d3e;\r\n    \t}\r\n    \t.content-6-2 .menu-foot{\r\n    \t\tbackground: #778d38;\r\n    \t\tcolor: #bbc69c;\r\n    \t}\r\n\t\t\r\n\t\t.content-7{\r\n    \t\tbackground: #b6a1cb;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-7 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/7.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-7 .menu-foot{\r\n\t\t\tbackground: #a391b6;\r\n\t\t\tcolor: #d1c8db;\r\n\t\t}\r\n\t\t\r\n\t\t.content-7-1{\r\n    \t\tbackground: #b6a1cb;\r\n    \t}\r\n    \t\r\n\t\t.content-7-1 .menu-foot{\r\n\t\t\tbackground: #a391b6;\r\n\t\t\tcolor: #d1c8db;\r\n\t\t}\r\n\t\t\r\n\t\t.content-8{\r\n    \t\tbackground: #874989;\r\n    \t}\r\n\t\t\r\n\t\t.nj_card.content-8 .menu-body .icon{\r\n\t\t\tbackground-image: url(https://i02.smp.ne.jp/u/joypla/images/menu_icon/8.png);\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.nj_card.content-8 .menu-foot{\r\n\t\t\tbackground: #79427b;\r\n\t\t\tcolor: #bca1bd;\r\n\t\t}\r\n\t\t\r\n\t\t.content-8-1{\r\n    \t\tbackground: #874989;\r\n    \t}\r\n    \t\r\n\t\t.content-8-1 .menu-foot{\r\n\t\t\tbackground: #79427b;\r\n\t\t\tcolor: #bca1bd;\r\n\t\t}\r\n\t\t\r\n\t\ta.top-to-icon {\r\n\t\t\tzoom : 1.4;\r\n\t\t}\r\n\t\t\r\n\t\t.limiter{\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t.uk-pagination{\r\n\t\t\tdisplay: none !important;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t.topic .limiter{\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t.topic .uk-pagination{\r\n\t\t\tdisplay: none !important;\r\n\t\t\t\r\n\t\t}\r\n\t\t.topic .title{\r\n\t\t\tpadding: 8px;\r\n\t\t\tbackground:#999999;\r\n\t\t\tcolor:white;\r\n\t\t\tmargin: 0px 0 0px 0;\r\n\t\t}\r\n\t\t.topic{\r\n\t\t\tborder: solid 1px #999999;\r\n\t\t\theight: 400px;\r\n\t\t}\r\n\t\t\r\n    <\/style>\r\n    <script>\r\n\tlet canAjax = true;\r\n    $(document).ready(function() {\r\n\t\t pageShow('<?php echo $_POST[\"page\"] ?>');\r\n    });\r\n    \tfunction paging(id){\r\n    \t\tlet url = location.href ;\r\n    \t\tlet param = '';\r\n    \t\tif(id){\r\n    \t\t\tparam = '&page='+id ;\r\n    \t\t}\r\n    \t\twindow.location.href = \"/area/servlet/area.MyPageBundle?MyPageID=<?php echo $_POST[\"MyPageID\"] ?>\"+param;\r\n    \t}\r\n    \t\r\n    \tfunction pageShow(page){\r\n    \t\tif(page == null || page == ''){\r\n    \t\t\tpage = 'page_top';\r\n    \t\t}\r\n\t\t\t$(\"[id^='page']\").hide();\r\n\t\t    $('#'+page).show();\r\n    \t}\r\n    \t\r\n\t\tfunction search(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet searchValue =  $('input[name=\"searchValue\"]').val();\r\n\t\t\tif(searchValue == ''){\r\n\t\t\t\tUIkit.modal.alert('検索したいバーコードを読み取りまたは、入力してください');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n            loading();\r\n            \r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:ObarcodeSAPI%',\r\n                type:'POST',\r\n                data:{\r\n                \tsearchValue :searchValue\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(data.code != 0){\r\n            \t\tUIkit.modal.alert(\"伝票が見つかりませんでした\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"伝票が見つかりました\").then(function(){\r\n\t\t\t\t\tlocation.href=data.urls[0];\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n            \tUIkit.modal.alert(\"伝票が見つかりませんでした\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n                \r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n    <\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding uk-padding-remove-horizontal\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-large\t\">\r\n\t\t    \t<div class=\"uk-margin\">\r\n\t\t    \t\t<form action=\"#\" onsubmit=\"search(); return false;\" method=\"post\">\r\n\t\t\t\t    \t<div class=\"uk-padding-top uk-background-muted uk-padding-small uk-width-1-2@m\" >\r\n\t\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\" name=\"searchValue\"> \r\n\t\t\t    \t\t\t<button class=\"uk-button uk-button-primary uk-float-right uk-width-1-5 uk-padding-remove\" type=\"submit\">検索<\/button>\r\n\t\t\t    \t\t<\/div>\r\n\t\t    \t\t<\/form> \r\n\t    \t\t<\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-1\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">発注書一覧<\/span><br>\r\n\t\t                                <span class=\"text\">Orders List<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"%url/rel:mpgt:page_266217%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-2\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">検収書一覧<\/span><br>\r\n\t\t                                <span class=\"text\">Acceptance Form List<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"%url/rel:mpgt:page_266905%\" class=\"slide2\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-3\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">実績<\/span><br>\r\n\t\t                                <span class=\"text\">Achievement<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"%url/rel:mpgt:page_266228%\" class=\"slide3\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-5\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">情報提供<\/span><br>\r\n\t\t                                <span class=\"text\">Information Provision<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"%url/rel:mpgt:page_266278%\" class=\"slide5\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-7\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">商品・見積<\/span><br>\r\n\t\t                                <span class=\"text\">Product Quotation<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page1')\" class=\"slide1\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t        <div class=\"nj_card content-8\">\r\n\t                        <div class=\"menu-content\">\r\n\t                            <div class=\"menu-body\">\r\n\t                                <i class=\"icon\"><\/i>\r\n\t                                <p>\r\n\t\t                                <span class=\"title\">ユーザー管理<\/span><br>\r\n\t\t                                <span class=\"text\">User Management<\/span>\r\n\t                                <\/p>\r\n\t                            <\/div>\r\n\t                            <div class=\"menu-foot\">\r\n\t                                <span>More Info<\/span>\r\n\t                            <\/div>\r\n\t                            <a href=\"javascript:paging('page8')\" class=\"slide8\"><\/a>\r\n\t                        <\/div>\r\n\t\t\t\t        <\/div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    <div>\r\n\t\t\t\t    <\/div>\r\n\t\t\t\t    \r\n\t\t\t\t\t<div class=\"uk-width-1-2@m uk-text-left\">\r\n\t\t\t\t\t\t<div class=\"topic\">\r\n\t\t\t\t    \t\t<div class=\"title\">\t\r\n\t\t\t\t    \t\t\t<div uk-grid>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 \">\r\n\t\t\t\t\t    \t\t\t\t<span>システム通知<\/span>\r\n\t\t\t\t\t    \t\t\t<\/p>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 uk-text-right\">\r\n\t\t\t\t\t    \t\t\t\t<a href=\"%url/rel:mpgt:page_266378%\" class=\"uk-link\" style=\"color:#ffffff\">More Info<\/a>\r\n\t\t\t\t\t    \t\t\t<\/p>\t\r\n\t\t\t\t    \t\t\t<\/div>\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t\t<div class=\"uk-padding-small\">\r\n\t\t\t\t    \t\t\t\t%sf:usr:search91:table%\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div class=\"uk-width-1-2@m uk-text-left\">\r\n\t\t\t\t\t\t<div class=\"topic\">\r\n\t\t\t\t    \t\t<div class=\"title\">\r\n\t\t\t\t    \t\t\t<div uk-grid>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 \">\r\n\t\t\t\t\t    \t\t\t\t<span>新着トピック<\/span>\r\n\t\t\t\t\t    \t\t\t<\/p>\r\n\t\t\t\t\t    \t\t\t<p class=\"uk-width-1-2 uk-text-right\">\r\n\t\t\t\t\t    \t\t\t\t<a href=\"%url/rel:mpgt:page_266278%\" class=\"uk-link\" style=\"color:#ffffff\">More Info<\/a>\r\n\t\t\t\t\t    \t\t\t<\/p>\t\r\n\t\t\t\t    \t\t\t<\/div>\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t\t<div class=\"uk-padding-small\">\r\n\t\t\t\t    \t\t\t\t%sf:usr:search88:table%\r\n\t\t\t\t    \t\t<\/div>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\r\n\t\t\t\t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page1\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">商品・見積<\/span><br>\r\n\t                            <span class=\"sub-title\">Product Quotation<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"uk-child-width-1-2@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-7-1 category-title\">見積<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t<?php if($tenantData['data'][0]['tenantKind'] == '1') : ?>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">見積依頼一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Quote Request List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266428%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-7-1 category-title\">商品<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-2@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-7-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">院内商品一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">In Hospital Items List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_267642%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t\r\n\t\t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-small uk-padding-remove-horizontal\" id=\"page8\">\r\n\t\t    <div class=\"uk-container uk-container-large\">\r\n\t\t    \t<div class=\"uk-child-width-1-1\">\r\n                    <div class=\"uk-text-left uk-child-width-1-2 uk-margin-remove\" uk-grid>\r\n\t                    <div class=\"uk-text-left uk-inline\">\r\n\t                    \t<a href=\"javascript:paging()\" class=\"uk-position-center-left top-to-icon\" uk-icon=\"icon: chevron-left\"><\/a>\r\n\t                    <\/div>\r\n\t                    <div class=\"uk-padding-remove-right\">\r\n\t                        <p class=\"uk-text-right\">\r\n\t                            <span class=\"title\">ユーザー管理<\/span><br>\r\n\t                            <span class=\"sub-title\">User Management<\/span>\r\n\t                        <\/p>\r\n\t                    <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n\t\t    \t<div class=\"uk-child-width-1-1@m uk-text-left@m uk-margin-small-top\"  style=\"color: #ffffff\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t\t    \t\t<div>\t\r\n\t\t\t\t    \t\t<p class=\"uk-width-1-1 content-8-1 category-title\">ユーザー管理<\/p>\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t\t    \t<div class=\"uk-child-width-1-4@m uk-text-center\" uk-grid>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">ユーザー情報変更<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">User Info Change<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"#\" onclick=\"document.userInfoChange.submit();\" class=\"slide1\"><\/a>\r\n\t\t\t\t\t\t\t\t\t\t\t<form method=\"post\" action=\"/regist/is\" name=\"userInfoChange\" target=\"_blank\">\r\n\t\t\t\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"userPermission\" value=\"%val:usr:userPermission:id%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"loginId\" value=\"%val:usr:loginId%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"name\" value=\"%val:usr:name%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"nameKana\" value=\"%val:usr:nameKana%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"mailAddress\" value=\"%val:usr:mailAddress%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"remarks\" value=\"%val:usr:remarks%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:oroshiUserChange%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"%val:sys:id%\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"authKey\" value=\"%val:usr:authKey%\" >\r\n\t\t\t\t\t\t\t\t\t\t<\/form>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t    <div>\r\n\t\t\t\t\t\t        <div class=\"nj_card content-8-1\">\r\n\t\t\t                        <div class=\"menu-content\">\r\n\t\t\t                            <div class=\"menu-body\">\r\n\t\t\t                                <p>\r\n\t\t\t\t                                <span class=\"title\">卸業者ユーザー一覧<\/span><br>\r\n\t\t\t\t                                <span class=\"text\">Distributor User List<\/span>\r\n\t\t\t                                <\/p>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <div class=\"menu-foot\">\r\n\t\t\t                                <span>More Info<\/span>\r\n\t\t\t                            <\/div>\r\n\t\t\t                            <a href=\"%url/rel:mpgt:page_266244%\" class=\"slide1 animsition-link\"  data-animsition-out-class=\"fade-out\"><\/a>\r\n\t\t\t                        <\/div>\r\n\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t\t\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39931",
   "name": "PayoutContent",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html> \r\n  <head>\r\n    <title>JoyPla 払出内容入力<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <style>\r\n\t\t\r\n\t\ta.top-to-icon {\r\n\t\t\tzoom : 1.4;\r\n\t\t}\r\n\t\t\r\n\t\t.page_title{\r\n\t\t}\r\n\t\t\r\n\t\t.shouhin-data{\r\n\t\t}\r\n\t\t\r\n\t\t.id{\r\n\t\t\tmin-width: 24px;\r\n\t\t\tmax-width: 24px;\r\n\t\t}\r\n\t\t\r\n\t\t.shouhin-data .itemName{\r\n\t\t\tfont-size: 14px;\r\n\t\t}\r\n\t\t.shouhin-data .makerName{\r\n\t\t\tfont-size: 12px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .tana{\r\n\t\t\tfont-size: 8px;\r\n\t\t}\r\n\t\t.shouhin-data .itemCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .constant{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .quantity{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .price{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .JANCode{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.shouhin-data .officialFlag{\r\n\t\t\tfont-size: 8px;\r\n\t\t\t\r\n\t\t}\r\n\t\t.itemCount{\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\t\t.itemCount->after {\r\n\t\t   content: attr(data-format); /* ここが重要!! */\r\n\t\t   width: 10%;\r\n\t\t   height: 20px;\r\n\t\t   position: absolute;\r\n\t\t   bottom: 4px;\r\n\t\t}\r\n\t\t.itemCountInput{\r\n\t\t\twidth: 90%;\r\n\t\t}\r\n\t\t.uk-table th, .uk-table td{\r\n\t\t\tword-break: break-word;\r\n\t\t\tpadding: 12px 8px;\r\n\t\t\tvertical-align: middle;\r\n\t\t}\r\n\t\t.uk-table tfoot tr{\r\n\t\t\tborder-bottom: #e5e5e5 1px solid;\r\n\t\t\tborder-top: #e5e5e5 1px solid;\r\n\t\t}\r\n    <\/style>\r\n    <script>\r\n\t\tlet canAjax = true;\r\n    \t// 参照ボタンクリック\r\n\t\tfunction sanshouClick(){\r\n\t\t\t// 参照マスタを別ウィンドウで開く\r\n\t\t\twindow.open('%url/rel:mpgt:page_262313%', '_blank','scrollbars=yes,width=1220,height=600');\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\tlet listObject = {};\r\n\t\tlet dataKey = ['id','maker','shouhinName','code','kikaku','irisu','count','symbol','labelCount','sumCount','jan'];\r\n\t\t\r\n\t\tfunction addTr(object){\r\n\t\t\tif(listObject[object.recordId]){\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\tlistObject[object.recordId] = object;\r\n\t\t\t\tlistObject[object.recordId].row = Object.keys(listObject).length;\r\n\t\t\t}\r\n\t\t\tlistObject[object.recordId].countNum = 0;\r\n\t\t\tlistObject[object.recordId].countLabelNum = 1;\r\n\t\t\tlet trElm = document.createElement(\"tr\"); \r\n\t\t\tlet tdElm = '';\r\n\t\t\tfor(let i = 0 ; i < dataKey.length; i++){\r\n\t\t\t\ttdElm = document.createElement(\"td\");\r\n\t\t\t\thtml = '';\r\n\t\t\t\ttext = '';\r\n\t\t\t\tinput = '';\r\n\t\t\t\tspan = '';\r\n\t\t\t\tif(dataKey[i] === 'id'){\r\n\t\t\t\t\thtml = document.createTextNode(listObject[object.recordId].row);\r\n\t\t\t\t} else if(dataKey[i] === 'count'){\r\n\t\t\t\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\r\n\t\t\t\t    html = document.createElement(\"div\");\r\n\t\t\t\t    input = document.createElement(\"input\");\r\n\t\t\t\t    input.type = 'number';\r\n\t\t\t\t\tinput.step=\"1\";\r\n\t\t\t\t    input.className = 'uk-input';\r\n\t\t\t\t    input.style = 'width:96px';\r\n\t\t\t\t    input.id = 'hp_' + object.recordId;\r\n\t\t\t\t    input.min = 0;\r\n\t\t\t\t    input.value = listObject[object.recordId].countNum;\r\n\t\t\t\t    \r\n\t\t\t\t    input.onchange  = function () {  \r\n\t\t\t\t\t\tchangeForInputNumber(this);\r\n\t\t\t\t    \tonchangeCountNum(object.recordId,this.value);\r\n\t\t\t\t\t\tonchangeSumCountNum(object.recordId);\r\n\t\t\t\t    };\r\n\t\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t\t    span = document.createElement(\"span\");\r\n\t\t\t\t    span.innerText = listObject[object.recordId].unit;\r\n\t\t\t\t    span.className = 'uk-text-bottom';\r\n\t\t\t\t\thtml.appendChild(input);\r\n\t\t\t\t\thtml.appendChild(span);\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t} else if(dataKey[i] === 'labelCount'){\r\n\t\t\t\t\thtml = document.createElement(\"div\");\r\n\t\t\t\t\t//html = '<input type=\"number\" class=\"uk-input\" style=\"width:72px\" step=\"10\">';\\\r\n\t\t\t\t    input = document.createElement(\"input\");\r\n\t\t\t\t    input.type = 'number';\r\n\t\t\t\t\tinput.step=\"1\";\r\n\t\t\t\t    input.className = 'uk-input';\r\n\t\t\t\t    input.style = 'width:96px';\r\n\t\t\t\t    input.id = 'labelCount_' + object.recordId;\r\n\t\t\t\t    input.min = 1;\r\n\t\t\t\t    input.value = 1;\r\n\t\t\t\t    \r\n\t\t\t\t    input.onchange  = function () {\r\n\t\t\t\t\t\tchangeForInputNumber(this);\r\n\t\t\t\t    \tonchangeCountLabelNum(object.recordId,parseInt(this.value));\r\n\t\t\t\t\t\tonchangeSumCountNum(object.recordId);\r\n\t\t\t\t    };\r\n\t\t\t\t    //input.step = listObject[object.recordId].irisu;\r\n\t\t\t\t    //<span class=\"uk-text-bottom\">個<\/span>\r\n\t\t\t\t    span = document.createElement(\"span\");\r\n\t\t\t\t    span.innerText = '枚';\r\n\t\t\t\t    span.className = 'uk-text-bottom';\r\n\t\t\t\t\thtml.appendChild(input);\r\n\t\t\t\t\thtml.appendChild(span);\r\n\t\t\t\t} else if(dataKey[i] === 'symbol'){\r\n\t\t\t\t\thtml = document.createTextNode('×');\r\n\t\t\t\t} else if(dataKey[i] === 'sumCount'){\r\n\t\t\t\t\thtml = document.createElement(\"div\");\r\n\t\t\t\t    span = document.createElement(\"span\");\r\n\t\t\t\t    span.id = 'sumCount_' + object.recordId;\r\n\t\t\t\t    span.innerText = parseInt(listObject[object.recordId].countNum) * parseInt(listObject[object.recordId].countLabelNum);\r\n\t\t\t\t\thtml.appendChild(span);\r\n\t\t\t\t    \r\n\t\t\t\t\tspan = document.createElement(\"span\");\r\n\t\t\t\t    span.innerText = listObject[object.recordId].unit;\r\n\t\t\t\t    span.className = 'uk-text-bottom';\r\n\t\t\t\t\thtml.appendChild(span);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext = \"\";\r\n\t\t\t\t\tif(dataKey[i] === 'kakaku') {\r\n\t\t\t\t\t\ttext += \"￥\";\r\n\t\t\t\t\t} \r\n\t\t\t\t\tif(listObject[object.recordId][dataKey[i]]){\r\n\t\t\t\t\t\ttext += listObject[object.recordId][dataKey[i]];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(dataKey[i] === 'teisu' || dataKey[i] === 'irisu') {\r\n\t\t\t\t\t\ttext += listObject[object.recordId].unit;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml = document.createTextNode(text);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttdElm.appendChild(html);\r\n\t\t\t\ttrElm.appendChild(tdElm);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\".shouhin-table table tbody\").append(trElm);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t/*\r\n\t\tfunction onchangeDeadlineMinimum(id,value){\r\n\t\t\t$('input[name=\"deadlineMax_'+id+'\"]').attr('min',value);\r\n\t\t\tlistObject[id].deadlineMinimum = value;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\tfunction onchangeDeadlineMax(id,value){\r\n\t\t\t$('input[name=\"deadlineMinimum_'+id+'\"]').attr('max',value);\r\n\t\t\tlistObject[id].deadlineMax = value;\r\n\t\t}\r\n\t\t*/\r\n\t\tfunction onchangeCountNum(id,value){\r\n\t\t\tlistObject[id].countNum = value;\r\n\t\t\t$('#hp_'+id).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"96px\"});\r\n\t\t\t$('#hp_'+id).val(value);\r\n\t\t\t$(window).scrollTop($('#hp_'+id+':first').offset().top - 100);\r\n\t\t}\r\n\t\t\r\n\t\tfunction onchangeCountLabelNum(id,value){\r\n\t\t\tlistObject[id].countLabelNum = value;\r\n\t\t\t$('#labelCount_'+id).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"96px\"});\r\n\t\t\t$('#labelCount_'+id).val(value);\r\n\t\t\t$(window).scrollTop($('#labelCount_'+id+':first').offset().top - 100);\r\n\t\t}\r\n\r\n\t\tfunction onchangeSumCountNum(id){\r\n\t\t\tvalue = parseInt(listObject[id].countLabelNum) * parseInt(listObject[id].countNum);\r\n\t\t\t$('#sumCount_'+id).text(value);\r\n\t\t}\t\t\r\n\t\t\r\n\t\tfunction barcodeSearch(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n            loading();\r\n          \r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:labelBarcodeSAPI%',\r\n                type:'POST',\r\n                data:{\r\n                \tbarcode : $('input[name=\"barcode\"]').val(),\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n            \tlet value = 0;\r\n                if(data.code != 0 || data.data.length == 0){\r\n            \t\tUIkit.modal.alert(\"商品が見つかりませんでした\");\r\n            \t\treturn false;\r\n                }\r\n                data = data.data;\r\n                let addFlag = addTr(data);\r\n                //value = parseInt(listObject[data.recordId].countNum) + parseInt(data.count);\r\n\t\t\t\tvalue = parseInt(data.count);\r\n\t\t\t\tif(addFlag == false){\r\n\t\t\t\t\tif(parseInt(listObject[data.recordId].countNum) !== value){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"すでに記載されている商品と数量が異なります。<br>追加されている数量:\"+listObject[data.recordId].countNum + \"<br>今回追加の数量:\"+value+\"<br>ご確認ください。\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue = parseInt(listObject[data.recordId].countLabelNum) + 1;\r\n\t\t\t\t\tonchangeCountLabelNum(data.recordId,value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonchangeCountNum(data.recordId,value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tonchangeSumCountNum(data.recordId);\r\n\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"商品が見つかりませんでした\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n                $('input[name=\"barcode\"]').val('');\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\tfunction payoutCheck(){\r\n\t\t\tif($('select[name=\"sourceDivision\"]').val()){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('払出元部署を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif($('select[name=\"targetDivision\"]').val()){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('払出先部署を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif($('select[name=\"sourceDivision\"]').val() != $('select[name=\"targetDivision\"]').val() ){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('払出元部署と払出先部署は同一のものを選択しないでください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Object.keys(listObject).length === 0){\r\n\t\t\t\tUIkit.modal.alert('商品を選択してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet checkflg = false;\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t  if(listObject[key].countNum !== 0){\r\n\t\t\t  \tcheckflg = true;\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(checkflg){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('数量を入力してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t\tcheckflg = false;\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t  if(listObject[key].countLabelNum !== 0){\r\n\t\t\t  \tcheckflg = true;\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\tif(checkflg){\r\n\t\t\t} else {\r\n\t\t\t\tUIkit.modal.alert('個数を入力してください');\r\n\t\t\t\treturn false ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction sendPayout(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n            loading();\r\n\t\t\tif(! payoutCheck()){\r\n\t\t\t\tloading_remove();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:'%url/rel:mpgt:regPayout%',\r\n                type:'POST',\r\n                data:{\r\n                \tpayout : JSON.stringify( objectValueToURIencode(listObject) ),\r\n                \tsourceDivisionId : $('select[name=\"sourceDivision\"]').val(),\r\n                \tsourceDivisionName : encodeURI($('select[name=\"sourceDivision\"] option:selected').text()),\r\n                \ttargetDivisionId : $('select[name=\"targetDivision\"]').val(),\r\n                \ttargetDivisionName : encodeURI($('select[name=\"targetDivision\"] option:selected').text()),\r\n                },\r\n                dataType: 'json'\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"払出に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"払出が完了しました\").then(function(){\r\n\t\t\t\t\tUIkit.modal.confirm(\"ラベルを発行しますか<br>※履歴から発行も可能です\").then(function () {\r\n\t\t\t\t\t\tcreateLabel();\r\n\t\t\t\t\t\tdataReset();\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\tdataReset();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n                UIkit.modal.alert(\"払出に失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n\t\t\t\tloading_remove();\r\n            });\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction dataReset(){\r\n            $('table.uk-table tbody tr').remove();\r\n            listObject = {};\r\n            loading_remove();\r\n\t\t}\r\n\r\n\t\tfunction createLabel(){\r\n\t\t\tlet items = {};\r\n\t\t\tObject.keys(listObject).forEach(function (key) {\r\n\t\t\t\tif(parseInt(listObject[key].countNum) * parseInt(listObject[key].countLabelNum) > 0){\r\n\t\t\t\t\titems[key] = listObject[key];\r\n\t\t\t\t\titems[key].printCount = listObject[key].countLabelNum;　//ラベル枚数\r\n\t\t\t\t\titems[key].quantity = listObject[key].countNum; //入数\r\n\t\t\t\t\titems[key].distributorName = listObject[key].oroshi; //業者名\r\n\t\t\t\t\titems[key].itemName = listObject[key].shouhinName; //商品名\r\n\t\t\t\t\titems[key].itemStandard = listObject[key].kikaku; //規格\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( objectValueToURIencode(items) ));\r\n\t\t\t$('input[name=\"sourceDivision\"]').val($('select[name=\"sourceDivision\"]').val());\r\n\t\t\t$('input[name=\"targetDivision\"]').val($('select[name=\"targetDivision\"]').val());\r\n\t\t\tdocument.createLabelForm.submit();\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t\r\n\t\t\r\n\t\t\r\n    <\/script>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>払出内容入力<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">払出内容入力<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-child-width-1-3@m\" uk-grid>\r\n\t\t    \t\t<div>\r\n\t\t    \t\t\t<label class=\"uk-form-label\">払出元部署<\/label>\r\n\t\t    \t\t\t<div class=\"uk-form-controls\">\r\n\t\t\t\t            <select class=\"uk-width-3-4 uk-select uk-inline\" name=\"sourceDivision\">\r\n\t\t\t\t                <option value=\"\">----- 部署選択 -----<\/option>\r\n\t\t\t\t\t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t                if($userInfo->getUserPermission() == '1') {\r\n\t\t\t\t\t                $stringDom .= '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t\t                $stringDom .= '<option value=\"\" disabled>--------------------<\/option>';\r\n\t\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t\t                \tif($divisiton[5] == '1'){\r\n\t\t\t\t\t                \t\tcontinue;\r\n\t\t\t\t\t                \t}\r\n\t\t\t\t\t\t\t\t\t\t$stringDom .= '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t\t                }\r\n\t\t\t\t                } else if($userInfo->getDivisionId() == $divisionData['store'][0][1]) {\r\n\t\t\t\t\t                $stringDom .= '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t                } else {\r\n\t\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t\t                \tif($divisiton[5] == '1'){\r\n\t\t\t\t\t                \t\tcontinue;\r\n\t\t\t\t\t                \t}\r\n\t\t\t\t\t\t\t\t\t\t$stringDom .= '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\techo $stringDom;\r\n\t\t\t\t                ?>\r\n\t\t\t\t            <\/select>\r\n\t\t\t            <\/div>\r\n\t\t\t        <\/div>\r\n\t\t    \t\t<div>\r\n\t\t    \t\t\t<label class=\"uk-form-label\" >払出先部署<\/label>\r\n\t\t    \t\t\t<div class=\"uk-form-controls\">\r\n\t\t\t\t            <select class=\"uk-select uk-width-3-4\" name=\"targetDivision\">\r\n\t\t\t\t                <option value=\"\">----- 部署選択 -----<\/option>\r\n\t\t\t\t                \r\n\t\t\t\t\t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t                $stringDom .= '<option value=\"'.$divisionData['store'][0][1].'\">'.$divisionData['store'][0][3].'(大倉庫)<\/option>';\r\n\t\t\t\t                $stringDom .= '<option value=\"\" disabled>---------------------<\/option>';\r\n\t\t\t\t                foreach($divisionData['division'] as $divisiton){\r\n\t\t\t\t\t\t\t\t\tif($divisiton[5] == '1'){\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$stringDom .= '<option value=\"'.$divisiton[1].'\">'.$divisiton[3].'<\/option>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\techo $stringDom;\r\n\t\t\t\t                ?>\r\n\t\t\t\t            <\/select>\r\n\t\t\t            <\/div>\r\n\t\t\t        <\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin-bottom\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-1-2@m\" uk-margin>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-default\" onclick=\"sanshouClick()\">商品マスタを開く<\/button>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-default\" type=\"submit\" onclick=\"window.print();return false;\">印刷プレビュー<\/button>\r\n\t\t\t    \t\t<button class=\"uk-button uk-button-primary uk-margin-small-top\" onclick=\"sendPayout()\">払出実行<\/button>\r\n\t\t    \t\t<\/div>\r\n\t\t    \t\t<?php /*\r\n\t\t    \t\t<div class=\"uk-inline uk-width-1-2@m\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\"> \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-default uk-float-right uk-width-1-5 uk-padding-remove\">検索<\/button>\r\n\t\t    \t\t<\/div>*/ ?>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t\t    <div uk-sticky=\"sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky\" class=\"uk-padding-top uk-background-muted uk-padding-small\">\r\n\t\t    \t\t<form action='#' method=\"post\" onsubmit=\"barcodeSearch(); return false\">\r\n\t    \t\t\t\t<input type=\"text\" class=\"uk-input uk-width-4-5\" placeholder=\"バーコード入力...\" autofocus=\"true\" name=\"barcode\">  \r\n\t\t    \t\t\t<button class=\"uk-button uk-button-primary uk-float-right uk-width-1-5 uk-padding-remove\" type=\"submit\">検索<\/button>\r\n\t\t\t\t\t<\/form>\t\r\n\t\t\t\t<\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"shouhin-table uk-width-expand uk-overflow-auto\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-striped uk-text-nowrap\">\r\n\t\t    \t\t\t<thead>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<th class=\"uk-table-shrink\">id<\/th>\r\n\t\t    \t\t\t\t\t<th>メーカー<\/th>\r\n\t\t    \t\t\t\t\t<th>商品名<\/th>\r\n\t\t    \t\t\t\t\t<th>製品コード<\/th>\r\n\t\t    \t\t\t\t\t<th>規格<\/th>\r\n\t\t    \t\t\t\t\t<th>入数<\/th>\r\n\t\t    \t\t\t\t\t<th class=\"uk-table-shrink\">数量<\/th>\r\n\t\t    \t\t\t\t\t<th class=\"uk-table-shrink\"><\/th>\r\n\t\t    \t\t\t\t\t<th class=\"uk-table-shrink\">個数（ラベル枚数）<\/th>\r\n\t\t    \t\t\t\t\t<th class=\"uk-table-shrink\">合計払出数<\/th>\r\n\t\t    \t\t\t\t\t<th>JANコード<\/th>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/thead>\r\n\t\t    \t\t\t<tbody>\r\n\t\t    \t\t\t<\/tbody>\r\n\t\t    \t\t\t<tfoot>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t\t<td>&emsp;<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/tfoot>\r\n\t\t    \t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t\r\n\t<form action=\"%url/rel:mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"uk-hidden\" name=\"createLabelForm\">\r\n\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t<input type=\"hidden\" value=\"\" name=\"sourceDivision\">\r\n\t\t<input type=\"hidden\" value=\"\" name=\"targetDivision\">\r\n\t\t<input type=\"hidden\" value=\"payout\" name=\"pattern\">\r\n\t<\/form>\r\n\t\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39932",
   "name": "PayoutHistoryList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\n//管理者以外は全表示不可\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 払出履歴一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>払出履歴一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">払出履歴一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:payoutList:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39933",
   "name": "PayoutMR",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\n\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/PayoutMonthlyReport.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$payoutMonthlyReport = new App\\Api\\PayoutMonthlyReport($spiralDataBase,$userInfo);\r\n\r\n$startMonth = date('Y-m-01');\r\n$endMonth = '';\r\n$divisionId = '';\r\n$page = 1;\r\n$limit = 100;\r\n$itemName = '';\r\n$itemCode = '';\r\n$itemStandard = '';\r\n\r\nif(isset($_POST['startMonth'])){\r\n\t$startMonth = App\\Lib\\html($_POST['startMonth']);\r\n}\r\n\r\nif(isset($_POST['endMonth'])){\r\n\t$endMonth = App\\Lib\\html($_POST['endMonth']);\r\n}\r\n\r\nif($userInfo->getUserPermission() == '1'){\r\n\tif(isset($_POST['divisionId'])){\r\n\t\t$divisionId = App\\Lib\\html($_POST['divisionId']);\r\n\t}\r\n} else {\r\n\t$divisionId = $userInfo->getDivisionId();\r\n}\r\n\r\nif(isset($_POST['page'])){\r\n\t$page = App\\Lib\\html($_POST['page']);\r\n}\r\n\r\nif(isset($_POST['limit'])){\r\n\t$limit = App\\Lib\\html($_POST['limit']);\r\n}\r\n\r\nif(isset($_POST['itemName'])){\r\n\t$itemName = App\\Lib\\html($_POST['itemName']);\r\n}\r\nif(isset($_POST['itemCode'])){\r\n\t$itemCode = App\\Lib\\html($_POST['itemCode']);\r\n}\r\nif(isset($_POST['itemStandard'])){\r\n\t$itemStandard = App\\Lib\\html($_POST['itemStandard']);\r\n}\r\n\r\n$result = $payoutMonthlyReport->dataSelect($startMonth,$endMonth,$divisionId,$itemName,$itemCode,$itemStandard,$page,$limit);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 月次レポート【払出】<\/title>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>月次レポート【払出】<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"listDl();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">月次レポート【払出】<\/h2> \r\n\t\t    \t<hr>\r\n\t\t\t\t<div class=\"uk-width-1-1 uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-stacked\" name=\"myform\" action=\"%url/rel:mpgt:payoutMR%\" method=\"post\" onsubmit=\"return submitCheck()\">\r\n\t\t\t\t\t\t<div class=\"uk-width-3-4@m uk-margin-auto\">\r\n\t\t\t\t\t\t\t<h3>検索<\/h3>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      日付\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-2@m\" uk-grid>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"startMonth\" value=\"<?php echo $startMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">から<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"endMonth\" value=\"<?php echo $endMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">まで<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"divisionId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tif($divisionData['store']){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $divisionData['store'][0][1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$divisionData['store'][0][1].\"\\\" \". $selected .\">\".$divisionData['store'][0][3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$record[1].\"\\\" \".$selected.\" >\".$record[3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom; \r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\tif($divisionData['store'][0][1] == $divisionId){\r\n\t\t\t\t\t\t\t\t\t\t\techo $divisionData['store'][0][3];\r\n\t\t\t\t\t\t\t\t\t\t} else { \r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t    \t\t\t\tif($record[1] != $divisionId){ continue; } \r\n\t\t\t\t\t\t\t    \t\t\t\techo $record[3] ;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t} ?>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      商品名\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemName\" value=\"<?php echo $itemName ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      製品コード\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemCode\" value=\"<?php echo $itemCode ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      規格\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemStandard\" value=\"<?php echo $itemStandard ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-text-center\">\r\n\t\t\t\t\t\t\t\t<input class=\"uk-margin-top uk-button uk-button-default\" type=\"submit\" value=\"検索\">\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-width-1-2@m uk-width-1-4@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(fixed('<?php echo $result['totalAmount'] ?>'))<\/script> -<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<\/tbody>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\">\r\n\t\t\t\t\t\t\t\t<span class=\"smp-offset-start\"><?php echo ($limit * ($page - 1) )+ 1 ?><\/span> - <span class=\"smp-offset-end\"><?php echo ($limit * $page > $result['count'])? $result['count'] : $limit * $page ?><\/span>件 / <span class=\"smp-count\"><?php echo $result['count'] ?><\/span>件\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\" uk-grid>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-2-3\">\r\n\t\t\t\t\t\t\t\t\t<select name=\"limit\" class=\" uk-select\">\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"10\" <?php echo ($limit == '10')? 'selected' : '' ?>>10件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"50\" <?php echo ($limit == '50')? 'selected' : '' ?>>50件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"100\" <?php echo ($limit == '100')? 'selected' : '' ?>>100件<\/option><\/select><\/div>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-1-3\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"smp-table-submit-button\" class=\"uk-button uk-button-default\" value=\"表示\">\r\n\t\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\">\r\n\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>No<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>最小単位の価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>払出数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>合計金額<\/th>\r\n\t\t\t\t\t\t\t\t\t<\/tr>\r\n\t\t\t\t\t\t\t\t<\/thead>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\tif($result['count'] > 0){\r\n\t\t\t\t\t\t\t\t\t\tforeach($result['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['id'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['makerName'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemName'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemCode'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['itemStandard'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['minPrice'].\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record['payoutQuantity'].\" \".$record['quantityUnit'].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\".$record['totalAmount'].\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t<\/tbody>\r\n\t\t\t\t\t\t\t<\/table>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<input name=\"page\" value=\"1\" type=\"hidden\">\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n     <script>\r\n\tfunction submitCheck(){\r\n\t if($('input[name=\"startMonth\"]').val() == \"\"){\r\n\t \tUIkit.modal.alert('日付検索の開始日は必須です');\r\n\t \treturn false;\r\n\t }\r\n\t return true;\r\n\t}\r\n\t\r\n\tfunction pageSubmit(page){\r\n\t $('input[name=\"page\"]').val(page);\r\n\t document.myform.submit();\r\n\t}\r\n     \r\n\tfunction exportCSV(records) {\r\n\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\r\n\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\tlet link = document.createElement('a');\r\n\t\tlink.download = 'goodsBillingMonthlyReport_<?php echo date('Ymd') ?>.tsv';\r\n\t\tlink.href = url;\r\n\t\tdocument.body.appendChild(link);\r\n\t\tlink.click();\r\n\t\tdocument.body.removeChild(link);\r\n\t};\r\n\t\r\n\tfunction listDl(){\r\n\t\tlet records = <?php echo json_encode($result['data']) ?>;\r\n\t\tlet result = [];\r\n\t\tfor(let i = 0 ; i < records.length ; i++){\r\n\t\t\tresult[i] = [];\r\n\t\t\tObject.keys(records[i]).forEach(function (key) {\r\n\t\t\t\tresult[i].push(records[i][key]);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tresult.unshift(['id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','minPrice','payoutQuantity','totalAmount','quantityUnit']);\r\n\t\r\n\t\texportCSV(result);\r\n\t}\r\n     <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39934",
   "name": "PayoutSlip",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemPayout.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"NJ_PayoutHDB\",$SPIRAL->getCardId(),\"payoutHistoryId\",\"payoutAuthKey\",\"sourceDivisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][2] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$getItemPayout = new App\\Api\\GetItemPayout($spiralDataBase,$userInfo);\r\n$payoutData = $getItemPayout->getItemPayout($card[\"data\"][0][0]);\r\n\r\n$payoutData = $spiralDataBase->arrayToNameArray($payoutData[\"data\"],array(\"registrationTime\",\"payoutHistoryId\",\"price\",\"itemId\",\"itemName\",\"itemCode\",\"itemStandard\",\"itemJANCode\",\"quantityUnit\",\"payoutQuantity\",\"payoutAmount\",\"itemUnit\",\"quantity\",\"makerName\",\"inHospitalItemId\",\"payoutCount\",\"payoutLabelCount\",\"distributorId\",\"catalogNo\",\"labelId\"));\r\n\r\nforeach($payoutData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"payoutQuantity\"=> $record[\"payoutQuantity\"]\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$payoutAuthKey = $crypt->encrypt($card[\"data\"][0][1], \"JoyPla\");\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_267442%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 払出伝票<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>払出履歴一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>払出伝票<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"button\" value=\"払出伝票取消\" onclick=\"payoutDelete();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"払出ラベル発行\" onclick=\"createLabel();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">払　出　伝　票<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">払出日時<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:registrationTime%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">払出部署<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:sourceDivision%<span uk-icon=\"icon: arrow-right\"><\/span>%val:usr:targetDivision%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">品目数<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">%val:usr:itemsNumber%<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-bold\">合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"uk-table-shrink\">数量<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"uk-table-shrink\"><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"uk-table-shrink\">個数（ラベル枚数）<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"uk-table-shrink\">合計払出数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>払出金額<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($payoutData as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td><script>price(\\\"\".$record[\"price\"].\"\\\")<\/script>円 / \".$record[\"itemUnit\"].\"<\/td>\";\r\n\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record[\"payoutCount\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>×<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\".$record[\"payoutLabelCount\"].\"枚<\/td>\";\r\n\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"payoutQuantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>￥<script>price(\\\"\".$record[\"payoutAmount\"].\"\\\")<\/script><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<form action=\"%url/rel:@mpgt:createLabel%\" target=\"_blank\" method=\"post\" class=\"uk-hidden\" name=\"createLabelForm\">\r\n\t\t<input type=\"hidden\" value=\"\" name=\"itemsData\" id=\"itemsData\">\r\n\t\t<input type=\"hidden\" value=\"%val:usr:sourceDivisionId%\" name=\"sourceDivision\">\r\n\t\t<input type=\"hidden\" value=\"%val:usr:targetDivisionId%\" name=\"targetDivision\">\r\n\t\t<input type=\"hidden\" value=\"payout\" name=\"pattern\">\r\n\t<\/form>\r\n\t<script>\r\n\t\tlet canAjax = true;\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\tlet lotdata = {};\r\n\r\n\t\tfunction payoutDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet flg = true;\r\n\t\t\t\r\n\t\t\tUIkit.modal.confirm(\"払出情報を削除します。<br>よろしいですか<br>注意:払出元へ在庫数を戻します。\").then(function () {\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:\"%url/card:page_267245%\",\r\n\t                type:\"POST\",\r\n\t                data:{\r\n\t                \tsourceDivisionId:\"%val:usr:sourceDivisionId%\",\r\n\t                \ttargetDivisionId:\"%val:usr:targetDivisionId%\",\r\n\t                \tpayoutData : JSON.stringify( itemsToJs ),\r\n\t                \tpayoutAuthKey: \"<?php echo $payoutAuthKey ?>\",\r\n\t                \tpayoutHistoryId: \"%val:usr:payoutHistoryId%\",\r\n\t                },\r\n\t                dataType: \"json\"\r\n\t            })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t            \t\r\n\t                if(! data.result){\r\n\t            \t\tUIkit.modal.alert(\"払出取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t            \t\treturn false;\r\n\t                }\r\n\t                UIkit.modal.alert(\"払出取消が完了しました\").then(function(){\r\n\t\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t            })\r\n\t            // Ajaxリクエストが失敗した時発動\r\n\t            .fail( (data) => {\r\n\t            \t\r\n\t        \t\tUIkit.modal.alert(\"払出取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t            \tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction createLabel(){\r\n\t\t\tUIkit.modal.confirm(\"ラベル発行を行います\").then(function(){\r\n\t\t\t\tconsole.log(<?php echo json_encode($payoutData); ?>);\r\n\t\t\t\tpayoutData = objectValueToURIencode( <?php echo json_encode($payoutData); ?> );\r\n\t\t\t\tcreateLabelData = {};\r\n\t\t\t\tObject.keys(payoutData).forEach(function (key) {\r\n\t\t\t\t\tid = payoutData[key].inHospitalItemId;\r\n\t\t\t\t\tcreateLabelData[id] = payoutData[key];\r\n\t\t\t\t\tcreateLabelData[id].printCount = payoutData[key].payoutLabelCount;//ラベル枚数\r\n\t\t\t\t\tcreateLabelData[id].quantity = payoutData[key].payoutCount; //入数\r\n\t\t\t\t\tcreateLabelData[id].distributorId = payoutData[key].distributorId; //業者ID\r\n\t\t\t\t\tcreateLabelData[id].distributorName = ''; //業者名\r\n\t\t\t\t\tcreateLabelData[id].itemName = payoutData[key].itemName; //商品名\r\n\t\t\t\t\tcreateLabelData[id].maker = payoutData[key].makerName;\r\n\t\t\t\t\tcreateLabelData[id].catalogNo = payoutData[key].catalogNo; \r\n\t\t\t\t\tcreateLabelData[id].unit = payoutData[key].quantityUnit;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#itemsData\").val(JSON.stringify(createLabelData));\r\n\t\t\t\tdocument.createLabelForm.submit();\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t}\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39935",
   "name": "ProductInformationDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/api/GetTenantData.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$getTenantData = new App\\Api\\GetTenantData($spiralDataBase,$userInfo);\r\n$tenantData = $getTenantData->select();\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 商品情報詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n    <script>\r\n    $(function(){\r\n\t\tif(\"%val:usr:notUsedFlag:id%\" == \"0\"){\r\n\t\t\tlabel = \"uk-label-success\";\r\n\t\t} else {\r\n\t\t\tlabel = \"uk-label-danger\";\r\n\t\t}\r\n\t\t\r\n\t\t$(\"#notUsedFlag\").addClass(label);\r\n    });\r\n    \r\n\t<\/script>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\">商品マスタ<\/a><\/li>\r\n\t\t\t\t    <li><span>商品情報詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == \"1\"): ?>\r\n\t\t\t\t\t<?php if($tenantData['data'][0]['tenantKind'] == '1'): ?>\r\n\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"商品情報変更\" onclick=\"document.itemsChange.submit()\">\r\n\t\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"itemsChange\" target=\"_blank\" class=\"uk-hidden\">\r\n\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemId\" value=\"%val:usr:itemId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemName\" value=\"%val:usr:itemName%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemCode\" value=\"%val:usr:itemCode%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemStandard\" value=\"%val:usr:itemStandard%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemJANCode\" value=\"%val:usr:itemJANCode%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"officialFlag\" value=\"%val:usr:officialFlag%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"officialpriceOld\" value=\"%val:usr:officialpriceOld%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"officialprice\" value=\"%val:usr:officialprice%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"quantity\" value=\"%val:usr:quantity%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"quantityUnit\" value=\"%val:usr:quantityUnit%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemUnit\" value=\"%val:usr:itemUnit%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"tenantId\" value=\"%val:usr:tenantId%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"minPrice\" value=\"%val:usr:minPrice%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"itemsAuthKey\" value=\"%val:usr:itemsAuthKey%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"makerName\" value=\"%val:usr:makerName%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"catalogNo\" value=\"%val:usr:catalogNo%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"serialNo\" value=\"%val:usr:serialNo%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:itemsChange%\">\r\n\t\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"submit\" value=\"院内商品として追加\" onclick=\"document.inHPItemsReg.submit()\">\r\n\t\t\t\t\t<form action=\"/regist/is\" method=\"post\" name=\"inHPItemsReg\" target=\"_blank\" class=\"uk-hidden\">\r\n\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemId\" value=\"%val:usr:itemId%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemName\" value=\"%val:usr:itemName%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemCode\" value=\"%val:usr:itemCode%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemStandard\" value=\"%val:usr:itemStandard%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemJANCode\" value=\"%val:usr:itemJANCode%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"quantity\" value=\"%val:usr:quantity%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"quantityUnit\" value=\"%val:usr:quantityUnit%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"itemUnit\" value=\"%val:usr:itemUnit%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"makerName\" value=\"%val:usr:makerName%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:@usr:hospitalId%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:inHpItemsReg%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"catalogNo\" value=\"%val:usr:catalogNo%\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"serialNo\" value=\"%val:usr:serialNo%\">\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-5-6@m uk-width-2-3\">\r\n\t\t    \t\t\t<h2>商品情報詳細<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-4-5@m uk-margin-auto uk-margin-remove-top print-width-1-1\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-divider uk-table-responsive\">\r\n\t\t\t\t\t    <tr><td colspan=\"6\">商品基本情報<\/td><\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>商品ID<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemId%<\/td>\r\n\t\t\t\t\t            <th>JANコード<\/th>\r\n\t\t\t\t\t            <td colspan=\"3\">%val:usr:itemJANCode%<\/td>\r\n\t\t\t\t\t       <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>メーカー名<\/th>\r\n\t\t\t\t\t            <td>%val:usr:makerName%<\/td>\r\n\t\t\t\t\t            <th>カタログNo<\/th>\r\n\t\t\t\t\t            <td>%val:usr:catalogNo%<\/td>\r\n\t\t\t\t\t            <th>シリアルNo<\/th>\r\n\t\t\t\t\t            <td>%val:usr:serialNo%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>商品名<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemName%<\/td>\r\n\t\t\t\t\t            <th>製品コード<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemCode%<\/td>\r\n\t\t\t\t\t            <th>規格<\/th>\r\n\t\t\t\t\t            <td>%val:usr:itemStandard%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>償還価格フラグ<\/th>\r\n\t\t\t\t\t            <td>%val:usr:officialFlag:v%<\/td>\r\n\t\t\t\t\t            <th>償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialprice%\"))<\/script>円<\/td>\r\n\t\t\t\t\t            <th>旧償還価格<\/th>\r\n\t\t\t\t\t            <td><script>price(fixed(\"%val:usr:officialpriceOld%\"))<\/script>円<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t        <tr>\r\n\t\t\t\t\t            <th>最小入数単位の価格<\/th>\r\n\t\t\t\t\t            <td colspan=\"5\"><script>price(fixed(\"%val:usr:minPrice%\"))<\/script>円 / 1 %val:usr:quantityUnit%<\/td>\r\n\t\t\t\t\t        <\/tr>\r\n\t\t\t\t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m\">\r\n\t\t    \t\t\t<h2>使用中の院内商品情報<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-4@m no_print\">\r\n\t\t\t\t\t    \t<ul uk-accordion class=\"uk-background-muted uk-padding-small\">\r\n\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t        <a class=\"uk-accordion-title\" href=\"#\">表示項目選択<\/a>\r\n\t\t\t\t\t\t\t        <div class=\"uk-accordion-content\" hidden>\r\n\t\t\t\t\t\t\t    \t\t<a class=\"uk-button uk-button-secondary uk-button-small uk-width-1-1\" href=\"#\" onclick=\"table_field_selector()\">反映<\/a>\r\n\t\t\t\t\t\t\t        \t<ul class=\"uk-list uk-list-striped\">\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_01\" type=\"checkbox\"> 使用状況<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_02\" type=\"checkbox\"> 登録日時<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_03\" type=\"checkbox\"> 更新日時<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_04\" type=\"checkbox\"> 商品ID<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_05\" type=\"checkbox\"> メーカー名<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_06\" type=\"checkbox\"> 商品名<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_07\" type=\"checkbox\"> 製品コード<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_08\" type=\"checkbox\"> 規格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_09\" type=\"checkbox\"> カタログNO<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_10\" type=\"checkbox\"> シリアルNO<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_11\" type=\"checkbox\"> 入数<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_12\" type=\"checkbox\"> 最小単位の価格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_13\" type=\"checkbox\"> 価格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_14\" type=\"checkbox\"> 旧価格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_15\" type=\"checkbox\"> JANコード<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_16\" type=\"checkbox\"> 院内倉庫在庫数<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_17\" type=\"checkbox\"> 償還価格フラグ<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_18\" type=\"checkbox\"> 償還価格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_19\" type=\"checkbox\"> 旧償還価格<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_20\" type=\"checkbox\"> 卸業者<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t    <li>\r\n\t\t\t\t\t\t\t\t\t\t    \t<div class=\"uk-margin uk-grid-small uk-child-width-auto uk-grid\">\r\n\t\t\t\t\t\t\t\t\t            \t<label><input class=\"uk-checkbox chk_21\" type=\"checkbox\"> 特記事項<\/label>\r\n\t\t\t\t\t\t\t\t\t            <\/div>\r\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\r\n\t\t\t\t\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t\t\t    <\/li>\r\n\t\t\t\t\t\t\t<\/ul>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-width-1-1 uk-margin-top\">\r\n\t\t    \t  %sf:usr:search63:mstfilter:table%\r\n               <\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t\r\n\t$(function(){\r\n\t\tlet storage = JSON.parse(localStorage.getItem(\"joypla_inHpItemsList\"));\r\n\t\tlet dispObj = {};\r\n\t\tif(!storage){\r\n\t\t\tfor(let i = 1 ; i <= 22 ; i++){\r\n\t\t\t\tdispObj[i] = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdispObj = storage;\r\n\t\t}\r\n\t\tdispSet(dispObj);\r\n\t});\r\n\tfunction table_field_selector(){\r\n\t\tlet count = $(\"input[class^='uk-checkbox chk_']\").length;;\r\n\t\tlet disp = {};\r\n\t\tfor(let i = 1 ; i <= count ; i++){\r\n\t\t\tdisp[i] = false;\r\n\t\t\tif($(\"input.chk_\"+( \"00\" + i ).slice( -2 )).is(\":checked\")){\r\n\t\t\t\tdisp[i] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlocalStorage.setItem(\"joypla_inHpItemsList\", JSON.stringify(disp));\r\n\t\tlocation.reload();\r\n\t}\r\n\t\r\n\tfunction dispSet(settingObj){\r\n\t\tObject.keys(settingObj).forEach(function (key) {\r\n\t\t  $(\".chk_\"+( \"00\" + key ).slice( -2 )).prop(\"checked\", settingObj[key]);\r\n\t\t  if(settingObj[key]){\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).show();\r\n\t\t  } else {\r\n\t\t  \t$(\".f_\"+( \"00\" + key ).slice( -2 )).hide();\r\n\t\t  }\r\n\t\t});\r\n\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39936",
   "name": "ProductMaster",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 商品マスタ<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>商品マスタ<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@l uk-width-2-3\">\r\n\t\t    \t\t\t<h2>商品マスタ<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t\r\n\t\t    \t\t\r\n\t\t    \t<\/div>\r\n\t\t\t\t%sf:usr:search74%\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39937",
   "name": "PurchaseOrderList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注書一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注書一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">発注書一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:orederList:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39938",
   "name": "PurchaseOrderListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 発注書一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>発注書一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">発注書一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search83%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39939",
   "name": "QuoteOrderDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 見積依頼詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%\">見積依頼一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>見積依頼詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-2-3@m\">\r\n\t\t    \t\t<article class=\"uk-article\">\r\n\r\n\t\t\t\t\t    <h1 class=\"uk-article-title\">%val:usr:requestTitle%<\/h1>\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    <p class=\"uk-article-meta\">\r\n\t\t\t\t\t        ステータス: %val:usr:requestStatus% <br>\r\n                            依頼者 %val:usr:hospitalName% %val:usr:requestUName% <br>\r\n\t\t\t\t\t    \t卸業者：%val:usr:distributorName%\r\n\t\t\t\t\t    <\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"\">\r\n\t\t\t\t\t    \t見積期限：%val:usr:quotePeriod% <br> <br>\r\n\t\t\t\t\t    \t%val:usr:requestDetail:br%\r\n\t\t\t\t\t    \t<\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"uk-grid-small uk-child-width-auto\" uk-grid>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-2\">\r\n\t\t\t\t\t    \t\t%val:usr:registrationTime%\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t        \r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t<\/article>\r\n\t\t\t\t<\/div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<p>見積商品一覧<\/p>\r\n                    <?php if($userInfo->getUserPermission() == '1') : ?>\r\n\t\t\t\t\t<div>%sf:usr:search95:mstfilter:table%<\/div>\r\n                    <?php else: ?>\r\n\t\t\t\t\t<div>%sf:usr:tantouMitsumori:mstfilter:table%<\/div>\r\n                    <?php endif ?>\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39940",
   "name": "QuoteOrderList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 見積依頼一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>見積依頼一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m\">\r\n\t\t    \t\t\t<h2>見積依頼一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-4-5@m\">\r\n\t\t\t\t%sf:usr:search94%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39941",
   "name": "QuoteOrderListForDistributor",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 見積依頼一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>見積依頼一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m\">\r\n\t\t    \t\t\t<h2>見積依頼一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-4-5@m\">\r\n\t\t\t\t%sf:usr:search92%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39942",
   "name": "ReceivingMR",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/api/ReceivingMonthlyReport.php';\r\ninclude_once 'NewJoyPla/api/GetDistributor.php';\r\ninclude_once 'NewJoyPla/api/GetDivision.php';\r\ninclude_once 'NewJoyPla/lib/Func.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$receivingMonthlyReport = new App\\Api\\ReceivingMonthlyReport($spiralDataBase,$userInfo);\r\n\r\n$startMonth = date('Y-m-01');\r\n$endMonth = '';\r\n$distributorId = '';\r\n$divisionId = '';\r\n$page = 1;\r\n$limit = 100;\r\n$itemName = '';\r\n$itemCode = '';\r\n$itemStandard = '';\r\n\r\nif(isset($_POST['startMonth'])){\r\n\t$startMonth = App\\Lib\\html($_POST['startMonth']);\r\n}\r\n\r\n\r\nif(isset($_POST['endMonth'])){\r\n\t$endMonth = App\\Lib\\html($_POST['endMonth']);\r\n}\r\n\r\nif(isset($_POST['distributorId'])){\r\n\t$distributorId = App\\Lib\\html($_POST['distributorId']);\r\n}\r\n\r\nif($userInfo->getUserPermission() == '1'){\r\n\tif(isset($_POST['divisionId'])){\r\n\t\t$divisionId = App\\Lib\\html($_POST['divisionId']);\r\n\t}\r\n} else {\r\n\t$divisionId = $userInfo->getDivisionId();\r\n}\r\n\r\nif(isset($_POST['page'])){\r\n\t$page = App\\Lib\\html($_POST['page']);\r\n}\r\n\r\nif(isset($_POST['limit'])){\r\n\t$limit = App\\Lib\\html($_POST['limit']);\r\n}\r\n\r\nif(isset($_POST['itemName'])){\r\n\t$itemName = App\\Lib\\html($_POST['itemName']);\r\n}\r\nif(isset($_POST['itemCode'])){\r\n\t$itemCode = App\\Lib\\html($_POST['itemCode']);\r\n}\r\nif(isset($_POST['itemStandard'])){\r\n\t$itemStandard = App\\Lib\\html($_POST['itemStandard']);\r\n}\r\n\r\n$getDistributor = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n\r\n$distributorData = $getDistributor->getDistributor();\r\n\r\n$result = $receivingMonthlyReport->dataSelect($startMonth,$endMonth,$distributorId,$divisionId,$itemName,$itemCode,$itemStandard,$page,$limit);\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n\r\n$divisionData = $getDivision->select();\r\n\r\n?>\r\n\r\n<!DOCTYPE html>\r\n\r\n<html>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n    <title>JoyPla 月次レポート【入荷照合】<\/title>\r\n  <\/head>\r\n  <body>\r\n   \r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t    \t\t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>月次レポート【入荷照合】<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"button\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"出力\" onclick=\"listDl();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<h2 class=\"page_title uk-margin-remove\">月次レポート【入荷照合】<\/h2>\r\n\t\t    \t<hr>\r\n\t\t\t\t<div class=\"uk-width-1-1 uk-margin-auto\">\r\n\t\t\t\t\t<form class=\"uk-form-stacked\" name=\"myform\" action=\"%url/rel:mpgt:receivingMR%\" method=\"post\" onsubmit=\"return submitCheck()\">\r\n\t\t\t\t\t\t<div class=\"uk-width-3-4@m uk-margin-auto\">\r\n\t\t\t\t\t\t\t<h3>検索<\/h3>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      日付\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-2@m\" uk-grid>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"startMonth\" value=\"<?php echo $startMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">から<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"uk-input uk-width-4-5\" name=\"endMonth\" value=\"<?php echo $endMonth ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"uk-width-1-5'\">まで<\/span>\r\n\t\t\t\t\t\t\t    \t\t<\/div>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      卸業者\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"distributorId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($distributorData['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($distributorId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t\t\t$stringDom .= \"<option value=\\\"\". $record[1] .\"\\\" \".$selected.\">\".$record[0].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom;\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php if($userInfo->getUserPermission() == '1'): ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t    \t\t<select name=\"divisionId\" class=\"uk-select\">\r\n\t\t\t\t\t\t\t    \t\t\t<option value=\"\">----- 選択してください -----<\/option>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t$stringDom = '';\r\n\t\t\t\t\t\t\t\t\t\t\tif($divisionData['store']){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $divisionData['store'][0][1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$divisionData['store'][0][1].\"\\\" \". $selected .\">\".$divisionData['store'][0][3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$selected = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif($divisionId == $record[1]){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$selected = 'selected';\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t$stringDom .= \"<option value=\\\"\".$record[1].\"\\\" \".$selected.\" >\".$record[3].\"<\/option>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\techo $stringDom; \r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t    \t\t<\/select>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      部署\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\tif($divisionData['store'][0][1] == $divisionId){\r\n\t\t\t\t\t\t\t\t\t\t\techo $divisionData['store'][0][3];\r\n\t\t\t\t\t\t\t\t\t\t} else { \r\n\t\t\t\t\t\t\t\t\t\t\tforeach($divisionData['division'] as $record){\r\n\t\t\t\t\t\t\t    \t\t\t\tif($record[1] != $divisionId){ continue; } \r\n\t\t\t\t\t\t\t    \t\t\t\techo $record[3] ;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t    \t\t} ?>\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<?php endif ?>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      商品名\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemName\" value=\"<?php echo $itemName ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      製品コード\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemCode\" value=\"<?php echo $itemCode ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-form-controls uk-margin\">\r\n\t\t\t\t\t\t\t\t<label class=\"uk-form-label\">\r\n\t\t\t\t\t\t\t      規格\r\n\t\t\t\t\t\t\t    <\/label>\r\n\t\t\t\t\t\t\t    <div class=\"uk-child-width-1-1\">\r\n\t\t\t\t\t\t\t    \t<div>\r\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"uk-input\" name=\"itemStandard\" value=\"<?php echo $itemStandard ?>\">\r\n\t\t\t\t\t\t\t    \t<\/div>\r\n\t\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"uk-text-center\">\r\n\t\t\t\t\t\t\t\t<input class=\"uk-margin-top uk-button uk-button-default\" type=\"submit\" value=\"検索\">\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-width-1-2@m uk-width-1-4@m uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(fixed('<?php echo $result['totalAmount'] ?>'))<\/script> -<\/td>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<\/tbody>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\">\r\n\t\t\t\t\t\t\t\t<span class=\"smp-offset-start\"><?php echo ($limit * ($page - 1) )+ 1 ?><\/span> - <span class=\"smp-offset-end\"><?php echo ($limit * $page > $result['count'])? $result['count'] : $limit * $page ?><\/span>件 / <span class=\"smp-count\"><?php echo $result['count'] ?><\/span>件\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-3@m\" uk-grid>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-2-3\">\r\n\t\t\t\t\t\t\t\t\t<select name=\"limit\" class=\" uk-select\">\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"10\" <?php echo ($limit == '10')? 'selected' : '' ?>>10件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"50\" <?php echo ($limit == '50')? 'selected' : '' ?>>50件<\/option>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"100\" <?php echo ($limit == '100')? 'selected' : '' ?>>100件<\/option><\/select><\/div>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-1-3\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"smp-table-submit-button\" class=\"uk-button uk-button-default\" value=\"表示\">\r\n\t\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t\t\t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\">\r\n\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>No<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>卸業者<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>価格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>合計金額<\/th>\r\n\t\t\t\t\t\t\t\t\t<\/tr>\r\n\t\t\t\t\t\t\t\t<\/thead>\r\n\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\tif($result['count'] > 0){\r\n\t\t\t\t\t\t\t\t\t\tforeach($result['data'] as $record){\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['id'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['distributorName'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['makerName'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['itemName'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['itemCode'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['itemStandard'] .\"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\". $record['price'] .\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>\". $record['receivingCount'] .\" \". $record['itemUnit'];\r\n\t\t\t\t\t\t\t\t\t\t\tif($record['totalReturnCount'] > 0){\r\n\t\t\t\t\t\t\t\t\t\t\t\techo \"<br><span class=\\\"uk-text-danger\\\">(返品数:\". $record['totalReturnCount'] .\")<\/span>\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<td>￥<script>price(fixed('\". $record['totalAmount'] .\"'))<\/script><\/td>\";\r\n\t\t\t\t\t\t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} ?>\r\n\t\t\t\t\t\t\t\t<\/tbody>\r\n\t\t\t\t\t\t\t<\/table>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<input name=\"page\" value=\"1\" type=\"hidden\">\r\n\t\t\t\t\t\t<?php \\App\\Lib\\pager($page, $result['count'],$limit); ?>\r\n\t\t\t\t\t<\/form>\r\n\t\t\t\t<\/div>\r\n    \t\t<\/div>\r\n\t\t<\/div>\r\n     <\/div>\r\n     <script>\r\n     function submitCheck(){\r\n     \tif($('input[name=\"startMonth\"]').val() == \"\"){\r\n     \t\tUIkit.modal.alert('日付検索の開始日は必須です');\r\n     \t\treturn false;\r\n     \t}\r\n     \treturn true;\r\n     }\r\n     \r\n     function pageSubmit(page){\r\n     \t$('input[name=\"page\"]').val(page);\r\n     \tdocument.myform.submit();\r\n     }\r\n     \r\n\tfunction exportCSV(records) {\r\n\t\tlet data = records.map((record)=>record.join('\\t')).join('\\r\\n');\r\n\t\t\r\n\t\tlet bom  = new Uint8Array([0xEF, 0xBB, 0xBF]);\r\n\t\tlet blob = new Blob([bom, data], {type: 'text/tab-separated-values'});\r\n\t\tlet url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n\t\tlet link = document.createElement('a');\r\n\t\tlink.download = 'receivingMonthlyReport_<?php echo date('Ymd') ?>.tsv';\r\n\t\tlink.href = url;\r\n\t\tdocument.body.appendChild(link);\r\n\t\tlink.click();\r\n\t\tdocument.body.removeChild(link);\r\n\t};\r\n\t\r\n\tfunction listDl(){\r\n\t\tlet records = <?php echo json_encode($result['data']) ?>;\r\n\t\tlet result = [];\r\n\t\tfor(let i = 0 ; i < records.length ; i++){\r\n\t\t\tresult[i] = [];\r\n\t\t\tObject.keys(records[i]).forEach(function (key) {\r\n\t\t\t\tresult[i].push(records[i][key]);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tresult.unshift(['id','inHospitalItemId','makerName','itemName','itemCode','itemStandard','price','receivingCount','totalAmount','itemUnit','distributorName']);\r\n\t\r\n\t\texportCSV(result);\r\n\t}\r\n     <\/script>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39943",
   "name": "ReturnHistoryList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 返品一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>返品一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">返品一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search82:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39944",
   "name": "ReturnSlip",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetReturnData.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"NJ_ReturnHDB\",$SPIRAL->getCardId(),\"returnHistoryID\",\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][1] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$getReturnData = new App\\Api\\GetReturnData($spiralDataBase,$userInfo);\r\n\r\n$returnItem = $getReturnData->select($card[\"data\"][0][0]);\r\n//$receivingData = $spiralDataBase->arrayToNameArray($receiptItem[\"data\"],array(\"id\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"quantity\",\"quantityUnit\",\"itemUnit\",\"itemJANCode\",\"orderQuantity\",\"receivingCount\",\"orderCNumber\",\"inHospitalItemId\"));\r\n$returnItem = $returnItem[\"data\"];\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266910%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 返品伝票<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>返品一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>返品伝票<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">返　品　伝　票<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td>\r\n\t\t    \t\t\t\t\t\t返品合計金額\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t\t<td>\r\n\t\t    \t\t\t\t\t\t￥-<script>price(fixed(\"%val:usr:returnTotalPrice%\"));<\/script>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>返品日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:registrationTime%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>返品番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:returnHistoryID%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:orderHistoryId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t\t\t\t\t\t<div id=\"return_barcode\" class=\"uk-text-center\">\r\n\t\t\t\t\t\t\t\t<span id=\"return_num\">%val:usr:returnHistoryID%<\/span>\r\n\t\t\t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>返品数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>返品金額<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($returnItem as $record){\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"returnCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>￥<script>price(fixed(\".$record[\"returnPrice\"].\"));<\/script><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\t$(function(){\r\n\t\t let return_num = $(\"#return_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#return_barcode\").html(\"<svg id='barcode_return'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_return\",return_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39945",
   "name": "ReturnSlipEntry",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemReceipt.php\";\r\n\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"receiptHDB\",$SPIRAL->getCardId(),\"receivingHId\",\"authKey\",\"orderAuthKey\",\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][3] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$getItemReceipt = new App\\Api\\GetItemReceipt($spiralDataBase,$userInfo);\r\n\r\n$receiptItem = $getItemReceipt->getItemReceipt($card[\"data\"][0][0]);\r\n//$receivingData = $spiralDataBase->arrayToNameArray($receiptItem[\"data\"],array(\"id\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"quantity\",\"quantityUnit\",\"itemUnit\",\"itemJANCode\",\"orderQuantity\",\"receivingCount\",\"orderCNumber\",\"inHospitalItemId\"));\r\n$receivingData = $receiptItem[\"data\"];\r\n\r\nforeach($receivingData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"receivingCount\"=> $record[\"receivingCount\"],\r\n\t\t\"quantity\"=> $record[\"quantity\"],\r\n\t\t\"orderCNumber\" => $record[\"orderCNumber\"],\r\n\t\t\"makerName\" => $record[\"makerName\"],\r\n\t\t\"itemName\" => $record[\"itemName\"],\r\n\t\t\"itemCode\" => $record[\"itemCode\"],\r\n\t\t\"itemStandard\" => $record[\"itemStandard\"],\r\n\t\t\"quantityUnit\" => $record[\"quantityUnit\"],\r\n\t\t\"itemUnit\" => $record[\"itemUnit\"],\r\n\t\t\"itemJANCode\" => $record[\"itemJANCode\"],\r\n\t\t\"orderQuantity\" => $record[\"orderQuantity\"],\r\n\t\t\"receivingNumber\" => $record[\"receivingNumber\"],\r\n\t\t\"totalReturnCount\" => $record[\"totalReturnCount\"],\r\n\t\t\"price\" => $record[\"price\"],\r\n\t\t\"returnCount\" => 0,\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][1], \"JoyPla\");\r\n$orderAuthKey = $crypt->encrypt($card[\"data\"][0][2], \"JoyPla\");\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266908%';\r\n} \r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 返品伝票入力<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>検収書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/card:page_266892%\"><span>検収書<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>返品伝票入力<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"返品伝票登録\" onclick=\"returnReg();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">返　品　伝　票　入　力<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:registrationTime%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:orderHistoryId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>返品数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>今回返品数<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($receivingData as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t$max = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tif($record[\"receivingCount\"] == ''){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$record[\"receivingCount\"] = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif($record[\"totalReturnCount\"] == ''){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$record[\"totalReturnCount\"] = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(((int)$record[\"receivingCount\"] - (int)$record[\"totalReturnCount\"]) > 0){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$max = (int)$record[\"receivingCount\"] - (int)$record[\"totalReturnCount\"];\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"totalReturnCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td><input type='number' step='1' class='uk-input' style='width:100px' id='hp_\".$record[\"inHospitalItemId\"].\"' min='0' max='\".$max.\"' value='0' onchange='returnCount(this,\\\"\".$record[\"inHospitalItemId\"].\"\\\")'><span class='uk-text-small uk-text-middle'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n    \tlet canAjax = true;\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\tfunction returnReg(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet errflag = false;\r\n\t\t\tlet checked = false;\r\n\t\t\tObject.keys(itemsToJs).forEach(function (inhpkey) {\r\n\t\t\t\tif(!checked){\r\n\t\t\t\t\tif(parseInt(itemsToJs[inhpkey].returnCount) <= 0){\r\n\t\t\t\t\t\terrflag = true;\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrflag = false;\r\n\t\t\t\t\t\tchecked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(errflag){\r\n\t\t\t\tUIkit.modal.alert(\"返品対象がありません\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\terrflag = false;\r\n\t\t\tObject.keys(itemsToJs).forEach(function (inhpkey) {\r\n\t\t\t\tif(parseInt(itemsToJs[inhpkey].receivingCount) < parseInt(itemsToJs[inhpkey].returnCount)){\r\n\t\t\t\t\terrflag = true;\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(errflag){\r\n\t\t\t\tUIkit.modal.alert(\"返品数が入庫数を超えています\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUIkit.modal.confirm(\"返品を行います。<br>よろしいですか\").then(function () {\r\n\t\t\t\tUIkit.modal.alert(\"注意:卸業者へのご連絡はシステムでは行いません。\").then(function(){\r\n\t\t\t\t\tloading();\r\n\t\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\tasync: false,\r\n\t\t\t\t\t\turl:\"%url/rel:@mpgt:regReturn%\",\r\n\t\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\t\tdata:{\r\n\t\t\t\t\t\t\treceivingHistoryId : \"%val:usr:receivingHId%\",\r\n\t\t\t\t\t\t\tdistributorId: \"%val:usr:distributorId%\",\r\n\t\t\t\t\t\t\treturnData : JSON.stringify( itemsToJs ),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録が完了しました\").then(function(){\r\n\t\t\t\t\t\t\tlocation.href =\"%url/card:page_263469%\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t\t.always( (data) => {\r\n\t\t\t\t\t\tloading_remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction returnCount(elm,inHpItemId){\r\n\t\t\titemsToJs[inHpItemId].returnCount = elm.value;\r\n\t\t\t$('#hp_'+inHpItemId).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"100px\"});\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39946",
   "name": "ReturnSlipEntryByProduct",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetItemReceipt.php\";\r\ninclude_once \"NewJoyPla/api/GetReceivingHistory.php\";\r\n\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/api/GetDivision.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\nif($userInfo->getUserPermission() != \"1\"){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"receivingdata\",$SPIRAL->getCardId(),\"receivingHId\");\r\n\r\n$getReceivingHistory = new App\\Api\\GetReceivingHistory($spiralDataBase,$userInfo);\r\n\r\n$receivingHistory = $getReceivingHistory->select($card[\"data\"][0][0]);\r\n//$receivingHistory = $spiralDataBase->arrayToNameArray($receivingHistory[\"data\"],array(\"registrationTime\",\"distributorName\",\"orderHistoryId\",\"hospitalName\",\"postalCode\",\"prefectures\",\"address\",\"phoneNumber\",\"ordererUserName\",\"authKey\",\"orderAuthKey\"));\r\n$receivingHistory  = $receivingHistory[\"data\"];\r\n\r\n$getItemReceipt = new App\\Api\\GetItemReceipt($spiralDataBase,$userInfo);\r\n\r\n$receiptItem = $getItemReceipt->getItemReceipt($card[\"data\"][0][0]);\r\n$receivingData = $receiptItem[\"data\"];\r\n\r\n$ItemsToJs = array();\r\nforeach($receivingData as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"receivingCount\"=> $record[\"receivingCount\"],\r\n\t\t\"quantity\"=> $record[\"quantity\"],\r\n\t\t\"orderCNumber\" => $record[\"orderCNumber\"],\r\n\t\t\"makerName\" => $record[\"makerName\"],\r\n\t\t\"itemName\" => $record[\"itemName\"],\r\n\t\t\"itemCode\" => $record[\"itemCode\"],\r\n\t\t\"itemStandard\" => $record[\"itemStandard\"],\r\n\t\t\"quantityUnit\" => $record[\"quantityUnit\"],\r\n\t\t\"itemUnit\" => $record[\"itemUnit\"],\r\n\t\t\"itemJANCode\" => $record[\"itemJANCode\"],\r\n\t\t\"orderQuantity\" => $record[\"orderQuantity\"],\r\n\t\t\"receivingNumber\" => $record[\"receivingNumber\"],\r\n\t\t\"totalReturnCount\" => $record[\"totalReturnCount\"],\r\n\t\t\"price\" => $record[\"price\"],\r\n\t\t\"returnCount\" => 0,\r\n\t\t);\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n\r\nif($receivingHistory[0][\"authKey\"] != \"\"){\r\n\t$authKeyCrypt = $crypt->encrypt($receivingHistory[0][\"authKey\"], \"JoyPla\");\r\n}\r\nif($receivingHistory[0][\"orderAuthKey\"] != \"\"){\r\n\t$orderAuthKey = $crypt->encrypt($receivingHistory[0][\"orderAuthKey\"], \"JoyPla\");\r\n}\r\n\r\n$getDivision = new App\\Api\\GetDivision($spiralDataBase,$userInfo);\r\n$divisionData = $getDivision->select($receivingHistory[0][\"divisionId\"]);\r\n\r\n$divisionName = \"\";\r\nforeach($divisionData[\"store\"] as $record ){\r\n\t$divisionName = $record[3];\r\n}\r\nforeach($divisionData[\"division\"] as $record ){\r\n\t$divisionName = $record[3];\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 返品伝票入力<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%&table_cache=true\"><span>商品別照合一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/card:page_263496%\"><span>検収書<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>返品伝票入力<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"submit\" value=\"返品伝票登録\" onclick=\"returnReg();return false;\">\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">返　品　伝　票　入　力<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b><?php echo $receivingHistory[0][\"distributorName\"] ?> 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td><?php echo $receivingHistory[0][\"registrationTime\"] ?><\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>検収番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:receivingHId%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td><?php echo $receivingHistory[0][\"orderHistoryId\"] ?><\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span><?php echo $receivingHistory[0][\"hospitalName\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒<?php echo $receivingHistory[0][\"postalCode\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span><?php echo $receivingHistory[0][\"prefectures\"] ?> <?php echo $receivingHistory[0][\"address\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：<?php echo $receivingHistory[0][\"phoneNumber\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：<?php echo $receivingHistory[0][\"ordererUserName\"] ?><\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：<?php echo $divisionName ?><\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>発注数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入庫数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>返品数<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>今回返品数<\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t    \t\t\t\t\t$num = 1;\r\n\t\t\t\t    \t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tforeach($receivingData as $record){\r\n\t\t\t\t\t\t\t\t\t\t\t$max = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tif($record[\"receivingCount\"] == ''){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$record[\"receivingCount\"] = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif($record[\"totalReturnCount\"] == ''){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$record[\"totalReturnCount\"] = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif(((int)$record[\"receivingCount\"] - (int)$record[\"totalReturnCount\"]) > 0){\r\n\t\t\t\t\t\t\t\t\t\t\t\t$max = (int)$record[\"receivingCount\"] - (int)$record[\"totalReturnCount\"];\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].$record[\"quantityUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"orderQuantity\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"receivingCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"totalReturnCount\"].$record[\"itemUnit\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td><input type='number' step='1' class='uk-input' style='width:100px' id='hp_\".$record[\"inHospitalItemId\"].\"' min='0' max='\".$max.\"' value='0' onchange='returnCount(this,\\\"\".$record[\"inHospitalItemId\"].\"\\\")'><span class='uk-text-small uk-text-middle'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    \t\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tlet canAjax = true;\r\n\t\t$(function(){\r\n\t\t let nouhin_num = $(\"#nouhin_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#nouhin_barcode\").html(\"<svg id='barcode_nouhin'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_nouhin\",nouhin_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n    \t\r\n\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\tfunction returnReg(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet errflag = false;\r\n\t\t\tlet checked = false;\r\n\t\t\tObject.keys(itemsToJs).forEach(function (inhpkey) {\r\n\t\t\t\tif(!checked){\r\n\t\t\t\t\tif(parseInt(itemsToJs[inhpkey].returnCount) <= 0){\r\n\t\t\t\t\t\terrflag = true;\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrflag = false;\r\n\t\t\t\t\t\tchecked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(errflag){\r\n\t\t\t\tUIkit.modal.alert(\"返品対象がありません\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\terrflag = false;\r\n\t\t\tObject.keys(itemsToJs).forEach(function (inhpkey) {\r\n\t\t\t\tif(parseInt(itemsToJs[inhpkey].receivingCount) < parseInt(itemsToJs[inhpkey].returnCount)){\r\n\t\t\t\t\terrflag = true;\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(errflag){\r\n\t\t\t\tUIkit.modal.alert(\"返品数が入庫数を超えています\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUIkit.modal.confirm(\"返品を行います。<br>よろしいですか\").then(function () {\r\n\t\t\t\tUIkit.modal.alert(\"注意:卸業者へのご連絡はシステムでは行いません。\").then(function(){\r\n\t\t\t\t\tloading();\r\n\t\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\tasync: false,\r\n\t\t\t\t\t\turl:\"%url/rel:@mpgt:regReturn%\",\r\n\t\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\t\tdata:{\r\n\t\t\t\t\t\t\treceivingHistoryId : \"%val:usr:receivingHId%\",\r\n\t\t\t\t\t\t\tdistributorId: \"<?php echo $receivingHistory[0][\"distributorId\"] ?>\",\r\n\t\t\t\t\t\t\treturnData : JSON.stringify( itemsToJs ),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録が完了しました\").then(function(){\r\n\t\t\t\t\t\t\tlocation.href =\"%url/card:page_263496%\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tUIkit.modal.alert(\"返品伝票登録に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t\t.always( (data) => {\r\n\t\t\t\t\t\tloading_remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction createLabel(){\r\n\t\t\t$(\"#itemsData\").val(JSON.stringify( itemsToJs ));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction returnCount(elm,inHpItemId){\r\n\t\t\titemsToJs[inHpItemId].returnCount = elm.value;\r\n\t\t\t$('#hp_'+inHpItemId).css({\"color\":\"rgb(68, 68, 68)\", \"background-color\":\"rgb(255, 204, 153)\", \"width\":\"100px\"});\r\n\t\t}\r\n\t<\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39947",
   "name": "SystemNotificationDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla システム通知詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%\">システム通知一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>システム通知詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<hr>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-2-3@m\">\r\n\t\t    \t\t<article class=\"uk-article uk-margin-bottom\">\r\n\r\n\t\t\t\t\t    <h1 class=\"uk-article-title\">%val:usr:title%<\/h1>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"uk-article-meta\">作成者 %val:usr:creator%<\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"\">%val:usr:content:br%<\/p>\r\n\t\t\t\t\t\t<div class=\"uk-grid-small uk-child-width-auto uk-grid\" uk-grid>\r\n\t\t\t\t\t\t\t\t<div class=\"uk-width-1-2 uk-first-column\">\r\n\t\t\t\t\t\t    \t\t%val:usr:registrationTime%\r\n\t\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t<\/article>\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39948",
   "name": "SystemNotificationList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla システム通知一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>システム通知一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class=\"uk-width-1-1\" uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m\">\r\n\t\t    \t\t\t<h2>システム通知一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-4-5@m\">\r\n\t\t\t\t%sf:usr:search91:table%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39949",
   "name": "TopicDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "\r\n<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"topicsDB\",$SPIRAL->getCardId(),\"topicId\",\"authKey\");\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][1], \"JoyPla\");\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla トピック詳細<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"%url/table:back%\">トピック一覧<\/a><\/li>\r\n\t\t\t\t    <li><span>トピック詳細<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-2-3@m\">\r\n\t\t    \t\t<article class=\"uk-article\">\r\n\r\n\t\t\t\t\t    <h1 class=\"uk-article-title\">%val:usr:topicTitle%<\/h1>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"uk-article-meta\">\r\n\t\t\t\t\t    \t作成者 %val:usr:topicName% <br>\r\n\t\t\t\t\t    \t病院：%val:usr:hospitalName%<br>\r\n\t\t\t\t\t    \t卸業者：%val:usr:distributorName%\r\n\t\t\t\t\t    <\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t    <p class=\"uk-text-lead\">%val:usr:topicContent:br%<\/p>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"uk-grid-small uk-child-width-auto\" uk-grid>\r\n\t\t\t\t\t\t\t<div class=\"uk-width-1-2\">\r\n\t\t\t\t\t    \t\t%val:usr:registrationTime%\r\n\t\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t        <div class=\"uk-width-1-2 uk-text-right\">\r\n\t\t\t\t\t            %val:usr:commentCount% Comments\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t<\/article>\r\n\t\t    \t\t<hr>\r\n\t\t\t        %sf:usr:search89:mstfilter:table%\r\n\t\t    \t\t<hr>\r\n\t\t\t        <form onsubmit=\"return false;\">\r\n\t\t\t        \t<legend class=\"uk-legend\">コメント<\/legend>\r\n\t\t\t        \t<div class=\"uk-margin\">\r\n\t\t\t\t\t        <label class=\"uk-form-label\" for=\"form-stacked-text\">氏名<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t        \t\t\t<input type=\"text\" class=\"uk-input\" name=\"name\" value=\"%val:@usr:name%\" readonly>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t        \t<div class=\"uk-margin\">\r\n\t\t\t\t\t        <label class=\"uk-form-label\" for=\"form-stacked-text\">コメント<\/label>\r\n\t\t\t\t\t        <div class=\"uk-form-controls\">\r\n\t\t\t        \t\t\t<textarea class=\"uk-textarea\" rows=\"15\" name=\"comment\" maxlength=\"2000\"><\/textarea>\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t        <span class=\"uk-text-meta\">※2000文字以内で入力してください<\/span>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t\t\t    \r\n\t\t\t        \t<div class=\"uk-margin\">\r\n\t\t\t\t\t        <div class=\"uk-form-controls uk-text-center\">\r\n\t\t\t        \t\t\t<input type=\"submit\" class=\"uk-button uk-button-primary\" value=\"コメントを送信\" onclick=\"regComment()\">\r\n\t\t\t\t\t        <\/div>\r\n\t\t\t\t\t    <\/div>\r\n\t\t\t        <\/form>\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tlet canAjax = true;\r\n\t\t$(function(){\r\n\t\t\tlet length = $(\".uk-comment-list.comment-table\").children().length;\r\n\t\t\tif(length == 0 ){\r\n\t\t\t\t$(\".uk-comment-list.comment-table\").html(\"<li class='uk-text-center uk-text-bold'><p>コメントはありません<\/p><\/li>\");\r\n\t\t\t\t$(\".uk-pagination\").hide();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tfunction regComment(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet comment = $(\"textarea[name='comment']\").val();\r\n\t\t\tlet name = $(\"input[name='name']\").val();\r\n\t\t\t\r\n\t\t\tif(comment == \"\"){\r\n\t\t\t\t$(\"textarea[name='comment']\").addClass(\"uk-form-danger\");\r\n\t\t\t\tUIkit.modal.alert(\"コメントが空欄です。\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(name == \"\"){\r\n\t\t\t\t$(\"input[name='name']\").addClass(\"uk-form-danger\");\r\n\t\t\t\tUIkit.modal.alert(\"氏名が空欄です。\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tloading();\r\n\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t$.ajax({\r\n\t\t\t\tasync: false,\r\n                url:\"%url/card:page_266362%\",\r\n                type:\"POST\",\r\n                data:{\r\n                \ttopicId : \"%val:usr:topicId%\",\r\n                \tauthKey: \"<?php echo $authKeyCrypt ?>\",\r\n                \tcommentData : JSON.stringify( objectValueToURIencode({\"comment\":comment,\"name\":name}) ),\r\n                },\r\n                dataType: \"json\"\r\n            })\r\n            // Ajaxリクエストが成功した時発動\r\n            .done( (data) => {\r\n            \t\r\n                if(! data.result){\r\n            \t\tUIkit.modal.alert(\"コメントに失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n            \t\treturn false;\r\n                }\r\n                UIkit.modal.alert(\"コメントが完了しました\").then(function(){\r\n\t\t\t\t\tlocation.reload(true);\r\n\t\t\t\t});\r\n                \r\n            })\r\n            // Ajaxリクエストが失敗した時発動\r\n            .fail( (data) => {\r\n        \t\tUIkit.modal.alert(\"コメントに失敗しました\").then(function(){\r\n\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t});\r\n        \t\treturn false;\r\n            })\r\n            // Ajaxリクエストが成功・失敗どちらでも発動\r\n            .always( (data) => {\r\n            \tloading_remove();\r\n            });\r\n\t\t}\r\n\t\t\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39950",
   "name": "TopicList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\nif($SPIRAL->getContextByFieldTitle(\"distributorId\") != ''){\r\n\tinclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\n\tinclude_once \"NewJoyPla/lib/Define.php\";\r\n\tinclude_once \"NewJoyPla/lib/UserInfo.php\";\r\n\tinclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\n\tinclude_once \"NewJoyPla/lib/Func.php\";\r\n\tinclude_once \"NewJoyPla/api/GetDistributor.php\";\r\n\t$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\t$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n\t$spiralApiRequest = new SpiralApiRequest();\r\n\t$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\t$getDistributor = new App\\Api\\GetDistributor($spiralDataBase,$userInfo);\r\n\t\r\n\t$getMyDistributorData = $getDistributor->getMyDistributor($SPIRAL->getContextByFieldTitle(\"distributorId\"));\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla トピック一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>トピック一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<div class='uk-width-1-1' uk-grid>\r\n\t\t    \t\t<div class=\"uk-width-3-4@m\">\r\n\t\t    \t\t\t<h2>トピック一覧<\/h2>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t\t<div class=\"uk-width-1-4@m uk-text-right@m\">\r\n\t\t    \t\t\t<?php if($SPIRAL->getContextByFieldTitle(\"distributorId\") != ''): ?>\r\n\t\t    \t\t\t<a href=\"#\" class=\"uk-button uk-button-primary\" onclick=\"document.form.submit()\">トピック作成<\/a>\r\n\t\t    \t\t\t<form method=\"post\" action=\"/regist/is\" name=\"form\" target=\"_blank\">\r\n\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:topicReg%\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\" >\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorId\" value=\"%val:usr:distributorId%\" >\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"topicName\" value=\"%val:usr:name%\" >\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"distributorName\" value=\"<?php echo $getMyDistributorData['data'][0][0] ?>\" >\r\n\t\t\t\t\t\t<\/form>\r\n\t\t    \t\t\t<?php else: ?>\r\n\t\t    \t\t\t<a href=\"%url/rel:mpgt:page_266351%\" class=\"uk-button uk-button-primary\" target=\"_blank\">トピック作成<\/a>\r\n\t\t    \t\t\t<?php endif ?>\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<hr>\r\n\t\t    \t<div uk-grid=\"\" uk-margin=\"\" class=\"uk-grid uk-grid-stack\">\r\n\t\t\t\t\t<div class=\"uk-width-1-1 uk-grid-margin uk-first-column uk-margin-small-top\">\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-margin-auto uk-width-4-5@m\">\r\n\t\t\t\t%sf:usr:search88:table%\r\n\t\t\t\t<\/div>\r\n\t\t\t<\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39951",
   "name": "UnorderedList",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 未発注書一覧<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>未発注書一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">未発注書一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:unorderedSlip:mstfilter%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39952",
   "name": "UnorderedSlipDetail",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once \"NewJoyPla/lib/Define.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\ninclude_once \"NewJoyPla/lib/SpiralDataBase.php\";\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/api/UpdateUnordered.php\";\r\ninclude_once \"NewJoyPla/api/GetCardInfo.php\";\r\ninclude_once \"NewJoyPla/api/GetOrderItems.php\";\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$cardInfo = new App\\Api\\GetCardInfo($spiralDataBase);\r\n$card = $cardInfo->select(\"orderdataDB\",$SPIRAL->getCardId(),\"orderNumber\",\"orderStatus\",\"orderAuthKey\",\"divisionId\");\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $card[\"data\"][0][3] != $userInfo->getDivisionId()){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n$getOrderItems = new App\\Api\\GetOrderItems($spiralDataBase);\r\n$orderItems = $getOrderItems->select($card[\"data\"][0][0],\"orderNumber\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\",\"quantityUnit\",\"itemUnit\",\"orderCNumber\",\"inHospitalItemId\");\r\n$orderItems = $spiralDataBase->arrayToNameArray($orderItems[\"data\"],array(\"orderNumber\",\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\",\"quantityUnit\",\"itemUnit\",\"orderCNumber\",\"inHospitalItemId\"));\r\n\r\n//,\"makerName\",\"itemName\",\"itemCode\",\"itemStandard\",\"price\",\"quantity\",\"orderQuantity\",\"orderPrice\",\"itemJANCode\"\r\n\r\n$updateUnordered = new App\\Api\\UpdateUnordered($spiralDataBase);\r\n$result = $updateUnordered->update($card[\"data\"][0][0]);\r\n\r\n$ItemsToJs = array();\r\nforeach($orderItems as $record){\r\n\t$ItemsToJs[$record[\"inHospitalItemId\"]] = array(\r\n\t\t\"countNum\"=> $record[\"orderQuantity\"],\r\n\t\t\"quantity\" => $record[\"quantity\"]\r\n\t\t);\r\n\t\r\n}\r\n\r\n$crypt   = $SPIRAL->getSpiralCryptOpenSsl();\r\n$authKeyCrypt = $crypt->encrypt($card[\"data\"][0][2], \"JoyPla\");\r\n\r\n\r\nif($userInfo->getUserPermission() == \"1\"){\r\n\t$link = '%url/table:back%';\r\n}else{\r\n\t$link = '%url/rel:mpgt:page_266849%';\r\n} \r\n?> \r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 未発注書<\/title>\r\n\t<?php include_once \"NewJoyPla/src/Head.php\"; ?>\r\n  <\/head>\r\n\r\n  <body>\r\n\r\n\t<?php if($result[\"pattern\"] == \"delete\" || $card[\"data\"][0][1] == \"2\"){ ?>\r\n\t\t<script>\r\n\t\t\tUIkit.modal.alert(\"発注商品が0件となりました。<br>未発注書一覧へ戻ります。\").then(function(){\r\n\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t});\r\n\t\t<\/script>\r\n\t<?php exit; } ?>\r\n\r\n\r\n    <?php include_once \"NewJoyPla/src/HeaderForMypage.php\"; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t\t<li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><a href=\"<?php echo $link ?>&table_cache=true\"><span>未発注書一覧<\/span><\/a><\/li>\r\n\t\t\t\t    <li><span>未発注書<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t\t\t<div class=\"no_print uk-margin\" uk-margin>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-default uk-margin-small-top\" type=\"submit\" value=\"印刷プレビュー\" onclick=\"window.print();return false;\">\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-danger uk-margin-small-top\" type=\"submit\" value=\"発注伝票取消\" onclick=\"orderedDelete();return false;\">\r\n\t\t\t\t\t<?php if($userInfo->getUserPermission() == \"1\"): ?>\r\n\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary uk-margin-small-top\" type=\"submit\" id=\"orderFixButton\" value=\"発注確定\" onclick=\"orderFix();return false;\">\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t<\/div>\r\n\t\t    \t<div class=\"uk-text-center uk-text-large\">\r\n\t\t    \t\t<p class=\"uk-text-bold\" style=\"font-size: 32px\">（ 未 ）発　　注　　書<\/p>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div uk-grid>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-width-2-3@m uk-table-divider\">\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">\r\n\t\t    \t\t\t\t\t\t<b>%val:usr:distributorName% 御中<\/b>\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t\t<tr class=\"uk-text-large\">\r\n\t\t    \t\t\t\t\t<td>合計金額<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-text-right\">￥<script>price(\"%val:usr:totalAmount%\")<\/script> - <\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/table>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    \t<div class=\"uk-width-1-2@m\">\r\n\t\t\t    \t\t<div class=\"uk-float-right uk-width-2-3@m\">\r\n\t\t\t    \t\t\t<table class=\"uk-table uk-width-1-1 uk-table-responsive uk-table-divider\">\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注日時<\/td>\r\n\t\t\t    \t\t\t\t\t<td> --- <\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t\t<tr>\r\n\t\t\t    \t\t\t\t\t<td>発注番号<\/td>\r\n\t\t\t    \t\t\t\t\t<td>%val:usr:orderNumber%<\/td>\r\n\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t    \t\t\t<\/table>\r\n\t\t    \t\t\t\t<div id=\"order_barcode\" class=\"uk-text-center\">\r\n\t    \t\t\t\t\t\t<span id=\"hacchu_num\">%val:usr:orderNumber%<\/span>\r\n\t    \t\t\t\t\t<\/div>\r\n\t\t    \t\t\t\t<div class=\"uk-text-left\">\r\n\t    \t\t\t\t\t\t<span>%val:usr:hospitalName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>〒%val:usr:postalCode%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>%val:usr:prefectures% %val:usr:address%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>電話番号：%val:usr:phoneNumber%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注担当者：%val:usr:ordererUserName%<\/span><br>\r\n\t    \t\t\t\t\t\t<span>発注部署：%val:usr:divisionName%<\/span><br>\r\n\t    \t\t\t\t\t<\/div>\r\n\t    \t\t\t\t<\/div>\r\n\t\t    \t\t\t<div class=\"uk-clearfix\"><\/div>\r\n\t\t\t    \t<\/div>\r\n\t\t\t    <\/div>\r\n\t\t    \t\r\n\t\t    \t<div class=\"uk-margin\" id=\"tablearea\">\r\n\t\t    \t\t<form>\r\n\t\t\t    \t\t<div class=\"no_print\">\r\n\t\t\t    \t\t\t<input class=\"print_hidden uk-button uk-button-primary\" type=\"button\" value=\"更新\" onclick=\"itemlistUpdate();return false;\">\r\n\t\t\t    \t\t\t<input class=\"print_hidden uk-button uk-button-default\" type=\"reset\" value=\"リセット\">\r\n\t\t\t    \t\t\t<input class=\"print_hidden uk-button uk-button-danger\" type=\"button\" value=\"削除\" onclick=\"itemlistDelete();return false;\">\r\n\t\t\t    \t\t<\/div>\r\n\t\t\t    \t\t<div class=\"uk-overflow-auto\">\r\n\t\t\t\t    \t\t<table class=\"uk-table uk-table-hover uk-table-middle uk-table-divider uk-text-nowrap\" id=\"tbl-Items\">\r\n\t\t\t\t    \t\t\t<thead>\r\n\t\t\t\t    \t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<th>NO<\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"no_print\"><input type=\"checkbox\" onclick=\"allItems(this.checked)\" class=\"uk-checkbox\"><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">メーカー<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px\">商品名<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>製品コード<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>規格<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>価格<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>入数<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th style=\"min-width:150px;max-width: 180px;\">数量<\/a><\/th>\r\n\t\t\t\t\t\t\t\t\t\t<th>金額<\/a><\/th>\r\n\t\t\t\t    \t\t\t\t<\/tr>\r\n\t\t\t\t    \t\t\t<\/thead>\r\n\t\t\t\t    \t\t\t<tbody>\r\n\t\t\t\t    \t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t\t\t$num = 1;\r\n\t\t\t\t\t\t\t\t\t\tforeach($orderItems as $record){\r\n\t  \t\t\t\t\t\t\t\t\t\t$barcodeId = \"01\".$record[\"inHospitalItemId\"].\"X\".$record[\"quantity\"];\r\n\t\t\t\t    \t\t\t\t\t\techo \"<tr>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$num.\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td class='no_print'><input type='checkbox' class='uk-checkbox itemsCheckBox' name='check\".$num.\"'><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"makerName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemName\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemCode\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"itemStandard\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>￥\".$record[\"price\"].\"<span class='uk-text-small'> / 1\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>\".$record[\"quantity\"].\"<span class='uk-text-small'>\".$record[\"quantityUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td><input type='number' step='1' class='uk-input' style='color:#444444;width:100px;' onchange='active(this,\".$num.\")' min='1' value='\".$record[\"orderQuantity\"].\"'><span class='uk-text-small uk-text-middle'>\".$record[\"itemUnit\"].\"<\/span><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td>￥<script>price('\".$record[\"orderPrice\"].\"')<\/script><\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<td style='display:none'>\".$record[\"orderCNumber\"].\"<\/td>\";\r\n\t\t\t\t    \t\t\t\t\t\techo \"<\/tr>\";\r\n\t\t\t\t    \t\t\t\t\t\t$num++;\r\n\t\t\t\t    \t\t\t\t\t}\r\n\t\t\t\t    \t\t\t\t?>\r\n\t\t\t\t    \t\t\t<\/tbody>\r\n\t\t\t\t    \t\t\t\r\n\t\t\t\t    \t\t<\/table>\r\n\t\t\t\t    \t<\/div>\r\n\t\t\t    \t\r\n\t\t    \t\t<\/form>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-width-3-4 uk-margin\">\r\n\t\t    \t\t<table class=\"uk-table uk-table-middle uk-table-divider\">\r\n\t\t    \t\t\t<thead>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td colspan=\"2\">備考<\/td>\r\n\t\t    \t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/thead>\r\n\t\t    \t\t\t<tbody>\r\n\t\t    \t\t\t\t<tr>\r\n\t\t    \t\t\t\t\t<td class=\"uk-width-1-5\">\r\n\t\t    \t\t\t\t\t    %val:usr:divisionName%\t\r\n\t\t    \t\t\t\t\t<\/td>\r\n\t\t    \t\t\t\t\t<td class=\"uk-width-4-5\">\r\n\t\t    \t\t\t\t\t\t<textarea class=\"uk-textarea uk-width-1-1\" rows=\"5\" name=\"ordercomment\" placeholder=\"コメント...\">%val:usr:ordercomment%<\/textarea>\r\n\t\t\t\t\t\t\t\t\t<input class=\"print_hidden uk-button uk-button-primary uk-align-center\" type=\"button\" value=\"コメントを更新\" onclick=\"commentUpdate();return false;\">\r\n\t\t\t\t\t\t\t\t<\/td>\r\n\t\t\t\t\t\t\t<\/tr>\r\n\t\t    \t\t\t<\/tbody>\r\n\t\t    \t\t<\/table>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n    <script>\r\n\t\tlet canAjax = true;\r\n    \tlet upToData = {};\r\n\t\t$(function(){\r\n\t\t \r\n\t\t let order_num = $(\"#hacchu_num\").text();\r\n\t\t //$(\"#hacchu_num\").remove();\r\n\t\t $(\"#order_barcode\").html(\"<svg id='barcode_hacchu'><\/svg>\");\r\n\t\t generateBarcode(\"barcode_hacchu\",order_num);\r\n\t\t //$(\"td#order_barcode div\").barcode({code:order_num, crc:false }, \"int25\",{barWidth: 3 ,barHeight: 40 , output: \"css\"});\r\n\t\t});\r\n\t\t\r\n    \t\r\n    \tfunction active(elm,num){\r\n    \t\telm.style.backgroundColor = \"rgb(255, 204, 153)\";\r\n    \t\t$(\"#tbl-Items tbody input[type='checkbox'][name='check\"+num+\"']\").prop(\"checked\", true);\r\n    \t\t$(\"#orderFixButton\").prop(\"disabled\", true);\r\n    \t}\r\n    \t\r\n    \tfunction allItems(checked){\r\n    \t\t$(\"#tbl-Items tbody input[type='checkbox']\").prop(\"checked\", checked);\r\n    \t}\r\n\t\t\r\n\t\tfunction itemlistUpdate(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$(\"#tbl-Items tbody tr\").map(function () {\r\n\t\t\t\tlet td = $(this).children();\r\n\t\t\t\tif($(td[1]).children(\"input\")[0].checked ){\r\n\t\t\t\t\tupToData[$(td[10]).text()] = {\r\n\t\t\t\t\t\tnum: $(td[8]).children(\"input\").val(),\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete upToData[$(td[11]).text()] ;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(Object.keys(upToData).length == 0){\r\n\t\t\t\tUIkit.modal.alert(\"更新対象がありません\").then(function(){\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(Object.keys(upToData).length+\"件更新します。<br>よろしいですか\").then(function () {\r\n                loading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:\"%url/card:page_267235%\",\r\n\t                type:\"POST\",\r\n\t                data:{data:JSON.stringify(upToData)},\r\n\t                dataType: \"json\"\r\n\t\t        })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"更新に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t            \t\r\n\t        \t\tUIkit.modal.alert(\"更新が完了しました\").then(function(){\r\n\t        \t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t            })\r\n\t            .fail( (data) => {\r\n\t        \t\tUIkit.modal.alert(\"更新に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction itemlistDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$(\"#tbl-Items tbody tr\").map(function () {\r\n\t\t\t\tlet td = $(this).children();\r\n\t\t\t\tif($(td[1]).children(\"input\")[0].checked){\r\n\t\t\t\t\tupToData[$(td[10]).text()] = {\r\n\t\t\t\t\t\tnum: $(td[8]).children(\"input\").val(),\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete upToData[$(td[10]).text()] ;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(Object.keys(upToData).length == 0){\r\n\t\t\t\tUIkit.modal.alert(\"削除対象がありません\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(Object.keys(upToData).length+\"件削除します。<br>よろしいですか\").then(function () {\r\n                loading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:\"%url/card:page_267236%\",\r\n\t                type:\"POST\",\r\n\t                data:{data:JSON.stringify(upToData)},\r\n\t                dataType: \"json\"\r\n\t\t        })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"削除に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t            \t\r\n\t        \t\tUIkit.modal.alert(\"削除が完了しました\").then(function(){\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t            })\r\n\t            .fail( (data) => {\r\n\t        \t\tUIkit.modal.alert(\"削除に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction commentUpdate(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"コメントを更新します。<br>よろしいですか\").then(function () {\r\n            \tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:\"%url/card:page_162483%\",\r\n\t                type:\"POST\",\r\n\t                data:{\r\n                \t\torderAuthKey: \"<?php echo $authKeyCrypt ?>\" ,\r\n\t                \tordercomment: encodeURI($(\"textarea[name='ordercomment']\").val()),\r\n\t                },\r\n\t                dataType: \"json\"\r\n\t\t        })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"コメントに失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t        \t\tUIkit.modal.alert(\"コメントを更新しました\").then(function(){\r\n\t\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t});\r\n\t            })\r\n\t            .fail( (data) => {\r\n\t        \t\tUIkit.modal.alert(\"コメントの更新に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t<?php if($userInfo->getUserPermission() == \"1\"): ?>\r\n\t\tfunction orderFix(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\t\tUIkit.modal.confirm(\"発注を確定します。<br>よろしいですか\").then(function () {\r\n            \tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t                url:\"%url/card:page_267202%\",\r\n\t                type:\"POST\",\r\n\t                data:{\r\n                \t\torderAuthKey: \"<?php echo $authKeyCrypt ?>\" ,\r\n\t                \torder:JSON.stringify(itemsToJs),\r\n\t                \tordercomment: encodeURI($(\"textarea[name='ordercomment']\").val()),\r\n\t                },\r\n\t                dataType: \"json\"\r\n\t\t        })\r\n\t            // Ajaxリクエストが成功した時発動\r\n\t            .done( (data) => {\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"発注書確定に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t        \t\tUIkit.modal.alert(\"発注を確定しました\").then(function(){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"一覧表へ戻ります\").then(function(){\r\n\t\t\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t            })\r\n\t            .fail( (data) => {\r\n\t        \t\tUIkit.modal.alert(\"発注に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\r\n\t        \t\treturn false;\r\n\t            })\r\n\t            // Ajaxリクエストが成功・失敗どちらでも発動\r\n\t            .always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t            });\r\n\t\t\t}, function () {\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n\t\t<?php endif; ?>\r\n\t\t\r\n\t\tfunction orderedDelete(){\r\n\t\t\tif(!canAjax) { \r\n\t\t\t\tconsole.log('通信中');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tUIkit.modal.confirm(\"発注書を削除します。<br>よろしいですか\").then(function () {\r\n\t\t\t\tlet itemsToJs = objectValueToURIencode( <?php echo json_encode($ItemsToJs); ?> );\r\n\t\t\t\tloading();\r\n\t\t\t\tcanAjax = false; // これからAjaxを使うので、新たなAjax処理が発生しないようにする\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\turl:\"%url/card:page_267227%\",\r\n\t\t\t\t\ttype:\"POST\",\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\torderAuthKey: \"<?php echo $authKeyCrypt ?>\" ,\r\n\t\t\t\t\t\torderData : JSON.stringify( objectValueToURIencode(itemsToJs) ),\r\n\t\t\t\t\t\tdivisionId : \"%val:usr:divisionId%\",\r\n\t\t\t\t\t\tcountFlg : null\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdataType: \"json\"\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功した時発動\r\n\t\t\t\t.done( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(! data.result){\r\n\t\t\t\t\t\tUIkit.modal.alert(\"発注書取消に失敗しました\").then(function(){\r\n\t\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tUIkit.modal.alert(\"発注書取消が完了しました\").then(function(){\r\n\t\t\t\t\t\tlocation.href =\"<?php echo $link ?>&table_cache=true\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが失敗した時発動\r\n\t\t\t\t.fail( (data) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tUIkit.modal.alert(\"伝票削除に失敗しました\").then(function(){\r\n\t\t\t\t\t\tcanAjax = true; // 再びAjaxできるようにする\r\n\t\t\t\t\t});\t\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t})\r\n\t\t\t\t// Ajaxリクエストが成功・失敗どちらでも発動\r\n\t\t\t\t.always( (data) => {\r\n\t\t\t\t\tloading_remove();\r\n\t\t\t\t});\r\n\t\t\t},function(){\r\n\t\t\t\tUIkit.modal.alert(\"中止します\");\r\n\t\t\t});\r\n\t\t}\r\n    <\/script>\r\n  <\/body>\r\n<\/html>"
  },
    {
   "id": "custom_module_mst39953",
   "name": "UserManagement",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once 'NewJoyPla/lib/ApiSpiral.php';\r\ninclude_once 'NewJoyPla/lib/UserInfo.php';\r\ninclude_once 'NewJoyPla/lib/SpiralDataBase.php';\r\ninclude_once 'NewJoyPla/api/GetHospitalData.php';\r\n\r\n$spiralApiCommunicator = $SPIRAL->getSpiralApiCommunicator();\r\n$spiralApiRequest = new SpiralApiRequest();\r\n$spiralDataBase = new App\\Lib\\SpiralDataBase($SPIRAL,$spiralApiCommunicator,$spiralApiRequest);\r\n\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n$getHospitalData = new App\\Api\\GetHospitalData($spiralDataBase,$userInfo);\r\n$hospitalData = $getHospitalData->select();\r\n$hospitalAuthKey = $hospitalData['data'][0]['authKey'];\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla ユーザー管理<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n<\/head>\r\n<body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb no_print\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>ユーザー管理<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t\t\t<h2 class=\"page_title uk-margin-remove\">ユーザー管理<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\">\r\n\t\t\t\t\t<div uk-grid uk-margin>\r\n\t\t\t\t\t\t<div class=\"uk-width-2-3@m\">\r\n\t\t\t\t\t\t\t<h3>病院ユーザー一覧<\/h3>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div class=\"uk-width-1-3@m uk-text-right@m\">\r\n\t\t\t\t\t\t\t<form action=\"/regist/is\" target=\"_blank\" method=\"post\">\r\n\t\t\t\t\t\t\t\t%SMPAREA%\r\n\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"SMPFORM\" value=\"%smpform:hpUserReg%\">\r\n\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalId\" value=\"%val:usr:hospitalId%\">\r\n\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"hospitalAuthKey\" value=\"<?php echo $hospitalAuthKey ?>\">\r\n\t\t\t\t\t\t\t\t<input type=\"submit\" value=\"病院ユーザー登録\" class=\"uk-button uk-button-primary\">\r\n\t\t\t\t\t\t\t<\/form>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div class=\"uk-margin\">\r\n\t\t\t\t\t\t%sf:usr:search78:table%\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    \t<div class=\"uk-margin\">\r\n\t\t    \t\t<div uk-grid uk-margin>\r\n\t\t\t\t\t\t<div class=\"uk-width-2-3@m\">\r\n\t\t\t\t\t\t\t<h3>卸業者ユーザー一覧<\/h3>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t\t<div class=\"uk-width-1-3@m uk-text-right@m\">\r\n\t\t\t\t\t\t\t<a href=\"%url/rel:mpgt:page_265118%\" class=\"uk-button uk-button-primary\">卸業者ユーザー登録<\/a>\r\n\t\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<\/div>\r\n\t\t\t\t\t<div class=\"uk-margin\">      \r\n\t\t\t\t\t\t%sf:usr:search79:table%\r\n\t\t\t\t\t<\/div>\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<script>\r\n\t\tfunction deleteHpUserCheck(url,loginId){\r\n\t\t\tlet myLoginId = \"<?php echo $userInfo->getLoginId() ?>\";\r\n\t\t\tif(myLoginId == loginId){\r\n\t\t\t\tUIkit.modal.alert(\"ログイン者自身を削除することはできません\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t\tfunction deleteOroshiUserCheck(url,loginId){\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>\r\n"
  },
    {
   "id": "custom_module_mst39954",
   "name": "VerificationListByProduct",
   "comment": "",
   "kind": "php",
   "parent_path": "/NewJoyPla/view/",
   "php_script": "<?php\r\ninclude_once \"NewJoyPla/lib/UserInfo.php\";\r\ninclude_once \"NewJoyPla/lib/Func.php\";\r\n$userInfo = new App\\Lib\\UserInfo($SPIRAL);\r\n\r\n$myPageID = '';\r\nif(isset($_POST['MyPageID']) && $_POST['MyPageID'] != '' ){\r\n\t$myPageID = $_POST['MyPageID'];\r\n}\r\n\r\nif($userInfo->getUserPermission() != \"1\" && $myPageID != ''){\r\n\tApp\\Lib\\viewNotPossible();\r\n\texit;\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>JoyPla 商品別照合一覧<\/title>\r\n\t<?php include_once 'NewJoyPla/src/Head.php'; ?>\r\n  <\/head>\r\n  <body>\r\n    <?php include_once 'NewJoyPla/src/HeaderForMypage.php'; ?>\r\n    <div class=\"animsition uk-margin-bottom\" uk-height-viewport=\"expand: true\">\r\n\t  \t<div class=\"uk-section uk-section-default uk-preserve-color uk-padding-remove uk-margin-top\" id=\"page_top\">\r\n\t\t    <div class=\"uk-container uk-container-expand\">\r\n\t\t    \t<ul class=\"uk-breadcrumb\">\r\n\t\t\t\t    <li><a href=\"%url/rel:mpg:top%\">TOP<\/a><\/li>\r\n\t\t\t\t    <li><span>商品別照合一覧<\/span><\/li>\r\n\t\t\t\t<\/ul>\r\n\t\t    \t<h2 class=\"page_title\">商品別照合一覧<\/h2>\r\n\t\t    \t<hr>\r\n\t\t    \t<div class=\"\" id=\"tablearea\">\r\n\t\t    \t\t%sf:usr:search11%\r\n\t\t    \t<\/div>\r\n\t\t    <\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n  <\/body>\r\n<\/html>\r\n"
  }
 ]
}