<?php
//<!-- SMP_DYNAMIC_PAGE DISPLAY_ERRORS=OFF NAME=form -->
?>
<!DOCTYPE html>
<html>
  <head>
 <?php include_once "NewJoyPla/src/Head.php"; ?>
    <title>JoyPla 院内商品情報追加 - 入力</title>
    <script>
     $(function(){
    getDistributor();
   })
   
  function distributor(elm){
    var idx = elm.selectedIndex;
    var text  = elm.options[idx].text;  // 表示テキスト
    $('input[name="distributorName"]').val(text);
  }
   function getDistributor(){
    $.ajax({
              url:'%url/rel:mpgt:getDistributor%',
              type:'POST',
              data:{
              },
              dataType: 'json'
          })
          // Ajaxリクエストが成功した時発動
          .done( (data) => {
           if(! data.result){
              alert("取得に失敗しました");
              return false;
            }
            makeDistributor(data.data,'distributorId','$distributorId$');
          })
          // Ajaxリクエストが失敗した時発動
          .fail( (data) => {
           console.log(data);
        alert("取得に失敗しました");
        return false;
          })
          // Ajaxリクエストが成功・失敗どちらでも発動
          .always( (data) => {
           console.log(data);
          });
   }
   
   function makeDistributor(data,tag,selectedval){
    option = '';
          for(let i = 0 ; i < data.length ; i++){
           selected = '';
           if(selectedval == data[i][1]){
            selected = 'selected';
            $('input[name="distributorName"]').val(data[i][0]);
           }
           option += '<option value='+data[i][1]+' '+selected+'>'+data[i][0]+'</option>';
          }
          $('#'+tag).append(option);
   }
    </script>
    <style>
     .uk-navbar-container{
      border-bottom : solid 2px #98CB00;
     }
     .bk-application-color{
      background : #98CB00;
     }
#mainPage{
    display: none;
}

dl.cf{
  padding-bottom: 20px;
  border-bottom: 1px solid #e5e5e5 !important;
}

    </style>
  </head>
  <body>
 <?php include_once "NewJoyPla/src/Header.php"; ?>
   <div class="uk-section uk-section-default uk-preserve-color uk-padding-remove">
     <div class="uk-container uk-container-expand" uk-height-viewport="expand: true">
<div class="uk-width-2-3@m uk-margin-auto uk-margin-remove-top uk-margin-bottom" id="mainPage">

                <!-- SMP_TEMPLATE_HEADER start -->
 <h1>院内商品情報追加 - 入力</h1>

 <!--SMP:DISP:REG:START-->
 <p class="header_rmesg">必要事項をご入力の上、確認ボタンを押してください。</p>
 <!--SMP:DISP:REG:END-->

 <!--SMP:DISP:ERR:START-->
 <p class="header_emesg">ご入力内容に不備がございます。エラーが発生した項目を修正し、送信しなおしてください。</p>
 <!--SMP:DISP:ERR:END-->
                <!-- SMP_TEMPLATE_HEADER end -->
               <!-- SMP_TEMPLATE_FORM start -->
 <form method="post" action="/regist/Reg2">
  <div class="smp_tmpl">
     <dl class="cf">
      <dt class="title">
       メーカー名
      </dt><dd class="data ">
       $makerName$ <br>       <span class="msg">$error:makerName$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       商品名
      </dt><dd class="data ">
       $itemName$ <br>       <span class="msg">$error:itemName$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       製品コード
      </dt><dd class="data ">
       $itemCode$ <br>       <span class="msg">$error:itemCode$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       規格
      </dt><dd class="data ">
       $itemStandard$ <br>       <span class="msg">$error:itemStandard$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       JANコード
      </dt><dd class="data ">
       $itemJANCode$ <br>       <span class="msg">$error:itemJANCode$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       不使用フラグ
      </dt><dd class="data multi2">
       <ul class="cf">
        <li><label><input class="input" type="checkbox" name="notUsedFlag" value="1" $notUsedFlag$><span>未使用</span></label></li>
       </ul>
       <input type="hidden" value="" name="notUsedFlag">
       <span class="msg">$error:notUsedFlag$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       卸業者ID <span class="need">必須</span>
      </dt><dd class="data ">
       <select name="distributorId" id="distributorId" class="uk-select $errorInputColor:distributorId$"  onchange="distributor(this);">
                      <option value=""> --- 選択してください --- </option>
                    </select>
       <br>
       <span class="msg">$error:distributorId$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       カタログNo
      </dt><dd class="data ">
       
       <input class="input $errorInputColor:catalogNo$" type="text" name="catalogNo" value="$catalogNo$" maxlength="128" >
       <br>
       <span class="msg">$error:catalogNo$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       シリアルNo
      </dt><dd class="data ">
       
       <input class="input $errorInputColor:serialNo$" type="text" name="serialNo" value="$serialNo$" maxlength="128" >
       <br>
       <span class="msg">$error:serialNo$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       入数 <span class="need">必須</span>
      </dt><dd class="data integer">
       
       <input class="input $errorInputColor:quantity$" type="text" name="quantity" value="$quantity$" maxlength="10" style="text-align: right;" >
       <br>
       <span class="msg">$error:quantity$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       入数単位
      </dt><dd class="data ">
       $quantityUnit$ <br>       <span class="msg">$error:quantityUnit$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       個数単位 <span class="need">必須</span>
      </dt><dd class="data ">
       
       <input class="input $errorInputColor:itemUnit$" type="text" name="itemUnit" value="$itemUnit$" maxlength="32" >
       <br>
       <span class="msg">$error:itemUnit$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       保険請求分類（医科）
      </dt><dd class="data ">
       <textarea class="$errorInputColor:medicineCategory$" name="medicineCategory" rows="4" wrap="soft" >$medicineCategory$</textarea><br>
       <span class="msg">$error:medicineCategory$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       保険請求分類（在宅）
      </dt><dd class="data ">
       <textarea class="$errorInputColor:homeCategory$" name="homeCategory" rows="4" wrap="soft" >$homeCategory$</textarea><br>
       <span class="msg">$error:homeCategory$</span>
      </dd>
     </dl>
     <dl class="cf">
      <dt class="title">
       特記事項
      </dt><dd class="data ">
       <textarea class="$errorInputColor:notice$" name="notice" rows="4" wrap="soft" >$notice$</textarea><br>
       <span class="msg">$error:notice$</span>
      </dd>
     </dl>
   </div>
  <input type="hidden" name="detect" value="判定">
  <!-- HIDDEN_PARAM START -->
  $form:hidden$<input type="hidden" name="makerName" value="$makerName$">
<input type="hidden" name="itemName" value="$itemName$">
<input type="hidden" name="itemCode" value="$itemCode$">
<input type="hidden" name="itemStandard" value="$itemStandard$">
<input type="hidden" name="itemJANCode" value="$itemJANCode$">
<input type="hidden" name="quantityUnit" value="$quantityUnit$">
<input type="hidden" name="hospitalId" value="$hospitalId$">
<input type="hidden" name="itemId" value="$itemId$">
<input type="hidden" name="minPrice" value="$minPrice$">
<input type="hidden" name="distributorName" value="">
  <!-- HIDDEN_PARAM END -->
  <input class="submit" type="submit" name="submit" value="確認">  
 </form>
<!-- SMP_TEMPLATE_FORM end -->
</div>
     </div>
 </div>
<script>
  $(function(){
    $("form").addClass("uk-form-horizontal uk-margin-large uk-text-center uk-margin-remove");

    $("table").addClass("uk-table");

    $("div.smp_tmpl").addClass("uk-text-left");

    $("input[type='text']").addClass("uk-input uk-width-expand");
    $("select").addClass("uk-select");
    $("input[type='checkbox']").addClass("uk-checkbox");
    $("input[type='checkbox']").addClass("uk-margin-small-right");


    $("input[type='submit']").addClass("uk-button uk-button-primary uk-margin-large-right uk-margin-large-left");
    $("input[type='reset']").addClass("uk-button uk-button-default");
    $("input[name='SMPFORM_BACK']").removeClass("uk-button-primary");
    $("input[name='SMPFORM_BACK']").addClass("uk-button-default");
    $("input").css('text-align','left');
    $("textarea").addClass("uk-textarea");

    $(".title").addClass("uk-form-label uk-margin-remove-top");
    $(".data").addClass("uk-form-controls");

    $(".header").addClass("uk-text-large");
    $(".need").addClass("uk-label uk-label-danger");

    $(".sample").addClass("uk-text-meta uk-text-small");
    $(".suffix").addClass("uk-text-meta uk-text-small uk-width-1-5");
    $(".caution").addClass("uk-text-meta uk-text-small");
    $(".caution").before("<br>");

    $("ul").addClass("uk-list uk-margin-remove");

    $(".error").addClass("uk-form-danger");
    $(".msg").addClass("uk-text-danger");
    $(".header_emesg").addClass("uk-alert-danger uk-alert");


    $("#mainPage").show();

  });
</script>
  </body>
</html>
